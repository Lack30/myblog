[{"categories":null,"content":"æš‚æ—¶ä¸ºç©º ","date":"2017-08-20","objectID":"/about/:0:0","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"æ•°æ®ç»“æ„å’Œç®—æ³•æ˜¯ç¼–ç¨‹çš„ä¸¤ä¸ªæ ¸å¿ƒéƒ¨åˆ†ã€‚ä¹‹å‰æˆ‘ä»¬ä»‹ç»äº†å‡ ç§å¸¸è§çš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯è¦è§£å†³å®é™…çš„é—®é¢˜å…‰æœ‰æ•°æ®ç»“æ„è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“å¤„ç†è¿™äº›æ•°æ®ç»“æ„çš„é¡ºåºå’Œæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ç®—æ³•ã€‚ ç®—æ³•æ˜¯ä¸€ä¸ªå¾ˆæŠ½è±¡çš„æ¦‚å¿µï¼Œå¤„ç†ä¸åŒçš„é—®é¢˜å¯èƒ½éœ€è¦ä¸åŒçš„ç®—æ³•æˆ–è€…æœ‰å¥½å‡ ç§ä¸åŒç®—æ³•å¯ä»¥å¤„ç†ç›¸åŒçš„é—®é¢˜ã€‚è™½ç„¶ç®—æ³•æœ‰æ— æ•°ä¸­ï¼Œä½†æ˜¯å†…åœ¨çš„æŒ‡å¯¼æ€æƒ³æ˜¯æœ‰é™çš„ã€‚æœ¬ç¯‡æˆ‘ä»¬å°±æ¥äº†è§£å‡ ç§å¸¸è§çš„ç®—æ³•æ€æƒ³ã€‚ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:0:0","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"ç©·ä¸¾ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:1:0","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å®šä¹‰ ç©·ä¸¾(ä¹Ÿç§°æšä¸¾) æ˜¯ä¸€ç§æœ€ç®€å•çš„ç®—æ³•æ€æƒ³ã€‚å®ƒçš„æ ¸å¿ƒæ˜¯å°†å¯èƒ½çš„è§£ä¸€ä¸€åˆ—ä¸¾å‡ºæ¥ï¼Œç„¶åæ ¹æ®æ¡ä»¶è¿›è¡ŒéªŒè¯ï¼Œå¾—åˆ°æœ€ç»ˆæ‰€æœ‰è§£ã€‚ ä½¿ç”¨ç©·ä¸¾ç®—æ³•è§£é¢˜çš„åŸºæœ¬æ€è·¯å¦‚ä¸‹ï¼š ç¡®å®šç©·ä¸¾å¯¹è±¡ã€ç©·ä¸¾èŒƒå›´å’Œåˆ¤æ–­æ¡ä»¶ã€‚ åˆ—ä¸¾å‡ºæ‰€æœ‰çš„è§£ï¼ŒéªŒè¯æ¯ä¸ªè§£æ˜¯å¦ç¬¦åˆæ¡ä»¶ã€‚ åŒæ—¶æˆ‘ä»¬ä¹Ÿè¦æ³¨æ„å‰”é™¤æ‰è®¸å¤šæ— æ•ˆè§£ï¼Œé¿å…è¦éªŒè¯çš„å¯èƒ½è§£è¿‡å¤šã€‚ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:1:1","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"è§£é¢˜ æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ç©·ä¸¾ç®—æ³•æ¥è§£ LeetCode-1534 é¢˜ã€‚ æˆ‘ä»¬æ ¹æ®é¢˜ç›®æ‰€ç»™å‡ºçš„ä¿¡æ¯å…ˆæ¥ç¡®å®šç©·ä¸¾èŒƒå›´å’Œåˆ¤æ–­æ¡ä»¶ã€‚é¢˜ç›®è¦æ±‚åˆ—ä¸¾å‡ºæ‰€æœ‰è§£ï¼Œæ‰€ä»¥ä½¿ç”¨ä¸‰é‡éå†é€‰å‡ºæ‰€æœ‰å¯èƒ½çš„å…ƒç»„ã€‚åˆå› ä¸ºæ¡ä»¶ 0 \u003c= i \u003c j \u003c k \u003c arr.lengthï¼Œå¯ä»¥ç¼©å° iã€jã€k çš„åˆå§‹èŒƒå›´ã€‚ 0 \u003c= i \u003c arr.length - 2 i + 1 \u003c= j \u003c arr.length - 1 j + 1 \u003c= k \u003c arr.length åœ¨æ ¹æ®æ¡ä»¶å¾—å‡ºæ‰€æœ‰è§£ã€‚æœ€ç»ˆä»£ç å®ç°å¦‚ä¸‹ï¼š func countGoodTriplets(arr []int, a int, b int, c int) int { length := len(arr) count := 0 for i := 0; i \u003c length-2; i++ { for j := i + 1; j \u003c length-1; j++ { // æå‰é€€å‡ºï¼Œé¿å…æ— æ•ˆå¾ªç¯ if abs(arr[i]-arr[j]) \u003e a { continue } for k := j + 1; k \u003c length; k++ { if abs(arr[j]-arr[k]) \u003c= b \u0026\u0026 abs(arr[i]-arr[k]) \u003c= c { count += 1 } } } } return count } func abs(n int) int { if n \u003c 0 { return -n } return n } è¯¥ç®—æ³•çš„å¤æ‚åº¦ï¼š æ—¶é—´å¤æ‚åº¦ï¼šä¸»è¦æ˜¯ä¸‰é‡å¾ªç¯ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º $O(n^3)$ã€‚ ç©ºé—´å¤æ‚åº¦ï¼šä½¿ç”¨éå†ä¿å­˜ç¬¦åˆå…ƒç»„ä¸ªä¸ªæ•°ï¼Œå› æ­¤ä¸º $O(1)$ã€‚ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:1:2","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"é€’æ¨ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:2:0","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å®šä¹‰ é€’æ¨ç®—æ³•èƒ½å¤Ÿé€šè¿‡å·²çŸ¥çš„æŸä¸ªæ¡ä»¶ï¼Œåˆ©ç”¨ç‰¹å®šçš„å…³ç³»å¾—å‡ºä¸­é—´æ¨è®ºï¼Œç„¶åé€æ­¥é€’æ¨ï¼Œç›´åˆ°å¾—åˆ°ç»“æœä¸ºæ­¢ã€‚å’Œç©·ä¸¾ä¸åŒçš„æ˜¯é€’æ¨æ¯æ¬¡ä¼šè®°å½•å½“å‰çš„çŠ¶æ€ï¼Œå†è®¡ç®—ä¸‹æ¬¡çš„ç»“æœã€‚ é€’æ¨ç®—æ³•ä¸€èˆ¬åˆ†æˆä¸¤ç§: é¡ºæ¨æ³•ï¼šä»å·²çŸ¥æ¡ä»¶å‡ºå‘ï¼Œé€æ­¥æ¨ç®—å‡ºè¦è§£å†³é—®é¢˜çš„æ–¹æ³•ã€‚ä¾‹å¦‚æ–æ³¢é‚£å¥‘æ•°åˆ—å°±å¯ä»¥é€šè¿‡é¡ºæ¨æ³•ä¸æ–­é€’æ¨ç®—å‡ºæ–°çš„æ•°æ®ã€‚ é€†æ¨æ³•ï¼šä»å·²çŸ¥çš„ç»“æœå‡ºå‘ï¼Œç”¨è¿­ä»£è¡¨è¾¾å¼é€æ­¥æ¨ç®—å‡ºé—®é¢˜å¼€å§‹çš„æ¡ä»¶ï¼Œå³é¡ºæ¨æ³•çš„é€†è¿‡ç¨‹ã€‚ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:2:1","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"é¢˜è§£ æˆ‘ä»¬ä½¿ç”¨é€’æ¨ç®—æ³•æ¥è§£ leetcodeé¢˜ç›® è¿™é“æå‡ºçš„è¦æ±‚æ˜¯ä½¿ç”¨é€’å½’ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨é€’æ¨æ–¹å¼æ¥è§£ç­”ã€‚ é¢˜ç›®è¦æ±‚è®¡ç®—ä¿©ä¸ªæ•°çš„ä¹˜ç§¯ä½†ä¸èƒ½ä½¿ç”¨ä¹˜æ³•ç¬¦å·ï¼Œé‚£æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŠ æ³•æ¥ä»£æ›¿ä¹˜æ³•ã€‚åªè¦å¾ªç¯ B æ¬¡ï¼Œæ¯æ¬¡ç´¯åŠ  A å¹¶ä¿å­˜åˆ°å’Œã€‚ä»£ç å¦‚ä¸‹ã€‚ func multiply(A int, B int) int { sum := 0 for i := 0; i \u003c B; i++ { sum += A } return sum } å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼šä½¿ç”¨ä¸€è½®å¾ªç¯ï¼Œå› æ­¤ä¸º $O(n)$ã€‚ ç©ºé—´å¤æ‚åº¦ï¼šç»“æœä¿å­˜åˆ° sum å˜é‡ï¼Œå› æ­¤ä¸º $O(1)$ã€‚ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:2:2","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"é€’å½’ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:3:0","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å®šä¹‰ é€’å½’ç®—æ³•æ˜¯æŠŠé—®é¢˜è½¬åŒ–æˆè§„æ¨¡æ›´å°çš„åŒç±»å­é—®é¢˜ï¼Œå…ˆè§£å†³å­é—®é¢˜ï¼Œå†é€šè¿‡ç›¸åŒçš„æ±‚è§£è¿‡ç¨‹é€æ­¥è§£å†³æ›´é«˜å±‚æ¬¡çš„é—®é¢˜ï¼Œæœ€ç»ˆè·å¾—æœ€ç»ˆçš„è§£ã€‚ åœ¨å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œæœ€é‡è¦çš„æ˜¯ç¡®å®šé€’å½’è¿‡ç¨‹ç»ˆæ­¢çš„æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¿­ä»£è¿‡ç¨‹è·³å‡ºçš„æ¡ä»¶åˆ¤æ–­ã€‚å¦åˆ™ï¼Œç¨‹åºä¼šåœ¨è‡ªæˆ‘è°ƒç”¨ä¸­æ— é™å¾ªç¯ï¼Œæœ€ç»ˆå¯¼è‡´å†…å­˜æº¢å‡ºè€Œå´©æºƒã€‚ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:3:1","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"é¢˜è§£ æˆ‘ä»¬ä½¿ç”¨é€’å½’ç®—æ³•æ¥è§£ leetcodeé¢˜ç›® è¿™é“é¢˜ç›®è¦æ±‚æ±‚æ˜¯å¦å­˜åœ¨ä¸€ä¸ªæ•´æ•° x ä½¿å¾— $n == 2^x$ã€‚æˆ‘ä»¬å°±å¯ä»¥æ ¹æ®è¿™ä¸ªå…¬å¼è®¡ç®— x çš„å€¼ã€‚é€’å½’çš„ç»“æŸæ¡ä»¶æœ‰ä¸¤ç§ï¼š x \u003e n: è¡¨ç¤º n ä¸æ˜¯ 2 çš„å†¥ã€‚ x == n: è¡¨ç¤º n ä¸º 2 çš„å†¥ã€‚ ä»£ç å¦‚ä¸‹: func isPowerOfTwo(n int) bool { if n == 1 { return true } return power(n, 1) } func power(n, x int) bool { if x \u003e n { return false } if x == n { return true } return power(n, x * 2) } å¤æ‚åº¦åˆ†æ: æ—¶é—´å¤æ‚åº¦: é€’å½’è®¡ç®— x çš„å€¼ï¼Œæ‰€ä»¥ä¸º $O(n)$ã€‚ ç©ºé—´å¤æ‚åº¦: ä½¿ç”¨ x å­˜å‚¨ 2 çš„å†¥ï¼Œæ‰€ä»¥ä¸º $O(1)$ã€‚ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:3:2","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"è´ªå¿ƒ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:4:0","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å®šä¹‰ è´ªå¿ƒç®—æ³•ä¹Ÿæ˜¯å°†é—®é¢˜åˆ†è§£æˆå¤šä¸ªå°é—®é¢˜ï¼Œä½†æ˜¯è´ªå¿ƒç®—æ³•ä¼šå¾—å‡ºæ¯ä¸ªæ­¥éª¤çš„å±€éƒ¨æœ€ä¼˜è§£ï¼Œä»è€Œå¾—å‡ºå…¨å±€è§£ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯å±€éƒ¨çš„æœ€ä¼˜è§£ä¸ç­‰äºå…¨å±€æœ€ä¼˜è§£ï¼Œæ‰€ä»¥å½“è¦æ±‚å–å¾—å…¨å±€æœ€ä¼˜è§£æ—¶éœ€è¦è°¨æ…ä½¿ç”¨è´ªå¿ƒç®—æ³•ã€‚ è´ªå©ªæ³•çš„åŸºæœ¬æ­¥éª¤ï¼š ä»æŸä¸ªåˆå§‹è§£å‡ºå‘ï¼› é‡‡ç”¨è¿­ä»£çš„è¿‡ç¨‹ï¼Œå½“å¯ä»¥å‘ç›®æ ‡å‰è¿›ä¸€æ­¥æ—¶ï¼Œå°±æ ¹æ®å±€éƒ¨æœ€ä¼˜ç­–ç•¥ï¼Œå¾—åˆ°ä¸€éƒ¨åˆ†è§£ï¼Œç¼©å°é—®é¢˜è§„æ¨¡ï¼› å°†æ‰€æœ‰è§£ç»¼åˆèµ·æ¥ã€‚ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:4:1","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"é¢˜è§£ æˆ‘ä»¬ä½¿ç”¨è´ªå¿ƒç®—æ³•æ¥è§£ leetcodeé¢˜ç›® åˆ—è¡¨ä¸­åŒ…å« 5ã€10ã€20 ç¾å…ƒï¼Œåˆ†ä¸‰ç§æƒ…å†µï¼š 5 ç¾å…ƒæ—¶ç›´æ¥æ”¶å–ã€‚ 10 ç¾å…ƒæ—¶ï¼Œå¦‚æœæœ‰å‰©ä½™çš„ 5 ç¾å…ƒï¼Œæ‰¾ 5 ç¾å…ƒï¼Œæ”¶å– 10 ç¾å…ƒã€‚ 20 ç¾å…ƒæ—¶ï¼Œå¦‚æœæœ‰å‰©ä½™çš„ 10 ç¾å…ƒå’Œ 5 ç¾åŒ–ï¼Œç›´æ¥å…‘æ¢å¹¶æ”¶å–ï¼Œå¦åˆ™ï¼Œå°è¯•æ‰¾ 3ä¸ª 5 ç¾å…ƒ (å› ä¸º 5 ç¾å…ƒçš„ç”¨é€”å¤§äº 10 ç¾å…ƒ)ã€‚ ä»£ç å¦‚ä¸‹: func lemonadeChange(bills []int) bool { five, ten := 0, 0 for _, b := range bills { if b == 5 { five += 1 } if b == 10 { if five \u003e 0 { five -= 1 ten += 1 } else { return false } } if b == 20 { if five \u003e 0 \u0026\u0026 ten \u003e 0 { five -= 1 ten -= 1 } else if five \u003e 2 { five -= 3 } else { return false } } } return true } å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼šéå†åˆ—è¡¨ä¸º $O(n)$ã€‚ ç©ºé—´å¤æ‚åº¦: ä½¿ç”¨ä¸¤ä¸ªå˜é‡ä¿å­˜æ”¶å–çš„é›¶é’±ï¼Œæ‰€æœ‰ä¸º $O(1)$ã€‚ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:4:2","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"æ¨¡æ‹Ÿ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:5:0","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å®šä¹‰ æ¨¡æ‹Ÿæ€æƒ³å°±æ˜¯å¯¹çœŸå®åœºæ™¯å°½å¯èƒ½çš„æ¨¡æ‹Ÿï¼Œç„¶åé€šè¿‡è®¡ç®—æœºå¼ºå¤§çš„è®¡ç®—èƒ½åŠ›å¯¹ç»“æœè¿›è¡Œé¢„æµ‹ã€‚ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:5:1","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"é¢˜è§£ æˆ‘ä»¬ä½¿ç”¨æ¨¡æ‹Ÿç®—æ³•æ¥è§£ leetcodeé¢˜ç›® æ ˆçš„ç‰¹ç‚¹æ˜¯å…ˆè¿›åå‡ºï¼Œé˜Ÿåˆ—çš„ç‰¹ç‚¹æ˜¯å…ˆè¿›å…ˆå‡ºã€‚ç›´æ¥ä½¿ç”¨æ ˆè‚¯å®šä¸è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªæ ˆ headã€tailï¼Œåˆ†åˆ«å¯¹åº”é˜Ÿåˆ—çš„å…¥é˜Ÿå’Œå‡ºé˜Ÿã€‚ å…ƒç´ æ¯æ¬¡å…¥é˜Ÿæ—¶ï¼Œå…¨éƒ¨ä¿å­˜åˆ° tail æ ˆï¼Œå½“å…ƒç´ å‡ºé˜Ÿæ—¶ï¼Œå…ˆæ£€æŸ¥ head æ˜¯å¦ä¸ºç©ºã€‚å¦‚æœ head ä¸ºç©ºï¼Œç›´æ¥å°† tail çš„å€¼å…¨éƒ¨æ”¾å…¥ head ä¸­ã€‚ ä»£ç å®ç°å¦‚ä¸‹: type CQueue struct { head []int tail []int } func Constructor() CQueue { return CQueue{ head: make([]int, 0), tail: make([]int, 0), } } func (this *CQueue) AppendTail(value int) { this.tail = append(this.tail, value) } func (this *CQueue) DeleteHead() int { if len(this.head) \u003e 0 { v := this.head[len(this.head)-1] this.head = this.head[:len(this.head)-1] return v } if len(this.tail) \u003e 0 { for i := len(this.tail) - 1; i \u003e= 0; i-- { this.head = append(this.head, this.tail[i]) } this.tail = make([]int, 0) return this.DeleteHead() } return -1 } ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:5:2","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"åˆ†æ²» ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:6:0","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å®šä¹‰ åˆ†æ²»æ€æƒ³ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯åˆ†è€Œæ²»ä¹‹ã€‚æ ¸å¿ƒæ­¥éª¤ä¸º ä¸€åˆ†ã€äºŒæ²»ã€‚å…ˆå°†ä¸»é—®é¢˜è‡ªé¡¶å‘ä¸‹åˆ†è§£æˆæ›´å°çš„ç»†é¢—ç²’åº¦å­é—®é¢˜ï¼Œä¹‹åå°±æ˜¯è‡ªåº•å‘ä¸Šå°†å­é—®é¢˜çš„è§£åˆå¹¶åˆ°ä¸»é—®é¢˜ä¸­ã€‚ ä¾‹å¦‚æ’åºç®—æ³•ä¸­çš„å½’å¹¶æ’åºå°±æ˜¯å…¸å‹çš„åˆ†æ²»æ€æƒ³ï¼š å°†æ•°ç»„æ‹†åˆ†ä¸ºå•ä¸ªå…ƒç´ ï¼Œå†å¯¹å…ƒç´ ä¸¤ä¸¤æ’åºã€åˆå¹¶ï¼Œä¸æ–­å‘ä¸Šåˆæˆï¼Œç›´åˆ°æ’åºå®Œæˆã€‚ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:6:1","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"é¢˜è§£ æˆ‘ä»¬ä½¿ç”¨æ¨¡æ‹Ÿç®—æ³•æ¥è§£ leetcodeé¢˜ç›® è¿™é“é¢˜ç›®å¯ä»¥çœ‹ä½œå½’å¹¶æ’åºçš„å˜å½¢ï¼Œæ¯æ¬¡å½’å¹¶æ’åºæ—¶ï¼Œå…ƒç´ ä¹‹é—´éœ€è¦äº¤äº’ä½ç½®æ—¶å°±è¡¨ç¤ºè¿™ä¸¤ä¸ªæ•°ç»„ç»„æˆä¸€ä¸ªé€†åºå¯¹ã€‚ ä»£ç å®ç°å¦‚ä¸‹: func reversePairs(nums []int) int { tmp := make([]int, len(nums)) return mergeSort(0, len(nums)-1, nums, tmp) } func mergeSort(l, r int, nums, tmp []int) int { if l \u003e= r { return 0 } m := (l + r) / 2 res := mergeSort(l, m, nums, tmp) + mergeSort(m+1, r, nums, tmp) i, j := l, m+1 for k := l; k \u003c= r; k++ { tmp[k] = nums[k] } for k := l; k \u003c= r; k++ { if i == m+1 { nums[k] = tmp[j] j += 1 } else if j == r+1 || tmp[i] \u003c= tmp[j] { nums[k] = tmp[i] i += 1 } else { nums[k] = tmp[j] res += m - i + 1 // ç»Ÿè®¡é€†åºå¯¹ j += 1 } } return res } å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦: ä½¿ç”¨å½’å¹¶ç®—æ³•ï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦ä¸º $O(n \\log{n})$ã€‚ ç©ºé—´å¤æ‚åº¦: ä½¿ç”¨å˜é‡ä¿å­˜æ’åºåçš„æ•°ç»„ï¼Œå› æ­¤ä¸º $O(n)$ã€‚ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:6:2","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å›æº¯ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:7:0","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å®šä¹‰ å›æº¯ç®—æ³•å®é™…ä¸Šä¸€ä¸ªç±»ä¼¼æšä¸¾çš„æœç´¢å°è¯•è¿‡ç¨‹ï¼Œä¸»è¦æ˜¯åœ¨æœç´¢å°è¯•è¿‡ç¨‹ä¸­å¯»æ‰¾é—®é¢˜çš„è§£ï¼Œå½“å‘ç°å·²ä¸æ»¡è¶³æ±‚è§£æ¡ä»¶æ—¶ï¼Œå°±â€œå›æº¯â€è¿”å›ï¼Œå°è¯•åˆ«çš„è·¯å¾„ã€‚ å›æº¯æ³•æ˜¯ä¸€ç§é€‰ä¼˜æœç´¢æ³•ï¼ŒæŒ‰é€‰ä¼˜æ¡ä»¶å‘å‰æœç´¢ï¼Œä»¥è¾¾åˆ°ç›®æ ‡ã€‚ä½†å½“æ¢ç´¢åˆ°æŸä¸€æ­¥æ—¶ï¼Œå‘ç°åŸå…ˆé€‰æ‹©å¹¶ä¸ä¼˜æˆ–è¾¾ä¸åˆ°ç›®æ ‡ï¼Œå°±é€€å›ä¸€æ­¥é‡æ–°é€‰æ‹©ï¼Œè¿™ç§ èµ°ä¸é€šå°±é€€å›å†èµ°çš„æŠ€æœ¯ä¸ºå›æº¯æ³•ï¼Œè€Œæ»¡è¶³å›æº¯æ¡ä»¶çš„æŸä¸ªçŠ¶æ€çš„ç‚¹ç§°ä¸ºâ€œå›æº¯ç‚¹â€ã€‚è®¸å¤šå¤æ‚çš„ï¼Œè§„æ¨¡è¾ƒå¤§çš„é—®é¢˜éƒ½å¯ä»¥ä½¿ç”¨å›æº¯æ³•ï¼Œæœ‰â€œé€šç”¨è§£é¢˜æ–¹æ³•â€çš„ç¾ç§°ã€‚â€”â€” ç™¾åº¦ç™¾ç§‘ å›æº¯ç®—æ³•æœ‰ä¸€å¥—å›ºå®šçš„æ¨¡æ¿: res = [] # å®šä¹‰å…¨å±€å˜é‡ä¿å­˜æœ€ç»ˆç»“æœ state = [] # å®šä¹‰çŠ¶æ€å˜é‡ä¿å­˜å½“å‰çŠ¶æ€ p,q,r # å®šä¹‰æ¡ä»¶å˜é‡ï¼ˆä¸€èˆ¬æ¡ä»¶å˜é‡å°±æ˜¯é¢˜ç›®ç›´æ¥ç»™çš„å‚æ•°ï¼‰ def back(çŠ¶æ€ï¼Œæ¡ä»¶1ï¼Œæ¡ä»¶2ï¼Œâ€¦â€¦): if # ä¸æ»¡è¶³åˆæ³•æ¡ä»¶ï¼ˆå¯ä»¥è¯´æ˜¯å‰ªæï¼‰ return elif # çŠ¶æ€æ»¡è¶³æœ€ç»ˆè¦æ±‚ res.append(state) # åŠ å…¥ç»“æœ return # ä¸»è¦é€’å½’è¿‡ç¨‹ï¼Œä¸€èˆ¬æ˜¯å¸¦æœ‰ å¾ªç¯ä½“ æˆ–è€… æ¡ä»¶ä½“ for # æ»¡è¶³æ‰§è¡Œæ¡ä»¶ if # æ»¡è¶³æ‰§è¡Œæ¡ä»¶ back(çŠ¶æ€ï¼Œæ¡ä»¶1ï¼Œæ¡ä»¶2ï¼Œâ€¦â€¦) back(çŠ¶æ€ï¼Œæ¡ä»¶1ï¼Œæ¡ä»¶2ï¼Œâ€¦â€¦) return res ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:7:1","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"é¢˜è§£ æˆ‘ä»¬ä½¿ç”¨æ¨¡æ‹Ÿç®—æ³•æ¥è§£ leetcodeé¢˜ç›® å…ˆé€šè¿‡å¾ªç¯ç¡®å®šä¸€ä¸ªåˆå§‹ç‚¹ï¼Œæ¯æ¬¡æ·±åº¦éå†å‰å…ˆè¿›è¡Œå‰ªæã€‚ æ¯æ¬¡ç»è¿‡ä¸€ä¸ªç½‘ç»œæ—¶ï¼Œä¿®æ”¹çŸ©é˜µä¸­å…ƒç´ çš„å€¼ä¸ºç©ºï¼Œæ¯ä¸ªç½‘æ ¼éƒ½å¯ä»¥é€‰æ‹©ä¸Šã€ä¸‹ã€å·¦ã€å³å››ä¸ªæ–¹å‘çš„ä¸‹ä¸€ä¸ªç½‘æ ¼ã€‚ func exist(board [][]byte, word string) bool { for i := 0; i \u003c len(board); i++ { for j := 0; j \u003c len(board[0]); j++ { // ç¡®å®šèµ·å§‹ç‚¹ if dfs(\u0026board, \u0026word, i, j, 0) { return true } } } return false } func dfs(board *[][]byte, word *string, i, j, k int) bool { // å‰ªæ if i \u003e= len(*board) || i \u003c 0 || j \u003e= len((*board)[0]) || j \u003c 0 || (*board)[i][j] != (*word)[k] { return false } // æ‰€æœ‰è·¯å¾„åŒ¹é… if k == len(*word)-1 { return true } // æ ‡è®°å·²ç»èµ°è¿‡çš„ç½‘æ ¼ (*board)[i][j] = ' ' // æ¯ä¸ªç½‘ç»œä¸‹ä¸€æ­¥éƒ½æœ‰å››ä¸ªæ–¹å‘çš„é€‰æ‹© boolean := dfs(board, word, i+1, j, k+1) || dfs(board, word, i, j+1, k+1) || dfs(board, word, i-1, j, k+1) || dfs(board, word, i, j-1, k+1) // çŠ¶æ€å›æº¯ (*board)[i][j] = (*word)[k] return boolean } å¤æ‚åº¦åˆ†æ: M,N åˆ†åˆ«ä¸ºçŸ©é˜µè¡Œåˆ—å¤§å°ï¼Œ KK ä¸ºå­—ç¬¦ä¸² word é•¿åº¦ã€‚ æ—¶é—´å¤æ‚åº¦ $O(3^K MN)$ ï¼šæœ€å·®æƒ…å†µä¸‹ï¼Œéœ€è¦éå†çŸ©é˜µä¸­é•¿åº¦ä¸º KK å­—ç¬¦ä¸²çš„æ‰€æœ‰æ–¹æ¡ˆï¼Œæ—¶é—´å¤æ‚åº¦ä¸º $O(3^K)$ï¼›çŸ©é˜µä¸­å…±æœ‰ MN ä¸ªèµ·ç‚¹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º $O(MN)$ ã€‚ æ–¹æ¡ˆæ•°è®¡ç®—ï¼š è®¾å­—ç¬¦ä¸²é•¿åº¦ä¸º KK ï¼Œæœç´¢ä¸­æ¯ä¸ªå­—ç¬¦æœ‰ä¸Šã€ä¸‹ã€å·¦ã€å³å››ä¸ªæ–¹å‘å¯ä»¥é€‰æ‹©ï¼Œèˆå¼ƒå›å¤´ï¼ˆä¸Šä¸ªå­—ç¬¦ï¼‰çš„æ–¹å‘ï¼Œå‰©ä¸‹ 33 ç§é€‰æ‹©ï¼Œå› æ­¤æ–¹æ¡ˆæ•°çš„å¤æ‚åº¦ä¸º $O(3^K)$ ã€‚ ç©ºé—´å¤æ‚åº¦ $O(K)$ ï¼š æœç´¢è¿‡ç¨‹ä¸­çš„é€’å½’æ·±åº¦ä¸è¶…è¿‡ KK ï¼Œå› æ­¤ç³»ç»Ÿå› å‡½æ•°è°ƒç”¨ç´¯è®¡ä½¿ç”¨çš„æ ˆç©ºé—´å ç”¨ $O(K)$ã€‚æœ€åæƒ…å†µä¸‹ $K = M$ï¼Œé€’å½’æ·±åº¦ä¸º $MN$ ï¼Œæ­¤æ—¶ç³»ç»Ÿæ ˆä½¿ç”¨ $O(MN)$O çš„é¢å¤–ç©ºé—´ã€‚ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:7:2","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"åŠ¨æ€è§„åˆ’ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:8:0","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å®šä¹‰ åŠ¨æ€è§„åˆ’éœ€è¦å°†é—®é¢˜åˆ’åˆ†ä¸ºå¤šä¸ªå­é—®é¢˜ï¼Œä½†æ˜¯å­é—®é¢˜ä¹‹é—´å¾€å¾€ä¸æ˜¯äº’ç›¸ç‹¬ç«‹çš„ã€‚å½“å‰å­é—®é¢˜çš„è§£å¯çœ‹ä½œæ˜¯å‰å¤šä¸ªé˜¶æ®µé—®é¢˜çš„å®Œæ•´æ€»ç»“ã€‚ å› æ­¤è¿™å°±éœ€è¦åœ¨åœ¨å­é—®é¢˜æ±‚è§£çš„è¿‡ç¨‹ä¸­è¿›è¡Œå¤šé˜¶æ®µçš„å†³ç­–ï¼ŒåŒæ—¶å½“å‰é˜¶æ®µä¹‹å‰çš„å†³ç­–éƒ½èƒ½å¤Ÿæ„æˆä¸€ç§æœ€ä¼˜çš„å­ç»“æ„ã€‚è¿™å°±æ˜¯æ‰€è°“çš„æœ€ä¼˜åŒ–åŸç†ã€‚ æœ€ä¼˜åŒ–åŸç†ï¼Œä¸€ä¸ªæœ€ä¼˜åŒ–ç­–ç•¥å…·æœ‰è¿™æ ·çš„æ€§è´¨ï¼Œä¸è®ºè¿‡å»çŠ¶æ€å’Œå†³ç­–å¦‚ä½•ï¼Œå¯¹å‰é¢çš„å†³ç­–æ‰€å½¢æˆçš„çŠ¶æ€è€Œè¨€ï¼Œä½™ä¸‹çš„è¯¸å†³ç­–å¿…é¡»æ„æˆæœ€ä¼˜ç­–ç•¥ã€‚ åŒæ—¶ï¼Œè¿™æ ·çš„æœ€ä¼˜ç­–ç•¥æ˜¯é’ˆå¯¹æœ‰å·²ä½œå‡ºå†³ç­–çš„æ€»ç»“ï¼Œå¯¹åæ¥çš„å†³ç­–æ²¡æœ‰ç›´æ¥å½±å“ï¼Œåªèƒ½å€Ÿç”¨ç›®å‰æœ€ä¼˜ç­–ç•¥çš„çŠ¶æ€æ•°æ®ã€‚è¿™ä¹Ÿè¢«ç§°ä¹‹ä¸ºæ— åæ•ˆæ€§ã€‚ åŠ¨æ€è§„åˆ’ï¼Œç®€å•è®²å°±æ˜¯åˆ©ç”¨å†å²è®°å½•ï¼Œæ¥é¿å…æˆ‘ä»¬çš„é‡å¤è®¡ç®—ã€‚è€Œè¿™äº›å†å²è®°å½•ï¼Œé€šå¸¸æ˜¯ç”¨ä¸€ç»´æ•°ç»„æˆ–è€…äºŒç»´æ•°ç»„æ¥ä¿å­˜ã€‚ åŠ¨æ€è§„åˆ’çš„ä¸»è¦æ­¥éª¤ï¼š å®šä¹‰æ•°ç»„å…ƒç´ çš„å«ä¹‰ï¼Œè®¾ç½® dp è®°å½•å†å²æ•°æ®ã€‚ æ‰¾å‡ºæ•°ç»„å…ƒç´ ä¹‹é—´çš„å…³ç³»å¼ï¼Œç¡®å®šçŠ¶æ€è½¬ç§»æ–¹ç¨‹å¼ã€‚ æ‰¾å‡ºåˆå§‹å€¼ã€‚ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:8:1","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"é¢˜è§£ æˆ‘ä»¬ä½¿ç”¨æ¨¡æ‹Ÿç®—æ³•æ¥è§£ leetcodeé¢˜ç›® ä»£å…¥æ­¥éª¤æ¥è§£ç­”æ­¤é¢˜ã€‚ ä½¿ç”¨ä¸€ç»´æ•°ç»„ dp[n] æ¥ä¿å­˜æ¯æ¬¡è®¡ç®—çš„æ–æ³¢é‚£å¥‘å€¼ã€‚ æ ¹æ®æ–æ³¢é‚£å¥‘çš„å®šä¹‰å¯å¾—çŠ¶æ€è½¬ç§»æ–¹ç¨‹å¼: $F(i) = F(i-1) + F(i-2)$ã€‚ ç¡®å®šåˆå§‹åŒ–ï¼ŒF(0) = 0, F(0) = 1ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ n çš„æœ€å¤§å€¼ä¸º 100ï¼Œè®¡ç®—ç»“æœä¼šè¶…å‡º int èŒƒå›´ï¼Œæ‰€ä»¥ç»“æœå–æ¨¡ã€‚ æœ€ç»ˆä»£ç å¦‚ä¸‹: func fib(n int) int { if n == 0 { return 0 } if n == 1 { return 1 } mod := 1e9 + 7 dp := make([]int, n+1) dp[0], dp[1] = 0, 1 for i := 2; i \u003c= n; i++ { dp[i] = (dp[i-1] + dp[i-2]) % int(mod) } return dp[n] } å¤æ‚åº¦åˆ†æ: æ—¶é—´å¤æ‚åº¦ï¼šä¸»è¦åœ¨äºå¾ªç¯çš„æ—¶é—´èŠ±è´¹ï¼Œå› æ­¤ä¸º $O(n)$ã€‚ ç©ºé—´å¤æ‚åº¦: ä½¿ç”¨ä¸€ç»´æ•°ç»„ dp ä¿ç•™æ¯æ¬¡è®¡ç®—çš„ç»“æœï¼Œæ‰€ä»¥ä¸º $O(n)$ï¼Œå®é™…å¯ä»¥åªä½¿ç”¨ä¸¤ä¸ªå˜é‡ä¿å­˜å‰ä¸¤ä¸ªç»“æœï¼Œè¿™æ ·ç©ºé—´å¤æ‚åº¦å¯ä»¥ä¼˜åŒ–ä¸º $O(1)$ã€‚ ","date":"2022-04-25","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/:8:2","tags":["ç®—æ³•","golang"],"title":"å¸¸è§çš„ç®—æ³•æ€æƒ³","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"ä½œä¸ºæ€»ç»“å’Œå›é¡¾ï¼Œæœ¬ç¯‡æ¥æ¢³ç†ä¸‹å¼€å‘å’Œåˆ·é¢˜è¿‡ç¨‹ä¸­æ‰€é‡åˆ°çš„å¸¸ç”¨æ•°æ®ç»“æ„ã€‚ é¦–å…ˆä»€ä¹ˆæ˜¯æ•°æ®ç»“æ„å‘¢ï¼Ÿåœ¨ä¸€èˆ¬çš„ç®—æ³•ä¹¦ç±ä¸­éƒ½ä¼šå‘Šè¯‰è¯»è€…è¿™å¥è¯: $$ç¨‹åº = æ•°æ®ç»“æ„ + ç®—æ³•$$ ç®€å•çš„æ¥è¯´ï¼Œæ•°æ®ç»“æ„ä¼šæè¿°æ•°æ®çš„ä¸¤ä¸ªæ–¹é¢: æ•°æ®çš„ç±»å‹ æ•°æ®ä¹‹é—´çš„å…³ç³»ï¼Œæˆ–è€…è¯´ç»„ç»‡å½¢å¼ã€‚ å¸¸ç”¨çš„æ•°æ®ç»“æ„æœ‰: æ•°æ® é“¾è¡¨ é˜Ÿåˆ— æ ˆ å­—ç¬¦ä¸² å“ˆå¸Œè¡¨ æ ‘ å † ä¸‹é¢å°±æ¥ä¸€ä¸€ä»‹ç» ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:0:0","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"æ•°ç»„ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:1:0","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å®šä¹‰ æ•°ç»„æ˜¯ç”±ç›¸åŒç±»å‹çš„æ•°æ®ç»„æˆçš„æœ‰é™é›†åˆã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯å…ƒç´ çš„ç±»å‹ç›¸åŒï¼Œå…ƒç´ åœ¨å†…å­˜ä¸­è¿ç»­å­˜å‚¨ã€‚ åˆ›å»ºä¸€ä¸ªæ•°ç»„ func main() { arr := []int{1,2,3,4,5} } ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:1:1","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"æ“ä½œ æ•°ç»„å¸¸ç”¨çš„æ“ä½œæœ‰æŸ¥è¯¢ã€æ’å…¥å’Œåˆ é™¤å…ƒç´  æŸ¥è¯¢å…ƒç´  æ•°ç»„å¯ä»¥ç›´æ¥é€šè¿‡ä¸‹æ ‡æŸ¥è¯¢å¯¹åº”çš„å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1) func main() { list := []int{1,2,3} n := list[1] } æ’å…¥å…ƒç´  æ’å…¥å…ƒç´ çš„åˆ†æˆä¸‰ä¸ªæ­¥éª¤: æŸ¥è¯¢ä¸‹æ ‡ ä¸‹æ ‡ä¹‹åçš„å…ƒç´ å‘åæ”¾ç½® æ’å…¥å…ƒç´  ä»£ç å®ç°å¦‚ä¸‹: func Insert(list []int, index, n int) []int { length := len(list) // æ£€æŸ¥è¾¹ç•Œ if index \u003c 0 || index \u003e length { return list } // æ•°ç»„æ‰©å±• list = append(list, n) // å…ƒç´ äº¤æ¢ for i := index; i \u003c= length; i++ { list[i], list[length] = list[length], list[i] } return list } å½“æ’å…¥çš„ä½ç½®ä¸ºæ•°ç»„å°¾éƒ¨æ—¶ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œå…¶ä»–æƒ…å†µåˆ™ä¸º O(n)ã€‚å¹³å‡çŠ¶æ€ä¸‹ï¼Œæ•°ç»„æ’å…¥çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚ ç§»é™¤å…ƒç´  ç§»é™¤å…ƒç´ çš„åˆ†æˆä¸‰ä¸ªæ­¥éª¤: æŸ¥è¯¢ä¸‹æ ‡ ç§»é™¤å…ƒç´  ä¸‹æ ‡ä¹‹åçš„å…ƒç´ å‘å‰æ”¾ç½® ä»£ç å®ç°å¦‚ä¸‹: func Remove(list []int, index int) []int { length := len(list) if index \u003c 0 || index \u003e= length { return list } // å…ƒç´ äº¤æ¢ for i := index; i \u003c length-1; i++ { list[i] = list[i+1] } return list[:length-1] } å½“ç§»é™¤çš„ä½ç½®ä¸ºæ•°ç»„å°¾éƒ¨æ—¶ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œå…¶ä»–æƒ…å†µåˆ™ä¸º O(n)ã€‚å¹³å‡çŠ¶æ€ä¸‹ï¼Œæ•°ç»„ç§»é™¤çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚ å°ç»“ æ•°ç»„æ˜¯æœ€ç®€å•çš„æ•°æ®ç»“æ„ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯å…ƒç´ ä¹‹é—´å­˜å‚¨è¿ç»­ï¼ŒæŸ¥è¯¢å…ƒç´ é«˜æ•ˆã€‚ç¼ºç‚¹æ˜¯æ’å…¥å’Œåˆ é™¤æ—¶éœ€è¦ç§»åŠ¨å…ƒç´ ï¼Œå®¹é‡å˜åŠ¨æ—¶ï¼Œéœ€è¦ç”³è¯·æ–°çš„è¿ç»­å†…å­˜ç©ºé—´ï¼Œå®¹æ˜“é€ æˆå†…å­˜ç¢ç‰‡ã€‚ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:1:2","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"é“¾è¡¨ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:2:0","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å®šä¹‰ é“¾è¡¨çš„å®šä¹‰å’Œæ•°ç»„ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒçš„æ¯ä¸ªå…ƒç´ é™¤äº†å€¼ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæŒ‡é’ˆåŸŸï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚é“¾è¡¨ä¸­çš„å…ƒç´ ç§°ä¸ºèŠ‚ç‚¹ã€‚ type ListNode struct { Val int Next *ListNode } æ¯ä¸ªé“¾è¡¨çš„èŠ‚ç‚¹ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼šæ•°æ®åŸŸå’ŒæŒ‡åŸŸã€‚æ¯ä¸ªèŠ‚ç‚¹ä¸²è”æˆä¸€ä¸ªåˆ—è¡¨ã€‚ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:2:1","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"æ“ä½œ æŸ¥è¯¢å…ƒç´  é“¾è¡¨çš„æŸ¥è¯¢éœ€è¦ä»ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ headï¼Œä¾æ¬¡éå†åˆ°å¯¹åº”çš„èŠ‚ç‚¹ã€‚æ‰€ä»¥æŸ¥è¯¢æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚ func GetElement(head *ListNode, index int) *ListNode { node := head n := 0 for node != nil { if n == index { return node } n += 1 node = node.Next } return node } æ’å…¥å…ƒç´  é“¾è¡¨çš„æ’å…¥æœ‰ä»¥ä¸‹æ­¥éª¤ï¼š éå†æ‰¾åˆ°å¯¹åº”çš„ä½ç½® åˆ›å»ºæ–°çš„èŠ‚ç‚¹ åŸèŠ‚ç‚¹çš„ Next æŒ‡å‘è¯¥èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹çš„ Next æŒ‡å‘åŸèŠ‚ç‚¹çš„ Nextã€‚ æ’å…¥æ—¶åˆ†ä¸‰ç§æƒ…å†µè¯´æ˜: å¤´éƒ¨æ’å…¥æ—¶ï¼Œæ’å…¥èŠ‚ç‚¹çš„ Next ä¸º headï¼Œå¹¶ä¿®æ”¹ head ä¸ºæ’å…¥çš„èŠ‚ç‚¹ã€‚ å°¾éƒ¨æ’å…¥æ—¶ï¼Œå°¾éƒ¨èŠ‚ç‚¹ä¸ºæ’å…¥èŠ‚ç‚¹ï¼Œæ’å…¥èŠ‚ç‚¹çš„ Next ä¸ºç©ºã€‚ ä¸­é—´æ’å…¥æ—¶ï¼Œæ•ˆæœå¦‚å›¾æ‰€ç¤ºã€‚ ä»£ç å®ç°ï¼š func Insert(head *ListNode, index, val int) *ListNode { if index == 0 { head = \u0026ListNode{Val: val, Next: head} return head } n := 0 node := head for node != nil { // å®šä½åˆ°å‰ä¸€ä¸ªèŠ‚ç‚¹ if n == index-1 { node.Next = \u0026ListNode{Val: val, Next: node.Next} break } n += 1 node = node.Next } return head } é“¾è¡¨æ’å…¥çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚ åˆ é™¤å…ƒç´  é“¾è¡¨çš„åˆ é™¤å…ƒç´ æ“ä½œå’Œæ’å…¥ç±»ä¼¼ï¼š å®šä½èŠ‚ç‚¹ å¾…ç§»é™¤çš„å‰ä¸€ä¸ªèŠ‚ç‚¹çš„ next æŒ‡å‘å¸¦ç§»é™¤èŠ‚ç‚¹çš„ next ç§»é™¤èŠ‚ç‚¹ ç§»é™¤æ—¶åˆ†ä¸‰ç§æƒ…å†µè¯´æ˜: å¤´éƒ¨ç§»é™¤æ—¶ï¼Œhead å˜æˆ head.Next å°¾éƒ¨ç§»é™¤æ—¶ï¼Œå°¾éƒ¨å˜æˆç©ºèŠ‚ç‚¹ ä¸­é—´ç§»é™¤æ—¶ï¼Œæ•ˆæœå¦‚å›¾æ‰€ç¤ºã€‚ ä»£ç å®ç°: func DeleteNode(head *ListNode, val int) *ListNode { fast := head var slow *ListNode for fast != nil { if fast.Val == val { if slow == nil { head = fast.Next } else { slow.Next = fast.Next } break } slow = fast fast = fast.Next } return head } ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:2:2","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å…¶ä»–é“¾è¡¨ç»“æ„ åœ¨é“¾è¡¨ç»“æ„åœ¨å•é“¾è¡¨çš„åŸºç¡€ä¸Šè¿˜è¡ç”Ÿå‡ºå…¶ä»–çš„å˜ç§ï¼Œå¦‚å¾ªç¯é“¾è¡¨ã€åŒé“¾è¡¨ã€‚ å¾ªç¯é“¾è¡¨ å¾ªç¯é“¾è¡¨çš„å°¾æŒ‡é’ˆæŒ‡å‘å¤´èŠ‚ç‚¹ï¼Œå®ƒå¯ä»¥å°†å°¾éƒ¨æ’å…¥å’Œåˆ é™¤çš„æ—¶é—´èŠ‚ç‚¹ä¼˜åŒ–ä¸º O(1)ã€‚ åŒè¿é“¾è¡¨ åŒé“¾è¡¨çš„æ¯ä¸ªèŠ‚ç‚¹æœ‰ä¸€ä¸ªé¢å¤–çš„ Prev æŒ‡é’ˆæŒ‡å‘ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œå®ƒå¯ä»¥ä¼˜åŒ–é“¾è¡¨çš„åå‘éå†ã€‚ä½†æ˜¯å› ä¸ºå¤šä¸€ä¸ªæŒ‡é’ˆåŸŸï¼Œæ‰€ä»¥æ’å…¥å’Œåˆ é™¤èŠ‚ç‚¹æ—¶çš„æ“ä½œæ›´åŠ å¤æ‚ã€‚ type DoubleNode struct { Val int Prev *DoubleNode Next *DoubleNode } func DoubleNodeInsert(node *DoubleNode, val int) { // ... next := node.Next cur := \u0026DoubleNode{Val: val} cur.Next = next cur.Prev = node next.Prev = node node.Next = cur // ... } func DoubleNodeRemove(node *DoubleNode) { // ... prior := node.Prev next := node.Next prior.Next = next next.Prev = prior // ... node = nil } å®ƒä»¬æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€ç§ä»¥ç©ºé—´æ¢æ—¶é—´çš„ä¼˜åŒ–æ–¹å¼ã€‚ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:2:3","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å°ç»“ é“¾è¡¨å’Œæ•°ç»„éƒ½æ˜¯çº¿æ€§è¡¨ï¼Œå…ƒç´ çš„ç±»å‹ç›¸åŒï¼Œä¸”å…ƒç´ ä¹‹é—´é¡ºåºå­˜æ”¾ã€‚å®ƒä»¬æ˜¯æœ€åŸºæœ¬æ•°æ®ç»“æ„ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¯ä»¥æ„å»ºå‡ºå…¶ä»–æ›´å¤æ‚çš„æ•°æ®ç»“æ„ã€‚è™½ç„¶æ•°æ®å’Œé“¾è¡¨åœ¨å®šä¹‰å’ŒåŠŸèƒ½ä¸Šç›¸ä¼¼ï¼Œä½†æ˜¯å®ƒä»¬ä¹Ÿå„æœ‰ç‰¹ç‚¹: æ•°æ®ç»“æ„ å­˜å‚¨åˆ†é…æ–¹å¼ æ—¶é—´æ€§èƒ½ ç©ºé—´æ€§èƒ½ æ•°ç»„ åœ¨å†…å­˜ä¸­ç”¨ä¸€æ®µè¿ç»­çš„å­˜å‚¨å•å…ƒä¾æ¬¡å­˜å‚¨æ•°æ®å…ƒç´  æŸ¥æ‰¾ä¸º O(1)ï¼Œ æ’å…¥å’Œåˆ é™¤åœ¨(éœ€è¦ç§»åŠ¨åç»­å…ƒç´ )ä¸º O(1) éœ€è¦é¢„åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œå®¹æ˜“é€ æˆå†…å­˜ç¢ç‰‡ã€‚å½“éœ€è¦çš„æ•°ç»„å®¹é‡è¿‡å¤§æ—¶å¯ä»¥æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´å¯ä»¥ç”³è¯·ã€‚ é“¾è¡¨ é‡‡ç”¨é“¾å¼å­˜å‚¨ç»“æ„ï¼Œç”¨ä¸€ç»„ä»»æ„çš„å­˜å‚¨å•å…ƒå­˜æ”¾æ•°æ®å…ƒç´  æŸ¥æ‰¾ä¸º O(n), æŸ¥æ‰¾å’Œåˆ é™¤ä¸º O(n)ï¼Œä½†æ˜¯ä¸éœ€è¦ç§»åŠ¨å…ƒç´ ï¼Œæ€§èƒ½ä¼˜äºæ•°ç»„ ä¸éœ€è¦é¢„åˆ†é…ï¼Œå…ƒç´ ä¸ªæ•°ä¹Ÿä¸å—é™åˆ¶ï¼Œå› ä¸ºå¤šä¸€ä¸ªæŒ‡é’ˆåŸŸï¼Œæ‰€ä»¥æ¯ä¸ªèŠ‚ç‚¹æ‰€å ç”¨çš„ç©ºé—´å¤§äºæ•°ç»„ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:2:4","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"é˜Ÿåˆ— ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:3:0","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å®šä¹‰ é˜Ÿåˆ—æ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡º (FIFO) çš„çº¿æ€§è¡¨ã€‚é˜Ÿåˆ—æœ‰é˜Ÿå¤´å’Œé˜Ÿå°¾ï¼Œå…ƒç´ ä»é˜Ÿå°¾æ·»åŠ ï¼Œä»é˜Ÿå¤´å–å‡ºã€‚ é˜Ÿåˆ—çš„å®ç°æ–¹å¼æœ‰å¤šç§ï¼Œå¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–æ˜¯é“¾è¡¨æ¥å®ç°ã€‚å®é™…ä¸Šï¼Œåªè¦èƒ½ä¿è¯ FIFOï¼Œé˜Ÿåˆ—å†…éƒ¨å¦‚ä½•å®ç°éƒ½ä¸é‡è¦ã€‚ type Node struct { Val int Next *Node } type Queue struct { head *Node tail *Node } func NewQueue() *Queue { return \u0026Queue{} } ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:3:1","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"æ“ä½œ é˜Ÿåˆ—ä¸»è¦çš„æ“ä½œä¸º push (å…¥é˜Ÿ) å’Œ pop (å‡ºé˜Ÿ)ã€‚ push å…¥é˜Ÿ ç›´æ¥ä»é˜Ÿåˆ—çš„å°¾éƒ¨ç›´æ¥è¿½åŠ æ–°çš„å…ƒç´ ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œé˜Ÿåˆ—çš„å¤´å°¾æŒ‡é’ˆè¦åŒæ—¶æŒ‡å‘æ–°çš„å…ƒç´ ã€‚å¦‚æœä¸ä¸ºç©ºï¼Œè¿½åŠ å…ƒç´ åéœ€è¦æ›´æ–°é˜Ÿå°¾æŒ‡é’ˆæŒ‡å‘æ–°çš„å…ƒç´ ã€‚ func (q *Queue) Push(val int) { node := \u0026Node{Val: val} if q.head == nil { q.head = node q.tail = node return } q.tail.Next = node q.tail = node } å…¥é˜Ÿçš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚ pop å‡ºé˜Ÿ åœ¨é˜Ÿåˆ—ä¸ä¸ºç©ºæ—¶ï¼Œç›´æ¥è¾“å‡ºé˜Ÿå¤´å…ƒç´ çš„å€¼å¹¶æ›´æ–°é˜Ÿå¤´æŒ‡é’ˆæŒ‡å‘åä¸€ä¸ªå…ƒç´ ã€‚ func (q *Queue) Pop() (int, error) { if q.head == nil { return 0, fmt.Errorf(\"empty queue\") } val := q.head.Val q.head = q.head.Next return val, nil } å‡ºé˜Ÿçš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:3:2","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"ä¼˜å…ˆé˜Ÿåˆ— ä¼˜å…ˆé˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ å¸¦æœ‰æƒé‡å€¼ã€‚è¿™æ—¶é˜Ÿåˆ—ä¸å†æ˜¯ç®€å•çš„ FIFOï¼Œè€Œä¸”æƒé‡å€¼é«˜çš„å…ƒç´ ä¼˜å…ˆå‡ºé˜Ÿã€‚ä¼˜å…ˆé˜Ÿåˆ—å†…éƒ¨ä½¿ç”¨äºŒå‰å †å®ç°ã€‚ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:3:3","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å°ç»“ é˜Ÿåˆ—å…·æœ‰å…ˆè¿›å…ˆå‡ºçš„ç‰¹ç‚¹ï¼Œå®ƒå¸¸è§çš„æ“ä½œæœ‰å…¥é˜Ÿ (Push) å’Œå‡ºé˜Ÿ (Pop)ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚æ€»çš„æ¥è¯´ï¼Œé˜Ÿåˆ—æ˜¯ä¸€ç§ç®€å•çš„æ•°æ®ç»“æ„ï¼Œå¸¸è§çš„ä½¿ç”¨åœºæ™¯æ˜¯å¤„ç†å…·æœ‰å…ˆåé¡ºåºçš„ä»»åŠ¡ã€‚ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:3:4","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"æ ˆ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:4:0","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å®šä¹‰ æ ˆå’Œé˜Ÿåˆ—ç›¸åï¼Œå®ƒæ˜¯ä¸€ç§å…·æœ‰å…ˆè¿›åå‡ºçš„çº¿æ€§è¡¨ã€‚å…ƒç´ ä»æ ˆé¡¶æ·»åŠ ï¼Œä»æ ˆé¡¶ç§»é™¤ã€‚æˆ‘ä»¬å¯å°†æ ˆæƒ³åƒæˆä¸€ä¸ªå­˜æ”¾å°çƒçš„åœ†ç­’ï¼Œæ¡¶çš„å®½åº¦åªèƒ½å®¹çº³ä¸€ä¸ªå°çƒã€‚æ¯æ¬¡æ”¾å…¥å°çƒæ—¶ï¼Œå…ˆè¿›çš„çƒå°±ä¼šè½åˆ°åº•éƒ¨ï¼Œè€Œæ¯æ¬¡ä»æ¡¶ä¸­å–å‡ºæ˜¯ï¼Œæ€»æ˜¯ä»æ¡¶çš„é¡¶éƒ¨å¼€å§‹ã€‚ type Node struct { Val int Next *Node } type Stack struct { top *Node } func NewStack() *Stack { return \u0026Stack{} } func (s Stack) String() string { out := make([]string, 0) p := s.top for p != nil { out = append(out, strconv.Itoa(p.Val)) p = p.Next } return strings.Join(out, \"-\u003e\") } ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:4:1","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"æ“ä½œ æ ˆçš„å¸¸è§æ“ä½œä¸º Push(è¿›æ ˆ) å’Œ Pop (å‡ºæ ˆ)ã€‚ Push è¿›æ ˆ ä»æ ˆé¡¶æ·»åŠ ä¸€ä¸ªæ–°çš„å…ƒç´ ï¼Œæ–°å…ƒç´ çš„ Next æŒ‡é’ˆæŒ‡å‘ top èŠ‚ç‚¹ï¼Œå¹¶æ›´æ–° top æŒ‡é’ˆæŒ‡å‘æ–°çš„å…ƒç´ ã€‚ func (s *Stack) Push(val int) { node := \u0026Node{Val: val} if s.top == nil { s.top = node return } node.Next = s.top s.top = node } è¿›æ ˆæ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚ Pop å‡ºæ ˆ åœ¨æ ˆä¸ä¸ºç©ºæƒ…å†µä¸‹ï¼Œå–å‡º top å…ƒç´ çš„å€¼ï¼Œå¹¶æ›´æ–° top æŒ‡é’ˆæŒ‡å‘æŒ‡å‘åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚ func (s *Stack) Pop() (int, error) { if s.top == nil { return 0, fmt.Errorf(\"empty stack\") } val := s.top.Val s.top = s.top.Next return val, nil } ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:4:2","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å°ç»“ æ ˆå’Œé˜Ÿåˆ—ç»“æ„ç›¸ä¼¼ï¼Œåªæ˜¯åœ¨æ“ä½œä¸Šçš„å¤„ç†æœ‰å†™ä¸åŒã€‚æ ˆæ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(1)ã€‚æ ˆä¹Ÿæ”¯æŒä½¿ç”¨æ•°ç»„å’Œé“¾è¡¨çš„æ–¹å¼å®ç°ã€‚å¦‚æœæ ˆçš„å®¹é‡å°ï¼Œä½¿ç”¨æ•°ç»„æ›´æœ‰ä¼˜åŠ¿ï¼Œåä¹‹åˆ™é€‰é“¾è¡¨ã€‚ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:4:3","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å­—ç¬¦ä¸² å­—ç¬¦ä¸²æ˜¯ç”±é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ç»„æˆçš„æœ‰é™åºåˆ—ã€‚ å­—ç¬¦ä¸²å¸¸è§çš„æ“ä½œä¸ºæ¨¡å¼åŒ¹é…ã€‚æ¨¡å¼åŒ¹é…ç®—æ³•æœ‰: KMPã€BM å’Œ BF ç®—æ³•ã€‚ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:5:0","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å“ˆå¸Œè¡¨ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:6:0","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å®šä¹‰ å“ˆå¸Œè¡¨ä¹Ÿå«æ•£åˆ—è¡¨ï¼Œæ˜¯ä¸€ç§ä½¿ç”¨æ•£åˆ—å‡½æ•° f(key) å»ºç«‹å…³é”®å­— (key) ä¸å…·ä½“å€¼ (value) å¯¹åº”å…³ç³»çš„æ•°æ®ç»“æ„ã€‚å“ˆå¸Œè¡¨çš„å€¼ä¸€èˆ¬å­˜å‚¨åœ¨æ•°ç»„ä¸­ã€‚ å“ˆå¸Œè¡¨çš„è¯»å†™æ€§èƒ½ä¼˜å¼‚ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚å“ˆå¸Œè¡¨æ€§èƒ½ä¼˜å¼‚çš„å…³é”®ç‚¹åœ¨äºå“ˆå¸Œå‡½æ•°å’Œè§£å†³å“ˆå¸Œå†²çªã€‚ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:6:1","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å“ˆå¸Œå‡½æ•° å“ˆå¸Œè¡¨çš„å“ˆå¸Œå‡½æ•°æœ‰ï¼š éšæœºæ•°æ³• æŠ˜å æ³• é™¤ç•™å–ä½™æ³• æœ€ä¸ºå¸¸è§çš„æ˜¯é™¤ç•™å–ä½™æ³•ã€‚å¯¹äºæ•£åˆ—è¡¨é•¿ä¸º m çš„æ•£åˆ—å‡½æ•°å…¬å¼ä¸ºï¼š $$ f(key) = key \\ mod \\ p \\ (p \\leq m) $$ æ ¹æ®ç»éªŒï¼Œè‹¥å“ˆå¸Œè¡¨è¡¨é•¿ä¸º mï¼Œé€šå¸¸ p ä¸ºå°äºæˆ–è€…ç­‰äºè¡¨é•¿ (æœ€å¥½æ¥è¿‘ m) çš„æœ€å°è´¨æ•°æˆ–ä¸åŒ…å«å°äº 20 è´¨å› å­çš„åˆæ•°ã€‚ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:6:2","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å“ˆå¸Œå†²çª åœ¨ç†æƒ³çŠ¶æ€ä¸‹ï¼Œæ¯ä¸ª key ç»è¿‡å“ˆå¸Œå‡½æ•°åéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€å€¼ã€‚ä½†æ˜¯ç†æƒ³ä¸°æ»¡ï¼Œç°å®éª¨æ„Ÿã€‚æ²¡æœ‰å®Œç¾å“ˆå¸Œå‡½æ•°ï¼Œå½“å“ˆå¸Œè¡¨çš„å®¹é‡ä¸æ–­æ‰©å¤§æ—¶ï¼Œä¸å¯é¿å…çš„ä¼šå‡ºç°å“ˆå¸Œå†²çª (ä¸åŒ key ç»è¿‡å“ˆå¸Œå‡½æ•°åæŒ‡å‘ç›¸åŒçš„å“ˆå¸Œåœ°å€)ã€‚å‡ºç°å†²çªåå“ˆå¸Œè¡¨çš„æ€§èƒ½ä¼šæ€¥å‰§ä¸‹é™ï¼Œæç«¯æƒ…å†µä¸‹ä¼šå˜æˆ O(n)ã€‚ æ—¢ç„¶å†²çªä¸å¯é¿å…ï¼Œé‚£å¦‚ä½•å¤„ç†å†²çªå°±æˆä¸ºå…³é”®ç‚¹ã€‚è§£å†³å“ˆå¸Œå†²çªçš„æ–¹å¼æœ‰ï¼š å¼€æ”¾å¯»å€æ³•ï¼šå¦‚æœå‘ç”Ÿå†²çªï¼Œå°±å»å¯»æ‰¾ä¸‹ä¸€ä¸ªç©ºçš„æ•£åˆ—åœ°å€ï¼Œåªè¦æ•£åˆ—è¡¨è¶³å¤Ÿå¤§ï¼Œç©ºçš„æ•£åˆ—åœ°å€æ€»èƒ½æ‰¾åˆ°ã€‚ å†å“ˆå¸Œæ³•ï¼šå¦‚æœå‘ç”Ÿå†²çªï¼Œå°±æ¢ä¸€å¼ æ•£åˆ—å‡½æ•°ï¼Œç›´åˆ°å†²çªè§£å†³ã€‚ å…¬å…±æº¢å‡ºåŒºæ³•ï¼šå»ºç«‹ä¸€ä¸ªå…¬å…±çš„æº¢å‡ºåŒºï¼Œå†²çªçš„å…³é”®å­—å°†å­˜æ”¾åœ¨æ­¤å¤„ã€‚ é“¾åœ°å€æ³•ï¼šå“ˆå¸Œè¡¨çš„å­˜å‚¨ç»“æ„å˜æˆæ•°æ®åŠ ä¸Šé“¾è¡¨ã€‚æ¯ä¸ªå…³é”®å­—å¯¹åº”å­˜å‚¨åœ°å€å˜æˆå•é“¾è¡¨çš„å¤´æŒ‡é’ˆã€‚æœ‰æ—¶ä¸ºäº†é¢„é˜²æç«¯æƒ…å†µå‡ºç°ï¼Œä¼šç”¨çº¢é»‘æ ‘ä»£æ›¿å•é“¾è¡¨ã€‚ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:6:3","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"è£…è½½å› å­ $$ è£…è½½å› å­ = å“ˆå¸Œè¡¨å…ƒç´  / é•¿åº¦ $$ éšç€è£…è½½å› å­çš„å¢åŠ ï¼Œçº¿æ€§æ¢æµ‹çš„å¹³å‡ç”¨æ—¶å°±ä¼šé€æ¸å¢åŠ ï¼Œè¿™ä¼šå½±å“å“ˆå¸Œè¡¨çš„è¯»å†™æ€§èƒ½ã€‚å½“è£…è½½ç‡è¶…è¿‡ 70% ä¹‹åï¼Œå“ˆå¸Œè¡¨çš„æ€§èƒ½å°±ä¼šæ€¥å‰§ä¸‹é™ï¼Œè€Œä¸€æ—¦è£…è½½ç‡è¾¾åˆ° 100%ï¼Œæ•´ä¸ªå“ˆå¸Œè¡¨å°±ä¼šå®Œå…¨å¤±æ•ˆï¼Œè¿™æ—¶æŸ¥æ‰¾å’Œæ’å…¥ä»»æ„å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ ğ‘‚(n) çš„ï¼Œè¿™æ—¶éœ€è¦éå†æ•°ç»„ä¸­çš„å…¨éƒ¨å…ƒç´ ï¼Œæ‰€ä»¥åœ¨å®ç°å“ˆå¸Œè¡¨æ—¶ä¸€å®šè¦å…³æ³¨è£…è½½å› å­çš„å˜åŒ–ã€‚ è€Œä¸ºäº†ä¿è¯å“ˆå¸Œè¡¨çš„æ€§èƒ½ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šè€ƒè™‘å¯¹å“ˆå¸Œè¡¨æ‰©å®¹ã€‚ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:6:4","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å°ç»“ æ€»çš„æ¥è¯´å“ˆå¸Œè¡¨æ˜¯ä¸€ç§å¸¸ç”¨é«˜æ€§èƒ½æ•°æ®ç»“æ„ã€‚åœ¨æŸ¥æ‰¾ç®—æ³•ä¸­å…·æœ‰å¾ˆå¤§ç”¨é€”ã€‚ä½†æ˜¯æƒ³è¦ç»´æŒå®ƒçš„é«˜æ€§èƒ½å°±éœ€è¦å¤„ç†å¥½å“ˆå¸Œå†²çªé—®é¢˜ã€‚ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:6:5","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"æ ‘ æ ‘æ˜¯ä¸€ç§è¾ƒå¤æ‚çš„æ•°æ®ç»“æ„ã€‚ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:7:0","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å®šä¹‰ æ ‘ (Tree) æ˜¯ n $ (n \\geq 0) $ ä¸ªèŠ‚ç‚¹çš„æœ‰é™é›†åˆ æ ‘æœ‰å¾ˆå¤šç›¸å…³çš„æ¦‚å¿µï¼š æ ¹ç»“ç‚¹ (root)ï¼šæ ‘çš„æœ€é¡¶ç«¯ç»“ç‚¹è¢«ç§°ä¸ºæ ‘çš„æ ¹ç»“ç‚¹ã€‚æ¯æ£µæ ‘éƒ½æœ‰ä¸€ä¸ªæ ¹ç»“ç‚¹ï¼Œå®ƒæ˜¯æ ‘çš„å…¥å£ã€‚ å­æ ‘ (SubTree)ï¼šéæ ¹ç»“ç‚¹çš„æ¯ä¸ªé›†åˆæœ¬èº«åˆæ˜¯ä¸€æ£µæ ‘ï¼Œå®ƒä»¬æ˜¯æ ¹çš„å­æ ‘ã€‚ åº¦ (Degree)ï¼šç»“ç‚¹æ‹¥æœ‰çš„å­æ ‘æ•°ç§°ä¸ºç»“ç‚¹çš„åº¦ã€‚ å¶ç»“ç‚¹ (Leaf)ï¼šåº¦ä¸º 0 çš„ç»“ç‚¹ç§°ä¸ºå¶ç»“ç‚¹ã€‚ æ ‘çš„æ·±åº¦ (Depth)ï¼šæ ¹ç»“ç‚¹åˆ°å¶ç»“ç‚¹çš„æœ€å¤§å±‚æ•°ç§°ä¸ºæ ‘çš„æ·±åº¦ã€‚ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:7:1","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"äºŒå‰æ ‘ äºŒå‰æ ‘çš„æ¯ä¸ªç»“ç‚¹æœ€å¤šåªæœ‰ä¸¤æ£µå­æ ‘ï¼Œåˆ†åˆ«ä¸ºå·¦å­æ ‘å’Œå³å­æ ‘ã€‚ æ ‘ç»“ç‚¹ type TreeNode struct { Val int Left *TreeNode Right *TreeNode } ç‰¹æ®Šçš„äºŒå‰æ ‘ 1. æ»¡äºŒå‰æ ‘ åœ¨ä¸€æ£µäºŒå‰æ ‘ä¸­ï¼Œå¦‚æœæ‰€æœ‰åˆ†æ”¯ç»“ç‚¹éƒ½å­˜åœ¨å·¦å­æ ‘å’Œå³å­æ ‘ï¼Œå¹¶ä¸”æ‰€æœ‰å¶å­æ ‘éƒ½åœ¨åŒä¸€å±‚ä¸Šï¼Œè¿™æ ·çš„äºŒå‰æ ‘ç§°ä¸ºæ»¡äºŒå‰æ ‘ã€‚ 2. å®Œå…¨äºŒå‰æ ‘ å¯¹ä¸€æ£µå…·æœ‰ n ä¸ªç»“ç‚¹çš„äºŒå‰æ ‘æŒ‰å±‚åºç¼–å·ï¼Œå¦‚æœç¼–å·ä¸º i $(i \\leq i \\leq n)$ çš„ç»“ç‚¹ä¸åŒæ ·æ·±åº¦çš„æ»¡äºŒå‰æ ‘ä¸­ç¼–å·ä¸º i çš„èŠ‚ç‚¹åœ¨äºŒå‰æ ‘ä¸­ä½ç½®å®Œå…¨ç›¸åŒï¼Œåˆ™è¿™æ£µäºŒå‰æ ‘ç§°ä¸ºå®Œå…¨äºŒå‰æ ‘ã€‚ å¦‚ä½•åˆ¤æ–­ä¸€æ£µæ ‘æ˜¯å¦æ˜¯å®Œå…¨äºŒå‰æ ‘? å¯ä»¥å¯¹ç…§æ ‘çš„ç¤ºæ„å›¾,ç»™æ¯ä¸ªç»“ç‚¹æŒ‰ç…§æ»¡äºŒå‰æ ‘çš„ç»“æ„é€å±‚é¡ºåºç¼–å·,å¦‚æœç¼–å·å‡ºç°ç©ºæ¡£,å°±è¯´æ˜ä¸æ˜¯å®Œå…¨äºŒå‰æ ‘,åä¹‹åˆ™æ˜¯ã€‚ äºŒå‰æ ‘çš„æ€§è´¨ æ€§è´¨1: åœ¨äºŒå‰æ ‘çš„ç¬¬ i å±‚ä¸Šè‡³å¤šæœ‰ $2^{i-1}$ ä¸ªèŠ‚ç‚¹ $ ( i \\geq 1) $ã€‚ æ€§è´¨2: æ·±åº¦ä¸º k çš„äºŒå‰æ ‘è‡³å¤šæœ‰ $2^k-1$ ä¸ªèŠ‚ç‚¹ $(k \\geq 1)$ã€‚ æ€§è´¨3: å¯¹ä»»ä½•ä¸€æ£µäºŒå‰æ ‘ Tï¼Œå¦‚æœå…¶å¶ç»“ç‚¹æ•°ä¸º $n_0$ï¼Œåº¦ä¸º 2 çš„ç»“ç‚¹æ•°ä¸º $n_2$ï¼Œåˆ™ $ n_0 = n_2 + 1$ ã€‚ æ€§è´¨4: å…·æœ‰ n ä¸ªç»“ç‚¹çš„å®Œå…¨äºŒå‰æ ‘çš„æ·±åº¦ä¸º $[log_2n]+1$ ($[x]$ è¡¨ç¤ºä¸å¤§äº x çš„æœ€å¤§æ•´æ•°)ã€‚ æ€§è´¨5: å¦‚æœå¯¹ä¸€ä¸ªæœ‰ n ä¸ªç»“ç‚¹çš„å®Œå…¨äºŒå‰æ ‘ (å…¶æ·±åº¦ä¸º$[log_2n]+1$) çš„èŠ‚ç‚¹æŒ‰å±‚åºç¼–å· (ä»ç¬¬1å±‚åˆ°ç¬¬$[log_2n]+1$å±‚ï¼Œæ¯å±‚ä»å·¦åˆ°å³)ï¼Œå¯¹ä»»ä¸€ç»“ç‚¹ i ($i \\leq i \\leq n$) æœ‰ï¼š å¦‚æœ $i=1$ï¼Œåˆ™ç»“ç‚¹ i æ˜¯äºŒå‰æ ‘çš„æ ¹ï¼Œæ— åŒäº²ï¼›å¦‚æœ $i \u003e 1$ï¼Œåˆ™å…¶åŒäº²æ˜¯èŠ‚ç‚¹ $[i/2]$ ã€‚ å¦‚æœ $2i\u003en$ï¼Œåˆ™ç»“ç‚¹ i æ— å·¦å­©å­ (ç»“ç‚¹ i ä¸ºå¶å­ç»“ç‚¹)ï¼›å¦åˆ™å…¶å·¦å­©å­æ˜¯ç»“ç‚¹ 2iã€‚ å¦‚æœ $2i+1\u003en$ï¼Œåˆ™ç»“ç‚¹ i æ— å³å­©å­ï¼›å¦åˆ™å…¶å³å­©å­æ˜¯ç»“ç‚¹ 2i+1 ã€‚ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:7:2","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"äºŒå‰æ ‘çš„éå† äºŒå‰æ ‘çš„éå† (traversing binary tree) æ˜¯æŒ‡ä»æ ¹ç»“ç‚¹å‡ºå‘ï¼ŒæŒ‰ç…§æŸç§æ¬¡åºä¾æ¬¡è®¿é—®äºŒå‰æ ‘ä¸­æ‰€æœ‰ç»“ç‚¹ï¼Œä½¿å¾—æ¯ä¸ªç»“ç‚¹è¢«è®¿é—®ä¸€æ¬¡ä¸”è¢«è®¿é—®ä¸€æ¬¡ã€‚ äºŒå‰æ ‘å­˜åœ¨å››ç§éå†æ–¹å¼ï¼šå‰åºã€ä¸­åºã€ååºå’Œå±‚åºã€‚ å‰åºéå† å‰åºéå†çš„å¾ªåºçš„: Val -\u003e Left -\u003e Right ä»£ç å®ç°: // é€’å½’æ–¹å¼ func PreorderTraversal1(root *TreeNode) []int { out := make([]int, 0) var traversal func(*TreeNode, *[]int) traversal = func(root *TreeNode, out *[]int) { *out = append(*out, root.Val) traversal(root.Left, out) traversal(root.Right, out) } traversal(root, \u0026out) return out } // è¿­ä»£æ–¹å¼ func PreorderTraversal2(root *TreeNode) []int { vals := make([]int, 0) stack := make([]*TreeNode, 0) node := root for node != nil || len(stack) \u003e 0 { for node != nil { vals = append(vals, node.Val) stack = append(stack, node) node = node.Left } node = stack[len(stack)-1].Right stack = stack[:len(stack)-1] } return vals } ä¸­åºéå† ä¸­åºéå†çš„é¡ºåºä¸º: Left -\u003e Val -\u003e Right ä»£ç å®ç°: // é€’å½’ func InorderTraversal1(root *TreeNode) []int { out := make([]int, 0) var inorder func(*TreeNode, *[]int) inorder = func(root *TreeNode, out *[]int) { if root == nil { return } inorder(root.Left, out) *out = append(*out, root.Val) inorder(root.Right, out) } inorder(root, \u0026out) return out } // è¿­ä»£ func InorderTraversal2(root *TreeNode) []int { out := make([]int, 0) stack := make([]*TreeNode, 0) node := root for node != nil || len(stack) \u003e 0 { for node != nil { stack = append(stack, node) node = node.Left } node = stack[len(stack)-1] stack = stack[:len(stack)-1] out = append(out, node.Val) node = node.Right } return out } ååºéå† ååºéå†çš„é¡ºåºä¸ºï¼šLeft -\u003e Right -\u003e Val ä»£ç å®ç°: // é€’å½’ func postorderTraversal1(root *TreeNode) []int { out := make([]int, 0) var traversal func(*TreeNode, *[]int) traversal = func(root *TreeNode, out *[]int) { if root == nil { return } traversal(root.Left, out) traversal(root.Right, out) *out = append(*out, root.Val) } traversal(root, \u0026out) return out } // è¿­ä»£ func postorderTraversal2(root *TreeNode) []int { out := make([]int, 0) stack := make([]*TreeNode, 0) var prev *TreeNode node := root for node != nil || len(stack) \u003e 0 { for node != nil { stack = append(stack, node) node = node.Left } node = stack[len(stack)-1] stack = stack[:len(stack)-1] if node.Right == nil || node.Right == prev { out = append(out, node.Val) prev = node node = nil } else { stack = append(stack, node) node = node.Right } } return out } å±‚åºéå† éå†é¡ºåºä¸º: Val -\u003e Left -\u003e Rightï¼Œå†é€å±‚è¿›è¡Œã€‚ ä»£ç å®ç°: // è¿­ä»£ func levelTraversal(root *TreeNode) []int { if root == nil { return []int{} } out := make([]int, 0) node := root queue := make([]*TreeNode, 0) queue = append(queue, node) for len(queue) \u003e 0 { length := len(queue) tmp := make([]*TreeNode, 0) for i := 0; i \u003c length; i++ { node = queue[i] out = append(out, node.Val) if node.Left != nil { tmp = append(tmp, node.Left) } if node.Right != nil { tmp = append(tmp, node.Right) } } queue = tmp } return out } morris éå† äºŒå‰æ ‘éå†çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(n)ã€‚ä½†æ˜¯æœ‰ä¸€ç§è¿›é˜¶çš„éå†æ–¹å¼ï¼Œå¯ä»¥å°†ç©ºé—´å¤æ‚åº¦ä¼˜åŒ–ä¸º O(1)ã€‚å®ƒå°±æ˜¯ morris éå†ã€‚ morris éå†çš„åŸç†æ˜¯åˆ©ç”¨çš„æ˜¯æ ‘çš„å¶èŠ‚ç‚¹å·¦å³å­©å­ä¸ºç©ºï¼ˆæ ‘çš„å¤§é‡ç©ºé—²æŒ‡é’ˆï¼‰ï¼Œå®ç°ç©ºé—´å¼€é”€çš„æé™ç¼©å‡ã€‚ morris éå†çš„å®ç°åŸåˆ™ è®°ä½œå½“å‰èŠ‚ç‚¹ä¸ºcurã€‚ å¦‚æœ cur æ— å·¦å­©å­ï¼Œcur å‘å³ç§»åŠ¨ï¼ˆ cur = cur.Rightï¼‰ å¦‚æœ cur æœ‰å·¦å­©å­ï¼Œæ‰¾åˆ° cur å·¦å­æ ‘ä¸Šæœ€å³çš„èŠ‚ç‚¹ï¼Œè®°ä¸º mostright å¦‚æœ mostright çš„ right æŒ‡é’ˆæŒ‡å‘ç©ºï¼Œè®©å…¶æŒ‡å‘ curï¼Œcur å‘å·¦ç§»åŠ¨ï¼ˆcur = cur.Leftï¼‰ å¦‚æœ mostright çš„ right æŒ‡é’ˆæŒ‡å‘ curï¼Œè®©å…¶æŒ‡å‘ç©ºï¼Œcur å‘å³ç§»åŠ¨ï¼ˆcur = cur.Rightï¼‰ å®ç°ä»¥ä¸Šçš„åŸåˆ™ï¼Œå³å®ç°äº†morriséå†ã€‚ morris å‰åºéå† func MorrisPreorderTraversal(root *TreeNode) []int { vals := make([]int, 0) var p1, p2 *TreeNode = root, nil for p1 != nil { p2 = p1.Left if p2 != nil { for p2.Right != nil \u0026\u0026 p2.Right != p1 { p2 = p2.Right } if p2.Right == nil { vals = append(vals, p1.Val) p2.Right = p1 p1 = p1.Left continue } p2.Right = nil } else { vals = append(vals, p1.Val) } p1 = p1.Right } return vals } morris ä¸­åºéå† func MorrisInorderTraversal3(root *TreeNode) []int { vals := make([]int, 0) var p1, p2 *TreeNode = root, nil for p1 != nil { p2 = p1.Left if p2 != nil { for p2.Right != nil \u0026\u0026 p2.Right != p1 { p2 = p2.Right } if p2.Right == nil { p2.Right = p1 p1 = p1.Left continue } vals = append(vals, p1.Val) p2.Right = nil p1 = p1.Right } else { vals = append(vals, p1.Val) p1 = p1.Right } } return vals } morris ååºéå† func MorrisPostorderTraversal(root *TreeNo","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:7:3","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å°ç»“ æ ‘æ˜¯ä¸€ç§è¾ƒå¤æ‚çš„æ•°æ®ç»“æ„ï¼Œæœ¬èŠ‚ä»‹ç»æ ‘çš„ç»“æ„ã€ç‰¹ç‚¹å’Œæ€§è´¨ï¼Œé‡ç‚¹ä»‹ç»äºŒå‰æ ‘ï¼ŒåŠå…¶éå†æ–¹å¼ã€‚èµ·å§‹è¿˜æœ‰å…¶ä»–è®¸å¤šç‰¹æ®Šçš„æ ‘ï¼Œå› ä¸ºæ¯”è¾ƒå¤æ‚è¿™é‡Œå°±ä¸åœ¨èµ˜è¿°ã€‚ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:7:4","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å † ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:8:0","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å®šä¹‰ å †æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œæ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªç‰¹ç‚¹ï¼š å®ƒæ˜¯ä¸€æ£µå®Œå…¨äºŒå‰æ ‘ã€‚ æ¯ä¸ªéå¶å­ç»“ç‚¹çš„å­èŠ‚ç‚¹è¦ä¹ˆéƒ½å°äºè¯¥èŠ‚ç‚¹(å¤§æ ¹å †)ï¼Œè¦ä¹ˆéƒ½å¤§äºè¯¥èŠ‚ç‚¹(å°è·Ÿå †)ã€‚ å †åˆ†æˆå¤§æ ¹å †å’Œå°æ ¹å †ï¼š å¤§æ ¹å †çš„æ ¹ç»“ç‚¹ä¸ºæœ€å¤§å€¼ï¼Œå°æ ¹å †çš„æ ¹ç»“ç‚¹ä¸ºæœ€å°å€¼ã€‚ å®ç° golang æ ‡å‡†åº“ container/heap å¯ä»¥ç”¨æ¥å®ç°å †ã€‚ å¤§æ ¹å †ä»£ç å®ç°: type IntHeap []int func (h IntHeap) Len() int { return len(h) } func (h IntHeap) Less(i, j int) bool { return h[i] \u003e h[j] } func (h IntHeap) Swap(i, j int) { h[i], h[j] = h[j], h[i] } func (h *IntHeap) Push(x interface{}) { *h = append(*h, x.(int)) } func (h *IntHeap) Pop() interface{} { old := *h n := len(old) x := old[n-1] *h = old[:n-1] return x } type MaxHeap struct { data *IntHeap } func NewMaxHeap() *MaxHeap { data := \u0026IntHeap{} heap.Init(data) return \u0026MaxHeap{data: data} } func (h *MaxHeap) Push(v int) { heap.Push(h.data, v) } func (h *MaxHeap) Pop() (int, error) { if h.data.Len() == 0 { return -1, fmt.Errorf(\"empty heap\") } v := heap.Pop(h.data) return v.(int), nil } func (h *MaxHeap) Top() (int, error) { if h.data.Len() == 0 { return -1, fmt.Errorf(\"empty heap\") } return (*h.data)[0], nil } ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:8:1","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"content":"å°ç»“ å †å¯ä»¥ç”¨äºå®ç°ä¼˜å…ˆé˜Ÿåˆ—å’Œå †æ’åºã€‚ ","date":"2022-04-05","objectID":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/:8:2","tags":["æ•°æ®ç»“æ„","golang"],"title":"å¸¸è§çš„æ•°æ®ç»“æ„","uri":"/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"categories":["è¿ç»´"],"content":"ç”±äºåœ¨é¡¹ç›®ä¸­æœ‰è´Ÿè½½å‡è¡¡éœ€æ±‚ï¼Œæ‰€ä»¥å°±æƒ³åˆ°å‡ å¹´å‰å­¦è¿‡çš„ lvsã€‚æœ¬æ–‡è®°å½•ä¸‹ lvs åœ¨ linux å’Œ windows ä¸¤ä¸ªå¹³å°ä¸‹éƒ¨ç½²æ–¹å¼ã€‚ lvs ç®€ä»‹ Linux Virtual Server é¡¹ç›®çš„ç›®æ ‡ ï¼šä½¿ç”¨é›†ç¾¤æŠ€æœ¯å’Œ Linux æ“ä½œç³»ç»Ÿå®ç°ä¸€ä¸ªé«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„æœåŠ¡å™¨ï¼Œå®ƒå…·æœ‰å¾ˆå¥½çš„å¯ä¼¸ç¼©æ€§ï¼ˆScalabilityï¼‰ã€å¯é æ€§ï¼ˆReliabilityï¼‰å’Œå¯ç®¡ç†æ€§ï¼ˆManageabilityï¼‰ã€‚ ç›®å‰ï¼ŒLVS é¡¹ç›®å·²æä¾›äº†ä¸€ä¸ªå®ç°å¯ä¼¸ç¼©ç½‘ç»œæœåŠ¡çš„ Linux Virtual Server æ¡†æ¶ï¼Œå¦‚å›¾ 3 æ‰€ç¤ºã€‚åœ¨ LVS æ¡†æ¶ä¸­ï¼Œæä¾›äº†å«æœ‰ä¸‰ç§ IP è´Ÿè½½å‡è¡¡æŠ€æœ¯çš„ IP è™šæ‹ŸæœåŠ¡å™¨è½¯ä»¶ IPVSã€åŸºäºå†…å®¹è¯·æ±‚åˆ†å‘çš„å†…æ ¸ Layer-7 äº¤ æ¢æœº KTCPVS å’Œé›†ç¾¤ç®¡ç†è½¯ä»¶ã€‚å¯ä»¥åˆ©ç”¨ LVS æ¡†æ¶å®ç°é«˜å¯ä¼¸ç¼©çš„ã€é«˜å¯ç”¨çš„ Webã€Cacheã€Mail å’Œ Media ç­‰ç½‘ç»œæœåŠ¡ï¼›åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¯ä»¥å¼€ å‘æ”¯æŒåºå¤§ç”¨æˆ·æ•°çš„ã€é«˜å¯ä¼¸ç¼©çš„ã€é«˜å¯ç”¨çš„ç”µå­å•†åŠ¡åº”ç”¨ã€‚ æ›´åŠ å…·ä½“çš„ä¿¡æ¯å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ ç¯å¢ƒè¯´æ˜ è§’è‰² IP åœ°å€ ç¯å¢ƒ director 192.168.221.150 CentOS7, ipvsadm linux real server 1 192.168.221.200 CentOSï¼Œnginx linux real server 2 192.168.221.176 CentOS, nginx windows real server 1 192.168.221.190 Windows Server2012, nginx windows real server 2 192.168.221.191 Windows Server2012, nginx ç¯å¢ƒéƒ¨ç½² ","date":"2022-03-23","objectID":"/lvs%E5%9D%87%E8%A1%A1%E8%B4%9F%E8%BD%BD%E5%AE%9E%E6%88%98/:0:0","tags":["linux"],"title":"Lvs è´Ÿè½½å‡è¡¡å®æˆ˜","uri":"/lvs%E5%9D%87%E8%A1%A1%E8%B4%9F%E8%BD%BD%E5%AE%9E%E6%88%98/"},{"categories":["è¿ç»´"],"content":"director é…ç½® director ä½œä¸ºè´Ÿè½½å‡è¡¡çš„æœåŠ¡ç«¯ï¼Œæä¾›å…¥å£ã€‚é¦–å…ˆå®‰è£… ipvsadm å·¥å…· yum install -y ipvsadm æ·»åŠ å­ç½‘å¡ eth0:0 ifconfig eth0:0 192.168.221.150 broadcast 192.168.221.150 netmask 255.255.255.255 up route add -host 192.168.221.150 dev eth0:0 å¼€å¯ç«¯å£è½¬å‘ echo 1 \u003e /proc/sys/net/ipv4/ip_forward é…ç½® ipvs è§„åˆ™ ipvsadm -C ipvsadm -A -t 192.168.221.150:80 -s rr ipvsadm -a -t 192.168.221.150:80 -r 192.168.221.200:80 -g -w 1 ipvsadm -a -t 192.168.221.150:80 -r 192.168.221.176:80 -g -w 1 è¿™é‡Œä½œä¸€ä¸ªç®€è¦çš„è¯´æ˜ï¼Œé¦–å…ˆä½¿ç”¨ ipvsadm -A æ·»åŠ  VIP å¹¶æŒ‡å®šè´Ÿè½½è°ƒåº¦ç®—æ³•ä¸º rrã€‚æ¥ç€æ·»åŠ éœ€è¦å¦†å‘çš„çœŸå®æœåŠ¡å™¨æœåŠ¡å…¥å£ã€‚è¿™é‡Œå…ˆé€‰æ‹©ä¸¤å° linux ä¸»æœºã€‚ ","date":"2022-03-23","objectID":"/lvs%E5%9D%87%E8%A1%A1%E8%B4%9F%E8%BD%BD%E5%AE%9E%E6%88%98/:1:0","tags":["linux"],"title":"Lvs è´Ÿè½½å‡è¡¡å®æˆ˜","uri":"/lvs%E5%9D%87%E8%A1%A1%E8%B4%9F%E8%BD%BD%E5%AE%9E%E6%88%98/"},{"categories":["è¿ç»´"],"content":"linux real server é…ç½® æ¥ç€åœ¨ä¸¤å° linux real server è®¾ç½® vipã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ vip=192.168.10.140 ifconfig lo:0 $vip broadcast $vip netmask 255.255.255.255 up route add -host $vip lo:0 echo \"1\" \u003e /proc/sys/net/ipv4/conf/lo/arp_ignore echo \"2\" \u003e /proc/sys/net/ipv4/conf/lo/arp_announce echo \"1\" \u003e /proc/sys/net/ipv4/conf/all/arp_ignore echo \"2\" \u003e /proc/sys/net/ipv4/conf/all/arp_announce é€šè¿‡å‘½ä»¤ curl å‘½ä»¤éªŒè¯ç»“æœ curl http://192.168.221.150/ ","date":"2022-03-23","objectID":"/lvs%E5%9D%87%E8%A1%A1%E8%B4%9F%E8%BD%BD%E5%AE%9E%E6%88%98/:2:0","tags":["linux"],"title":"Lvs è´Ÿè½½å‡è¡¡å®æˆ˜","uri":"/lvs%E5%9D%87%E8%A1%A1%E8%B4%9F%E8%BD%BD%E5%AE%9E%E6%88%98/"},{"categories":["è¿ç»´"],"content":"windows real server é…ç½® å…ˆä¿®æ”¹ director ä¸Šçš„ ipvs è§„åˆ™ # åˆ é™¤åŸæœ‰è§„åˆ™ ipvsadm -D -t 192.168.221.150:80 ipvsadm -A -t 192.168.221.150:80 -s rr ipvsadm -a -t 192.168.221.150:80 -r 192.168.221.190:80 -g -w 1 ipvsadm -a -t 192.168.221.150:80 -r 192.168.221.191:80 -g -w 1 windows real server çš„æ“ä½œå’Œ linux ç±»ä¼¼ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ã€‚é»˜è®¤å®‰è£… windows æ—¶ï¼Œæœ¬æœºä¸ä¼šé…ç½®å›ç¯åœ°å€ï¼Œéœ€è¦ç”¨æˆ·æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ªã€‚æ‰‹åŠ¨æ·»åŠ çš„æ“ä½œæ­¥éª¤å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡æ¡£ã€‚ å¦‚æœæƒ³è¦é€šè¿‡å‘½ä»¤è¡Œæ–¹å¼æ·»åŠ å›ç¯è®¾å¤‡ï¼Œwindows ç³»ç»Ÿä¸­éœ€è¦å®‰è£… devcon.exe å‘½ä»¤ã€‚å®‰è£… devcon.exe å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡æ¡£ è¿™é‡Œä»‹ç»å¦‚ä½•é€šè¿‡å‘½ä»¤æ–¹å¼å®ç°å’Œ linux ä¸‹ç›¸åŒçš„æ“ä½œ C:\\\\devcon.exe /r install C:\\\\windows\\\\inf\\\\netloop.inf *msloop æ‰§è¡ŒæˆåŠŸåä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å›ç¯è®¾å¤‡ï¼Œå‘½ä»¤ ipconfig /all æ•ˆæœå¦‚ä¸‹ æ³¨: åˆ›å»ºçš„å›ç¯è®¾å¤‡çš„ mac åœ°å€éƒ½æ˜¯: 02-00-3C-4F-4F-50 ä¿®æ”¹å›ç¯è®¾å¤‡åç§°å’Œ vip åœ°å€ # ç½‘å¡é‡å‘½å netsh interface set interface name=\"æœ¬åœ°è¿æ¥ 4\" newname=\"realserver\" # æ·»åŠ  vip netsh interface ip set address name=\"realserver\" source=static 192.168.221.150 255.255.255.255 ä¿®æ”¹ç½‘å¡æ¥å£å’Œå›ç¯è®¾å¤‡æ¥å£è¿æ¥æ¨¡å¼ï¼Œå¼€å¯å¼±ä¸»æœºæ¨¡å¼ netsh interface ipv4 set interface \"realserver\" weakhostreceive=enabled netsh interface ipv4 set interface \"realserver\" weakhostsend=enabled netsh interface ipv4 set interface \"æœ¬åœ°è¿çº¿\" weakhostreceive=enabled netsh interface ipv4 set interface \"æœ¬åœ°è¿çº¿\" weakhostsend=enabled æ³¨: æœ¬åœ°è¿çº¿ æ›¿æ¢æˆ real server å¯¹åº”çš„ç½‘å¡åç§° ","date":"2022-03-23","objectID":"/lvs%E5%9D%87%E8%A1%A1%E8%B4%9F%E8%BD%BD%E5%AE%9E%E6%88%98/:3:0","tags":["linux"],"title":"Lvs è´Ÿè½½å‡è¡¡å®æˆ˜","uri":"/lvs%E5%9D%87%E8%A1%A1%E8%B4%9F%E8%BD%BD%E5%AE%9E%E6%88%98/"},{"categories":["ç¬”è®°"],"content":"ç®€ä»‹ ä¼—æ‰€å‘¨çŸ¥ï¼ŒOâ€™Reilly æ˜¯ä¸€å®¶ä¸–ç•Œè‘—åçš„æŠ€æœ¯ä¹¦å‡ºç‰ˆå•†ï¼Œæä¾›å¤§é‡é«˜è´¨é‡çš„æŠ€æœ¯ä¹¦ç±ã€‚ä½†æ˜¯ä¸æ”¯æŒä¸‹è½½åŠŸèƒ½ï¼Œæ‰€ä»¥æœ¬ç¯‡å°±æ¥è¯´æ˜å¦‚ä½•ä¸‹è½½ Oâ€™Reilly ä¸Šçš„ç”µå­ä¹¦ã€‚ å®‰è£… é¦–å…ˆä¸‹è½½ safaribooks å·¥å…·ã€‚ $ git clone https://github.com/lorenzodifuccia/safaribooks.git Cloning into 'safaribooks'... $ cd safaribooks/ $ pip3 install -r requirements.txt OR $ pipenv install \u0026\u0026 pipenv shell æœ¬æœºéœ€è¦å®‰è£… Python3 ç¯å¢ƒã€‚ safaribooks çš„ä½¿ç”¨å‘½ä»¤å¦‚ä¸‹ï¼š python3 safaribooks.py --cred \"account_mail@mail.com:password01\" XXXXXXXXXXXXX å…¶ä¸­ XXXXXXXXXXXXX è¡¨ç¤ºç”µå­ä¹¦çš„ IDã€‚ä¾‹å¦‚ç”µå­ä¹¦é¡µé¢ https://learning.oreilly.com/videos/python-fundamentals/9780135917411/ çš„ ID å°±æ˜¯ 9780135917411ã€‚ å› ä¸ºä½œè€…çš„ Oâ€™Reilly è´¦å·ä¸º ACM å…³è”è´¦å·ï¼Œæ— æ³•é€šè¿‡ç›´æ¥ä½¿ç”¨è´¦å·å¯†ç æ–¹å¼ç™»å½•ä¸‹è½½ã€‚æ‰€ä»¥é€‰æ‹©ç¬¬äºŒç§æ–¹å¼ï¼šæœ¬åœ° cookies.json æ–‡ä»¶ã€‚ ä¸‹è½½ å…ˆåœ¨æµè§ˆå™¨ä¸­ç™»å½• Oâ€™Reilly é¡µé¢ï¼Œè½¬åˆ°è¿™ä¸ªé¦–é¡µ https://learning.oreilly.com/profile/ã€‚æ‰“å¼€æµè§ˆå™¨çš„å¼€å‘è€…æ¨¡å¼ï¼Œåœ¨ Console ä¸‹æ‰§è¡Œå‘½ä»¤: javascript:(function(){var output = {};document.cookie.split(/\\s*;\\s*/).forEach(function(pair) {pair = pair.split(/\\s*=\\s*/);output[pair[0]]=pair.splice(1).join('=');});console.log(JSON.stringify(output));})(); å°†è¾“å‡ºçš„ä¿¡æ¯ä¿å­˜åˆ° safaribooks ç›®å½•ä¸‹çš„ cookies.json æ–‡ä»¶ä¸­ã€‚ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä¸‹è½½ç”µå­ä¹¦ï¼š python3 safaribooks.py XXXXXXXXXXXXX è¾“å‡ºç»“æœä¸º: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•— â–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â•šâ•â•â•â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–„â–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ•”â• â–€â–€â•â•â• â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•— â•šâ•â•â•â•â•â• â•šâ•â• â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â• â•šâ•â• ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ [-] Successfully authenticated. [*] Retrieving book info... [-] Title: Linux Kernel Programming [-] Authors: Kaiwan N Billimoria [-] Identifier: 9781789953435 [-] ISBN: 9781789953435 [-] Publishers: Packt Publishing [-] Rights: [-] Description: Learn how to write high-quality kernel module code, solve common Linux kernel programming issues, and understand the fundamentals of Linux kernel internalsKey FeaturesDiscover how to write kernel code using the Loadable Kernel Module frameworkExplore industry-grade techniques to perform efficient memory allocation and data synchronization within the kernelUnderstand the essentials of key internals topics such as kernel architecture, memory management, CPU scheduling, and kernel synchronizationBo... [-] Release Date: 2021-03-19 [-] URL: https://learning.oreilly.com/library/view/linux-kernel-programming/9781789953435/ [*] Retrieving book chapters... [*] Output directory: /Users/xingyys/project/python3/safaribooks/Books/Linux Kernel Programming (9781789953435) [-] Downloading book contents... (25 chapters) [###################################################################################################################################################################################################] 100% [-] Downloading book CSSs... (2 files) [###################################################################################################################################################################################################] 100% [-] Downloading book images... (145 files) [###################################################################################################################################################################################################] 100% [-] Creating EPUB file... [*] Done: /Users/xingyys/project/python3/safaribooks/Books/Linux Kernel Programming (9781789953435)/9781789953435.epub If you like it, please * this project on GitHub to make it known: https://github.com/lorenzodifuccia/safaribooks e don't forget to renew your Safari Books Online subscription: https://learning.oreilly.com [!] Bye!! æ ¼å¼è½¬åŒ– ä¸‹è½½çš„ç”µå­ä¹¦ä¸º epub æ ¼å¼ï¼Œå¦‚æœéœ€è¦å…¶ä»–æ ¼å¼æ—¶ï¼Œå¯ä»¥å€Ÿç”¨ calibre å·¥å…·æ¥è½¬åŒ–ã€‚ ","date":"2022-03-08","objectID":"/%E4%B8%8B%E8%BD%BDoreilly%E7%94%B5%E5%AD%90%E4%B9%A6/:0:0","tags":["è¯»ä¹¦"],"title":"ä¸‹è½½oreillyç”µå­ä¹¦","uri":"/%E4%B8%8B%E8%BD%BDoreilly%E7%94%B5%E5%AD%90%E4%B9%A6/"},{"categories":["è¿ç»´"],"content":"ç®€ä»‹ å¦‚ä½•æ›´æ¢ CentOS8 çš„ yum æºæˆå›½å†…æºã€‚ å†…å®¹ å¤‡ä»½è€çš„ *.repo æ–‡ä»¶ cd /etc/yum.repo.d/ mkdir bak mv *.repo ./bak æ·»åŠ æ–°çš„ CentOS-Base.repo æ–‡ä»¶ vi CentOS-Base.repo # CentOS-Base.repo # # The mirror system uses the connecting IP address of the client and the # update status of each mirror to pick mirrors that are updated to and # geographically close to the client. You should use this for CentOS updates # unless you are manually picking other mirrors. # # If the mirrorlist= does not work for you, as a fall back you can try the # remarked out baseurl= line instead. # # [base] name=CentOS-8.5.2111 - Base - mirrors.aliyun.com #failovermethod=priority baseurl=https://mirrors.aliyun.com/centos-vault/8.5.2111/BaseOS/$basearch/os/ http://mirrors.aliyuncs.com/centos-vault/8.5.2111/BaseOS/$basearch/os/ http://mirrors.cloud.aliyuncs.com/centos-vault/8.5.2111/BaseOS/$basearch/os/ gpgcheck=1 gpgkey=https://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-Official #additional packages that may be useful [extras] name=CentOS-8.5.2111 - Extras - mirrors.aliyun.com #failovermethod=priority baseurl=https://mirrors.aliyun.com/centos-vault/8.5.2111/extras/$basearch/os/ http://mirrors.aliyuncs.com/centos-vault/8.5.2111/extras/$basearch/os/ http://mirrors.cloud.aliyuncs.com/centos-vault/8.5.2111/extras/$basearch/os/ gpgcheck=1 gpgkey=https://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-Official #additional packages that extend functionality of existing packages [centos-vaultplus] name=CentOS-8.5.2111 - Plus - mirrors.aliyun.com #failovermethod=priority baseurl=https://mirrors.aliyun.com/centos-vault/8.5.2111/centos-vaultplus/$basearch/os/ http://mirrors.aliyuncs.com/centos-vault/8.5.2111/centos-vaultplus/$basearch/os/ http://mirrors.cloud.aliyuncs.com/centos-vault/8.5.2111/centos-vaultplus/$basearch/os/ gpgcheck=1 enabled=0 gpgkey=https://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-Official [PowerTools] name=CentOS-8.5.2111 - PowerTools - mirrors.aliyun.com #failovermethod=priority baseurl=https://mirrors.aliyun.com/centos-vault/8.5.2111/PowerTools/$basearch/os/ http://mirrors.aliyuncs.com/centos-vault/8.5.2111/PowerTools/$basearch/os/ http://mirrors.cloud.aliyuncs.com/centos-vault/8.5.2111/PowerTools/$basearch/os/ gpgcheck=1 enabled=0 gpgkey=https://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-Official [AppStream] name=CentOS-8.5.2111 - AppStream - mirrors.aliyun.com #failovermethod=priority baseurl=https://mirrors.aliyun.com/centos-vault/8.5.2111/AppStream/$basearch/os/ http://mirrors.aliyuncs.com/centos-vault/8.5.2111/AppStream/$basearch/os/ http://mirrors.cloud.aliyuncs.com/centos-vault/8.5.2111/AppStream/$basearch/os/ gpgcheck=1 gpgkey=https://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-Official ç›´æ¥ä½¿ç”¨å›½å†…é•œåƒç«™ä¸Šä¸‹è½½çš„æºæ–‡ä»¶ä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯ CentOS ç¤¾åŒºçš„æ–°è§„å¯¼è‡´åŸæ¥çš„è·¯å¾„éƒ½ 404 é”™è¯¯ã€‚ æ›´æ–°ç¼“å­˜ dnf makecache æ³¨: CentOS8 ä¸­ä½¿ç”¨ dnf æ¥æ›¿æ¢åŸæ¥çš„ yum å·¥å…·ã€‚å®ƒä»¬çš„ç”¨æ³•ä¸€è‡´ ","date":"2022-02-16","objectID":"/%E9%85%8D%E7%BD%AEcentos8%E7%9A%84yum%E6%BA%90/:0:0","tags":["linux"],"title":"é…ç½®CentOS8çš„yumæº","uri":"/%E9%85%8D%E7%BD%AEcentos8%E7%9A%84yum%E6%BA%90/"},{"categories":["å¼€å‘"],"content":"æœ¬ç¯‡ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨ Clion æ¥è¿œç¨‹è°ƒæ•´ C è¯­è¨€ä»£ç ã€‚æ‰€éœ€ç¯å¢ƒå¦‚ä¸‹: Mac ä¸»æœº Clion 2021.3.3 CentOS8 è¿œç¨‹å¼€å‘æœº åœ¨ mac ä¸Šæ–°å»ºä¸€ä¸ª mac é¡¹ç›® æ·»åŠ è¿œç¨‹å·¥å…·é“¾ toolchains: settings â€“\u003e Build â€“\u003e toolchains Clion é»˜è®¤é¡¹ç›®é»˜è®¤çš„ cmake æœ€å°ç‰ˆæœ¬ä¸º 3.21ã€‚æœ¬åœ°å‡çº§ cmake sudo brew upgrade cmake è¿œç¨‹ CentOS8 å®‰è£…å·¥å…·åº“ dnf install -y gcc gcc-c++ cmake wget net-tools openssl-devel ä¸‹è½½ cmake wget https://github.com/Kitware/CMake/releases/download/v3.21.5/cmake-3.21.5-linux-x86_64.tar.gz tar -xvf cmake-3.21.5-linux-x86_64.tar.gz cd cmake-3.21.5 å®‰è£… cmake ./bootstrap make make install åˆ é™¤æ—§ç‰ˆæœ¬çš„ cmake dnf remove -y cmake å®‰è£… gdb ç­‰å·¥å…· dnf install -y make clang gdb gdb-gdbsever è°ƒæ•´ Clion çš„ cmake é…ç½®ï¼š settings â€“\u003e Build â€“\u003e Cmake æ·»åŠ  Debug Configuration: é…ç½®è¿œç¨‹ linux è¿æ¥: settings â€“\u003e Deployment è°ƒæ•´è¿œç¨‹ç›®å½•çš„æ˜ å°„å…³ç³» ä»¥ä¸‹ä¸ºæœ€ç»ˆæ ·å¼ ä»¥ä¸Šå°±æ˜¯æœ¬ç¯‡çš„å…¨éƒ¨å†…å®¹äº†ï¼Œæœ‰äº†ä»¥ä¸Šé…ç½®çš„ç¯å¢ƒï¼Œå°±å¯ä»¥å¤§å¤§æé«˜Cçš„å¼€å‘æ•ˆç‡äº†ï¼Œæ„‰å¿«çš„å¼€å‘å§ï¼ ","date":"2022-02-16","objectID":"/clion%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95c%E4%BB%A3%E7%A0%81/:0:0","tags":["clion","linux","C"],"title":"Clionè¿œç¨‹è°ƒè¯•cä»£ç ","uri":"/clion%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95c%E4%BB%A3%E7%A0%81/"},{"categories":["äº‘åŸç”Ÿ"],"content":"æœ¬æ–‡ä»‹ç»å¦‚ä½•é€šè¿‡ Kubeadm å·¥å…·å®‰è£… Kubernetes 1.23ã€‚ ","date":"2022-01-13","objectID":"/%E5%AE%89%E8%A3%85kubernetes1.23/:0:0","tags":["k8s"],"title":"å®‰è£…kubernetes1.23","uri":"/%E5%AE%89%E8%A3%85kubernetes1.23/"},{"categories":["äº‘åŸç”Ÿ"],"content":"ä¸€ã€å‡†å¤‡ ","date":"2022-01-13","objectID":"/%E5%AE%89%E8%A3%85kubernetes1.23/:1:0","tags":["k8s"],"title":"å®‰è£…kubernetes1.23","uri":"/%E5%AE%89%E8%A3%85kubernetes1.23/"},{"categories":["äº‘åŸç”Ÿ"],"content":"1.1 ç³»ç»Ÿç¯å¢ƒ å‡†å¤‡ä¸‰å°vmwareè™šæ‹Ÿæœºï¼Œé…ç½®ä¸º CentOS7.6 / 2Core / 2Gï¼Œç³»ç»Ÿç¯å¢ƒå¦‚ä¸‹: 172.16.219.100 k8s-master 172.16.219.101 k8s-slave1 172.16.219.102 k8s-slave2 ","date":"2022-01-13","objectID":"/%E5%AE%89%E8%A3%85kubernetes1.23/:1:1","tags":["k8s"],"title":"å®‰è£…kubernetes1.23","uri":"/%E5%AE%89%E8%A3%85kubernetes1.23/"},{"categories":["äº‘åŸç”Ÿ"],"content":"1.2 é…ç½®é˜²ç«å¢™ å…³é—­Linuxçš„é˜²ç«å¢™ systemctl stop firewalld systemctl disable firewalld å…³é—­ selinux setenforce 0 vim /etc/selinux/config SELINUX=disabled ","date":"2022-01-13","objectID":"/%E5%AE%89%E8%A3%85kubernetes1.23/:1:2","tags":["k8s"],"title":"å®‰è£…kubernetes1.23","uri":"/%E5%AE%89%E8%A3%85kubernetes1.23/"},{"categories":["äº‘åŸç”Ÿ"],"content":"1.3 å…³é—­ swap åˆ†åŒº Kubernetes 1.8å¼€å§‹è¦æ±‚å…³é—­ç³»ç»Ÿçš„Swapï¼Œå¦‚æœä¸å…³é—­ï¼Œé»˜è®¤é…ç½®ä¸‹kubeletå°†æ— æ³•å¯åŠ¨ã€‚ å…³é—­ç³»ç»Ÿçš„Swapæ–¹æ³•å¦‚ä¸‹: swapoff -a åŒæ—¶ä¿®æ”¹ /etc/fstab: #UUID=7f0f3bd8-3605-4ad7-81b0-1a91c735969f swap swap defaults 0 0 ","date":"2022-01-13","objectID":"/%E5%AE%89%E8%A3%85kubernetes1.23/:1:3","tags":["k8s"],"title":"å®‰è£…kubernetes1.23","uri":"/%E5%AE%89%E8%A3%85kubernetes1.23/"},{"categories":["äº‘åŸç”Ÿ"],"content":"1.4 éƒ¨ç½² containerd kubernetes 1.22 ç‰ˆæœ¬ä¹‹åï¼Œé»˜è®¤çš„å®¹å™¨è¿è¡Œæ—¶å˜æˆ containerdã€‚æ‰€ä»¥åœ¨å®‰è£… k8s ä¹‹å‰å…ˆå®‰è£… containerdã€‚ é…ç½® overlay cat \u003c\u003c EOF \u003e /etc/modules-load.d/containerd.conf overlay br_netfilter EOF åŠ è½½å†…æ ¸é…ç½® modprobe overlay modprobe br_netfilter ä¿®æ”¹ç½‘ç»œç›¸å…³çš„å†…æ ¸å‚æ•° cat \u003c\u003c EOF \u003e /etc/sysctl.d/99-kubernetes-cri.conf net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 net.ipv4.ip_forward = 1 user.max_user_namespaces=28633 vm.swappiness=0 EOF åŠ è½½é…ç½® sysctl -p /etc/sysctl.d/99-kubernetes-cri.conf ç°åœ¨ kube-proxy å¯ä»¥ä½¿ç”¨ ipvs æ¥ä»£æ›¿åŸæ¥çš„ iptablesã€‚é…ç½® ipvs: cat \u003e /etc/sysconfig/modules/ipvs.modules \u003c\u003cEOF #!/bin/bash modprobe -- ip_vs modprobe -- ip_vs_rr modprobe -- ip_vs_wrr modprobe -- ip_vs_sh modprobe -- nf_conntrack_ipv4 EOF chmod 755 /etc/sysconfig/modules/ipvs.modules bash /etc/sysconfig/modules/ipvs.modules å®‰è£… ipvs å·¥å…·ï¼Œæ–¹ä¾¿ç®¡ç† ipvs è§„åˆ™ yum install -y ipset ipvsadm å®‰è£…éƒ¨ç½² containerdï¼Œåœ¨å„ä¸ªèŠ‚ç‚¹ä¸Šå®‰è£… containerd wget https://github.com/containerd/containerd/releases/download/v1.5.8/cri-containerd-cni-1.5.8-linux-amd64.tar.gz ç›´æ¥è§£å‹åˆ° / ç›®å½•ä¸‹ï¼Œ tar -zxvf cri-containerd-cni-1.5.8-linux-amd64.tar.gz -C / ç”±äº cri-containerd-cni-1.5.8-linux-amd64.tar.gz åŒ…å†…éƒ¨çš„ runc åŒ…åœ¨ CentOS7 ä¸‹çš„åŠ¨æ€é“¾æ¥æœ‰é—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶æ›¿æ¢å®ƒã€‚ wget https://github.com/opencontainers/runc/releases/download/v1.1.0-rc.1/runc.amd64 mv runc.amd64 /usr/local/sbin/runc ç”Ÿæˆ containerd çš„é…ç½®æ–‡ä»¶å¹¶ä¿®æ”¹ mkdir -p /etc/containerd containerd config default \u003e /etc/containerd/config.toml æ ¹æ®æ–‡æ¡£Container runtimes ä¸­çš„å†…å®¹ï¼Œå¯¹äºä½¿ç”¨systemdä½œä¸ºinit systemçš„Linuxçš„å‘è¡Œç‰ˆï¼Œä½¿ç”¨systemdä½œä¸ºå®¹å™¨çš„cgroup driverå¯ä»¥ç¡®ä¿æœåŠ¡å™¨èŠ‚ç‚¹åœ¨èµ„æºç´§å¼ çš„æƒ…å†µæ›´åŠ ç¨³å®šï¼Œå› æ­¤è¿™é‡Œé…ç½®å„ä¸ªèŠ‚ç‚¹ä¸Šcontainerdçš„cgroup driverä¸ºsystemdã€‚ ä¿®æ”¹å‰é¢ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ /etc/containerd/config.tomlï¼š [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc] ... [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc.options] SystemdCgroup = true ç”±äº k8s.grc.io è¢«å¢™ï¼Œæ›¿æ¢æˆå›½å†…æºã€‚å†ä¿®æ”¹ /etc/containerd/config.toml [plugins.\"io.containerd.grpc.v1.cri\"] ... # sandbox_image = \"k8s.gcr.io/pause:3.5\" sandbox_image = \"registry.aliyuncs.com/google_containers/pause:3.6\" é…ç½® containerd å¼€æœºè‡ªå¯ systemctl enable containerd systemctl start containerd æ‰§è¡Œ crictl å‘½ä»¤æµ‹è¯• crictl version Version: 0.1.0 RuntimeName: containerd RuntimeVersion: v1.5.8 RuntimeApiVersion: v1alpha2 ","date":"2022-01-13","objectID":"/%E5%AE%89%E8%A3%85kubernetes1.23/:1:4","tags":["k8s"],"title":"å®‰è£…kubernetes1.23","uri":"/%E5%AE%89%E8%A3%85kubernetes1.23/"},{"categories":["äº‘åŸç”Ÿ"],"content":"äºŒã€éƒ¨ç½² Kubernetes ","date":"2022-01-13","objectID":"/%E5%AE%89%E8%A3%85kubernetes1.23/:2:0","tags":["k8s"],"title":"å®‰è£…kubernetes1.23","uri":"/%E5%AE%89%E8%A3%85kubernetes1.23/"},{"categories":["äº‘åŸç”Ÿ"],"content":"2.1 å®‰è£… kubeadm ç¯å¢ƒéƒ½å‡†å¤‡å®Œæˆåï¼Œå¼€å§‹è¯å®å®‰è£… k8sã€‚åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šå®‰è£… kubeadm å’Œ kubeletï¼Œå…ˆé…ç½® yum æº cat \u003c\u003cEOF \u003e /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64 enabled=1 gpgcheck=0 repo_gpgcheck=0 gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg EOF æ›´æ–°ç¼“å­˜ yum makecache fast yum install -y kubelet kubeadm kubectl å¼€æœºå¯åŠ¨ kubelet æœåŠ¡ systemctl enable kubelet ","date":"2022-01-13","objectID":"/%E5%AE%89%E8%A3%85kubernetes1.23/:2:1","tags":["k8s"],"title":"å®‰è£…kubernetes1.23","uri":"/%E5%AE%89%E8%A3%85kubernetes1.23/"},{"categories":["äº‘åŸç”Ÿ"],"content":"2.2 åˆå§‹åŒ–é›†ç¾¤ ä½¿ç”¨ kubeadm config print init-defaults --component-configs KubeletConfiguration å¯ä»¥æ‰“å°é›†ç¾¤åˆå§‹åŒ–é»˜è®¤çš„ä½¿ç”¨çš„é…ç½®ï¼š apiVersion: kubeadm.k8s.io/v1beta3 bootstrapTokens: - groups: - system:bootstrappers:kubeadm:default-node-token token: abcdef.0123456789abcdef ttl: 24h0m0s usages: - signing - authentication kind: InitConfiguration localAPIEndpoint: advertiseAddress: 1.2.3.4 bindPort: 6443 nodeRegistration: criSocket: /var/run/dockershim.sock imagePullPolicy: IfNotPresent name: node taints: null --- apiServer: timeoutForControlPlane: 4m0s apiVersion: kubeadm.k8s.io/v1beta3 certificatesDir: /etc/kubernetes/pki clusterName: kubernetes controllerManager: {} dns: {} etcd: local: dataDir: /var/lib/etcd imageRepository: k8s.gcr.io kind: ClusterConfiguration kubernetesVersion: 1.23.0 networking: dnsDomain: cluster.local serviceSubnet: 10.96.0.0/12 scheduler: {} --- apiVersion: kubelet.config.k8s.io/v1beta1 authentication: anonymous: enabled: false webhook: cacheTTL: 0s enabled: true x509: clientCAFile: /etc/kubernetes/pki/ca.crt authorization: mode: Webhook webhook: cacheAuthorizedTTL: 0s cacheUnauthorizedTTL: 0s cgroupDriver: systemd clusterDNS: - 10.96.0.10 clusterDomain: cluster.local cpuManagerReconcilePeriod: 0s evictionPressureTransitionPeriod: 0s fileCheckFrequency: 0s healthzBindAddress: 127.0.0.1 healthzPort: 10248 httpCheckFrequency: 0s imageMinimumGCAge: 0s kind: KubeletConfiguration logging: flushFrequency: 0 options: json: infoBufferSize: \"0\" verbosity: 0 memorySwap: {} nodeStatusReportFrequency: 0s nodeStatusUpdateFrequency: 0s rotateCertificates: true runtimeRequestTimeout: 0s shutdownGracePeriod: 0s shutdownGracePeriodCriticalPods: 0s staticPodPath: /etc/kubernetes/manifests streamingConnectionIdleTimeout: 0s syncFrequency: 0s volumeStatsAggPeriod: 0s ä»é»˜è®¤çš„é…ç½®ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå¯ä»¥ä½¿ç”¨imageRepositoryå®šåˆ¶åœ¨é›†ç¾¤åˆå§‹åŒ–æ—¶æ‹‰å–k8sæ‰€éœ€é•œåƒçš„åœ°å€ã€‚åŸºäºé»˜è®¤é…ç½®å®šåˆ¶å‡ºæœ¬æ¬¡ä½¿ç”¨kubeadmåˆå§‹åŒ–é›†ç¾¤æ‰€éœ€çš„é…ç½®æ–‡ä»¶kubeadm.yamlï¼š apiVersion: kubeadm.k8s.io/v1beta3 kind: InitConfiguration localAPIEndpoint: advertiseAddress: 172.16.219.100 bindPort: 6443 nodeRegistration: criSocket: /run/containerd/containerd.sock taints: - effect: PreferNoSchedule key: node-role.kubernetes.io/master --- apiVersion: kubeadm.k8s.io/v1beta2 kind: ClusterConfiguration kubernetesVersion: v1.23.1 imageRepository: registry.aliyuncs.com/google_containers networking: podSubnet: 10.244.0.0/16 --- apiVersion: kubelet.config.k8s.io/v1beta1 kind: KubeletConfiguration cgroupDriver: systemd failSwapOn: false --- apiVersion: kubeproxy.config.k8s.io/v1alpha1 kind: KubeProxyConfiguration mode: ipvs è¿™é‡Œå®šåˆ¶äº†imageRepositoryä¸ºé˜¿é‡Œäº‘çš„registryï¼Œé¿å…å› gcrè¢«å¢™ï¼Œæ— æ³•ç›´æ¥æ‹‰å–é•œåƒã€‚criSocket è®¾ç½®äº†å®¹å™¨è¿è¡Œæ—¶ä¸ºcontainerdã€‚ åŒæ—¶è®¾ç½®kubeletçš„cgroupDriverä¸ºsystemdï¼Œè®¾ç½®kube-proxyä»£ç†æ¨¡å¼ä¸ºipvsã€‚ åœ¨å¼€å§‹åˆå§‹åŒ–é›†ç¾¤ä¹‹å‰å¯ä»¥ä½¿ç”¨kubeadm config images pull --config kubeadm.yamlé¢„å…ˆåœ¨å„ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸Šæ‹‰å–æ‰€k8séœ€è¦çš„å®¹å™¨é•œåƒã€‚ kubeadm config images pull --config kubeadm.yaml æ¥ä¸‹æ¥ä½¿ç”¨kubeadmåˆå§‹åŒ–é›†ç¾¤ï¼Œé€‰æ‹©node1ä½œä¸ºMaster Nodeï¼Œåœ¨node1ä¸Šæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š kubeadm init --config kubeadm.yaml æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šè¾“å‡ºç›¸å…³æ—¥å¿—ã€‚å…¶ä¸­æœ‰ä»¥ä¸‹å…³é”®å†…å®¹ï¼š [certs]ç”Ÿæˆç›¸å…³çš„å„ç§è¯ä¹¦ [kubeconfig]ç”Ÿæˆç›¸å…³çš„kubeconfigæ–‡ä»¶ [kubelet-start] ç”Ÿæˆkubeletçš„é…ç½®æ–‡ä»¶\"/var/lib/kubelet/config.yaml\" [control-plane]ä½¿ç”¨/etc/kubernetes/manifestsç›®å½•ä¸­çš„yamlæ–‡ä»¶åˆ›å»ºapiserverã€controller-managerã€schedulerçš„é™æ€pod [bootstraptoken]ç”Ÿæˆtokenè®°å½•ä¸‹æ¥ï¼Œåè¾¹ä½¿ç”¨kubeadm joinå¾€é›†ç¾¤ä¸­æ·»åŠ èŠ‚ç‚¹æ—¶ä¼šç”¨åˆ° ä¸‹é¢çš„å‘½ä»¤æ˜¯é…ç½®å¸¸è§„ç”¨æˆ·å¦‚ä½•ä½¿ç”¨kubectlè®¿é—®é›†ç¾¤ï¼š mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config æœ€åç»™å‡ºæ·»åŠ æ–°çš„å·¥ä½œèŠ‚ç‚¹å‘½ä»¤kubeadm join 172.16.219.100:6443 --token rdm2to.z9n608f4ix4lnik8 --discovery-token-ca-cert-hash sha256:047a21a7d519b87e594d36a6fdbfadc86557cd602ee58bda8f7fc97f38cba4d9 æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ kubectl get cs Warning: v1 ComponentStatus is deprecated in v1.19+ NAME STATUS MESSAGE ERROR controller-manager Healthy ok scheduler Healthy ok etcd-0 Healthy {\"health\":\"true\",\"reason\":\"\"} æ³¨æ„ï¼šå¦‚æœé›†ç¾¤åˆå§‹åŒ–ä¸­å‡ºç°é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ kubeadm reset å‘½ä»¤æ¸…é™¤å®‰è£…çš„å†…å®¹ï¼Œå†é‡æ–°å®‰è£…ã€‚ ","date":"2022-01-13","objectID":"/%E5%AE%89%E8%A3%85kubernetes1.23/:2:2","tags":["k8s"],"title":"å®‰è£…kubernetes1.23","uri":"/%E5%AE%89%E8%A3%85kubernetes1.23/"},{"categories":["äº‘åŸç”Ÿ"],"content":"2.3 å®‰è£… helm åŒ…ç®¡ç†å™¨ helm æ˜¯å¼€æºçš„ k8s åŒ…ç®¡ç†å·¥å…·ï¼Œå¯ä»¥ç®€åŒ– k8s æœåŠ¡çš„å®‰è£…æ­¥éª¤ã€‚å®‰è£…å‘½ä»¤å¦‚ä¸‹: wget https://get.helm.sh/helm-v3.7.2-linux-amd64.tar.gz tar -zxvf helm-v3.7.2-linux-amd64.tar.gz mv linux-amd64/helm /usr/local/bin/ ä½¿ç”¨å‘½ä»¤ helm list æ£€æŸ¥ã€‚ ","date":"2022-01-13","objectID":"/%E5%AE%89%E8%A3%85kubernetes1.23/:2:3","tags":["k8s"],"title":"å®‰è£…kubernetes1.23","uri":"/%E5%AE%89%E8%A3%85kubernetes1.23/"},{"categories":["äº‘åŸç”Ÿ"],"content":"2.4 å®‰è£… Calico ä½¿ç”¨ Calico ä½œä¸º k8s çš„ CNIã€‚è¿™é‡Œä½¿ç”¨ helm å®‰è£…ã€‚ ä¸‹è½½ tigera-openrator çš„ helm chartï¼š wget https://github.com/projectcalico/calico/releases/download/v3.21.2/tigera-operator-v3.21.2-1.tgz æŸ¥çœ‹è¿™ä¸ª chart ä¸­å¯å®šåˆ¶çš„é…ç½®: helm show values tigera-operator-v3.21.2-1.tgz \u003e calico.yaml imagePullSecrets: {} installation: enabled: true kubernetesProvider: \"\" apiServer: enabled: true certs: node: key: cert: commonName: typha: key: cert: commonName: caBundle: # Configuration for the tigera operator tigeraOperator: image: tigera/operator version: v1.23.3 registry: quay.io calicoctl: image: quay.io/docker.io/calico/ctl tag: v3.21.2 ä½¿ç”¨ helm å®‰è£… calico helm install calico tigera-operator-v3.21.2-1.tgz -f calico.yaml ç­‰å¾…æ‰€æœ‰ Pod å®‰è£…å®Œæˆ kubectl get pods -n calico-system NAME READY STATUS RESTARTS AGE calico-kube-controllers-59c45ff85c-cvzg6 1/1 Running 0 9h calico-node-lb7q8 0/1 Running 0 9h calico-typha-68c8b9b5ff-bdh6h 1/1 Running 0 9h æŸ¥çœ‹ calico æ–°å¢çš„ç›¸å…³èµ„æº kubectl api-resources | grep calico bgpconfigurations crd.projectcalico.org/v1 false BGPConfiguration bgppeers crd.projectcalico.org/v1 false BGPPeer blockaffinities crd.projectcalico.org/v1 false BlockAffinity caliconodestatuses crd.projectcalico.org/v1 false CalicoNodeStatus clusterinformations crd.projectcalico.org/v1 false ClusterInformation felixconfigurations crd.projectcalico.org/v1 false FelixConfiguration globalnetworkpolicies crd.projectcalico.org/v1 false GlobalNetworkPolicy globalnetworksets crd.projectcalico.org/v1 false GlobalNetworkSet hostendpoints crd.projectcalico.org/v1 false HostEndpoint ipamblocks crd.projectcalico.org/v1 false IPAMBlock ipamconfigs crd.projectcalico.org/v1 false IPAMConfig ipamhandles crd.projectcalico.org/v1 false IPAMHandle ippools crd.projectcalico.org/v1 false IPPool ipreservations crd.projectcalico.org/v1 false IPReservation kubecontrollersconfigurations crd.projectcalico.org/v1 false KubeControllersConfiguration networkpolicies crd.projectcalico.org/v1 true NetworkPolicy networksets crd.projectcalico.org/v1 true NetworkSet è¿™äº›apièµ„æºæ˜¯å±äºcalicoçš„ï¼Œå› æ­¤ä¸å»ºè®®ä½¿ç”¨kubectlæ¥ç®¡ç†ï¼Œæ¨èæŒ‰ç…§calicoctlæ¥ç®¡ç†è¿™äº›apièµ„æºã€‚ å°†calicoctlå®‰è£…ä¸ºkubectlçš„æ’ä»¶: cd /usr/local/bin curl -o kubectl-calico -O -L \"https://github.com/projectcalico/calicoctl/releases/download/v3.21.2/calicoctl\" chmod +x kubectl-calico éªŒè¯æ’ä»¶æ­£å¸¸å·¥ä½œ: kubectl calico -h æ£€æµ‹ k8s CoreDns æœåŠ¡ kubectl run curl --image=radial/busyboxplus:curl -it If you don't see a command prompt, try pressing enter. [ root@curl:/ ]$ é€šè¿‡å‘½ä»¤ nslookup kubernetes.default æ£€æµ‹ nslookup kubernetes.default Server: 10.96.0.10 Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local Name: kubernetes.default Address 1: 10.96.0.1 kubernetes.default.svc.cluster.local ","date":"2022-01-13","objectID":"/%E5%AE%89%E8%A3%85kubernetes1.23/:2:4","tags":["k8s"],"title":"å®‰è£…kubernetes1.23","uri":"/%E5%AE%89%E8%A3%85kubernetes1.23/"},{"categories":["äº‘åŸç”Ÿ"],"content":"2.5 æ·»åŠ å·¥ä½œèŠ‚ç‚¹ å°† k8s-slave1 å’Œ k8s-slave2 èŠ‚ç‚¹æ·»åŠ åˆ°é›†ç¾¤ä¸­ã€‚ kubeadm join 172.16.219.100:6443 --token rdm2to.z9n608f4ix4lnik8 --discovery-token-ca-cert-hash sha256:047a21a7d519b87e594d36a6fdbfadc86557cd602ee58bda8f7fc97f38cba4d9` åœ¨ k8s-master ä¸Šæµ‹è¯•ç»“æœï¼š kubectl get nodes NAME STATUS ROLES AGE VERSION k8s-master Ready control-plane,edge,master 9h v1.23.1 k8s-slave1 Ready \u003cnone\u003e 9h v1.23.1 k8s-slave2 Ready \u003cnone\u003e 9h v1.23.1 ","date":"2022-01-13","objectID":"/%E5%AE%89%E8%A3%85kubernetes1.23/:2:5","tags":["k8s"],"title":"å®‰è£…kubernetes1.23","uri":"/%E5%AE%89%E8%A3%85kubernetes1.23/"},{"categories":["äº‘åŸç”Ÿ"],"content":"ä¸‰ã€Kubernetes å¸¸ç”¨ç»„ä»¶ ","date":"2022-01-13","objectID":"/%E5%AE%89%E8%A3%85kubernetes1.23/:3:0","tags":["k8s"],"title":"å®‰è£…kubernetes1.23","uri":"/%E5%AE%89%E8%A3%85kubernetes1.23/"},{"categories":["äº‘åŸç”Ÿ"],"content":"3.1 éƒ¨ç½² ingress-nginx k8s æä¾› ingressï¼Œå¯ä»¥é—´é›†ç¾¤çš„æœåŠ¡æä¾›ç»™å¤–éƒ¨è¿›è¡Œè®¿é—®ã€‚Nginx Ingress Controllerè¢«éƒ¨ç½²åœ¨Kubernetesçš„è¾¹ç¼˜èŠ‚ç‚¹ä¸Šã€‚ è¿™é‡Œå°†node1(172.168.219.101)ä½œä¸ºè¾¹ç¼˜èŠ‚ç‚¹ï¼Œæ‰“ä¸ŠLabelï¼š kubectl label node k8s-slave1 node-role.kubernetes.io/edge= ä¸‹è½½ ingress-nginx wget https://github.com/kubernetes/ingress-nginx/releases/download/helm-chart-4.0.13/ingress-nginx-4.0.13.tgz ä¿®æ”¹ chart çš„é…ç½®ï¼š controller: ingressClassResource: name: nginx enabled: true default: true controllerValue: \"k8s.io/ingress-nginx\" admissionWebhooks: enabled: false replicaCount: 1 image: # registry: k8s.gcr.io # image: ingress-nginx/controller # tag: \"v1.1.0\" registry: docker.io image: unreachableg/k8s.gcr.io_ingress-nginx_controller tag: \"v1.1.0\" digest: sha256:4f5df867e9367f76acfc39a0f85487dc63526e27735fa82fc57d6a652bafbbf6 hostNetwork: true nodeSelector: node-role.kubernetes.io/edge: '' affinity: podAntiAffinity: requiredDuringSchedulingIgnoredDuringExecution: - labelSelector: matchExpressions: - key: app operator: In values: - nginx-ingress - key: component operator: In values: - controller topologyKey: kubernetes.io/hostname tolerations: - key: node-role.kubernetes.io/master operator: Exists effect: NoSchedule - key: node-role.kubernetes.io/master operator: Exists effect: PreferNoSchedule nginx ingress controllerçš„å‰¯æœ¬æ•°replicaCountä¸º1ï¼Œå°†è¢«è°ƒåº¦åˆ°node1è¿™ä¸ªè¾¹ç¼˜èŠ‚ç‚¹ä¸Šã€‚è¿™é‡Œå¹¶æ²¡æœ‰æŒ‡å®šnginx ingress controller serviceçš„externalIPsï¼Œè€Œæ˜¯é€šè¿‡hostNetwork: trueè®¾ç½®nginx ingress controllerä½¿ç”¨å®¿ä¸»æœºç½‘ç»œã€‚ å› ä¸ºk8s.gcr.ioè¢«å¢™ï¼Œè¿™é‡Œæ›¿æ¢æˆunreachableg/k8s.gcr.io_ingress-nginx_controlleræå‰æ‹‰å–ä¸€ä¸‹é•œåƒ: crictl pull unreachableg/k8s.gcr.io_ingress-nginx_controller:v1.1.0 å®‰è£… ingress-nginx helm install ingress-nginx ingress-nginx-4.0.13.tgz --create-namespace -n ingress-nginx -f values.yaml é€šè¿‡è®¿é—® http://172.16.219.101 æµ‹è¯•ï¼Œè¿”å› 404 è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚ ","date":"2022-01-13","objectID":"/%E5%AE%89%E8%A3%85kubernetes1.23/:3:1","tags":["k8s"],"title":"å®‰è£…kubernetes1.23","uri":"/%E5%AE%89%E8%A3%85kubernetes1.23/"},{"categories":["äº‘åŸç”Ÿ"],"content":"3.2 éƒ¨ç½² metrics-server ä¸‹è½½æè¿°æ–‡ä»¶ wget https://github.com/kubernetes-sigs/metrics-server/releases/download/v0.5.2/components.yaml ä¿®æ”¹components.yamlä¸­çš„imageä¸ºdocker.io/unreachableg/k8s.gcr.io_metrics-server_metrics-server:v0.5.2ã€‚ ä¿®æ”¹components.yamlä¸­å®¹å™¨çš„å¯åŠ¨å‚æ•°ï¼ŒåŠ å…¥--kubelet-insecure-tlsã€‚ kubectl apply -f components.yaml metrics-serverçš„podæ­£å¸¸å¯åŠ¨åï¼Œç­‰ä¸€æ®µæ—¶é—´å°±å¯ä»¥ä½¿ç”¨kubectl topæŸ¥çœ‹é›†ç¾¤å’Œpodçš„metricsä¿¡æ¯: kubectl top node --use-protocol-buffers=true NAME CPU(cores) CPU% MEMORY(bytes) MEMORY% k8s-master 287m 14% 1236Mi 71% k8s-slave1 99m 4% 894Mi 51% k8s-slave2 100m 5% 876Mi 50% kubectl top pod -n kube-system --use-protocol-buffers=true NAME CPU(cores) MEMORY(bytes) coredns-6d8c4cb4d-klthf 3m 17Mi coredns-6d8c4cb4d-xmgnj 3m 15Mi etcd-k8s-master 53m 60Mi kube-apiserver-k8s-master 84m 391Mi kube-controller-manager-k8s-master 31m 72Mi kube-proxy-6fxdl 14m 18Mi kube-proxy-ggf2t 12m 16Mi kube-proxy-l5t9b 13m 22Mi kube-scheduler-k8s-master 5m 29Mi kubernetes-dashboard-79f67c7494-pb6rq 1m 38Mi metrics-server-74689dcfd-c9fqn 5m 33Mi ","date":"2022-01-13","objectID":"/%E5%AE%89%E8%A3%85kubernetes1.23/:3:2","tags":["k8s"],"title":"å®‰è£…kubernetes1.23","uri":"/%E5%AE%89%E8%A3%85kubernetes1.23/"},{"categories":["äº‘åŸç”Ÿ"],"content":"3.3 éƒ¨ç½² dashboard ä½¿ç”¨helméƒ¨ç½²k8sçš„dashboardï¼Œæ·»åŠ chart repo: helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/ helm repo update æŸ¥çœ‹chartçš„å¯å®šåˆ¶é…ç½®: helm show values kubernetes-dashboard/kubernetes-dashboard ä¿®æ”¹ chart çš„å®šåˆ¶é…ç½® image: repository: kubernetesui/dashboard tag: v2.4.0 ingress: enabled: true annotations: nginx.ingress.kubernetes.io/ssl-redirect: \"true\" nginx.ingress.kubernetes.io/backend-protocol: \"HTTPS\" hosts: - k8s.example.com tls: - secretName: example-com-tls-secret hosts: - k8s.example.com metricsScraper: enabled: true ç”Ÿæˆä¸ªäººè¯ä¹¦ï¼š mkdir -p /etc/k8s/ssl/ cd /etc/k8s/ssl openssl genrsa -out dashboard.key 2048 openssl req -new -x509 -key dashboard.key -out dashboard.crt -subj \"/O=dashboard/CN=k8s.example.com\" å…ˆåˆ›å»ºå­˜æ”¾k8s.example.comsslè¯ä¹¦çš„secret: kubectl create secret tls example-com-tls-secret --cert=/etc/k8s/ssl/dashboard.crt --key=/etc/k8s/ssl/dashboard.key -n kube-system ä½¿ç”¨helméƒ¨ç½²dashboard: helm install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard -n kube-system -f dashboard-ingress.yaml ç¡®è®¤ä¸Šé¢çš„å‘½ä»¤éƒ¨ç½²æˆåŠŸã€‚ åˆ›å»ºç®¡ç†å‘˜sa: kubectl create serviceaccount kube-dashboard-admin-sa -n kube-system kubectl create clusterrolebinding kube-dashboard-admin-sa \\ --clusterrole=cluster-admin --serviceaccount=kube-system:kube-dashboard-admin-sa è·å–é›†ç¾¤ç®¡ç†å‘˜ç™»å½•dashboardæ‰€éœ€token: kubectl describe -n kube-system secret $(kubectl -n kube-system get secret | grep kube-dashboard-admin-sa-token|awk -F ' ' '{print $1}') Name: kube-dashboard-admin-sa-token-7r5dh Namespace: kube-system Labels: \u003cnone\u003e Annotations: kubernetes.io/service-account.name: kube-dashboard-admin-sa kubernetes.io/service-account.uid: 594e7c8a-4a81-43ec-9819-0df5d7813cfd Type: kubernetes.io/service-account-token Data ==== ca.crt: 1099 bytes namespace: 11 bytes token: eyJhbGciOiJSUzI1NiIsImtpZCI6IjJWLUlNOFBfd2lFUWZzVTZ6UHNMRFludHpkaU5TbFdwME80MmNMbGpVQTgifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJrdWJlLWRhc2hib2FyZC1hZG1pbi1zYS10b2tlbi03cjVkaCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJrdWJlLWRhc2hib2FyZC1hZG1pbi1zYSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjU5NGU3YzhhLTRhODEtNDNlYy05ODE5LTBkZjVkNzgxM2NmZCIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTprdWJlLWRhc2hib2FyZC1hZG1pbi1zYSJ9.P_zB-q-gp38XEkGMbtrdZawRwpL740Z2amVg1mQ5SeHY701cU2wNziIMfi_UyKRP0BZ1O_F8l2g-kEqzot5i9Pjbrw9mkJfx4x3AVXDCWHv6a-TJJSyXCj1Of8dFzksMWrkdXL3UHGAOZZ9DGMcPIeuaN1CQIOJVo9shInBcQt8dHglr8rBtAhnuMnhOJZZc9Pp1gXCktw2iWr1oeEdpZtgLYCH3c4hpMi9oQnkyP70T0m69BJBkbHP0_toMJISZk-NkR3KmhB4Ze959lyCFA09urP6sZKETlcxy1q_nJ1ILmMJWJaTGinY1hlHEGRYwz7Qur5N7oKEeAiJWugam5w ç”±äºè¿™é‡Œçš„è¯ä¹¦å’ŒåŸŸåéƒ½æ˜¯è‡ªç”Ÿæˆçš„ï¼Œæ‰€ä»¥é›†ç¾¤å¤–æ— æ³•è§£æã€‚åœ¨æœ¬æœºçš„ /etc/hosts ä¸Šæ·»åŠ è®°å½• 172.16.219.101 k8s.example.com åŒæ—¶åœ¨é›†ç¾¤çš„ coredns ä¸­æ·»åŠ è®°å½• kubectl describe configmap coredns -n kube-system Name: coredns Namespace: kube-system Labels: \u003cnone\u003e Annotations: \u003cnone\u003e Data ==== Corefile: ---- .:53 { errors health { lameduck 5s } ready kubernetes cluster.local in-addr.arpa ip6.arpa { pods insecure fallthrough in-addr.arpa ip6.arpa ttl 30 } hosts { 172.16.219.101 k8s.example.com fallthrough } prometheus :9153 forward . /etc/resolv.conf { max_concurrent 1000 } cache 30 loop reload loadbalance } BinaryData ==== ä½¿ç”¨ä¸Šé¢çš„tokenç™»å½•k8s dashboardã€‚ ","date":"2022-01-13","objectID":"/%E5%AE%89%E8%A3%85kubernetes1.23/:3:3","tags":["k8s"],"title":"å®‰è£…kubernetes1.23","uri":"/%E5%AE%89%E8%A3%85kubernetes1.23/"},{"categories":["äº‘åŸç”Ÿ"],"content":"ä» Kubernetes 1.22 å¼€å§‹ï¼Œk8s çš„å®¹å™¨è¿è¡Œæ˜¯é»˜è®¤æ›¿æ¢æˆ containerdã€‚æœ‰å¿…è¦æ·±å…¥äº†è§£ containerd çš„å†…éƒ¨å®ç°åŸç†ã€‚æœ¬ç¯‡é€šè¿‡åˆ†æ containerd çš„ä»£ç æ·±å…¥ç†è§£å…¶å†…éƒ¨åŸç†ã€‚ ä½¿ç”¨çš„ç‰ˆæœ¬ä¸º containerd 1.5ã€‚ ","date":"2021-11-16","objectID":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/:0:0","tags":["æºç åˆ†æ","golang"],"title":"Containerdæºç åˆ†æ","uri":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"},{"categories":["äº‘åŸç”Ÿ"],"content":"é…ç½®ç¯å¢ƒ ä¸‹è½½ containerd æºç : git clone github.com/containerd/containerd å¯åŠ¨ goland çš„è¿œç¨‹è°ƒè¯•åŠŸèƒ½ ","date":"2021-11-16","objectID":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/:1:0","tags":["æºç åˆ†æ","golang"],"title":"Containerdæºç åˆ†æ","uri":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"},{"categories":["äº‘åŸç”Ÿ"],"content":"å…¥å£ å…ˆæ¥ä» main å‡½æ•°æ¥çœ‹å¯åŠ¨æµç¨‹ã€‚ä»ä»¥ä¸‹ç›®å½•ç»“æ„ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œcontainerd é¡¹ç›®ç›®å½•ä¸­åŒ…å«ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹å’Œå¯¹åº”çš„æ‰§è¡Œå·¥å…·ã€‚ cmd â”œâ”€â”€ containerd // containerd CRI å®ç°ï¼Œå¯¹å¤–æä¾›å®¹å™¨æœåŠ¡ï¼Œå¯¹å†…å’Œ containerd-shim-runc é€šè®¯ â”œâ”€â”€ containerd-shim â”œâ”€â”€ containerd-shim-runc-v1 // è´Ÿè´£å’Œ runc é€šä¿¡ï¼Œç®¡ç†å®¹å™¨å®ä¾‹ â”œâ”€â”€ containerd-shim-runc-v2 // v2 ç‰ˆæœ¬ â”œâ”€â”€ containerd-stress â”œâ”€â”€ ctr // containerd å®¢æˆ·ç«¯å‘½ä»¤è¡Œå·¥å…· â”œâ”€â”€ gen-manpages â””â”€â”€ protoc-gen-gogoctrd ä»¥ä¸‹æ˜¯å®ƒä»¬ä¹‹é—´çš„è°ƒç”¨æµç¨‹å›¾: ","date":"2021-11-16","objectID":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/:2:0","tags":["æºç åˆ†æ","golang"],"title":"Containerdæºç åˆ†æ","uri":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"},{"categories":["äº‘åŸç”Ÿ"],"content":"containerd containerd æœ¬èº«æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·å®ç°ï¼Œå…¥å£æ–‡ä»¶ä¸º cmd/containerd/main.go func main() { app := command.App() if err := app.Run(os.Args); err != nil { fmt.Fprintf(os.Stderr, \"containerd: %s\\n\", err) os.Exit(1) } } ","date":"2021-11-16","objectID":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/:3:0","tags":["æºç åˆ†æ","golang"],"title":"Containerdæºç åˆ†æ","uri":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"},{"categories":["äº‘åŸç”Ÿ"],"content":"command app containerd åŒ…å«ä¸‰ä¸ªå­å‘½ä»¤: configCommand: è¾“å‡º containerd é»˜è®¤é…ç½®æ–‡ä»¶ publishCommand: å‘ containerd æœåŠ¡å‘å¸ƒä¸€ä¸ªäº‹ä»¶ ociHook: å¯åŠ¨ä¸€ä¸ª oci é’©å­ app.Action ä¸­å®šä¹‰äº† containerd çš„å¯åŠ¨æµç¨‹ï¼š ... app.Action = func(context *cli.Context) error { ... // åŠ è½½é…ç½®æ–‡ä»¶ configPath := context.GlobalString(\"config\") ... // é€šè¿‡é…ç½®æ–‡ä»¶åˆ›å»º serverï¼Œserver ä¸­åŒ…å« ttrpcã€grpcã€tcpã€metrics server, err := server.New(ctx, config) ... ... // å¯åŠ¨ ttrpc æœåŠ¡ serve(ctx, tl, server.ServeTTRPC) ... if config.GRPC.TCPAddress != \"\" { l, err := net.Listen(\"tcp\", config.GRPC.TCPAddress) if err != nil { return errors.Wrapf(err, \"failed to get listener for TCP grpc endpoint\") } // å¯åŠ¨ tcp æœåŠ¡ serve(ctx, l, server.ServeTCP) } ... // å¯åŠ¨ grpc æœåŠ¡ serve(ctx, l, server.ServeGRPC) ... return nil } ... å†æ¥çœ‹ server.Newï¼Œå®ƒåˆ›å»º containerd æœåŠ¡: func New(ctx context.Context, config *srvconfig.Config) (*Server, error) { ... // ä»é…ç½®æ–‡ä»¶ä¸­åŠ è½½æ’ä»¶ plugins, err := LoadPlugins(ctx, config) if err != nil { return nil, err } ... // å¾ªç¯ç¡®è®¤æ’ä»¶ç±»å‹ï¼Œå¹¶è§£æã€‚ for _, p := range plugins { id := p.URI() reqID := id if config.GetVersion() == 1 { reqID = p.ID } log.G(ctx).WithField(\"type\", p.Type).Infof(\"loading plugin %q...\", id) initContext := plugin.NewContext( ctx, p, initialized, config.Root, config.State, ) initContext.Events = s.events initContext.Address = config.GRPC.Address initContext.TTRPCAddress = config.TTRPC.Address // load the plugin specific configuration if it is provided if p.Config != nil { pc, err := config.Decode(p) if err != nil { return nil, err } initContext.Config = pc } result := p.Init(initContext) if err := initialized.Add(result); err != nil { return nil, errors.Wrapf(err, \"could not add plugin result to plugin set\") } instance, err := result.Instance() if err != nil { if plugin.IsSkipPlugin(err) { log.G(ctx).WithError(err).WithField(\"type\", p.Type).Infof(\"skip loading plugin %q...\", id) } else { log.G(ctx).WithError(err).Warnf(\"failed to load plugin %s\", id) } if _, ok := required[reqID]; ok { return nil, errors.Wrapf(err, \"load required plugin %s\", id) } continue } delete(required, reqID) // check for grpc services that should be registered with the server if src, ok := instance.(plugin.Service); ok { grpcServices = append(grpcServices, src) } if src, ok := instance.(plugin.TTRPCService); ok { ttrpcServices = append(ttrpcServices, src) } if service, ok := instance.(plugin.TCPService); ok { tcpServices = append(tcpServices, service) } s.plugins = append(s.plugins, result) } // æ³¨å†ŒæœåŠ¡ // register services after all plugins have been initialized for _, service := range grpcServices { if err := service.Register(grpcServer); err != nil { return nil, err } } for _, service := range ttrpcServices { if err := service.RegisterTTRPC(ttrpcServer); err != nil { return nil, err } } for _, service := range tcpServices { if err := service.RegisterTCP(tcpServer); err != nil { return nil, err } } return s, nil } ç”±æ­¤å¯çŸ¥ï¼Œcontainerd ä¸­çš„æœåŠ¡éƒ½æ˜¯é€šè¿‡æ’ä»¶åŠ è½½çš„ï¼Œæ’ä»¶çš„åŠ è½½ä»£ç ç»Ÿä¸€å­˜æ”¾åœ¨ cmd/containerd/containerd ç›®å½•ä¸‹çš„ builtins*.go æ–‡ä»¶ä¸­ã€‚ å…¶ä¸­åŒ…å«ä»¥ä¸‹å‡ ç§æœåŠ¡: container content diff images events introspection leases namespaces snapshots tasks ttrpc version å…·ä½“çš„ä»£ç å­˜æ”¾åœ¨ services ç›®å½•ä¸‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ images å’Œ container è¿™ä¸¤ä¸ªæœ€é‡è¦çš„æœåŠ¡ã€‚ ","date":"2021-11-16","objectID":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/:3:1","tags":["æºç åˆ†æ","golang"],"title":"Containerdæºç åˆ†æ","uri":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"},{"categories":["äº‘åŸç”Ÿ"],"content":"é•œåƒæ“ä½œ containerd ä½œä¸º docker çš„æ›¿ä»£è€…ï¼Œç†æ‰€å½“ç„¶çš„éœ€è¦å®ç° docker çš„æ ¸å¿ƒåŠŸèƒ½ OCIã€‚images æœåŠ¡åŒ…å«: Get : é€šè¿‡åç§°è·å–å•ä¸ªé•œåƒ List : è·å–é•œåƒåˆ—è¡¨ Create : åˆ›å»ºä¸€ä¸ªé•œåƒ Update : æ›´æ–°é•œåƒ Delete : é€šè¿‡åç§°åˆ é™¤é•œåƒ å…·ä½“ä»£ç è¯·çœ‹ services/images/local.go: // åˆå§‹åŒ–ï¼Œæ³¨å†Œæˆæ’ä»¶ func init() { plugin.Register(\u0026plugin.Registration{ Type: plugin.ServicePlugin, // æ’ä»¶ç±»å‹ ID: services.ImagesService, // æ’ä»¶åç§° Requires: []plugin.Type{ plugin.MetadataPlugin, // ä¾èµ–çš„æ’ä»¶ plugin.GCPlugin, }, InitFn: func(ic *plugin.InitContext) (interface{}, error) { // åˆå§‹åŒ–æ–¹æ³• m, err := ic.Get(plugin.MetadataPlugin) // è·å– plugin.MetadataPlugin æ’ä»¶ï¼Œä½œä¸ºå­˜å‚¨ï¼Œå†…éƒ¨ä½¿ç”¨ bblot å®ç° if err != nil { return nil, err } g, err := ic.Get(plugin.GCPlugin) // GC æ’ä»¶ï¼Œç”¨äºèµ„æºå›æ”¶ if err != nil { return nil, err } return \u0026local{ store: metadata.NewImageStore(m.(*metadata.DB)), publisher: ic.Events, // å†…éƒ¨çš„è®¢é˜…å‘å¸ƒæ¨¡å‹ gc: g.(gcScheduler), // gc è°ƒåº¦å™¨ }, nil }, }) } // images æœåŠ¡çš„å…·ä½“å®ç° type local struct { store images.Store // å†…éƒ¨å­˜å‚¨å™¨ gc gcScheduler // gc è°ƒåº¦å™¨ publisher events.Publisher // å†…éƒ¨çš„è®¢é˜…å‘å¸ƒæ¨¡å‹ } var _ imagesapi.ImagesClient = \u0026local{} ... è¿™é‡Œæˆ‘ä»¬å¯ä»¥æŠŠ images çš„æ“ä½œåˆ†ä¸ºè¯»å–å’Œä¿®æ”¹ä¸¤ç»„ã€‚Get å’Œ List ä¸ºè¯»å–æ“ä½œï¼Œå°±æ˜¯ä»æ•°æ®åº“ä¸­è¯»å–ç›¸å…³è®°å½•ã€‚ ... func (l *local) Get(ctx context.Context, req *imagesapi.GetImageRequest, _ ...grpc.CallOption) (*imagesapi.GetImageResponse, error) { image, err := l.store.Get(ctx, req.Name) if err != nil { return nil, errdefs.ToGRPC(err) } imagepb := imageToProto(\u0026image) return \u0026imagesapi.GetImageResponse{ Image: \u0026imagepb, }, nil } func (l *local) List(ctx context.Context, req *imagesapi.ListImagesRequest, _ ...grpc.CallOption) (*imagesapi.ListImagesResponse, error) { images, err := l.store.List(ctx, req.Filters...) if err != nil { return nil, errdefs.ToGRPC(err) } return \u0026imagesapi.ListImagesResponse{ Images: imagesToProto(images), }, nil } ... Createã€Update å’Œ Delete æ˜¯ä¿®æ”¹æ“ä½œï¼Œæ ¸å¿ƒæ˜¯é€šè¿‡ events.Publisher å‘å¸ƒäº‹ä»¶å¯¹åº”çš„äº‹ä»¶ // services/images/local.go func (l *local) Create(ctx context.Context, req *imagesapi.CreateImageRequest, _ ...grpc.CallOption) (*imagesapi.CreateImageResponse, error) { ... if err := l.publisher.Publish(ctx, \"/images/create\", \u0026eventstypes.ImageCreate{ Name: resp.Image.Name, Labels: resp.Image.Labels, }); err != nil { return nil, err } ... return \u0026resp, nil } è€ŒçœŸæ­£å¤„ç†è¯¥äº‹ä»¶çš„è®¢é˜…è€…åˆ™æ˜¯ containerd å®ç°çš„ CRI æ¥å£æœåŠ¡ ã€‚ // pkg/cri/server/service.go ... // criService implements CRIService. type criService struct { ... } ... cri å¯åŠ¨æ—¶ï¼Œè®¢é˜… containerd äº‹ä»¶ï¼Œå¹¶å¯åŠ¨äº‹ä»¶å¤„ç†åç¨‹: // pkg/cri/server/service.go // Run starts the CRI service. func (c *criService) Run() error { logrus.Info(\"Start subscribing containerd event\") c.eventMonitor.subscribe(c.client) ... // Start event handler. logrus.Info(\"Start event monitor\") eventMonitorErrCh := c.eventMonitor.start() ... } eventMonitor.start() å†…éƒ¨å¤„ç†é€»è¾‘å¦‚ä¸‹: func (em *eventMonitor) start() \u003c-chan error { ... go func() { defer close(errCh) for { select { case e := \u003c-em.ch: logrus.Debugf(\"Received containerd event timestamp - %v, namespace - %q, topic - %q\", e.Timestamp, e.Namespace, e.Topic) if e.Namespace != constants.K8sContainerdNamespace { logrus.Debugf(\"Ignoring events in namespace - %q\", e.Namespace) break } id, evt, err := convertEvent(e.Event) if err != nil { logrus.WithError(err).Errorf(\"Failed to convert event %+v\", e) break } if em.backOff.isInBackOff(id) { logrus.Infof(\"Events for %q is in backoff, enqueue event %+v\", id, evt) em.backOff.enBackOff(id, evt) break } if err := em.handleEvent(evt); err != nil { logrus.WithError(err).Errorf(\"Failed to handle event %+v for %s\", evt, id) em.backOff.enBackOff(id, evt) } case err := \u003c-em.errCh: ... case \u003c-backOffCheckCh: ... } } }() return errCh } namespace ä¸ä¸º k8s.io æ—¶äº‹ä»¶éƒ½ä¼šè¢«å¿½ç•¥ã€‚ criService ä¸€å…±å¤„ç†äº”ç±»äº‹ä»¶: TaskExit TaskOOM ImageCreate ImageUpdate ImageDelete // pkg/cri/server/event.go // handleEvent handles a containerd event. func (em *eventMonitor) handleEvent(any interface{}) error { ... switch e := any.(type) { case *eventtypes.TaskExit: ... case *eventtypes.TaskOOM: ... case *eventtypes.ImageCreate: logrus.Infof(\"ImageCreate event %+v\", e) return em.c.updateImage(ctx, e.Name) case *eventtypes.ImageUpdate: logrus.Infof(\"ImageUpdate event %+v\", e) return e","date":"2021-11-16","objectID":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/:4:0","tags":["æºç åˆ†æ","golang"],"title":"Containerdæºç åˆ†æ","uri":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"},{"categories":["äº‘åŸç”Ÿ"],"content":"å®¹å™¨æ“ä½œ ä»‹ç»å®Œé•œåƒæ“ä½œåï¼Œæ¥ä¸‹æ¥å°±æ˜¯å…³äºå®¹å™¨éƒ¨åˆ†çš„æ“ä½œã€‚ä»¥ä¸‹æˆ‘ä»¬é€šè¿‡ä¸€æ®µä»£ç æ¥æ¢ç©¶ containerd å†…éƒ¨çš„å®¹å™¨ç®¡ç†æ–¹å¼: package main import ( \"context\" \"log\" \"syscall\" \"github.com/containerd/containerd\" \"github.com/containerd/containerd/cio\" \"github.com/containerd/containerd/namespaces\" \"github.com/containerd/containerd/oci\" ) func main() { client, err := containerd.New(\"/run/containerd/containerd.sock\", containerd.WithDefaultNamespace(\"default\")) if err != nil { log.Fatal(err) } defer client.Close() ctx := context.Background() log.Println(\"get image\") img, err := client.GetImage(ctx, \"docker.io/library/redis:alpine3.14\") if err != nil { log.Fatal(err) } log.Println(\"new container\") ctx = namespaces.WithNamespace(ctx, \"default\") c, err := client.NewContainer(ctx, \"redis\", containerd.WithNewSnapshot(\"redis-rootfs\", img), containerd.WithNewSpec(oci.WithImageConfig(img)), ) if err != nil { log.Fatalf(\"new container: %v\", err) } defer c.Delete(ctx) log.Println(\"new task\") task, err := c.NewTask(ctx, cio.NewCreator(cio.WithStdio)) if err != nil { log.Fatal(err) } pid := task.Pid() log.Printf(\"redis running in pid=%d\\n\", pid) err = task.Start(ctx) if err != nil { log.Fatalf(\"start task: %v\", err) } err = task.Kill(ctx, syscall.SIGINT) if err != nil { log.Fatalf(\"kill task: %v\", err) } for { status, _ := task.Status(ctx) if status.Status == containerd.Stopped { break } } _, err = task.Delete(ctx) if err != nil { log.Fatalf(\"delete task: %v\", err) } } containerd ä¸­åˆ›å»ºä¸€ä¸ªå®¹å™¨ä¹‹åï¼Œå¦‚æœè¦è¿è¡Œè¿™ä¸ªå®¹å™¨ï¼Œå°±éœ€è¦åˆ›å»ºä¸€ä¸ª task ç”¨æ¥ç®¡ç†å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸã€‚å¯ä»¥ç†è§£ä¸º task å°±æ˜¯ containerd çš„è¿è¡Œæ—¶ã€‚ ","date":"2021-11-16","objectID":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/:5:0","tags":["æºç åˆ†æ","golang"],"title":"Containerdæºç åˆ†æ","uri":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"},{"categories":["äº‘åŸç”Ÿ"],"content":"åˆ›å»º åˆ›å»ºå®¹å™¨å¦‚ä¸‹: // services/containers/local.go func (l *local) Create(ctx context.Context, req *api.CreateContainerRequest, _ ...grpc.CallOption) (*api.CreateContainerResponse, error) { var resp api.CreateContainerResponse if err := l.withStoreUpdate(ctx, func(ctx context.Context) error { container := containerFromProto(\u0026req.Container) created, err := l.Store.Create(ctx, container) if err != nil { return err } resp.Container = containerToProto(\u0026created) return nil }); err != nil { return \u0026resp, errdefs.ToGRPC(err) } if err := l.publisher.Publish(ctx, \"/containers/create\", \u0026eventstypes.ContainerCreate{ ID: resp.Container.ID, Image: resp.Container.Image, Runtime: \u0026eventstypes.ContainerCreate_Runtime{ Name: resp.Container.Runtime.Name, Options: resp.Container.Runtime.Options, }, }); err != nil { return \u0026resp, err } return \u0026resp, nil } é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯ä¿å­˜æ•°æ®åˆ°å†…éƒ¨å­˜å‚¨ä¸­ï¼Œå†å‘å¸ƒåˆ›å»ºå®¹å™¨çš„äº‹ä»¶ã€‚ ","date":"2021-11-16","objectID":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/:5:1","tags":["æºç åˆ†æ","golang"],"title":"Containerdæºç åˆ†æ","uri":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"},{"categories":["äº‘åŸç”Ÿ"],"content":"å¯åŠ¨ å¯åŠ¨å®¹å™¨éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ª taskï¼Œä½¿ç”¨ task æ¥ç®¡ç†å®¹å™¨ // services/tasks/local.go ... func (l *local) Create(ctx context.Context, r *api.CreateTaskRequest, _ ...grpc.CallOption) (*api.CreateTaskResponse, error) { ... // åˆ›å»ºå®¹å™¨è¿è¡Œæ—¶ c, err := rtime.Create(ctx, r.ContainerID, opts) if err != nil { return nil, errdefs.ToGRPC(err) } if err := l.monitor.Monitor(c); err != nil { return nil, errors.Wrap(err, \"monitor task\") } return \u0026api.CreateTaskResponse{ ContainerID: r.ContainerID, Pid: c.PID(), }, nil } // runtime/v2/manager.go // Create a new task func (m *TaskManager) Create(ctx context.Context, id string, opts runtime.CreateOpts) (_ runtime.Task, retErr error) { // åœ¨ç£ç›˜ä¸Šæ–°å»ºä¸€ä¸ªçº¦æŸç›®å½• bundle, err := NewBundle(ctx, m.root, m.state, id, opts.Spec.Value) ... // åˆ›å»ºå¯åŠ¨ä¸€ä¸ª containerd-shim-runc-v2 ç®¡ç†å®¹å™¨è¿è¡Œæ—¶ shim, err := m.startShim(ctx, bundle, id, opts) ... // åˆ›å»ºä¸€ä¸ª task t, err := shim.Create(ctx, opts) ... // æ·»åŠ  task if err := m.tasks.Add(ctx, t); err != nil { return nil, errors.Wrap(err, \"failed to add task\") } return t, nil } å†…éƒ¨ç»´æŠ¤ä¸€ä¸ª TaskManager æ¥ç®¡ç† tasks // runtime/v2/manager.go // TaskManager manages v2 shim's and their tasks type TaskManager struct { root string state string containerdAddress string containerdTTRPCAddress string tasks *runtime.TaskList events *exchange.Exchange containers containers.Store } containerd æœåŠ¡å’Œ containerd-shim-runc-v2 ä½¿ç”¨ ttrpc é€šè®¯ã€‚ ","date":"2021-11-16","objectID":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/:5:2","tags":["æºç åˆ†æ","golang"],"title":"Containerdæºç åˆ†æ","uri":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"},{"categories":["äº‘åŸç”Ÿ"],"content":"åœæ­¢ å¦‚ä½•åœæ­¢ä¸€ä¸ªå®¹å™¨å‘¢? // services/tasks/local.go func (l *local) Kill(ctx context.Context, r *api.KillRequest, _ ...grpc.CallOption) (*ptypes.Empty, error) { t, err := l.getTask(ctx, r.ContainerID) if err != nil { return nil, err } p := runtime.Process(t) if r.ExecID != \"\" { if p, err = t.Process(ctx, r.ExecID); err != nil { return nil, errdefs.ToGRPC(err) } } if err := p.Kill(ctx, r.Signal, r.All); err != nil { return nil, errdefs.ToGRPC(err) } return empty, nil } // runtime/v2/shim.go func (s *shim) Kill(ctx context.Context, signal uint32, all bool) error { if _, err := s.task.Kill(ctx, \u0026task.KillRequest{ ID: s.ID(), Signal: signal, All: all, }); err != nil { return errdefs.FromGRPC(err) } return nil } ä» containerd tasks æœåŠ¡ä¸­è·å– tasks ä¿¡æ¯ï¼Œç„¶åé€šè¿‡ ttrpc è¿æ¥ containerd-shim-runc-v2 å¹¶æ€æ­»è¿›ç¨‹ã€‚ containerd-shim-runc-v2 æ”¯æŒä»¥ä¸‹æ¥å£ Create Delete Exec State Pause Resume Kill Pids CloseIO CheckPoint Update ResizePty ","date":"2021-11-16","objectID":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/:5:3","tags":["æºç åˆ†æ","golang"],"title":"Containerdæºç åˆ†æ","uri":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"},{"categories":["äº‘åŸç”Ÿ"],"content":"æ’ä»¶æœºåˆ¶ containerd å†…éƒ¨æœåŠ¡éƒ½æ˜¯é€šè¿‡æ’ä»¶æ–¹å¼æ³¨å†Œã€‚æ³¨å†Œæ’ä»¶ä»£ç å¦‚ä¸‹: // services/server/tasks/local.go func init() { plugin.Register(\u0026plugin.Registration{ Type: plugin.ServicePlugin, ID: services.TasksService, Requires: tasksServiceRequires, InitFn: initFunc, }) timeout.Set(stateTimeout, 2*time.Second) } containerd å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªå…¨å±€æ’ä»¶åˆ—è¡¨: // plugin/plugin.go var register = struct { sync.RWMutex r []*Registration }{} å¯¹å¤–æä¾›ä¸‰ç§æ–¹æ³•: Load : é€šè¿‡è·¯å¾„åŠ è½½æ’ä»¶ Register : æ³¨å†Œæ–°çš„æ’ä»¶ Graph : éå†æ’ä»¶åˆ—è¡¨ æ³¨å†Œçš„æ’ä»¶åœ¨ containerd æœåŠ¡å¯åŠ¨æ—¶åˆå§‹åŒ–: // services/server/server.go // New creates and initializes a new containerd server func New(ctx context.Context, config *srvconfig.Config) (*Server, error) { ... for _, p := range plugins { id := p.URI() reqID := id if config.GetVersion() == 1 { reqID = p.ID } log.G(ctx).WithField(\"type\", p.Type).Infof(\"loading plugin %q...\", id) // æ–°å»ºæ’ä»¶ä¸Šä¸‹æ–‡ç»“æ„ä½“ initContext := plugin.NewContext( ctx, p, initialized, config.Root, config.State, ) initContext.Events = s.events initContext.Address = config.GRPC.Address initContext.TTRPCAddress = config.TTRPC.Address // åŠ è½½é…ç½®å‚æ•° if p.Config != nil { pc, err := config.Decode(p) if err != nil { return nil, err } initContext.Config = pc } // æ’ä»¶åˆå§‹åŒ– result := p.Init(initContext) if err := initialized.Add(result); err != nil { return nil, errors.Wrapf(err, \"could not add plugin result to plugin set\") } // è·å–æ’ä»¶å®ä¾‹ instance, err := result.Instance() if err != nil { if plugin.IsSkipPlugin(err) { log.G(ctx).WithError(err).WithField(\"type\", p.Type).Infof(\"skip loading plugin %q...\", id) } else { log.G(ctx).WithError(err).Warnf(\"failed to load plugin %s\", id) } if _, ok := required[reqID]; ok { return nil, errors.Wrapf(err, \"load required plugin %s\", id) } continue } delete(required, reqID) // æ ¹æ®æ’ä»¶ç±»å‹ï¼ŒåŠ è½½æˆä¸åŒçš„æœåŠ¡ if src, ok := instance.(plugin.Service); ok { grpcServices = append(grpcServices, src) } if src, ok := instance.(plugin.TTRPCService); ok { ttrpcServices = append(ttrpcServices, src) } if service, ok := instance.(plugin.TCPService); ok { tcpServices = append(tcpServices, service) } s.plugins = append(s.plugins, result) } ... return s, nil } æ’ä»¶åˆå§‹åŒ–å‡½æ•°éœ€è¦ InitContextã€‚ // InitContext is used for plugin inititalization type InitContext struct { Context context.Context Root string State string Config interface{} Address string TTRPCAddress string Events *exchange.Exchange Meta *Meta // plugins can fill in metadata at init. plugins *Set } InitContext ä¸­æºå¸¦çš„ plugins å˜é‡æŒ‡å‘å…¨å±€æ’ä»¶é›†åˆã€‚ç»“æ„ä½“ä¸­ä¿å­˜æ’ä»¶åˆå§‹åŒ–æ‰€éœ€çš„å‚æ•°ï¼ŒåŒ…æ‹¬ Root : containerd é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œä»é…ç½®æ–‡ä»¶ä¸­è·å–ã€‚ï¼ˆé»˜è®¤ä¸º /var/lib/containerdï¼‰ State : containerd è¿è¡Œè¿‡ç¨‹ä¸­æ•°æ®çš„å­˜æ”¾ç›®å½•ï¼Œä»é…ç½®æ–‡ä»¶ä¸­è·å–ï¼Œ(é»˜è®¤ä¸º /run/containerd) Config : é…ç½®æ–‡ä»¶ Address : gRPC åœ°å€ TTRPCAddress: ttrpc åœ°å€ Events: å…¨å±€çš„è®¢é˜…å‘å¸ƒæ¨¡å‹ // plugin/context.go // Plugin represents an initialized plugin, used with an init context. type Plugin struct { Registration *Registration // registration, as initialized Config interface{} // config, as initialized Meta *Meta instance interface{} err error // will be set if there was an error initializing the plugin } æ¯ä¸ªæœåŠ¡ä½¿ç”¨ Plugin å°è£…ï¼Œæ’ä»¶çš„ä¿¡æ¯ä¿å­˜åˆ° Registration ä¸­: // plugin/plugin.go // Registration contains information for registering a plugin type Registration struct { // Type of the plugin Type Type // ID of the plugin ID string // Config specific to the plugin Config interface{} // Requires is a list of plugins that the registered plugin requires to be available Requires []Type // InitFn is called when initializing a plugin. The registration and // context are passed in. The init function may modify the registration to // add exports, capabilities and platform support declarations. InitFn func(*InitContext) (interface{}, error) // Disable the plugin from loading Disable bool } Registration åŒ…å«æ’ä»¶ç±»å‹ï¼Œæ’ä»¶IDï¼Œé…ç½®å‚æ•°ï¼Œä¾èµ–çš„å…¶ä»–æ’ä»¶ç±»å‹ï¼Œåˆå§‹åŒ–å‡½æ•°ã€‚ ","date":"2021-11-16","objectID":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/:6:0","tags":["æºç åˆ†æ","golang"],"title":"Containerdæºç åˆ†æ","uri":"/containerd%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"},{"categories":["ç¬”è®°"],"content":"å†…æ ¸æŠ¢å  æŠ¢å å†…æ ¸çš„ä¸»è¦ç‰¹ç‚¹æ˜¯: ä¸€ä¸ªåœ¨å†…æ ¸æ€è¿è¡Œçš„è¿›ç¨‹ï¼Œå¯èƒ½åœ¨æ‰§è¡Œå†…æ ¸å‡½æ•°æœŸé—´è¢«å¦å¤–ä¸€ä¸ªè¿›ç¨‹å–ä»£ã€‚ ç”¨å®ä¾‹æ¥è¯´æ˜æŠ¢å å†…æ ¸å’ŒéæŠ¢å å†…æ ¸çš„åŒºåˆ«: åœ¨è¿›ç¨‹Aæ‰§è¡Œå¼‚å¸¸å¤„ç†ç¨‹åºæ—¶ï¼Œä¸€ä¸ªå…·æœ‰è¾ƒé«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹Bå˜ä¸ºå¯æ‰§è¡ŒçŠ¶æ€ã€‚è¿™ç§æƒ…å†µæ˜¯æœ‰å¯èƒ½å‡ºç°çš„ï¼Œä¾‹å¦‚ï¼Œå‘ç”Ÿäº†ä¸­æ–­è¯·æ±‚è€Œä¸”ç›¸åº”çš„å¤„ç†ç¨‹åºå”¤é†’äº†è¿›ç¨‹Bã€‚å¦‚æœå†…æ ¸æ˜¯æŠ¢å çš„ï¼Œå°±ä¼šå‘ç”Ÿå¼ºåˆ¶æ€§è¿›ç¨‹åˆ‡æ¢ï¼Œè®©è¿›ç¨‹Bå–ä»£è¿›ç¨‹Aã€‚å¼‚å¸¸å¤„ç†ç¨‹åºçš„æ‰§è¡Œè¢«æš‚åœï¼Œç›´åˆ°è°ƒåº¦ç¨‹åºå†æ¬¡é€‰æ‹©è¿›ç¨‹Aæ—¶æ‰æ¢å¤å®ƒçš„æ‰§è¡Œã€‚ç›¸åï¼Œå¦‚æœå†…æ ¸æ˜¯éæŠ¢å çš„ï¼Œåœ¨è¿›ç¨‹Aå®Œæˆå¼‚å¸¸å¤„ç†ç¨‹åºçš„æ‰§è¡Œä¹‹å‰ï¼Œæ˜¯ä¸ä¼šå‘ç”Ÿè¿›ç¨‹åˆ‡æ¢çš„ï¼Œé™¤éè¿›ç¨‹Aè‡ªåŠ¨æ”¾å¼ƒCPUã€‚ ä¸€ä¸ªæ‰§è¡Œå¼‚å¸¸å¤„ç†ç¨‹åºçš„è¿›ç¨‹å·²ç»ç”¨å®Œäº†å®ƒçš„æ—¶é—´é…é¢ï¼Œå¦‚æœå†…æ ¸æ˜¯æŠ¢å çš„ï¼Œè¿›ç¨‹å¯èƒ½ä¼šç«‹å³è¢«å–ä»£ï¼Œä½†å¦‚æœå†…æ ¸æ˜¯éæŠ¢å çš„ï¼Œè¿›ç¨‹ç»§ç»­è¿è¡Œç›´åˆ°å®ƒæ‰§è¡Œå®Œå¼‚å¸¸å¤„ç†ç¨‹åºæˆ–è‡ªåŠ¨æ”¾å¼ƒCPUã€‚ ä½¿å†…æ ¸å¯æŠ¢å çš„ç›®çš„æ˜¯å‡å°‘ç”¨æˆ·æ€è¿›ç¨‹çš„åˆ†æ´¾å»¶è¿Ÿ(dispatch letency)ï¼Œå³ä»è¿›ç¨‹å˜ä¸ºå¯æ‰§è¡ŒçŠ¶æ€åˆ°å®ƒå®é™…å¼€å§‹è¿è¡Œä¹‹é—´çš„æ—¶é—´é—´éš”ã€‚ åªæœ‰å½“å†…æ ¸æ­£åœ¨æ‰§è¡Œå¼‚å¸¸å¤„ç†ç¨‹åº(å°¤å…¶æ˜¯ç³»ç»Ÿè°ƒç”¨)ï¼Œè€Œä¸”å†…æ ¸æŠ¢å æ²¡æœ‰æ˜¾å¼åœ°ç¦ç”¨æ—¶ï¼Œæ‰å¯èƒ½æŠ¢å å†…æ ¸ã€‚ ","date":"2021-10-29","objectID":"/linux%E5%86%85%E6%A0%B8%E5%90%8C%E6%AD%A5/:1:0","tags":["linux"],"title":"Linuxå†…æ ¸åŒæ­¥","uri":"/linux%E5%86%85%E6%A0%B8%E5%90%8C%E6%AD%A5/"},{"categories":["ç¬”è®°"],"content":"åŒæ­¥åŸè¯­ æŠ€æœ¯ è¯´æ˜ é€‚ç”¨èŒƒå›´ æ¯CPUå˜é‡ åœ¨CPUä¹‹é—´å¤åˆ¶æ•°æ®ç»“æ„ æ‰€æœ‰CPU åŸå­æ“ä½œ å¯¹ä¸€ä¸ªè®¡æ•°å™¨åŸå­åœ°\"è¯»-ä¿®æ”¹-å†™\"çš„æŒ‡ä»¤ æ‰€æœ‰CPU å†…å­˜å±éšœ é¿å…æŒ‡ä»¤é‡æ–°æ’åº æœ¬åœ°CPUæˆ–æ‰€æœ‰CPU è‡ªæ—‹é” åŠ é”æ—¶å¿™ç­‰ æ‰€æœ‰CPU ä¿¡å·é‡ åŠ é”æ—¶é˜»å¡ç­‰å¾…(ç¡çœ ) æ‰€æœ‰CPU é¡ºåºé” åŸºäºè®¿é—®è®¡æ•°å™¨çš„é” æ‰€æœ‰CPU æœ¬åœ°ä¸­æ–­çš„ç¦æ­¢ ç¦æ­¢å•ä¸ªCPUä¸Šçš„ä¸­æ–­å¤„ç† æœ¬åœ°CPU æœ¬åœ°è½¯ä¸­æ–­çš„ç¦æ­¢ ç¦æ­¢å•ä¸ªCPUä¸Šçš„å¯å»¶è¿Ÿå‡½æ•°å¤„ç† æœ¬åœ°CPU è¯»-æ‹·è´-æ›´æ–°(RCU) é€šè¿‡æŒ‡æ­£è€Œä¸æ˜¯é”æ¥è®¿é—®å…±äº«æ•°æ®ç»“æ„ æ‰€æœ‰CPU ","date":"2021-10-29","objectID":"/linux%E5%86%85%E6%A0%B8%E5%90%8C%E6%AD%A5/:2:0","tags":["linux"],"title":"Linuxå†…æ ¸åŒæ­¥","uri":"/linux%E5%86%85%E6%A0%B8%E5%90%8C%E6%AD%A5/"},{"categories":["ç¬”è®°"],"content":"æ¯CPUå˜é‡ æœ€ç®€å•ä¹Ÿæ˜¯æœ€é‡è¦çš„åŒæ­¥æŠ€æœ¯åŒ…æ‹¬æŠŠå†…æ ¸å˜é‡å£°æ˜ä¸ºæ¯CPUå˜é‡(per-cpu variable)ã€‚æ¯CPUå˜é‡ä¸»è¦æ˜¯æ•°æ®ç»“æ„çš„æ•°ç»„å˜é‡ä¸»è¦æ˜¯æŠ€æœ¯ç»“æ„çš„æ•°ç»„ï¼Œç³»ç»Ÿçš„æ¯ä¸ªCPUå¯¹åº”æ•°ç»„çš„ä¸€ä¸ªå…ƒç´ ã€‚ è™½ç„¶æ¯CPUå˜é‡ä¸ºæ¥è‡ªä¸åŒCPUçš„å¹¶å‘è®¿é—®æä¾›ä¿æŠ¤ï¼Œä½†å¯¹æ¥è‡ªå¼‚æ­¥å‡½æ•°(ä¸­æ–­å¤„ç†ç¨‹åºå’Œå¯å»¶è¿Ÿå‡½æ•°)çš„è®¿é—®ä¸æä¾›ä¿æŠ¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹éœ€è¦å¦å¤–çš„åŒæ­¥åŸè¯­ã€‚ æ­¤å¤–ï¼Œåœ¨å•å¤„ç†å™¨å’Œå¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œå†…æ ¸æŠ¢å éƒ½å¯èƒ½æ˜¯æ¯CPUå˜é‡äº§ç”Ÿç«äº‰æ¡ä»¶ã€‚æ€»çš„åŸåˆ™æ˜¯å†…æ ¸æ§åˆ¶è·¯å¾„åº”è¯¥åœ¨ç¦ç”¨æŠ¢å çš„æƒ…å†µä¸‹è®¿é—®æ¯CPUå˜é‡ã€‚ ","date":"2021-10-29","objectID":"/linux%E5%86%85%E6%A0%B8%E5%90%8C%E6%AD%A5/:2:1","tags":["linux"],"title":"Linuxå†…æ ¸åŒæ­¥","uri":"/linux%E5%86%85%E6%A0%B8%E5%90%8C%E6%AD%A5/"},{"categories":["ç¬”è®°"],"content":"åŸå­æ“ä½œ é€šè¿‡åŸå­æ“ä½œæŒ‡ä»¤å®Œæˆã€‚ 80x86 æŒ‡ä»¤: è¿›è¡Œé›¶æ¬¡æˆ–ä¸€æ¬¡å¯¹é½å†…å­˜è®¿é—®çš„æ±‡ç¼–æŒ‡ä»¤æ˜¯åŸå­çš„ã€‚ å¦‚æœåœ¨è¯»æ“ä½œä¹‹åï¼Œå†™æ“ä½œä¹‹å‰æ²¡æœ‰å…¶ä»–å¤„ç†å™¨å ç”¨å†…å­˜æ€»çº¿ï¼Œé‚£ä¹ˆä»å†…å­˜ä¸­è¯»å–æ•°æ®ï¼Œæ›´æ–°æ•°ç»„å¹¶æŠŠæ›´æ–°åæ•°ç»„å†™å›å†…å­˜ä¸­çš„è¿™äº›\"è¯»-ä¿®æ”¹-å†™\"æ±‡ç¼–è¯­è¨€æŒ‡ä»¤(ä¾‹å¦‚incæˆ–dec)æ˜¯åŸå­çš„ã€‚å½“ç„¶ï¼Œåœ¨å•å¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œæ°¸è¿œéƒ½ä¸ä¼šå‘ç”Ÿå†…å­˜æ€»çº¿çªƒç”¨çš„æƒ…å†µã€‚ æ“ä½œå—å‰ç¼€æ˜¯ lock å­—èŠ‚(0xf0)çš„\"è¯»-ä¿®æ”¹-å†™\"æ±‡ç¼–è¯­è¨€æŒ‡ä»¤å³ä½¿åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ä¹Ÿæ˜¯åŸå­çš„ã€‚å½“æ§åˆ¶å•å…ƒæ£€æµ‹åˆ°è¿™ä¸ªå‰ç¼€æ—¶ï¼Œå°±\"é”å®š\"å†…å­˜æ€»çº¿ï¼ŒçŸ¥é“è¿™æ¡æŒ‡ä»¤æ‰§è¡Œå®Œæˆä¸ºæ­¢ã€‚å› æ­¤ï¼Œå½“åŠ é”çš„æŒ‡ä»¤æ‰§è¡Œæ—¶ï¼Œå…¶ä»–å¤„ç†å™¨ä¸èƒ½è®¿é—®è¿™ä¸ªå†…å­˜å•å…ƒã€‚ æ“ä½œç å‰ç¼€æ˜¯ä¸€ä¸ªrepå­—èŠ‚(0xf2,0xf3)çš„æ±‡ç¼–è¯­è¨€æ‰§è¡Œä¸æ˜¯åŸå­çš„ï¼Œè¿™æ¡æŒ‡ä»¤å¼ºè¡Œè®©æ§åˆ¶å•å…ƒå¤šæ¬¡é‡å¤æ‰§è¡Œç›¸åŒçš„æŒ‡ä»¤ã€‚æ§åˆ¶å•å…ƒåœ¨æ‰§è¡Œæ–°çš„å¾ªç¯ä¹‹å‰è¦æ£€æŸ¥æŒ‚èµ·çš„ä¸­æ–­ã€‚ Linux å†…æ ¸æä¾›äº†ä¸€ä¸ªä¸“é—¨çš„ atomic_t ç±»å‹(ä¸€ä¸ªåŸå­è®¿é—®è®¡æ•°å™¨)å’Œä¸€äº›ä¸“é—¨çš„å‡½æ•°å’Œå®ï¼Œè¿™äº›å‡½æ•°å’Œå®ä½œç”¨äº atomic_t ç±»å‹çš„å˜é‡ï¼Œå¹¶å½“ä½œå•ç‹¬çš„ã€åŸå­çš„æ±‡ç¼–è¯­è¨€æŒ‡ä»¤æ¥ä½¿ç”¨ã€‚åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œæ¯æ¡è¿™æ ·çš„æŒ‡ä»¤éƒ½æœ‰ä¸€ä¸ª lock å­—èŠ‚çš„å‰ç¼€ã€‚ å¦ä¸€ç±»åŸå­å‡½æ•°æ“ä½œä½œç”¨äºä½æ©ç  ","date":"2021-10-29","objectID":"/linux%E5%86%85%E6%A0%B8%E5%90%8C%E6%AD%A5/:2:2","tags":["linux"],"title":"Linuxå†…æ ¸åŒæ­¥","uri":"/linux%E5%86%85%E6%A0%B8%E5%90%8C%E6%AD%A5/"},{"categories":["ç¬”è®°"],"content":"ä¼˜åŒ–å’Œå†…å­˜å±éšœ å½“ä½¿ç”¨ä¼˜åŒ–çš„ç¼–è¯‘å™¨æ—¶ï¼Œç¼–è¯‘å™¨å¯èƒ½é‡æ–°å®‰æ’æ±‡ç¼–è¯­è¨€æŒ‡ä»¤å·²ä½¿å¯„å­˜å™¨ä»¥æœ€ä¼˜çš„æ–¹å¼ä½¿ç”¨ã€‚æ­¤å¤–ï¼Œç°ä»£CPUé€šå¸¸å¹¶è¡Œåœ°æ‰§è¡Œè‹¥å¹²æ¡æŒ‡ä»¤ï¼Œä¸”å¯èƒ½é‡æ–°å®‰æ’å†…å­˜è®¿é—®ã€‚ç„¶è€Œï¼Œå½“å¤„ç†åŒæ­¥æ—¶ï¼Œå¿…é¡»é¿å…æŒ‡ä»¤é‡æ–°æ’åºã€‚ ä¼˜åŒ–å±éšœ(optimization barrier) åŸè¯­ä¿è¯ç¼–è¯‘ç¨‹åºä¸ä¼šæ··æ·†æ”¾åœ¨åŸè¯­æ“ä½œä¹‹å‰çš„æ±‡ç¼–è¯­è¨€æŒ‡ä»¤å’Œæ”¾åœ¨åŸè¯­æ“ä½œä¹‹åçš„æ±‡ç¼–è¯­è¨€æŒ‡ä»¤ï¼Œè¿™äº›æ±‡ç¼–è¯­è¨€æŒ‡ä»¤åœ¨Cä¸­éƒ½æœ‰å¯¹åº”çš„è¯­å¥ã€‚åœ¨Linuxä¸­ï¼Œä¼˜åŒ–å±éšœå°±æ˜¯ barrier() å®ï¼Œå®ƒå±•å¼€ asm volatile(\"\":::\"memory\") ã€‚æŒ‡ä»¤ asm å‘Šè¯‰ç¼–è¯‘ç¨‹åºè¦æ’å…¥æ±‡ç¼–è¯­è¨€ç‰‡æ®µ(è¿™ç§æƒ…å†µä¸‹ä¸ºç©º)ã€‚volatile å…³é”®å­—ç¦æ­¢ç¼–è¯‘å™¨æŠŠasmæŒ‡ä»¤ä¸ç¨‹åºä¸­çš„å…¶ä»–æŒ‡ä»¤é‡æ–°ç»„åˆã€‚memory å…³é”®å­—å¼ºåˆ¶ç¼–è¯‘å™¨å‡å®šRAMä¸­çš„æ‰€æœ‰å†…å­˜å•å…ƒå·²ç»è¢«æ±‡ç¼–è¯­è¨€æŒ‡ä»¤ä¿®æ”¹ã€‚ å†…å­˜å±éšœ(memory barrier)åŸè¯­ç¡®ä¿ï¼Œåœ¨åŸè¯­ä¹‹åçš„æ“ä½œå¼€å§‹æ‰§è¡Œä¹‹å‰ï¼ŒåŸè¯­ä¹‹å‰çš„æ“ä½œå·²ç»å®Œæˆã€‚å› æ­¤ï¼Œå†…å­˜å±éšœç±»ä¼¼äºé˜²ç«å¢™ï¼Œè®©ä»»ä½•æ±‡ç¼–è¯­è¨€æŒ‡ä»¤éƒ½ä¸èƒ½é€šè¿‡ã€‚ ","date":"2021-10-29","objectID":"/linux%E5%86%85%E6%A0%B8%E5%90%8C%E6%AD%A5/:2:3","tags":["linux"],"title":"Linuxå†…æ ¸åŒæ­¥","uri":"/linux%E5%86%85%E6%A0%B8%E5%90%8C%E6%AD%A5/"},{"categories":["ç¬”è®°"],"content":"è‡ªæ—‹é” è‡ªæ—‹é”(spin lock)æ˜¯ç”¨æ¥åœ¨å¤šå¤„ç†å™¨ç¯å¢ƒä¸­å·¥ä½œçš„ä¸€ç§ç‰¹æ®Šçš„é”ã€‚å¦‚æœå†…æ ¸æ§åˆ¶è·¯å¾„å‘ç°è‡ªæ—‹é”\"å¼€ç€\"ï¼Œå°±è·å–é”å¹¶ç»§ç»­è‡ªå·±çš„æ‰§è¡Œã€‚ç›¸åï¼Œå¦‚æœå†…æ ¸æ§åˆ¶è·¯å¾„å‘ç°é”ç”±è¿è¡Œåœ¨å¦ä¸€ä¸ªCPUä¸Šçš„å†…æ ¸æ§åˆ¶è·¯å¾„\"é”ç€\"ï¼Œå°±åœ¨å‘¨å›´\"æ—‹è½¬\"ï¼Œåå¤æ‰§è¡Œä¸€æ¡ç´§å‡‘çš„å¾ªç¯æŒ‡ä»¤ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ã€‚ è‡ªæ—‹é”çš„å¾ªç¯æŒ‡ä»¤è¡¨ç¤º\"å¿™ç­‰\"ã€‚å³ä½¿ç­‰å¾…çš„å†…æ ¸æ§åˆ¶è·¯å¾„æ— äº‹å¯åšï¼Œå®ƒä¹Ÿåœ¨CPUä¸Šä¿æŒè¿è¡Œã€‚ä¸è¿‡ï¼Œè‡ªæ—‹é”é€šå¸¸éå¸¸æ–¹ä¾¿ï¼Œå› ä¸ºå¾ˆå¤šå†…æ ¸èµ„æºåªé”1æ¯«ç§’çš„æ—¶é—´ç‰‡æ®µï¼›æ‰€ä»¥è¯´ï¼Œé‡Šæ”¾CPUå’Œéšåæœ‰è·å¾—CPUéƒ½ä¸ä¼šæ¶ˆè€—å¤šå°‘æ—¶é—´ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œç”±è‡ªæ—‹é”ä¿æŠ¤çš„æ¯ä¸ªä¸´ç•ŒåŒºéƒ½æ˜¯ç¦æ­¢å†…æ ¸æŠ¢å çš„ã€‚åœ¨å•å¤„ç†å™¨ç³»ç»Ÿä¸Šï¼Œè¿™ä¸­é”æœ¬èº«å¹¶ä¸èµ·é”çš„ä½œç”¨ï¼Œè‡ªæ—‹é”åŸè¯­ä»…ä»…æ˜¯ç¦æ­¢æˆ–å¯ç”¨å†…æ ¸æŠ¢å ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè‡ªæ—‹è½¬å¿™ç­‰æœŸé—´ï¼Œå†…æ ¸æŠ¢å è¿˜æ˜¯æœ‰æ•ˆçš„ï¼Œå› æ­¤ï¼Œç­‰å¾…è‡ªæ—‹é”é‡Šæ”¾çš„è¿›ç¨‹æœ‰å¯èƒ½è¢«æ›´é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹æ›¿ä»£ã€‚ è¯»/å†™è‡ªæ—‹é” è¯»/å†™è‡ªæ—‹é”çš„å¼•å…¥æ˜¯ä¸ºäº†å¢åŠ æ˜¯å†…æ ¸çš„å¹¶å‘èƒ½åŠ›ã€‚åªè¦æ²¡æœ‰å†…æ ¸æ§åˆ¶è·¯å¾„å¯¹æ•°æ®ç»“æ„è¿›è¡Œä¿®æ”¹ï¼Œè¯»/å†™è‡ªæ—‹é”å°±å…è®¸å¤šä¸ªå†…æ ¸æ§åˆ¶è·¯å¾„åŒæ—¶è¯»åŒä¸€æ•°æ®ç»“æ„ã€‚å¦‚æœä¸€ä¸ªå†…æ ¸æ§åˆ¶è·¯å¾„æƒ³å¯¹è¿™ä¸ªç»“æ„è¿›è¡Œå†™æ“ä½œï¼Œé‚£ä¹ˆå®ƒå¿…é¡»é¦–å…ˆè·å–è¯»/å†™é”çš„å†™é”ï¼Œå†™é”æˆæƒç‹¬å è®¿é—®è¿™ä¸ªèµ„æºã€‚å½“ç„¶ï¼Œå…è®¸å¯¹æ•°æ®ç»“æ„å¹¶å‘è¯»å¯ä»¥æé«˜ç³»ç»Ÿæ€§èƒ½ã€‚ é¡ºåºé” Linux 2.6 ä¸­å¼•å…¥é¡ºåºé”(seqlock)ï¼Œå®ƒä¸è¯»/å†™è‡ªæ—‹é”éå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯å®ƒä¸ºå†™è€…èµ‹äºˆäº†è¾ƒé«˜çš„ä¼˜å…ˆçº§ï¼›äº‹å®ä¸Šï¼Œå³ä½¿åœ¨è¯»è€…æ­£åœ¨è¯»çš„æ—¶å€™ï¼Œä¹Ÿå…è®¸å†™è€…ç»§ç»­è¿è¡Œã€‚è¿™ç§ç­–ç•¥çš„å¥½å¤„æ˜¯å†™è€…æ°¸è¿œä¸ä¼šç­‰å¾…(é™¤éå¦å¤–ä¸€ä¸ªå†™è€…æ­£åœ¨å†™)ï¼Œç¼ºç‚¹æ˜¯æœ‰äº›æ—¶å€™è¯»è€…ä¸å¾—ä¸åå¤å¤šæ¬¡è¯»ç›¸åŒçš„æ•°æ®ç›´åˆ°å®ƒè·å¾—æœ‰æ•ˆçš„å‰¯æœ¬ã€‚ æ¯ä¸ªè¯»è€…éƒ½å¿…é¡»åœ¨è¯»æ•°æ®å‰åä¸¤æ¬¡è¯»é¡ºåºè®¡æ•°å™¨ï¼Œå¹¶æ£€æŸ¥é›¶æ¬¡è¯»åˆ°çš„å€¼æ˜¯å¦ç›¸åŒï¼Œå¦‚æœä¸ç›¸åŒï¼Œè¯´æ˜æ–°çš„å†™è€…å·²ç»å¼€å§‹å†™å¹¶å¢åŠ äº†é¡ºåºè®¡æ•°å™¨ï¼Œå› æ­¤æš—ç¤ºè¯»è€…åˆšè¯»åˆ°çš„æ•°æ®æ˜¯æ— æ•ˆçš„ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œå¿…é¡»åœ¨æ»¡è¶³ä¸‹è¿°æ¡ä»¶æ˜¯æ‰èƒ½ä½¿ç”¨é¡ºåºé”: è¢«ä¿æŠ¤çš„æ•°æ®ç»“æ„ä¸åŒ…æ‹¬è¢«å†™è€…ä¿®æ”¹å’Œè¢«è¯»è€…é—´æ¥å¼•ç”¨çš„æŒ‡é’ˆã€‚ è¯»è€…çš„ä¸´ç•Œä»£ç æ²¡æœ‰å‰¯ä½œç”¨ã€‚ è¯»-æ‹·è´-æ›´æ–°(RCU) è¯»-æ‹·è´-æ›´æ–°(RCU)æ˜¯ä¸ºäº†ä¿æŠ¤åœ¨å¤šæ•°æƒ…å†µä¸‹è¢«å¤šä¸ªCPUè¯»çš„æ•°æ®ç»“æ„è€Œè®¾è®¡çš„é›¶ä¸€ç§åŒæ­¥æŠ€æœ¯ã€‚RCUå…è®¸å¤šä¸ªè¯»è€…å’Œå†™è€…å¹¶å‘æ‰§è¡Œ(ç›¸å¯¹äºåªå…è®¸ä¸€ä¸ªå†™è€…æ‰§è¡Œçš„é¡ºåºé”æœ‰äº†æ”¹è¿›)ã€‚è€Œä¸”ï¼ŒRCUæ˜¯ä¸ä½¿ç”¨é”çš„ï¼Œå°±æ˜¯è¯´ï¼Œå®ƒä¸ä½¿ç”¨è¢«æ‰€æœ‰CPUå…±äº«çš„é”æˆ–è®¡æ•°å™¨ï¼Œåœ¨è¿™ä¸€ç‚¹ä¸Šä¸è¯»/å†™è‡ªæ—‹é”å’Œé¡ºåºé”(ç”±äºé«˜é€Ÿç¼“å­˜è¡Œçªƒç”¨å’Œå¤±æ•ˆæœ‰å¾ˆé«˜çš„å¼€é”€)ç›¸æ¯”ï¼ŒRCU å…·æœ‰æ›´å¤§çš„ä¼˜åŠ¿ã€‚ RCU æ˜¯å¦‚ä½•ä¸æ˜¯ç”¨å…±äº«æ•°æ®ç»“æ„è€Œä»¤äººæƒŠè®¶åœ°å®ç°å¤šä¸ªCPUåŒæ­¥å‘¢ï¼Ÿå…¶å…³é”®çš„æ€æƒ³åŒ…æ‹¬é™åˆ¶RCUçš„èŒƒå›´ï¼Œå¦‚ä¸‹æ‰€è¿°: RCU åªä¿æŠ¤è¢«åŠ¨æ€åˆ†é…å¹¶é€šè¿‡æŒ‡é’ˆå¼•ç”¨çš„æ•°æ®ç»“æ„ã€‚ åœ¨è¢« RCU ä¿æŠ¤çš„ä¸´ç•ŒåŒºä¸­ï¼Œä»»ä½•å†…æ ¸æ§åˆ¶è·¯å¾„éƒ½ä¸èƒ½ç¡çœ ã€‚ å½“å†…æ ¸æ§åˆ¶è·¯å¾„è¦è¯»å– RCU ä¿æŠ¤çš„æ•°æ®ç»“æ„æ—¶ï¼Œæ‰§è¡Œ rcu_read_lock()ï¼Œå®ƒç­‰åŒäº preempt_disable()ã€‚æ¥ä¸‹æ¥ï¼Œè¯»è€…é—´æ¥å¼•ç”¨è¯¥æ•°æ®ç»“æ„æŒ‡é’ˆæ‰€å¯¹åº”çš„å†…å­˜å•å…ƒå¹¶å¼€å§‹è¯»è¿™ä¸ªæ•°æ®ç»“æ„ã€‚æ­£å¦‚åœ¨å‰é¢æ‰€å¼ºè°ƒçš„ï¼Œè¯»è€…åœ¨å®Œæˆå¯¹æ•°æ®ç»“æ„çš„è¯»æ“ä½œä¹‹å‰ï¼Œæ˜¯ä¸èƒ½ç¡çœ çš„ã€‚ç”¨ç­‰åŒäº preempt_enable() çš„å® rcu_read_unlock() æ ‡è®°ä¸´ç•ŒåŒºçš„ç»“æŸã€‚ ç”±äºè¯»è€…å‡ ä¹ä¸åšä»»ä½•äº‹æƒ…æ¥é˜²æ­¢ç«äº‰æ¡ä»¶çš„å‡ºç°ï¼Œæ‰€ä»¥å†™è€…ä¸å¾—ä¸åšå¾—æ›´å¤šä¸€äº›ã€‚äº‹å®ä¸Šï¼Œå½“å†™è€…è¦æ›´æ–°æ•°æ®ç»“æ„æ˜¯ï¼Œå®ƒé—´æ¥å¼•ç”¨æŒ‡é’ˆå¹¶ç”Ÿæˆæ•´ä¸ªæ•°æ®ç»“æ„çš„å‰¯æœ¬ã€‚æ¥ä¸‹æ¥ï¼Œå†™è€…ä¿®æ”¹è¿™ä¸ªå‰¯æœ¬ã€‚ä¸€æ—¦ä¿®æ”¹å®Œæ¯•ï¼Œå†™è€…æ”¹å˜æŒ‡å‘æ•°æ®ç»“æ„çš„æŒ‡é’ˆï¼Œä»¥ä½¿å®ƒæŒ‡å‘è¢«ä¿®æ”¹åçš„å‰¯æœ¬ã€‚ç”±äºä¿®æ”¹æŒ‡é’ˆå€¼çš„æ“ä½œæ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œæ‰€ä»¥æ—§å‰¯æœ¬å’Œæ–°å‰¯æœ¬å¯¹æ¯ä¸ªè¯»è€…æˆ–å†™è€…éƒ½æ˜¯å¯è§çš„ï¼Œåœ¨æ•°æ®ç»“æ„ä¸­ä¸ä¼šå‡ºç°æ•°æ®å´©æºƒã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿˜éœ€è¦å†…å­˜å±éšœæ¥ä¿è¯: åªæœ‰åœ¨æ•°æ®ç»“æ„è¢«ä¿®æ”¹ä¹‹åï¼Œå·²æ›´æ–°çš„æŒ‡é’ˆå¯¹å…¶ä»–CPUæ‰æ˜¯å¯è§çš„ï¼Œå¦‚æœæŠŠè‡ªæ—‹é”ä¸RCUç»“åˆèµ·æ¥ä»¥ç¦æ­¢å†™è€…çš„å¹¶å‘æ‰§è¡Œï¼Œå°±éšå«åœ°å¼•å…¥äº†è¿™æ ·çš„å†…å­˜å±éšœã€‚ ç„¶è€Œï¼Œä½¿ç”¨ RCU æŠ€æœ¯çš„çœŸæ­£å›°éš¾åœ¨äº: å†™è€…ä¿®æ”¹æŒ‡é’ˆæ—¶ä¸èƒ½ç«‹å³é‡Šæ”¾æ•°æ®ç»“æ„çš„å°±å‰¯æœ¬ã€‚å®é™…ä¸Šï¼Œå†™è€…å¼€å§‹ä¿®æ”¹æ—¶ï¼Œæ­£åœ¨è®¿é—®æ•°æ®ç»“æ„çš„è¯»è€…å¯èƒ½è¿˜åœ¨è¯»å‰¯æœ¬ã€‚åªæœ‰åœ¨CPUä¸Šæ‰€æœ‰(æ½œåœ¨çš„)è¯»è€…éƒ½æ‰§è¡Œå®Œå® rcu_read_unlock() ä¹‹åï¼Œæ‰å¯ä»¥é‡Šæ”¾å°±å‰¯æœ¬ã€‚å†…æ ¸è¦æ±‚æ¯ä¸ªæ½œåœ¨çš„è¯»è€…åœ¨ä¸‹é¢çš„æ“ä½œä¹‹å‰æ‰§è¡Œ rcu_read_unlock() å®: CPU æ‰§è¡Œè¿›ç¨‹åˆ‡æ¢ CPU å¼€å§‹åœ¨ç”¨æˆ·æ€æ‰§è¡Œ CPU æ‰§è¡Œç©ºå¾ªç¯ å¯¹ä¸Šè¿°æ¯ç§æƒ…å†µï¼Œæˆ‘ä»¬è¯´CPUå·²ç»è¿‡äº†é™æ­¢çŠ¶æ€(quiescent state)ã€‚ å†™è€…è°ƒç”¨å‡½æ•° call_rcu() æ¥é‡Šæ”¾æ•°æ®ç»“æ„çš„å°±å‰¯æœ¬ã€‚å½“æ‰€æœ‰çš„ CPU éƒ½é€šè¿‡é™æ­¢çŠ¶æ€ä¹‹åï¼Œcall_rcu() æ¥å— rcu_head æè¿°ç¬¦çš„åœ°å€å’Œå°†è¦è°ƒç”¨çš„å›è°ƒå‡½æ•°çš„åœ°å€ä½œä¸ºå‚æ•°ã€‚ä¸€æ—¦å›è°ƒå‡½æ•°è¢«æ‰§è¡Œï¼Œå®ƒé€šå¸¸é‡Šæ”¾æ•°æ®ç»“æ„çš„å°±å‰¯æœ¬ã€‚ å‡½æ•° call_rcu() æŠŠå›è°ƒå‡½æ•°å’Œå…¶å‚æ•°çš„åœ°å€å­˜æ”¾åœ¨ rcu_head æè¿°ç¬¦ä¸­ï¼Œç„¶åæŠŠæè¿°ç¬¦æ’å…¥å›è°ƒå‡½æ•°çš„æ¯ä¸ª CPU (per-CPU) é“¾è¡¨ä¸­ã€‚å†…æ ¸æ¯ç»è¿‡ä¸€ä¸ªæ—¶é’Ÿæ»´ç­”å°±å‘¨æœŸæ€§åœ°æ£€æŸ¥æœ¬åœ°CPUæ˜¯å¦è¿›è¿‡äº†ä¸€ä¸ªé™æ­¢çŠ¶æ€ã€‚å¦‚æœæ‰€æœ‰CPUéƒ½ç»è¿‡äº†é™æ­¢çŠ¶æ€ï¼Œæœ¬åœ° tasklet (å®ƒçš„æè¿°ç¬¦å­˜æ”¾åœ¨æ¯CPUå˜é‡ rcu_tasklet ä¸­)å°±æ‰§è¡Œé“¾è¡¨ä¸­çš„æ‰€æœ‰å›è°ƒå‡½æ•°ã€‚ RCU æ˜¯ Linux 2.6 ä¸­æ–°åŠ çš„åŠŸèƒ½ï¼Œç”¨åœ¨ç½‘ç»œå±‚å’Œè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸­ã€‚ ","date":"2021-10-29","objectID":"/linux%E5%86%85%E6%A0%B8%E5%90%8C%E6%AD%A5/:2:4","tags":["linux"],"title":"Linuxå†…æ ¸åŒæ­¥","uri":"/linux%E5%86%85%E6%A0%B8%E5%90%8C%E6%AD%A5/"},{"categories":["ç¬”è®°"],"content":"ä¿¡å·é‡ Linux æä¾›ä¸¤ç§ä¿¡å·é‡ : å†…æ ¸ä¿¡å·é‡ï¼Œç”±å†…æ ¸æ§åˆ¶è·¯å¾„ä½¿ç”¨ã€‚ System V IPC ä¿¡å·é‡ï¼Œç”±ç”¨æˆ·æ€è¿›ç¨‹ä½¿ç”¨ã€‚ å†…æ ¸ä¿¡å·é‡ç±»ä¼¼äºè‡ªæ—‹é”ï¼Œå› ä¸ºå½“é”å…³é—­ç€æ—¶ï¼Œå®ƒä¸å…è®¸å†…æ ¸æ§åˆ¶è·¯å¾„ç»§ç»­è¿›è¡Œã€‚ç„¶è€Œï¼Œå½“å†…æ ¸æ§åˆ¶è·¯å¾„è¯•å›¾è·å–å†…æ ¸ä¿¡å·é‡æ‰€ä¿æŠ¤çš„å¿™èµ„æºæ—¶ï¼Œç›¸åº”çš„è¿›ç¨‹è¢«æŒ‚èµ·ã€‚åªæœ‰åœ¨èµ„æºè¢«é‡Šæ”¾æ—¶ï¼Œè¿›ç¨‹æ‰å†æ¬¡å˜ä¸ºå¯è¿è¡Œçš„ã€‚å› æ­¤ï¼Œåªæœ‰å¯ä»¥ç¡çœ çš„å‡½æ•°æ‰èƒ½è·å–å†…æ ¸ä¿¡å·é‡ï¼›ä¸­æ–­å¤„ç†ç¨‹åºå’Œå¯å»¶è¿Ÿå‡½æ•°éƒ½ä¸èƒ½ä½¿ç”¨å†…æ ¸ä¿¡å·é‡ã€‚ å†…æ ¸ä¿¡å·é‡æ˜¯ struct semaphore ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…å«ä¸‹é¢è¿™äº›å­—æ®µ: count: å­˜æ”¾ atomic_t ç±»å‹çš„ä¸€ä¸ªå€¼ã€‚å¦‚æœè¯¥å€¼å¤§äº 0ï¼Œé‚£ä¹ˆèµ„æºå°±æ˜¯ç©ºé—²çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥èµ„æºç°åœ¨å¯ä»¥ä½¿ç”¨ã€‚ç›¸åï¼Œå¦‚æœ count ç­‰äº0ã€‚é‚£ä¹ˆä¿¡å·é‡æ˜¯å¿™çš„ï¼Œä½†æ²¡æœ‰è¿›ç¨‹ç­‰å¾…è¿™ä¸ªè¢«ä¿æŠ¤çš„èµ„æºã€‚æœ€åï¼Œå¦‚æœ count ä¸ºè´Ÿæ•°ï¼Œåˆ™èµ„æºæ—¶ä¸å¯ç”¨çš„ï¼Œå¹¶è‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹ç­‰å¾…èµ„æºã€‚ wait: å­˜æ”¾ç­‰å¾…é˜Ÿåˆ—é“¾è¡¨çš„åœ°å€ï¼Œå½“å‰ç­‰å¾…èµ„æºçš„æ‰€æœ‰ç¡çœ è¿›ç¨‹éƒ½æ”¾åœ¨è¿™ä¸ªé“¾è¡¨ä¸­ã€‚å½“ç„¶ï¼Œå¦‚æœ count å¤§äºæˆ–ç­‰äº 0ï¼Œç­‰å¾…é˜Ÿåˆ—å°±ä¸ºç©ºã€‚ sleepers: å­˜æ”¾ä¸€ä¸ªæ ‡å¿—ï¼Œè¡¨ç¤ºæ˜¯å¦æœ‰ä¸€äº›è¿›ç¨‹åœ¨ä¿¡å·é‡ä¸Šç¡çœ ã€‚ å¯ä»¥ç”¨ init_MUTEX() å’Œ init_MUTEX_LOCKED() å‡½æ•°æ¥åˆå§‹åŒ–äº’æ–¥è®¿é—®æ‰€éœ€çš„ä¿¡å·é‡ã€‚ å½“è¿›ç¨‹å¸Œæœ›é‡Šæ”¾å†…æ ¸ä¿¡å·é‡é”æ—¶ï¼Œå°±è°ƒç”¨ up() å‡½æ•°ã€‚ç›¸åï¼Œå½“è¿›ç¨‹å¸Œæœ›è·å–å†…æ ¸ä¿¡å·è·å–å†…æ ¸ä¿¡å·é‡é”æ—¶ï¼Œå°±è°ƒç”¨ down() å‡½æ•°ã€‚ è¯»/å†™ä¿¡å·é‡ç±»ä¼¼äº\"è¯»/å†™è‡ªæ—‹é”\"ï¼Œä¸åŒçš„æ˜¯ï¼šåœ¨ä¿¡å·é‡å†æ¬¡å˜ä¸ºæ‰“å¼€ä¹‹å‰ï¼Œç­‰å¾…è¿›ç¨‹æŒ‚èµ·è€Œä¸æ˜¯è‡ªæ—‹ã€‚ å¾ˆå¤šå†…æ ¸æ§åˆ¶è·¯å¾„ä¸ºè¯»å¯ä»¥å¹¶å‘åœ°è·å–è¯»/å†™ä¿¡å·é‡ã€‚ä½†æ˜¯ï¼Œä»»ä½•å†™è€…å†…æ ¸æ§åˆ¶è·¯å¾„å¿…é¡»æœ‰è¢«ä¿æŠ¤èµ„æºçš„äº’æ–¥è®¿é—®ã€‚å› æ­¤ï¼Œåªæœ‰åœ¨æ²¡æœ‰å†…æ ¸æ§åˆ¶è·¯å¾„ä¸ºè¯»è®¿é—®æˆ–å†™è®¿é—®æŒæœ‰ä¿¡å·é‡æ—¶ï¼Œæ‰å¯ä»¥ä¸ºå†™è·å–ä¿¡å·é‡ã€‚è¯»/å†™ä¿¡å·é‡å¯ä»¥æä¾›å†…æ ¸ä¸­çš„å¹¶å‘åº¦ï¼Œå¹¶æ”¹å–„äº†è¿™ä¸ªç³»ç»Ÿçš„æ€§èƒ½ã€‚ å†…æ ¸ä»¥ä¸¥æ ¼çš„FIFOé¡ºåºå¤„ç†ç­‰å¾…è¯»/å†™ä¿¡å·é‡çš„æ‰€æœ‰è¿›ç¨‹ã€‚å¦‚æœè¯»è€…æˆ–å†™è€…è¿›ç¨‹å‘ç°ä¿¡å·é‡å…³é—­ï¼Œè¿™äº›è¿›ç¨‹å°±è¢«æ’å…¥åˆ°ä¿¡å·é‡ç­‰å¾…é˜Ÿåˆ—é“¾è¡¨çš„æœ«å°¾ã€‚å½“ä¿¡å·é‡è¢«é‡Šæ”¾æ—¶ï¼Œå°±æ£€æŸ¥å¤„äºç­‰å¾…é˜Ÿåˆ—é“¾è¡¨ç¬¬ä¸€ä¸ªä½ç½®çš„è¿›ç¨‹ã€‚ç¬¬ä¸€ä¸ªè¿›ç¨‹å¸¸è¢«å”¤é†’ã€‚å¦‚æœæ˜¯ä¸€ä¸ªå†™è€…è¿›ç¨‹ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸Šå…¶ä»–çš„è¿›ç¨‹å°±ç»§ç»­ç¡çœ ã€‚å¦‚æœæ˜¯ä¸€ä¸ªè¯»è€…è¿›ç¨‹ï¼Œé‚£ä¹ˆç´§è·Ÿç¬¬ä¸€ä¸ªè¿›ç¨‹çš„å…¶ä»–æ‰€æœ‰è¯»è€…è¿›ç¨‹ä¹Ÿè¢«å”¤é†’å¹¶è·å¾—é”ã€‚ä¸è¿‡ï¼Œåœ¨å†™è€…è¿›ç¨‹ä¹‹åæ’é˜Ÿçš„è¯»è€…è¿›ç¨‹ç»§ç»­ç¡çœ ã€‚ æ¯ä¸ªè¯»/å†™ä¿¡å·é‡éƒ½æ˜¯ç”± rw_semaphore ç»“æ„æè¿°çš„ï¼Œå®ƒåŒ…å«ä¸‹åˆ—å­—æ®µ: count: å­˜æ”¾ä¸¤ä¸ª16ä½è®¡æ•°å™¨ã€‚å…¶ä¸­æœ€é«˜16ä½è®¡æ•°å™¨ä»¥äºŒè¿›åˆ¶è¡¥ç å½¢å¼å­˜æ”¾éç­‰å¾…å†™è€…è¿›ç¨‹çš„æ€»æ•°(0æˆ–1)å’Œç­‰å¾…çš„å†™å†…æ ¸æ§åˆ¶è·¯å¾„æ•°ã€‚æœ€ä½16ä½è®¡æ•°å™¨å­˜æ”¾éç­‰å¾…çš„è¯»è€…å’Œå†™è€…çš„æ€»æ•°ã€‚ wait_list: æŒ‡å‘ç­‰å¾…è¿›ç¨‹çš„é“¾è¡¨ã€‚é“¾è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ å¤šæ˜¯ä¸€ä¸ª rwsem_waiter ç»“æ„ï¼Œè¯¥ç»“æ„åŒ…å«ä¸€ä¸ªæŒ‡é’ˆå’Œä¸€ä¸ªæ ‡å¿—ï¼ŒæŒ‡é’ˆæŒ‡å‘ç¡çœ è¿›ç¨‹çš„æè¿°ç¬¦ï¼Œæ ‡å¿—è¡¨ç¤ºè¿›ç¨‹æ˜¯ä¸ºè¯»éœ€è¦ä¿¡å·é‡è¿˜æ˜¯ä¸ºéœ€è¦ä¿¡å·é‡ã€‚ wait_lock: ä¸€ä¸ªè‡ªæ—‹é”ï¼Œç”¨æˆ·ä¿æŠ¤ç­‰å¾…é˜Ÿåˆ—é“¾è¡¨å’Œ rw_semphore ç»“æ„æœ¬èº«ã€‚ down_read() å’Œ down_write() å‡½æ•°åˆ†åˆ«ä¸ºè¯»æˆ–å†™è·å–è¯»/å†™ä¿¡å·é‡ã€‚åŒæ ·ï¼Œup_read() å’Œ up_write() å‡½æ•°ä¸ºè¯»æˆ–å†™é‡Šæ”¾ä»¥å‰è·å–çš„è¯»/å†™ä¿¡å·é‡ã€‚ down_read_trylock() å’Œ down_write_trylock() å‡½æ•°åˆ†åˆ«ç±»ä¼¼äº down_read() å’Œ down_write() å‡½æ•°ï¼Œä½†æ˜¯ï¼Œåœ¨ä¿¡å·é‡å¿™çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬ä¸é˜»å¡è¿›ç¨‹ã€‚æœ€åï¼Œå‡½æ•° downgrade_write() è‡ªåŠ¨æŠŠå†™é”è½¬æ¢æˆè¯»é”ã€‚ ","date":"2021-10-29","objectID":"/linux%E5%86%85%E6%A0%B8%E5%90%8C%E6%AD%A5/:2:5","tags":["linux"],"title":"Linuxå†…æ ¸åŒæ­¥","uri":"/linux%E5%86%85%E6%A0%B8%E5%90%8C%E6%AD%A5/"},{"categories":["ç¬”è®°"],"content":"ä¸­æ–­(interrupt)é€šå¸¸è¢«å®šä¹‰ä¸ºä¸€ä¸ªäº‹ä»¶ï¼Œè¯¥äº‹ä»¶æ”¹å˜å¤„ç†å™¨æ‰§è¡Œçš„æŒ‡ä»¤é¡ºåºã€‚è¿™æ ·çš„äº‹ä»¶ä¸CPUèŠ¯ç‰‡å†…å¤–éƒ¨ç¡¬ä»¶ç”µè·¯äº§ç”Ÿçš„ç‚¹ä¿¡å·ç›¸å¯¹åº”ã€‚ ä¸­æ–­é€šå¸¸åˆ†ä¸ºåŒæ­¥ (synchronous) ä¸­æ–­å’Œå¼‚æ­¥ (asynchornous) ä¸­æ–­: åŒæ­¥ä¸­æ–­æ˜¯å½“æŒ‡ä»¤æ‰§è¡Œæ—¶ç”± CPU æ§åˆ¶å•å…ƒäº§ç”Ÿçš„ï¼Œä¹‹æ‰€ä»¥ç§°ä¸ºåŒæ­¥ï¼Œæ˜¯å› ä¸ºåªæœ‰åœ¨ä¸€æ¡æŒ‡ä»¤ç»ˆæ­¢æ‰§è¡Œå CPU æ‰ä¼šå‘å‡ºä¸­æ–­ã€‚ å¼‚æ­¥ä¸­æ–­æ˜¯ç”±å…¶ä»–ç¡¬ä»¶è®¾å¤‡ä¾ç…§ CPU æ—¶é’Ÿä¿¡å·éšæœºäº§ç”Ÿçš„ã€‚ åœ¨ Intel å¾®å¤„ç†å™¨ä¸­ï¼ŒæŠŠåŒæ­¥å’Œå¼‚æ­¥ä¸­æ–­åˆ†åˆ«ç§°ä¸ºå¼‚å¸¸ (exception) å’Œä¸­æ–­ (interrupt)ã€‚ ä¸­æ–­æ˜¯ç”±é—´éš”å®šæ—¶å™¨å’ŒI/Oè®¾å¤‡äº§ç”Ÿçš„ï¼Œå¼‚å¸¸æ˜¯ç”±ç¨‹åºçš„é”™è¯¯äº§ç”Ÿçš„ï¼Œæˆ–è€…æ˜¯ç”±å†…æ ¸å¿…é¡»å¤„ç†çš„å¼‚å¸¸æ¡ä»¶äº§ç”Ÿçš„ã€‚ ","date":"2021-10-28","objectID":"/linux%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B8/:0:0","tags":["linux"],"title":"Linuxä¸­æ–­å’Œå¼‚å¸¸","uri":"/linux%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B8/"},{"categories":["ç¬”è®°"],"content":"ä¸­æ–­ä¿¡å·çš„ä½œç”¨ ä¸­æ–­ä¿¡å·æä¾›äº†ä¸€ç§ç‰¹æ®Šçš„æ–¹å¼ï¼Œä½¿å¤„ç†å™¨è½¬è€Œå»è¿è¡Œæ­£å¸¸æ§åˆ¶æµä¹‹å¤–çš„ä»£ç ã€‚å½“ä¸€ä¸ªä¸­æ–­ä¿¡å·è¾¾åˆ°æ˜¯ï¼ŒCPU å¿…é¡»åœæ­¢å®ƒå½“å‰æ­£åœ¨åšçš„äº‹æƒ…ï¼Œå¹¶ä¸”åˆ‡æ¢åˆ°ä¸€ä¸ªæ–°çš„æ´»åŠ¨ã€‚æ‰€ä»¥è¦åœ¨å†…æ ¸æ€å †æ ˆä¿å­˜ç¨‹åºè®¡æ•°å™¨çš„å½“å‰å€¼(å³eipå’Œcså¯„å­˜å™¨çš„å†…å®¹)ï¼Œå¹¶æŠŠä¸ä¸­æ–­ç±»å‹ç›¸å…³çš„ä¸€ä¸ªåœ°å€æ”¾è¿›ç¨‹åºè®¡æ•°å™¨ã€‚ ","date":"2021-10-28","objectID":"/linux%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B8/:1:0","tags":["linux"],"title":"Linuxä¸­æ–­å’Œå¼‚å¸¸","uri":"/linux%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B8/"},{"categories":["ç¬”è®°"],"content":"ä¸­æ–­å’Œå¼‚å¸¸ ä¸­æ–­: å¯å±è”½ä¸­æ–­ (maskable interrupt) : I/O è®¾å¤‡å‘å‡ºçš„æ‰€æœ‰ä¸­æ–­è¯·æ±‚(IRQ)éƒ½äº§ç”Ÿå¯å±è”½ä¸­æ–­ã€‚å¯å±è”½ä¸­æ–­å¯ä»¥å¤„äºä¸¤ç§çŠ¶æ€: å±è”½çš„ (masked) æˆ–éå±è”½çš„ (unmasked)ï¼›ä¸€ä¸ªå±è”½çš„ä¸­æ–­åªè¦è¿˜æ˜¯å±è”½çš„ï¼Œæ§åˆ¶å•å…ƒå°±å¿½ç•¥å®ƒã€‚ éå±è”½ä¸­æ–­ (nonmaskable interrupt) : åªæœ‰å‡ ä¸ªå±æ€¥äº‹ä»¶(å¦‚ç¡¬ä»¶æ•…éšœ)æ‰å¼•èµ·éå±è”½ä¸­æ–­ã€‚éå±è”½ä¸­æ–­æ€»æ˜¯ç”±CPUè¾¨è®¤ã€‚ å¼‚å¸¸: å¤„ç†å™¨æ¢æµ‹å¼‚å¸¸(processor-detected exception) : å½“ CPU æ‰§è¡ŒæŒ‡ä»¤æ—¶æ¢æµ‹åˆ°ä¸€ä¸ªåå¸¸æ¡ä»¶æ‰€äº§ç”Ÿçš„å¼‚å¸¸ã€‚å¯ä»¥è¿›ä¸€æ­¥åˆ†ä¸ºä¸‰ç»„ï¼Œè¿™å–å†³äºCPUæ§åˆ¶å•å…ƒäº§ç”Ÿå¼‚å¸¸æ˜¯ä¿å­˜åœ¨å†…æ ¸æ€å †æ ˆeipå¯„å­˜å™¨ä¸­çš„å€¼ã€‚å®ƒä»¬åˆ†åˆ«æ˜¯æ•…éšœ(fault)ã€é™·é˜±(trap) å’Œå¼‚å¸¸ä¸­æ­¢(abort)ã€‚ ç¼–ç¨‹å¼‚å¸¸(programmed exception) : åœ¨ç¼–ç¨‹è€…å‘å‡ºè¯·æ±‚æ—¶å‘ç”Ÿã€‚æ˜¯ç”± int æˆ– int3 æŒ‡ä»¤è§¦å‘çš„ã€‚å½“ into(æ£€æŸ¥æº¢å‡º)å’Œ bound(æ£€æŸ¥åœ°å€å‡ºç•Œ)æŒ‡ä»¤æŸ¥è¯¢çš„æ¡ä»¶ä¸ä¸ºçœŸæ—¶ï¼Œä¹Ÿå¼•èµ·ç¼–ç¨‹å¼‚å¸¸ã€‚æ§åˆ¶å•å…ƒæŠŠç¼–ç¨‹å¼‚å¸¸ä½œä¸ºé™·é˜±æ¥å¤„ç†ã€‚ç¼–ç¨‹å¼‚å¸¸é€šå¸¸ä¹Ÿå«åšè½¯ä¸­æ–­(software interrupt)ã€‚è¿™æ ·çš„å¼‚å¸¸æœ‰ä¸¤ç§å¸¸ç”¨çš„ç”¨é€”: æ‰§è¡Œç³»ç»Ÿè°ƒç”¨å’Œç»™è°ƒè¯•ç¨‹åºé€šæŠ¥ä¸€ä¸ªç‰¹å®šçš„äº‹ä»¶ã€‚ å¤„ç†å™¨æ¢æµ‹çš„å¼‚å¸¸: æ•…éšœ: é€šå¸¸å¯ä»¥çº æ­£ã€‚ä¸€æ—¦çº æ­£ï¼Œç¨‹åºå°±å¯ä»¥åœ¨ä¸å¤±è¿è´¯æ€§çš„æƒ…å†µä¸‹é‡æ–°å¼€å§‹ã€‚ä¿å­˜åœ¨ eip ä¸­çš„å€¼æ˜¯å¼•èµ·æ•…éšœçš„æŒ‡ä»¤åœ°å€ã€‚å› æ­¤ï¼Œå½“å¼‚å¸¸å¤„ç†ç¨‹åºç»ˆæ­¢æ—¶ï¼Œé‚£æ¡æŒ‡ä»¤ä¼šè¢«é‡æ–°æ‰§è¡Œã€‚ é™·é˜±: åœ¨é™·é˜±æŒ‡ä»¤æ‰§è¡Œåç«‹å³æŠ¥å‘Šã€‚å†…æ ¸æŠŠæ§åˆ¶æƒè¿”å›ç»™ç¨‹åº¦åå°±å¯ä»¥ç»§ç»­å®ƒçš„æ‰§è¡Œè€Œä¸å¤±è¿è´¯æ€§ã€‚ä¿å­˜åœ¨ eip ä¸­çš„å€¼æ˜¯ä¸€ä¸ªéšåè¦æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€ã€‚åªæœ‰å½“æ²¡æœ‰å¿…é¡»è¦é‡æ–°æ‰§è¡Œä»¥ç»ˆæ­¢çš„æŒ‡ä»¤æ—¶ï¼Œæ‰è§¦å‘é™·é˜±ã€‚é™·é˜±çš„ä¸»è¦ç”¨é€”æ˜¯ä¸ºäº†è°ƒè¯•ç¨‹åºã€‚ å¼‚å¸¸ä¸­æ­¢: å‘é€ä¸€ä¸ªä¸¥é‡çš„é”™è¯¯ï¼Œæ§åˆ¶å•å…ƒå‡ºäº†é—®é¢˜ï¼Œä¸èƒ½åœ¨ eip å¯„å­˜å™¨ä¸­ä¿å­˜å¼•èµ·å¼‚å¸¸çš„æŒ‡ä»¤æ‰€åœ¨çš„ç¡®åˆ‡ä½ç½®ã€‚å¼‚å¸¸ä¸­æ­¢ç”¨äºæŠ¥å‘Šä¸¥é‡çš„é”™è¯¯ï¼Œå¦‚ç¡¬ä»¶æ•…éšœæˆ–ç³»ç»Ÿè¡¨ä¸­æ— æ•ˆçš„å€¼æˆ–ä¸ä¸€è‡´çš„å€¼ã€‚ç”±æ§åˆ¶å•å…ƒå‘é€çš„è¿™ä¸ªä¸­æ–­ä¿¡å·æ—¶ç´§æ€¥ä¿¡å·ï¼Œç”¨æ¥æŠŠæ§åˆ¶æƒåˆ‡æ¢åˆ°ç›¸åº”çš„å¼‚å¸¸ä¸­æ­¢å¤„ç†ç¨‹åºï¼Œè¿™ä¸ªå¼‚å¸¸ä¸­æ­¢å¤„ç†ç¨‹åºé™¤äº†å¼ºåˆ¶å—å½±å“çš„è¿›ç¨‹ä¸­æ­¢å¤–ï¼Œæ²¡æœ‰åˆ«çš„é€‰æ‹©ã€‚ æ¯ä¸ªä¸­æ–­å’Œå¼‚å¸¸æ˜¯ç”±0~255ä¹‹é—´çš„ä¸€ä¸ªæ•°æ¥æ ‡è¯†ã€‚Intel æŠŠè¿™ä¸ª8ä½çš„æ— ç¬¦å·æ•´æ•°å«åšä¸€ä¸ªå‘é‡(vector)ã€‚éå±è”½ä¸­æ–­çš„å‘é‡å’Œå¼‚å¸¸çš„å‘é‡æ˜¯å›ºå®šçš„ï¼Œè€Œå¯å±è”½ä¸­æ–­çš„å‘é‡å¯ä»¥é€šè¿‡å¯¹ä¸­æ–­æ§åˆ¶å™¨çš„ç¼–ç¨‹æ¥æ”¹å˜ã€‚ ","date":"2021-10-28","objectID":"/linux%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B8/:2:0","tags":["linux"],"title":"Linuxä¸­æ–­å’Œå¼‚å¸¸","uri":"/linux%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B8/"},{"categories":["ç¬”è®°"],"content":"è¿›ç¨‹æ—¶ç¨‹åºæ‰§è¡Œçš„ä¸€ä¸ªå®ä¾‹ï¼Œå¯ä»¥æŠŠå®ƒçœ‹ä½œå……åˆ†æè¿°ç¨‹åºå·²ç»æ‰§è¡Œåˆ°ä½•ç§ç¨‹åº¦çš„æ•°æ®ç»“æ„çš„æ±‡é›†ã€‚åœ¨ Linux æºä»£ç ä¸­ï¼Œå¸¸æŠŠè¿›ç¨‹ç§°ä¸ºä»»åŠ¡(task)æˆ–çº¿ç¨‹(thread)ã€‚ Linux ä½¿ç”¨è½»é‡çº§è¿›ç¨‹(lightweight process)å¯¹å¤šçº¿ç¨‹åº”ç”¨æä¾›æ›´å¥½çš„æ”¯æŒã€‚ä¸¤ä¸ªè½»é‡çº§è¿›ç¨‹åŸºæœ¬ä¸Šå¯ä»¥å…±äº«ä¸€äº›èµ„æºï¼Œè¯¸å¦‚åœ°å€ç©ºé—´ã€æ‰“å¼€çš„æ–‡ä»¶ç­‰ç­‰ã€‚ ","date":"2021-10-25","objectID":"/linux%E8%BF%9B%E7%A8%8B/:0:0","tags":["linux"],"title":"Linuxè¿›ç¨‹","uri":"/linux%E8%BF%9B%E7%A8%8B/"},{"categories":["ç¬”è®°"],"content":"è¿›ç¨‹æè¿°ç¬¦ ","date":"2021-10-25","objectID":"/linux%E8%BF%9B%E7%A8%8B/:1:0","tags":["linux"],"title":"Linuxè¿›ç¨‹","uri":"/linux%E8%BF%9B%E7%A8%8B/"},{"categories":["ç¬”è®°"],"content":"è¿›ç¨‹çŠ¶æ€ è¿›ç¨‹çŠ¶æ€ç¬¦ä¸­çš„ state å­—æ®µæè¿°äº†è¿›ç¨‹æ‰€å¤„çš„çŠ¶æ€: å¯è¿è¡ŒçŠ¶æ€ (TASK_RUNNING) : è¿›ç¨‹è¦ä¹ˆåœ¨ CPU ä¸Šæ‰§è¡Œï¼Œè¦ä¹ˆå‡†å¤‡æ‰§è¡Œã€‚ å¯ä¸­æ–­çš„ç­‰å¾…çŠ¶æ€ (TASK_INTERRUPTIBLE) : è¿›ç¨‹è¢«æŒ‚èµ· (ç¡çœ )ï¼Œç›´åˆ°æŸä¸ªæ¡ä»¶è¡¨ä¸ºçœŸã€‚äº§ç”Ÿä¸€ä¸ªç¡¬ä»¶ä¸­æ–­ï¼Œé‡Šæ”¾è¿›ç¨‹æ­£ç­‰å¾…çš„ç³»ç»Ÿèµ„æºï¼Œæˆ–ä¼ é€’ä¸€ä¸ªä¿¡å·éƒ½æ˜¯å¯ä»¥å”¤é†’è¿›ç¨‹çš„æ¡ä»¶(æŠŠè¿›ç¨‹çš„çŠ¶æ€æ”¾å›åˆ° TASK_RUNNING)ã€‚ ä¸å¯ä¸­æ–­çš„ç­‰å¾…çŠ¶æ€ (TASK_UNINTERRUPTIBLE) : ä¸å¯ä¸­æ–­çš„ç­‰å¾…çŠ¶æ€ç±»ä¼¼ï¼Œä½†æœ‰ä¸€ä¸ªä¾‹å¤–ï¼ŒæŠŠä¿¡å·ä¼ é€’åˆ°ç¡çœ ä¸èƒ½æ”¹å˜å®ƒçš„çŠ¶æ€ã€‚è¿™ç§çŠ¶æ€å¾ˆå°‘ç”¨åˆ°ï¼Œä½†åœ¨ä¸€äº›ç‰¹å®šçš„æƒ…å†µä¸‹(è¿›ç¨‹å¿…é¡»ç­‰å¾…ï¼Œç›´åˆ°ä¸€ä¸ªä¸èƒ½è¢«ä¸­æ–­çš„äº‹ä»¶å‘ç”Ÿ)ï¼Œè¿™ç§çŠ¶æ€æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ä¾‹å¦‚ï¼Œå½“è¿›ç¨‹æ‰“å¼€ä¸€ä¸ªè®¾å¤‡æ–‡ä»¶ï¼Œå…¶ç›¸åº”çš„è®¾å¤‡é©±åŠ¨ç¨‹åºå¼€å§‹æ¢æµ‹ç›¸åº”çš„ç¡¬ä»¶è®¾å¤‡æ—¶ä¼šç”¨åˆ°è¿™ç§çŠ¶æ€ã€‚æ¢æµ‹å®Œæˆä»¥å‰ï¼Œè®¾å¤‡é©±åŠ¨ç¨‹åºä¸èƒ½è¢«ä¸­æ–­ï¼Œå¦åˆ™ï¼Œç¡¬ä»¶è®¾å¤‡ä¼šå¤„äºä¸å¯é¢„çŸ¥çš„çŠ¶æ€ã€‚ æš‚å®šçŠ¶æ€ (TASK_STOPPED) : è¿›ç¨‹çš„æ‰§è¡Œè¢«æš‚åœã€‚å½“è¿›ç¨‹æ¥æ”¶åˆ° SIGSTOPã€SIGTSTPã€SIGTTIN æˆ– STGTTOU ä¿¡å·ï¼Œè¿›ç¨‹æš‚åœçŠ¶æ€ã€‚ è·Ÿè¸ªçŠ¶æ€ (TASK_TRACED) : è¿›ç¨‹çš„æ‰§è¡Œå·²ç”± debugger ç¨‹åºæš‚åœã€‚å½“ä¸€ä¸ªè¿›ç¨‹è¢«å¦ä¸€ä¸ªè¿›ç¨‹ç›‘æ§æ—¶(ä¾‹å¦‚ debugger æ‰§è¡Œ ptrace() ç³»ç»Ÿè°ƒç”¨ç›‘æ§ä¸€ä¸ªæµ‹è¯•ç¨‹åº)ï¼Œä»»ä½•ä¿¡å·éƒ½å¯ä»¥æŠŠè¿™ä¸ªè¿›ç¨‹ç½®äº TASK_TRACED çŠ¶æ€ã€‚ è¿˜æœ‰ä¸¤ä¸ªè¿›ç¨‹çŠ¶æ€æ˜¯æ—¢å¯ä»¥å­˜æ”¾åœ¨è¿›ç¨‹æè¿°ç¬¦çš„ state å­—æ®µä¸­ï¼Œä¹Ÿå¯ä»¥å­˜æ”¾åœ¨ exit_state å­—æ®µä¸­ã€‚ä»è¿™ä¸¤ä¸ªå­—æ®µçš„åç§°å¯ä»¥çœ‹å‡ºï¼Œåªæœ‰å½“è¿›ç¨‹çš„æ‰§è¡Œè¢«ç»ˆæ­¢æ—¶ï¼Œè¿›ç¨‹çš„çŠ¶æ€æ‰ä¼šå˜ä¸ºè¿™ä¸¤ç§çŠ¶æ€ä¸­çš„ä¸€ç§: åƒµæ­»çŠ¶æ€ (EXIT_ZOMBIE) : è¿›ç¨‹çš„æ‰§è¡Œè¢«ç»ˆæ­¢ï¼Œä½†æ˜¯ï¼Œçˆ¶è¿›ç¨‹è¿˜æ²¡æœ‰å‘å¸ƒ wait4() æˆ– waitpid() ç³»ç»Ÿè°ƒç”¨æ¥è¿”å›æœ‰å…³æ­»äº¡è¿›ç¨‹çš„ä¿¡æ¯ã€‚å‘å¸ƒ wait() ç±»ç³»ç»Ÿè°ƒç”¨å‰ï¼Œå†…æ ¸ä¸èƒ½ä¸¢å¼ƒåŒ…å«åœ¨æ­»è¿›ç¨‹æè¿°ç¬¦ä¸­çš„æ•°æ®ï¼Œå› ä¸ºçˆ¶è¿›ç¨‹å¯èƒ½è¿˜éœ€è¦å®ƒã€‚ åƒµæ­»æ’¤é”€çŠ¶æ€ (EXIT_DEAD) : æœ€ç»ˆçŠ¶æ€ï¼šç”±äºçˆ¶è¿›ç¨‹åˆšå‘å‡º wait4() æˆ– waitpid() ç³»ç»Ÿè°ƒç”¨ï¼Œå› è€Œè¿›ç¨‹ç”±ç³»ç»Ÿåˆ é™¤ã€‚ä¸ºäº†é˜²æ­¢å…¶ä»–æ‰§è¡Œçº¿ç¨‹åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸Šä¹Ÿæ‰§è¡Œ wait() ç±»ç³»ç»Ÿè°ƒç”¨ï¼Œè€ŒæŠŠè¿›ç¨‹çš„çŠ¶æ€ç”± (EXIT_ZOMBIE) çŠ¶æ€æ”¹ä¸ºåƒµæ­»æ’¤é”€çŠ¶æ€ (EXIT_DEAD)ã€‚ ","date":"2021-10-25","objectID":"/linux%E8%BF%9B%E7%A8%8B/:1:1","tags":["linux"],"title":"Linuxè¿›ç¨‹","uri":"/linux%E8%BF%9B%E7%A8%8B/"},{"categories":["ç¬”è®°"],"content":"æ ‡è¯†ä¸€ä¸ªè¿›ç¨‹ æ ‡è¯†ä¸€ä¸ªè¿›ç¨‹æœ‰ä¸¤ç§æ–¹å¼: è¿›ç¨‹æè¿°ç¬¦æŒ‡é’ˆ: è¿›ç¨‹å’Œè¿›ç¨‹æè¿°ç¬¦ä¹‹é—´æœ‰éå¸¸ä¸¥æ ¼çš„ä¸€ä¸€å¯¹åº”å…³ç³»ï¼Œè¿™ä½¿å¾—ç”¨32ä½è¿›ç¨‹æè¿°ç¬¦åœ°å€æ ‡è¯†è¿›ç¨‹æˆä¸ºä¸€ç§æ–¹ä¾¿çš„æ–¹å¼ã€‚ PID: PID å­˜æ”¾åœ¨è¿›ç¨‹æè¿°ç¬¦çš„ pid å­—æ®µä¸­ã€‚ PID è¢«é¡ºåºç¼–å·ï¼Œæ–°åˆ›å»ºè¿›ç¨‹çš„ PID é€šå¸¸æ˜¯å‰ä¸€ä¸ªè¿›ç¨‹çš„ PID åŠ 1ã€‚PID å­˜åœ¨ä¸Šé™ï¼Œå½“å†…æ ¸ä½¿ç”¨çš„ PID è¾¾åˆ°è¿™ä¸ªä¸Šé™å€¼çš„æ—¶å€™å°±å¿…é¡»å¼€å§‹å¾ªç¯ä½¿ç”¨å·²é—²ç½®çš„ PID å·ã€‚ PID çš„é»˜è®¤æœ€å¤§å€¼æ˜¯32767(PID_MAX_DEFAULT-1)ã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹ /proc/sys/kernel/pid_max æ–‡ä»¶æ”¹å˜ PID ä¸Šé™å€¼ã€‚ å†…æ ¸é€šè¿‡ç®¡ç†ä¸€ä¸ª pidmap-array ä½å›¾æ¥è¡¨ç¤ºå½“å‰å·²åˆ†é…çš„ PID å·å’Œé—²ç½®çš„ PID å·ã€‚ ","date":"2021-10-25","objectID":"/linux%E8%BF%9B%E7%A8%8B/:1:2","tags":["linux"],"title":"Linuxè¿›ç¨‹","uri":"/linux%E8%BF%9B%E7%A8%8B/"},{"categories":["ç¬”è®°"],"content":"è¿›ç¨‹çš„åˆ‡æ¢ ä¸ºäº†æ§åˆ¶è¿›ç¨‹çš„æ‰§è¡Œï¼Œå†…æ ¸å¿…é¡»æœ‰èƒ½åŠ›æŒ‚èµ·æ­£åœ¨ CPU ä¸Šè¿è¡Œçš„è¿›ç¨‹ï¼Œå¹¶æ¢å¤ä»¥å‰æŒ‚èµ·çš„æŸä¸ªè¿›ç¨‹çš„æ‰§è¡Œã€‚è¿™ä¸ªä¸­è¡Œä¸ºè¢«ç§°ä¸ºè¿›ç¨‹åˆ‡æ¢ (process switch)ã€ä»»åŠ¡åˆ‡æ¢ (task switch) æˆ–ä¸Šä¸‹æ–‡åˆ‡æ¢ (context switch)ã€‚ æ‰€æœ‰è¿›ç¨‹å…±äº« CPU å¯„å­˜å™¨ï¼Œæ‰€ä»¥åœ¨æ¢å¤ä¸€ä¸ªè¿›ç¨‹çš„æ‰§è¡Œä¹‹å‰ï¼Œå¿…é¡»ç¡®ä¿æ¯ä¸ªå¯„å­˜å™¨è£…å…¥äº†æŒ‚èµ·è¿›ç¨‹æ—¶çš„å€¼ã€‚ ","date":"2021-10-25","objectID":"/linux%E8%BF%9B%E7%A8%8B/:2:0","tags":["linux"],"title":"Linuxè¿›ç¨‹","uri":"/linux%E8%BF%9B%E7%A8%8B/"},{"categories":["ç¬”è®°"],"content":"ç¡¬ä»¶ä¸Šä¸‹æ–‡ è¿›ç¨‹æ¢å¤æ‰§è¡Œå‰å¿…é¡»è£…å…¥å¯„å­˜å™¨çš„ä¸€ç»„æ•°æ®ç§°ä¸ºç¡¬ä»¶ä¸Šä¸‹æ–‡ (hardware context)ã€‚åœ¨ Linux ä¸­ï¼Œè¿›ç¨‹ç¡¬ä»¶ä¸Šä¸‹æ–‡çš„ä¸€éƒ¨åˆ†å­˜æ”¾åœ¨ TSS æ®µï¼Œè€Œå‰©ä½™éƒ¨åˆ†å­˜æ”¾åœ¨å†…æ ¸æ€å †æ ˆä¸­ã€‚ è¿›ç¨‹åˆ‡æ¢åªå‘ç”Ÿåœ¨å†…æ ¸æ€ï¼Œåœ¨æ‰§è¡Œè¿›ç¨‹åˆ‡æ¢ä¹‹å‰ï¼Œç”¨æˆ·æ€è¿›ç¨‹ä½¿ç”¨çš„æ‰€æœ‰å¯„å­˜å™¨å†…å®¹éƒ½å·²ä¿å­˜åœ¨å†…æ ¸æ€å †æ ˆä¸Šï¼Œè¿™ä¹ŸåŒ…æ‹¬ ss å’Œ esp è¿™å¯¹å¯„å­˜å™¨çš„å†…å®¹ (å­˜å‚¨ç”¨æˆ·æ€å †æ ˆæŒ‡é’ˆçš„åœ°å€)ã€‚ Linux ä½¿ç”¨è½¯ä»¶åˆ‡æ¢ä¸Šä¸‹æ–‡ ","date":"2021-10-25","objectID":"/linux%E8%BF%9B%E7%A8%8B/:2:1","tags":["linux"],"title":"Linuxè¿›ç¨‹","uri":"/linux%E8%BF%9B%E7%A8%8B/"},{"categories":["ç¬”è®°"],"content":"ä»»åŠ¡çŠ¶æ€æ®µ 80x86 ä½“ç³»ç»“æ„åŒ…æ‹¬äº†ä¸€ä¸ªç‰¹æ®Šçš„ä½†ç±»å‹ï¼Œå«ä»»åŠ¡çŠ¶æ€æ®µ (Task State Segment, TSS) æ¥å­˜æ”¾ç¡¬ä»¶ä¸Šä¸‹æ–‡ã€‚Linux ä¸ä½¿ç”¨ç¡¬ä»¶ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä½†æ˜¯å¼ºåˆ¶ä¸ºæ¯ä¸ªä¸åŒCPUåˆ›å»ºä¸€ä¸ªTSSã€‚ ","date":"2021-10-25","objectID":"/linux%E8%BF%9B%E7%A8%8B/:2:2","tags":["linux"],"title":"Linuxè¿›ç¨‹","uri":"/linux%E8%BF%9B%E7%A8%8B/"},{"categories":["ç¬”è®°"],"content":"æ‰§è¡Œè¿›ç¨‹åˆ‡æ¢ è¿›ç¨‹åˆ‡æ¢çš„æ ¸å¿ƒç‚¹åœ¨äº scheduler() å‡½æ•°ã€‚ ä»æœ¬è´¨ä¸Šè¯´ï¼Œæ¯ä¸ªè¿›ç¨‹åˆ‡æ¢ç”±ä¸¤æ­¥ç»„æˆ: åˆ‡æ¢é¡µå…¨å±€ç›®å½•ä»¥å®‰è£…ä¸€ä¸ªæ–°çš„åœ°å€ç©ºé—´ã€‚ åˆ‡æ¢å†…æ ¸æ€å †æ ˆå’Œç¡¬ä»¶ä¸Šä¸‹æ–‡ï¼Œå› ä¸ºç¡¬ä»¶ä¸Šä¸‹æ–‡æä¾›äº†å†…æ ¸æ‰§è¡Œæ–°è¿›ç¨‹æ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…å« CPU å¯„å­˜å™¨ (é‡ç‚¹åœ¨ switch_to() å‡½æ•°)ã€‚ ","date":"2021-10-25","objectID":"/linux%E8%BF%9B%E7%A8%8B/:2:3","tags":["linux"],"title":"Linuxè¿›ç¨‹","uri":"/linux%E8%BF%9B%E7%A8%8B/"},{"categories":["ç¬”è®°"],"content":"åˆ›å»ºè¿›ç¨‹ Linux ä¸­åˆ›å»ºä¸€ä¸ªè¿›ç¨‹çš„æ–¹å¼: fork() -\u003e sys_fork() -\u003e do_fork() -\u003e copy_process() ","date":"2021-10-25","objectID":"/linux%E8%BF%9B%E7%A8%8B/:3:0","tags":["linux"],"title":"Linuxè¿›ç¨‹","uri":"/linux%E8%BF%9B%E7%A8%8B/"},{"categories":["ç¬”è®°"],"content":"å†…æ ¸è¿›ç¨‹ ä¼ ç»Ÿçš„ Unix ç³»ç»ŸæŠŠä¸€äº›é‡è¦çš„ä»»åŠ¡å§”æ‰˜ç»™å‘¨æœŸæ€§æ‰§è¡Œçš„è¿›ç¨‹ï¼Œè¿™äº›è¿›ç¨‹åªè¿è¡Œåœ¨å†…æ ¸æ€ï¼Œç§°ä½œå†…æ ¸çº¿ç¨‹(kernel thread)ï¼Œå†…æ ¸çº¿ç¨‹ä¸å—ä¸å¿…è¦çš„ç”¨æˆ·æ€ä¸Šä¸‹æ–‡çš„æ‹–ç´¯ã€‚å†…æ ¸çº¿ç¨‹å’Œæ™®é€šè¿›ç¨‹çš„åŒºåˆ«: å†…æ ¸çº¿ç¨‹åªè¿è¡Œåœ¨å†…æ ¸æ€ï¼Œè€Œæ™®é€šè¿›ç¨‹æ—¢å¯ä»¥è¿è¡Œåœ¨å†…æ ¸æ€ï¼Œä¹Ÿå¯ä»¥è¿è¡Œåœ¨ç”¨æˆ·æ€ã€‚ å› ä¸ºå†…æ ¸çº¿ç¨‹åªè¿è¡Œåœ¨å†…æ ¸æ€ï¼Œå®ƒä»¬åªä½¿ç”¨å¤§äº PAGE_OFFSET çš„çº¿æ€§åœ°å€ç©ºé—´ã€‚å¦ä¸€æ–¹é¢ï¼Œä¸ç®¡åœ¨ç”¨æˆ·æ€è¿˜æ˜¯åœ¨å†…æ ¸æ€ï¼Œæ™®é€šè¿›ç¨‹å¯ä»¥ç”¨ 4GB çš„çº¿ç¨‹åœ°å€ç©ºé—´ã€‚ ","date":"2021-10-25","objectID":"/linux%E8%BF%9B%E7%A8%8B/:3:1","tags":["linux"],"title":"Linuxè¿›ç¨‹","uri":"/linux%E8%BF%9B%E7%A8%8B/"},{"categories":["ç¬”è®°"],"content":"è¿›ç¨‹ 0 æ‰€æœ‰è¿›ç¨‹çš„ç¥–å…ˆå«åšè¿›ç¨‹0ï¼Œidle è¿›ç¨‹æˆ– swapper è¿›ç¨‹ï¼Œå®ƒæ˜¯åœ¨ Linux çš„åˆå§‹åŒ–é˜¶æ®µä»æ— åˆ°æœ‰åˆ›å»ºçš„ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ã€‚start_kernel() å‡½æ•°åˆå§‹åŒ–å†…æ ¸éœ€è¦çš„æ‰€æœ‰æ•°æ®ç»“æ„ï¼Œæ¿€æ´»ä¸­æ–­ï¼Œåˆ›å»ºå¦ä¸€ä¸ªå«è¿›ç¨‹1çš„å†…æ ¸çº¿ç¨‹(initè¿›ç¨‹)ã€‚ æ–°åˆ›å»ºçš„å†…æ ¸çº¿ç¨‹çš„ PID ä¸º1ï¼Œå¹¶ä¸è¿›ç¨‹0å…±äº«æ¯è¿›ç¨‹æ‰€æœ‰çš„å†…æ ¸æ•°æ®ç»“æ„ã€‚æ­¤å¤–ï¼Œå½“è°ƒåº¦ç¨‹åºé€‰æ‹©åˆ°å®ƒæ—¶ï¼Œinit è¿›ç¨‹å¼€å§‹æ‰§è¡Œ init() å‡½æ•°ã€‚ åˆ›å»ºinitè¿›ç¨‹åï¼Œè¿›ç¨‹0æ‰§è¡Œ cpu_idle() å‡½æ•°ï¼Œè¯¥å‡½æ•°æœ¬è´¨ä¸Šæ˜¯åœ¨å¼€ä¸­æ–­çš„æƒ…å†µä¸‹é‡å¤æ‰§è¡Œ hlt æ±‡ç¼–è¯­è¨€æŒ‡ä»¤ã€‚åªæœ‰å½“æ²¡æœ‰è¿›ç¨‹å¤„äº TASK_RUNNING çŠ¶æ€æ˜¯ï¼Œè°ƒåº¦ç¨‹åºæ‰é€‰æ‹©è¿›ç¨‹0ã€‚ åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ª CPU éƒ½æœ‰ä¸€ä¸ªè¿›ç¨‹ 0ã€‚åªè¦æ‰“å¼€æœºå™¨ç”µæºï¼Œè®¡ç®—æœºçš„ BIOS å°±å¯åŠ¨æŸä¸€ä¸ª CPUï¼ŒåŒæ—¶ç¦ç”¨å…¶ä»– CPUã€‚è¿è¡Œåœ¨ CPU 0 ä¸Šçš„ swapper è¿›ç¨‹åˆå§‹åŒ–å†…æ ¸æ•°æ®ç»“æ„ï¼Œç„¶åæ¿€æ´»å…¶ä»–çš„CPUï¼Œå¹¶é€šè¿‡ copy_process() å‡½æ•°åˆ›å»ºå¦å¤–çš„ swapper è¿›ç¨‹ï¼ŒæŠŠ 0 ä¼ é€’ç»™æ–°åˆ›å»ºçš„ swapper è¿›ç¨‹ä½œä¸ºå®ƒä»¬çš„æ–° PIDã€‚æ­¤å¤–ï¼Œå†…æ ¸æŠŠé€‚å½“çš„ CPU ç´¢å¼•èµ‹ç»™å†…æ ¸æ‰€åˆ›å»ºçš„æ¯ä¸ªè¿›ç¨‹çš„ thread_info æè¿°ç¬¦çš„ cpu å­—æ®µã€‚ ","date":"2021-10-25","objectID":"/linux%E8%BF%9B%E7%A8%8B/:3:2","tags":["linux"],"title":"Linuxè¿›ç¨‹","uri":"/linux%E8%BF%9B%E7%A8%8B/"},{"categories":["ç¬”è®°"],"content":"è¿›ç¨‹ 1 ç”±è¿›ç¨‹0åˆ›å»ºçš„å†…æ ¸çº¿ç¨‹æ‰§è¡Œ init() å‡½æ•°ï¼Œinit() ä¾æ¬¡å®Œæˆå†…æ ¸åˆå§‹åŒ–ã€‚init() è°ƒç”¨ execve() ç³»ç»Ÿè°ƒç”¨è£…å…¥å¯æ‰§è¡Œç¨‹åº initã€‚ç»“æœï¼Œinit å†…æ ¸çº¿ç¨‹å˜ä¸ºä¸€ä¸ªæ™®é€šè¿›ç¨‹ï¼Œä¸”æ‹¥æœ‰è‡ªå·±çš„æ¯è¿›ç¨‹(per-process)å†…æ ¸æ•°æ®ç»“æ„ã€‚åœ¨ç³»ç»Ÿå…³é—­ä¹‹å‰ï¼Œinit è¿›ç¨‹ä¸€ç›´å­˜æ´»ï¼Œå› ä¸ºå®ƒåˆ›å»ºå’Œç›‘æ§åœ¨æ“ä½œç³»ç»Ÿå¤–å±‚æ‰§è¡Œçš„æ‰€æœ‰è¿›ç¨‹çš„æ´»åŠ¨ã€‚ ","date":"2021-10-25","objectID":"/linux%E8%BF%9B%E7%A8%8B/:3:3","tags":["linux"],"title":"Linuxè¿›ç¨‹","uri":"/linux%E8%BF%9B%E7%A8%8B/"},{"categories":["ç¬”è®°"],"content":"å…¶ä»–å†…æ ¸çº¿ç¨‹ keventd(ä¹Ÿè¢«ç§°ä¸ºäº‹ä»¶): æ‰§è¡Œ keventd_wq å·¥ä½œé˜Ÿåˆ—ä¸­çš„å‡½æ•°ã€‚ kapmd: å¤„ç†ä¸é«˜çº§ç”µæºç®¡ç†(APM)ç›¸å…³çš„äº‹ä»¶ã€‚ kswapd: æ‰§è¡Œå†…å­˜å›æ”¶ã€‚ pdflush: åˆ·æ–° â€œè„â€ ç¼“å†²åŒºä¸­çš„å†…å®¹åˆ°ç£ç›˜å›æ”¶å†…å­˜ã€‚ blockd: æ‰§è¡Œ kblockd_workqueue å·¥ä½œé˜Ÿåˆ—ä¸­çš„å‡½æ•°ã€‚ ksoftirqd: è¿è¡Œ tasklet; ç³»ç»Ÿä¸­æ¯ä¸ª CPU éƒ½æœ‰è¿™æ ·ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ã€‚ ","date":"2021-10-25","objectID":"/linux%E8%BF%9B%E7%A8%8B/:3:4","tags":["linux"],"title":"Linuxè¿›ç¨‹","uri":"/linux%E8%BF%9B%E7%A8%8B/"},{"categories":["ç¬”è®°"],"content":"æ’¤é”€è¿›ç¨‹ è¿›ç¨‹ç»ˆæ­¢çš„ä¸€èˆ¬æ–¹å¼æ˜¯è°ƒç”¨ exit() åº“å‡½æ•°ã€‚ ","date":"2021-10-25","objectID":"/linux%E8%BF%9B%E7%A8%8B/:4:0","tags":["linux"],"title":"Linuxè¿›ç¨‹","uri":"/linux%E8%BF%9B%E7%A8%8B/"},{"categories":["ç¬”è®°"],"content":"è¿›ç¨‹ç»ˆæ­¢ ç»ˆæ­¢ç”¨æˆ·æ€åº”ç”¨çš„ç³»ç»Ÿè°ƒç”¨: exit_group() ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒç»ˆæ­¢æ•´ä¸ªçº¿ç¨‹ç»„ï¼Œå³æ•´ä¸ªåŸºäºå¤šçº¿ç¨‹çš„åº”ç”¨ã€‚do_group_exit() æ˜¯å®ç°è¿™ä¸ªç³»ç»Ÿè°ƒç”¨çš„ä¸»è¦å†…æ ¸å‡½æ•°ã€‚ exit() ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒç»ˆæ­¢æŸä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œä¸ç®¡è¯¥çº¿ç¨‹æ‰€å±çº¿ç¨‹ç»„ä¸­çš„æ‰€æœ‰å…¶ä»–è¿›ç¨‹ã€‚do_exit() æ˜¯å®ç°è¿™ä¸ªç³»ç»Ÿè°ƒç”¨çš„ä¸»è¦å†…æ ¸å‡½æ•°ã€‚ ","date":"2021-10-25","objectID":"/linux%E8%BF%9B%E7%A8%8B/:4:1","tags":["linux"],"title":"Linuxè¿›ç¨‹","uri":"/linux%E8%BF%9B%E7%A8%8B/"},{"categories":["ç¬”è®°"],"content":"è¿›ç¨‹åˆ é™¤ è¿›ç¨‹é€šè¿‡è°ƒç”¨ wait() ç±»å‡½æ•°æ¥æ£€æŸ¥å­è¿›ç¨‹æ˜¯å¦ç»ˆæ­¢ï¼Œåœ¨å­è¿›ç¨‹å·²ç»ˆæ­¢ï¼Œä½†æ˜¯çˆ¶è¿›ç¨‹è¿˜æœªæ¥æ”¶åˆ° wait() ç±»å‡½æ•°çš„é€šçŸ¥ä¹‹å‰ï¼Œå­è¿›ç¨‹å¤„äºåƒµæ­»çŠ¶æ€ã€‚è¿™æ—¶ç³»ç»Ÿèµ„æºå·²ç»é‡Šæ”¾ï¼Œä½†è¿˜å ç”¨è¿›ç¨‹æè¿°ç¬¦ã€‚ å¦‚æœçˆ¶è¿›ç¨‹åœ¨æ¥æ”¶åˆ°å­è¿›ç¨‹å‰å°±ç»ˆæ­¢ï¼Œå­è¿›ç¨‹å°±ä¼šè¢«initè¿›ç¨‹æ¥ç®¡ã€‚ ","date":"2021-10-25","objectID":"/linux%E8%BF%9B%E7%A8%8B/:4:2","tags":["linux"],"title":"Linuxè¿›ç¨‹","uri":"/linux%E8%BF%9B%E7%A8%8B/"},{"categories":["ç¬”è®°"],"content":"å†…å­˜æ¦‚è®º ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:1:0","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"è™šæ‹Ÿå†…å­˜ è™šæ‹Ÿå†…å­˜(virtual memory)æ˜¯ Unix ç³»ç»Ÿä¸­ä¸€ç§å¯¹å†…å­˜çš„æŠ½è±¡ã€‚è™šæ‹Ÿå†…å­˜ä½œä¸ºä¸€ç§é€»è¾‘å±‚ï¼Œå¤„äºåº”ç”¨ç¨‹åºçš„å†…å­˜è¯·æ±‚ä¸ç¡¬ä»¶å†…å­˜ç®¡ç†å•å…ƒ(Memory Management Unit, MMU)ä¹‹é—´ã€‚è™šæ‹Ÿå†…å­˜æœ‰å¾ˆå¤šç”¨é€”å’Œä¼˜ç‚¹: è‹¥å¹²ä¸ªè¿›ç¨‹å¯èƒ½å¹¶å‘åœ°æ‰§è¡Œã€‚ åº”ç”¨ç¨‹åºæ‰€éœ€å†…å­˜å¤§äºå¯ç”¨ç‰©ç†å†…å­˜æ—¶ä¹Ÿå¯ä»¥è¿è¡Œã€‚ ç¨‹åºåªæœ‰éƒ¨åˆ†ä»£ç è£…å…¥å†…å­˜æ—¶è¿›ç¨‹å¯ä»¥æ‰§è¡Œå®ƒã€‚ å…è®¸æ¯ä¸ªè¿›ç¨‹è®¿é—®å¯ç”¨ç‰©ç†å†…å­˜çš„å­é›†ã€‚ è¿›ç¨‹å¯ä»¥å…±äº«åº“å‡½æ•°æˆ–ç¨‹åºçš„ä¸€ä¸ªå•ç‹¬å†…å­˜æ˜ è±¡ã€‚ ç¨‹åºæ—¶å¯é‡å®šä½çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥æŠŠç¨‹åºæ”¾åœ¨ç‰©ç†å†…å­˜çš„ä»»ä½•åœ°æ–¹ã€‚ ç¨‹åºå‘˜å¯ä»¥ç¼–å†™ä¸æœºå™¨æ— å…³çš„ä»£ç ï¼Œå› ä¸ºä»–ä»¬ä¸å¿…å…³å¿ƒæœ‰å…³ç‰©ç†å†…å­˜çš„ç»„ç»‡ç»“æ„ã€‚ è™šæ‹Ÿå†…å­˜å­ç³»ç»Ÿçš„ä¸»è¦æˆåˆ†æ˜¯è™šæ‹Ÿåœ°å€ç©ºé—´(virtual address space)çš„æ¦‚å¿µã€‚è¿›ç¨‹æ‰€ç”¨çš„ä¸€ç»„å†…å­˜åœ°å€ä¸åŒäºç‰©ç†å†…å­˜åœ°å€ã€‚å½“è¿›ç¨‹ä½¿ç”¨ä¸€ä¸ªè™šæ‹Ÿåœ°å€æ—¶ï¼Œå†…æ ¸å’ŒMMUååŒå®šä½å…¶åœ¨å†…å­˜ä¸­çš„å®é™…ç‰©ç†åœ°å€ä½ç½®ã€‚ ç°åœ¨çš„ CPU åŒ…å«äº†èƒ½è‡ªåŠ¨æŠŠè™šæ‹Ÿåœ°å€è½¬æ¢æˆç‰©ç†åœ°å€çš„ç¡¬ä»¶ç”µè·¯ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®æ ‡ï¼ŒæŠŠå¯ç”¨ RAM åˆ’åˆ†æˆé•¿åº¦ä¸º 4KB æˆ– 8KB çš„é¡µæ¡†(page frame)ï¼Œå¹¶å¼•å…¥ä¸€ç»„é¡µè¡¨æ¥æŒ‡å®šè™šæ‹Ÿåœ°å€ä¸ç‰©ç†åœ°å€ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚ ä¸€å—è¿ç»­çš„è™šæ‹Ÿåœ°å€è¯·æ±‚å¯ä»¥é€šè¿‡åˆ†é…ä¸€ç»„éè¿ç»­çš„ç‰©ç†åœ°å€é¡µæ¡†è€Œå¾—åˆ°æ»¡è¶³ã€‚ ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:1:1","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"éšæœºè®¿é—®å­˜å‚¨å™¨(RAM)çš„ä½¿ç”¨ Unix æ“ä½œç³»ç»Ÿå°† RAM åˆ’åˆ†æˆä¸¤éƒ¨åˆ†ã€‚å…¶ä¸­è‹¥å¹²å…†å­—èŠ‚ä¸“é—¨ç”¨äºå­˜æ”¾å†…æ ¸æ˜ è±¡(ä¹Ÿå°±æ˜¯å†…æ ¸ä»£ç å’Œå†…æ ¸é™æ€æ•°æ®ç»“æ„)ã€‚RAMçš„å…¶ä½™éƒ¨åˆ†é€šå¸¸ç”±è™šæ‹Ÿå†…å­˜ç³»ç»Ÿæ¥å¤„ç†ï¼Œå¹¶ä¸”ç”¨åœ¨ä»¥ä¸‹ä¸‰ç§å¯èƒ½çš„æ–¹é¢: æ»¡è¶³å†…æ ¸å¯¹ç¼“å†²åŒºï¼Œæè¿°ç¬¦åŠå…¶ä»–åŠ¨æ€å†…å­˜æ•°æ®ç»“æ„çš„è¯·æ±‚ã€‚ æ»¡è¶³è¿›ç¨‹å¯¹ä¸€èˆ¬å†…å­˜åŒºçš„è¯·æ±‚åŠå¯¹æ–‡ä»¶å†…å­˜æ˜ å°„çš„è¯·æ±‚ã€‚ å€ŸåŠ©ä¸é«˜é€Ÿç¼“å­˜ä»ç£ç›˜åŠå…¶ä»–ç¼“å†²è®¾å¤‡è·å¾—è¾ƒå¥½çš„æ€§èƒ½ã€‚ ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:1:2","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"å†…æ ¸å†…å­˜åˆ†é…å™¨ å†…æ ¸å†…å­˜åˆ†é…å™¨(Kernel Memory Allocator, KMA)æ˜¯ä¸€ä¸ªå­ç³»ç»Ÿï¼Œå®ƒè¯•å›¾æ»¡è¶³ç³»ç»Ÿä¸­éƒ¨åˆ†å¯¹å†…å­˜çš„è¯·æ±‚ã€‚å…¶ä¸­ä¸€äº›è¯·æ±‚æ¥è‡ªå†…æ ¸å…¶ä»–å­ç³»ç»Ÿï¼Œå®ƒä»¬éœ€è¦ä¸€äº›å†…æ ¸ä½¿ç”¨çš„å†…å­˜ï¼Œè¿˜æœ‰ä¸€äº›è¯·æ±‚æ¥è‡ªäºç”¨æˆ·ç¨‹åºçš„ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨æ¥å¢åŠ ç”¨æˆ·è¿›ç¨‹ä¸­åœ°å€ç©ºé—´ã€‚ä¸€ä¸ªå¥½çš„ KMA åº”è¯¥å…·æœ‰ä¸‹åˆ—ç‰¹ç‚¹: å¿…é¡»å¿«ã€‚å› ä¸ºå®ƒç”±æ‰€æœ‰çš„å†…æ ¸å­ç³»ç»Ÿ(åŒ…æ‹¬ä¸­æ–­å¤„ç†ç¨‹åº)è°ƒç”¨ã€‚ å¿…é¡»æŠŠå†…å­˜çš„æµªè´¹å‡åˆ°æœ€å°‘ã€‚ å¿…é¡»åŠªåŠ›å‡è½»å†…å­˜çš„ç¢ç‰‡(fragmentation)é—®é¢˜ã€‚ å¿…é¡»èƒ½ä¸å…¶ä»–å†…å­˜ç®¡ç†å­ç³»ç»Ÿåˆä½œï¼Œä»¥ä¾¿å€Ÿç”¨å’Œé‡Šæ”¾é¡µæ¡†ã€‚ åŸºäºä¸åŒçš„ç®—æ³•æŠ€æœ¯å®ç°çš„KMA: èµ„æºå›¾åˆ†é…ç®—æ³•(allocator) 2çš„å¹‚æ¬¡æ–¹ç©ºé—²é“¾è¡¨ McKusick-Karels åˆ†é…ç®—æ³• ä¼™ä¼´ (Buddy) ç³»ç»Ÿ Mach çš„åŒºåŸŸ (Zone) åˆ†é…ç®—æ³• Dynix åˆ†é…ç®—æ³• Solaris çš„ Slab åˆ†é…ç®—æ³• ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:1:3","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´å¤„ç† è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´åŒ…æ‹¬äº†è¿›ç¨‹å¯ä»¥å¼•ç”¨çš„æ‰€æœ‰è™šæ‹Ÿå†…å­˜åœ°å€ã€‚å†…æ ¸é€šå¸¸ç”¨ä¸€ç»„å†…å­˜åŒºæè¿°ç¬¦æè¿°è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚ä¾‹å¦‚ï¼Œå½“è¿›ç¨‹é€šè¿‡ exec() ç±»ç³»ç»Ÿè°ƒç”¨å¼€å§‹æŸä¸ªç¨‹åºæ‰§è¡Œæ—¶ï¼Œå†…æ ¸åˆ†é…ç»™è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´æœ‰ä»¥ä¸‹å†…å­˜åŒºç»„æˆã€‚ ç¨‹åºçš„å¯æ‰§è¡Œä»£ç ã€‚ ç¨‹åºçš„åˆå§‹åŒ–æ•°æ®ã€‚ ç¨‹åºçš„æœªåˆå§‹åŒ–æ•°æ®ã€‚ åˆå§‹ç¨‹åºæ ˆ(å³ç”¨æˆ·æ€æ ˆ)ã€‚ æ‰€éœ€å…±äº«åº“çš„å¯æ‰§è¡Œä»£ç å’Œæ•°æ®ã€‚ å †(ç”±ç¨‹åºè‘£å¤ªå¤ªè¯·æ±‚çš„å†…å­˜)ã€‚ ç°ä»£ Unix æ“ä½œç³»ç»Ÿé‡‡ç”¨äº†è¯·æ±‚è°ƒé¡µ(demand paging)çš„å†…å­˜åˆ†é…ç­–ç•¥ã€‚æœ‰äº†è¯·æ±‚è°ƒé¡µï¼Œè¿›ç¨‹å¯ä»¥åœ¨å®ƒçš„é¡µè¿˜æ²¡æœ‰åœ¨å†…å­˜æ—¶å°±å¼€å§‹æ‰§è¡Œã€‚å½“è¿›ç¨‹è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„é¡µæ—¶ï¼ŒMMUäº§ç”Ÿä¸€ä¸ªå¼‚å¸¸ï¼Œå¼‚å¸¸å¤„ç†ç¨‹åºæ‰¾åˆ°å—å½±å“çš„å†…å­˜åŒºï¼Œåˆ†é…ä¸€ä¸ªç©ºé—²çš„é¡µï¼Œå¹¶ç”¨é€‚å½“çš„æ•°æ®æŠŠå•Šåˆå§‹åŒ–ã€‚åŒç†ï¼Œå½“è¿›ç¨‹é€šè¿‡è°ƒç”¨ malloc() æˆ– brk()(ç”±malloc()åœ¨å†…éƒ¨è°ƒç”¨)ç³»ç»Ÿè°ƒç”¨åŠ¨æ€åœ°è¯·æ±‚å†…å­˜æ˜¯ï¼Œå†…æ ¸ä»…ä»…ä¿®æ”¹è¿›ç¨‹çš„å †å†…å­˜åŒºçš„å¤§å°ã€‚åªæœ‰è¯•å›¾å¼•è¿›è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜è€Œäº§ç”Ÿå¼‚å¸¸æ—¶ï¼Œæ‰ç»™è¿›ç¨‹åˆ†é…é¡µæ¡†ã€‚ è™šæ‹Ÿåœ°å€ç©ºé—´ä¹Ÿé‡‡ç”¨å…¶ä»–æ›´æœ‰æ•ˆçš„ç­–ç•¥ï¼Œå¦‚å†™æ—¶å¤åˆ¶ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªæ–°è¿›ç¨‹è¢«åˆ›å»ºæ—¶ï¼Œå†…æ ¸ä»…ä»…æŠŠçˆ¶è¿›ç¨‹çš„é¡µæ¡†èµ‹ç»™å­è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œä½†æ˜¯æŠŠè¿™äº›é¡µæ¡†æ ‡è®°ä¸ºåªè¯»ã€‚ä¸€æ—¦çˆ¶æˆ–å­è¿›ç¨‹ä¿®æ”¹é¡µä¸­çš„å†…å®¹æ—¶ï¼Œä¸€ä¸ªå¼‚å¸¸å°±ä¼šäº§ç”Ÿã€‚å¼‚å¸¸å¤„ç†ç¨‹åºæŠŠæ–°é¡µæ¡†èµ‹ç»™å—å½±å“çš„è¿›ç¨‹ï¼Œå¹¶ç”¨åŸæ¥ä¹Ÿä¸­çš„å†…å®¹åˆå§‹åŒ–æ–°é¡µæ¡†ã€‚ ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:1:4","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"é«˜é€Ÿç¼“å­˜ ç‰©ç†å†…å­˜çš„ä¸€å¤§ä¼˜åŠ¿å°±æ˜¯ç”¨ä½œç£ç›˜å’Œå…¶ä»–å—è®¾å¤‡çš„é«˜é€Ÿç¼“å­˜ã€‚é€šå¸¸ï¼Œåœ¨æœ€æ—©çš„ Unix ç³»ç»Ÿä¸­å°±å·²ç»å®ç°çš„ä¸€ä¸ªç­–ç•¥æ˜¯: å°½å¯èƒ½åœ°æ¨è¿Ÿå†™ç£ç›˜çš„æ—¶é—´ï¼Œå› æ­¤ï¼Œä»ç£ç›˜è¯»å…¥å†…å­˜çš„æ•°æ®å³ä½¿ä»»ä½•è¿›ç¨‹éƒ½ä¸å†ä½¿ç”¨å®ƒä»¬ï¼Œå®ƒä»¬ä¹Ÿç»§ç»­ç•™åœ¨ RAM ä¸­ã€‚ æ–°è¿›ç¨‹è¯·æ±‚ä»ç£ç›˜è¯»æˆ–å†™çš„æ•°æ®ï¼Œå°±æ˜¯è¢«æ’¤é”€è¿›ç¨‹æ›¾æ‹¥æœ‰çš„æ•°æ®ã€‚å½“ä¸€ä¸ªè¿›ç¨‹è¯·æ±‚è®¿é—®ç£ç›˜æ—¶ï¼Œå†…æ ¸é¦–å…ˆæ£€æŸ¥è¿›ç¨‹è¯·æ±‚çš„æ•°æ®æ˜¯å¦åœ¨ç¼“å­˜ä¸­ï¼Œå¦‚æœåœ¨(æŠŠè¿™ç§è¯·æ±‚å«åšç¼“å­˜å‘½ä¸­)ï¼Œå†…æ ¸å°±å¯ä»¥ä¸ºè¿›ç¨‹è¯·æ±‚æä¾›æœåŠ¡è€Œä¸ç”¨è®¿é—®ç£ç›˜ã€‚ sync() ç³»ç»Ÿè°ƒç”¨æŠŠæ‰€æœ‰\"è„\"çš„ç¼“å†²åŒºå†™å…¥ç£ç›˜æ¥å¼ºåˆ¶ç£ç›˜åŒæ­¥ã€‚ä¸ºäº†é¿å…æ•°æ®ä¸¢å¤±ï¼Œæ‰€æœ‰çš„æ“ä½œç³»ç»Ÿéƒ½ä¼šæ³¨æ„å‘¨æœŸæ€§åœ°æŠŠè„ç¼“å­˜åŒºå†™å›ç£ç›˜ã€‚ ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:1:5","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"å†…å­˜åœ°å€ x86å¾®å¤„ç†å™¨çš„ä¸‰ç§ä¸åŒåœ°å€: é€»è¾‘åœ°å€(logical address): æ¯ä¸€ä¸ªé€»è¾‘åœ°å€éƒ½ç”±ä¸€ä¸ªæ®µ(segment)å’Œåç§»é‡(offsetæˆ–displacement)ç»„æˆï¼Œåç§»é‡æŒ‡æ˜äº†ä»æ®µå¼€å§‹çš„åœ°æ–¹åˆ°å®é™…åœ°å€ä¹‹é—´çš„è·ç¦»ã€‚ çº¿æ€§åœ°å€(linear address)(ä¹Ÿç§°è™šæ‹Ÿåœ°å€ virtual address): çº¿æ€§åœ°å€é€šå¸¸ç”¨åå…­è¿›åˆ¶æ•°å­—è¡¨ç¤ºï¼Œå€¼å¾—èŒƒå›´ä» 0x00000000 åˆ° 0xffffffffã€‚å¯ä»¥è¡¨ç¤ºé«˜è¾¾ 4GB çš„åœ°å€ã€‚ ç‰©ç†åœ°å€(physical address): ç”¨äºèŠ¯ç‰‡çº§å†…å­˜å•å…ƒå¯»å€ã€‚ä»–ä»¬ä»å¾®å¤„ç†å™¨çš„åœ°å€å¼•è„šå‘é€åˆ°å†…å­˜æ€»çº¿ä¸Šçš„ç”µä¿¡å·ç›¸å¯¹åº”ã€‚ å†…å­˜æ§åˆ¶å•å…ƒ(MMU)é€šè¿‡åˆ†æ®µå•å…ƒ(segmentation unit)çš„ç¡¬ä»¶ç”µè·¯æŠŠä¸€ä¸ªé€»è¾‘åœ°å€è½¬æ¢æˆçº¿æ€§åœ°å€ã€‚é€šè¿‡åˆ†é¡µå•å…ƒ(paging unit)çš„ç¡¬ä»¶ç”µè·¯æŠŠçº¿æ€§åœ°å€è½¬åŒ–æˆç‰©ç†åœ°å€ã€‚ åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œæ‰€æœ‰ CPU éƒ½å…±äº«åŒä¸€å†…å­˜ã€‚RAMèŠ¯ç‰‡ä¸Šçš„è¯»å’Œå†™æ“ä½œå¿…é¡»ä¸²è¡Œæ‰§è¡Œï¼Œå› æ­¤å†…å­˜ä»²è£å™¨(memory arbiter)çš„ç¡¬ä»¶ç”µè·¯æ’åœ¨æ€»çº¿å’Œæ¯ä¸ª RAM èŠ¯ç‰‡ä¹‹é—´ã€‚å…¶ä½œç”¨å°±æ˜¯å¦‚æœæŸä¸ª RAM èŠ¯ç‰‡ç©ºé—²ï¼Œå°±å‡†äºˆä¸€ä¸ª CPU è®¿é—®ï¼Œå¦‚æœè¯¥èŠ¯ç‰‡å¿™äºä¸ºå¦ä¸€ä¸ªå¤„ç†å™¨æå‡ºçš„è¯·æ±‚æœåŠ¡ï¼Œå°±å»¶è¿Ÿè¿™ä¸ª CPU çš„è®¿é—®ã€‚ ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:2:0","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"ç¡¬ä»¶ä¸­çš„åˆ†æ®µ 80206 å¼€å§‹ï¼ŒIntel å¾®å¤„ç†å™¨å…·æœ‰ä¸¤ç§æ–¹å¼æ‰§è¡Œåœ°å€è½¬æ¢ï¼š å®æ¨¡å¼(real mode)ã€‚ ä¿æŠ¤æ¨¡å¼(protected mode)ã€‚ å®æ¨¡å¼å­˜åœ¨æ˜¯å¤„äºå…¼å®¹æ€§è€ƒè™‘ï¼Œä¸»è¦è¿˜æ˜¯ä¿æŠ¤æ¨¡å¼ã€‚ ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:3:0","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"æ®µé€‰æ‹©ç¬¦å’Œæ®µå¯„å­˜å™¨ ä¸€ä¸ªé€»è¾‘åœ°å€ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šä¸€ä¸ªæ®µæ ‡è¯†ç¬¦å’Œä¸€ä¸ªæŒ‡å®šæ®µå†…ç›¸å¯¹åœ°å€çš„åç§»é‡ã€‚æ®µæ ‡è¯†ç¬¦æ˜¯ä¸€ä¸ª 16 ä½é•¿çš„å­—æ®µï¼Œç§°ä¸ºæ®µé€‰æ‹©ç¬¦(Segment Selector)ã€‚åç§»é‡æ˜¯ä¸€ä¸ª 32 ä½é•¿çš„å­—æ®µã€‚ ä¸“é—¨å­˜æ”¾æ®µé€‰æ‹©ç¬¦çš„å¯„å­˜å™¨: cs, ss, ds, es, fs å’Œ gsã€‚å…¶ä¸­3ä¸ªæœ‰ä¸“é—¨çš„ç”¨é€”: cs ä»£ç æ®µå¯„å­˜å™¨ï¼ŒæŒ‡å‘åŒ…å«ç¨‹åºæŒ‡ä»¤çš„æ®µã€‚ ss æ ˆæ®µå¯„å­˜å™¨ï¼ŒæŒ‡å‘åŒ…å«å½“å‰ç¨‹åºæ ˆçš„æ®µã€‚ ds æ•°æ®æ®µå¯„å­˜å™¨ï¼ŒæŒ‡å‘åŒ…å«é™æ€æ•°æ®æˆ–è€…å…¨å±€æ•°æ®æ®µã€‚ å…¶ä»–3ä¸ªæ®µå¯„å­˜å™¨ä½œä¸€èˆ¬ç”¨é€”ï¼Œå¯ä»¥æŒ‡å‘ä»»æ„çš„æ•°æ®æ®µã€‚ cs å¯„å­˜å™¨è¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½: å®ƒå«æœ‰ä¸€ä¸ªä¸¤ä½çš„å­—æ®µï¼Œç”¨ä»¥æŒ‡æ˜ CPU çš„å½“å‰ç‰¹æƒçº§ (Current Privilege Level, CPL)ã€‚å€¼ä¸º0ä»£è¡¨æœ€é«˜ä¼˜å…ˆçº§ï¼Œä¸ºå€¼ä¸º3ä»£è¡¨æœ€ä½ä¼˜å…ˆçº§ã€‚Linux åªç”¨0çº§å’Œ3çº§ï¼Œåˆ†åˆ«ç§°ä¹‹ä¸ºå†…æ ¸æ€å’Œç”¨æˆ·æ€ã€‚ ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:3:1","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"æ®µæè¿°ç¬¦ æ¯ä¸ªæ®µç”±ä¸€ä¸ª8å­—èŠ‚çš„æ®µæè¿°ç¬¦(Segment Descriptor)è¡¨ç¤ºï¼Œå®ƒæè¿°äº†æ®µçš„ç‰¹å¾ã€‚æ®µæè¿°ç¬¦æ”¾åœ¨å…¨å±€æè¿°ç¬¦è¡¨(Global Descriptor Table, GDT)æˆ–å±€éƒ¨æè¿°ç¬¦è¡¨(Local Descriptor Table, LDT)ä¸­ã€‚ GDT é€šå¸¸åªæœ‰ä¸€ä¸ªï¼Œåœ¨ä¸»å­˜ä¸­çš„åœ°å€å’Œå¤§å°å­˜æ”¾åœ¨ gdtr æ§åˆ¶å¯„å­˜å™¨ä¸­ï¼Œå½“å‰æ­£è¢«ä½¿ç”¨çš„ LDT åœ°å€å’Œå¤§å°æ”¾åœ¨ ldtr æ§åˆ¶å¯„å­˜å™¨ä¸­ã€‚ æ®µæè¿°ç¬¦å­—æ®µ å­—æ®µ å«ä¹‰ Base åŒ…å«æ®µçš„é¦–å­—èŠ‚çš„çº¿æ€§åœ°å€ G ç²’åº¦æ ‡å¿—ï¼šå¦‚æœæ”¹ä½æ¸…0ï¼Œåˆ™å¤§å°ä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œå¦åˆ™ä»¥4096å­—èŠ‚çš„å€æ•°è®¡ã€‚ Limit å­˜æ”¾æ®µä¸­æœ€åä¸€ä¸ªå†…å­˜å•å…ƒçš„åç§»é‡ï¼Œä»è€Œå†³å®šæ®µçš„é•¿åº¦ã€‚å¦‚æœ G è¢«ç½®ä¸º0ï¼Œåˆ™ä¸€ä¸ªæ®µçš„å¤§å°åœ¨1ä¸ªå­—èŠ‚åˆ°1MBä¹‹é—´å˜åŒ–ï¼›å¦åˆ™ï¼Œå°†åœ¨ 4KB åˆ° 4GB ä¹‹é—´å˜åŒ–ã€‚ S ç³»ç»Ÿæ ‡å¿—ï¼šå¦‚æœå®ƒè¢«æ¸…0ï¼Œåˆ™è¿™æ˜¯ä¸€ä¸ªç³»ç»Ÿæ®µï¼Œå­˜å‚¨è¯¸å¦‚ LDT è¿™ç§å…³é”®çš„æ•°æ®ç»“æ„ï¼Œå¦åˆ™å®ƒæ˜¯ä¸€ä¸ªæ™®é€šçš„ä»£ç æ®µæˆ–æ•°æ®æ®µã€‚ Type æè¿°äº†æ®µçš„ç±»å‹ç‰¹å¾å’Œå®ƒçš„å­˜å–æƒé™ã€‚ DPL æè¿°ç¬¦ç‰¹æƒçº§(Descriptor Privilege Level)å­—æ®µï¼šç”¨äºé™åˆ¶å¯¹è¿™ä¸ªæ®µçš„å­˜å–ã€‚å®ƒè¡¨ç¤ºä¸ºè®¿é—®è¿™ä¸ªæ®µè€Œè¦æ±‚çš„CPUæœ€å°çš„ä¼˜å…ˆçº§ã€‚å› æ­¤ï¼ŒDPLè®¾ä¸º0çš„æ®µåªèƒ½å½“ CPL ä¸º0æ—¶(å³åœ¨å†…æ ¸æ€)æ‰æ˜¯å¯è®¿é—®çš„ï¼Œè€ŒDPLè®¾ä¸º3çš„æ®µå¯¹ä»»ä½•CPLå€¼éƒ½æ˜¯å¯è®¿é—®çš„ P Segment-Presentæ ‡å¿—ï¼šç­‰äº0è¡¨ç¤ºæ®µå½“å‰ä¸åœ¨ä¸»å­˜ä¸­ã€‚Linuxæ€»æ˜¯æŠŠè¿™ä¸ªè¡¨ç¤º(ç¬¬47ä½)è®¾ä¸º1ï¼Œå› ä¸ºå®ƒä»æ¥ä¸æŠŠæ•´ä¸ªdauntäº¤æ¢åˆ°ç£ç›˜ä¸Šå»ã€‚ D æˆ– B ç§°ä¸ºDæˆ–Bçš„æ ‡å¿—ï¼Œå–å†³äºä»£ç æ®µè¿˜æ˜¯æ•°æ®æ®µã€‚Dæˆ–Bçš„å«ä¹‰åœ¨ä¸¤ç§æƒ…å†µä¸­æœ‰æ‰€åŒºåˆ«ï¼Œä½†æ˜¯å¦‚æœæ®µåç§»é‡çš„åœ°å€æ˜¯32ä½é•¿ï¼Œå°±åŸºæœ¬ä¸ŠæŠŠå®ƒç½®ä¸º1ï¼Œå¦‚æœè¿™ä¸ªåç§»é‡æ˜¯16ä½é•¿ï¼Œå®ƒè¢«æ¸…0ã€‚ AVL æ ‡å¿— å¯ä»¥ç”±æ“ä½œç³»ç»Ÿä½¿ç”¨ï¼Œä½†æ˜¯è¢« Linux å¿½ç•¥ã€‚ Linux ä¸­è¢«å¹¿æ³›é‡‡ç”¨çš„ç±»å‹: ä»£ç æ®µæè¿°ç¬¦ æ•°æ®æ®µæè¿°ç¬¦ ä»»åŠ¡çŠ¶æ€æ®µæè¿°ç¬¦ æ®µé€‰æ‹©ç¬¦å­—æ®µ: å­—æ®µ å«ä¹‰ index æŒ‡å®šäº†æ”¾åœ¨ GDT æˆ– LDT ä¸­çš„ç›¸åº”æ®µæè¿°ç¬¦çš„å…¥å£ã€‚ TI TI ((Table Indicator)æ ‡å¿—ï¼šæŒ‡æ˜æ®µæè¿°ç¬¦æ˜¯åœ¨ GDT ä¸­ (TI=0) æˆ–åœ¨ LDT ä¸­(TI=1))ã€‚ RPL è¯·æ±‚è€…ç‰¹æƒçº§ï¼šå½“ç›¸åº”çš„æ®µé€‰æ‹©ç¬¦è£…å…¥åˆ° cs å¯„å­˜å™¨ä¸­æ—¶ï¼ŒæŒ‡ç¤ºå‡º CPU å½“å‰çš„ç‰¹æƒçº§ï¼›å®ƒè¿˜å¯ä»¥ç”¨äºåœ¨è®¿é—®æ•°æ®æ®µæ—¶æœ‰é€‰æ‹©åœ°å‰Šå¼±å¤„ç†å™¨çš„ç‰¹æƒçº§ã€‚ ä¸ºäº†åŠ é€Ÿé€»è¾‘åœ°å€åˆ°çº¿æ€§åœ°å€çš„è½¬æ¢ï¼Œ80x86å¤„ç†å™¨æä¾›ä¸€ç§é™„åŠ çš„éç¼–ç¨‹çš„å¯„å­˜å™¨ï¼Œä¾›6ä¸ªå¯ç¼–ç¨‹çš„æ®µå¯„å­˜å™¨ä½¿ç”¨ã€‚ç°åœ¨ï¼Œé’ˆå¯¹é‚£ä¸ªæ®µçš„é€»è¾‘åœ°å€è½¬åŒ–å°±å¯ä»¥ä¸è®¿é—®ä¸»å­˜ä¸­çš„ GDT æˆ– LDTï¼Œå¤„ç†å™¨åªéœ€ç›´æ¥å¼•ç”¨å­˜æ”¾æ®µæè¿°ç¬¦çš„CPUå¯„å­˜å™¨å³å¯ã€‚ ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:3:2","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"åˆ†æ®µå•å…ƒ åˆ†æ®µå•å…ƒ(segmentation unit)æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼Œå°†ä¸€ä¸ªé€»è¾‘åœ°å€è½¬æ¢æˆç›¸åº”çš„çº¿æ€§åœ°å€ã€‚ å…ˆæ£€æŸ¥æ®µé€‰æ‹©ç¬¦çš„TIå­—æ®µï¼Œä»¥å†³å®šæ®µæè¿°ç¬¦ä¿å­˜åœ¨å“ªä¸€ä¸ªæè¿°è¡¨ä¸­ã€‚TIå­—æ®µæŒ‡æ˜æè¿°ç¬¦æ˜¯åœ¨GDTä¸­(åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåˆ†æ®µå•å…ƒä»gdtrå¯„å­˜å™¨ä¸­å¾—åˆ°GDTçš„çº¿æ€§åŸºåœ°å€)è¿˜æ˜¯åœ¨æ¿€æ´»çš„LDTä¸­(åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåˆ†æ®µå•å…ƒä»ldtrå¯„å­˜å™¨ä¸­å¾—åˆ°LDTçš„çº¿æ€§åŸºåœ°å€)ã€‚ ä»æ®µé€‰æ‹©ç¬¦çš„ index å­—æ®µè®¡ç®—æ®µæè¿°ç¬¦çš„åœ°å€ï¼Œindexå­—æ®µçš„å€¼ä¹˜ä»¥8(ä¸€ä¸ªæ®µæè¿°ç¬¦çš„å¤§å°)ï¼Œè¿™ä¸ªç»“æœä¸gdtræˆ–ldtrå¯„å­˜å™¨ä¸­çš„å†…å­˜ç›¸åŠ ã€‚ æŠŠé€»è¾‘åœ°å€çš„åç§»é‡ä¸æ®µæè¿°ç¬¦ Base å­—æ®µçš„å€¼ç›¸åŠ å°±å¾—åˆ°äº†çº¿æ€§åœ°å€ã€‚ ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:3:3","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"Linux ä¸­çš„åˆ†æ®µã€‚ Linux ä¸­ä½¿ç”¨åˆ†æ®µçš„æ–¹å¼ååˆ†æœ‰é™ã€‚åˆ†æ®µå¯ä»¥ç»™æ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸åŒçš„çº¿æ€§åœ°å€ç©ºé—´ï¼Œè€Œåˆ†é¡µå¯ä»¥æŠŠåŒä¸€çº¿æ€§åœ°å€ç©ºé—´æ˜ å°„åˆ°ä¸åŒçš„ç‰©ç†ç©ºé—´ã€‚ä¸åˆ†æ®µç›¸æ¯”ï¼ŒLinux ä¸­å€¾å‘é‡‡ç”¨åˆ†é¡µæ–¹å¼ï¼Œå› ä¸º: å½“æ‰€æœ‰çš„è¿›ç¨‹ä½¿ç”¨ç›¸åŒçš„æ®µå¯„å­˜å™¨å€¼æ—¶ï¼Œå†…å­˜ç®¡ç†å˜å¾—æ›´ç®€å•ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬èƒ½å…±äº«åŒæ ·çš„ä¸€ç»„çº¿æ€§åœ°å€ã€‚ Linux è®¾è®¡ç›®æ ‡ä¹‹ä¸€æ˜¯å¯ä»¥æŠŠå®ƒç§»æ¤åˆ°ç»å¤§å¤šæ•°æµè¡Œçš„å¤„ç†å™¨å¹³å°ä¸Šã€‚ç„¶è€Œï¼ŒRISCä½“ç³»ç»“æ„å¯¹åˆ†æ®µçš„æ”¯æŒå¾ˆæœ‰é™ã€‚ 2.6 ç‰ˆçš„ Linux åªæœ‰åœ¨ 80x86 ç»“æ„ä¸‹æ‰éœ€è¦ä½¿ç”¨åˆ†æ®µã€‚ ç›¸åº”çš„æ®µé€‰æ‹©ç¬¦ç”±å® __USER_CS, __USER_DS, __KERNEL_CS å’Œ __KERNEL_DS åˆ†åˆ«å®šä¹‰ã€‚ä¾‹å¦‚ï¼Œä¸ºäº†å¯¹å†…å­˜ä»£ç æ®µå¯»å€ï¼Œå†…æ ¸åªéœ€è¦æŠŠ __KERNEL_CS å®äº§ç”Ÿçš„å€¼è£…è¿› cs æ®µå¯„å­˜å™¨å³å¯ã€‚ æ‰€æœ‰æ®µéƒ½ä» 0x00000000 å¼€å§‹ï¼Œè¿™å¯ä»¥å¾—å‡ºå¦ä¸€ä¸ªé‡è¦çš„ç»“è®ºï¼Œå°±æ˜¯åœ¨ Linux ä¸‹é€»è¾‘åœ°å€ä¸çº¿æ€§åœ°å€æ˜¯ä¸€è‡´çš„ï¼Œæœºé€»è¾‘åœ°å€çš„åç§»é‡å­—æ®µçš„å€¼ä¸ç›¸åº”çš„çº¿æ€§åœ°å€çš„å€¼æ€»æ˜¯ä¸€è‡´çš„ã€‚ ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:4:0","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"Linux GDT åœ¨å•å¤„ç†å™¨ç³»ç»Ÿä¸­åªæœ‰ä¸€ä¸ª GDTï¼Œè€Œåœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­æ¯ä¸ª CPU å¯¹åº”ä¸€ä¸ª GDTã€‚æ‰€æœ‰çš„ GDT éƒ½å­˜æ”¾åœ¨ cpu_gdt_table æ•°ç»„ä¸­ã€‚ä»¥ä¸‹æ˜¯ GDT çš„å¸ƒå±€ç¤ºæ„å›¾ã€‚æ¯ä¸ª GDT åŒ…å« 18 ä¸ªæ®µæè¿°ç¬¦åˆ 14 ä¸ªç©ºçš„ï¼Œæœªä½¿ç”¨çš„ï¼Œæˆ–ä¿ç•™çš„é¡¹ã€‚ æ¯ä¸€ä¸ª GDT ä¸­åŒ…å« 18 ä¸ªæ®µæè¿°ç¬¦æŒ‡å‘ä¸‹åˆ—çš„æ®µ: ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¸‹çš„ä»£ç æ®µå’Œæ•°æ®æ®µå…± 4 ä¸ªã€‚ ä»»åŠ¡çŠ¶æ€æ®µ (TSS)ï¼Œæ¯ä¸ªå¤„ç†å™¨æœ‰ 1 ä¸ªã€‚ 1 ä¸ªåŒ…æ‹¬ç¼ºçœå±€éƒ¨æè¿°ç¬¦è¡¨çš„æ®µã€‚ 3 ä¸ªå±€éƒ¨çº¿ç¨‹å­˜å‚¨ã€‚ ä¸é«˜çº§ç”µæºç®¡ç† (AMP) ç›¸å…³çš„ 3 ä¸ªæ®µã€‚ ä¸æ”¯æŒå³æ’å³ç”¨ (PnP) åŠŸèƒ½çš„ BIOS æœåŠ¡ç¨‹åºç›¸å…³çš„ 5 ä¸ªæ®µã€‚ è¢«å†…æ ¸ç”¨æ¥å¤„ç†â€œåŒé‡é”™è¯¯â€(å¤„ç†ä¸€ä¸ªå¼‚å¸¸æ˜¯å¯èƒ½å¼•å‘å¦ä¸€ä¸ªå¼‚å¸¸ï¼Œåœ¨è¿™ä¸ªæƒ…å†µä¸‹äº§ç”Ÿçš„åŒé‡é”™è¯¯)å¼‚å¸¸çš„ç‰¹æ®Š TSS æ®µã€‚ ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:4:1","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"Linux LDT å¤§å¤šæ•°ç”¨æˆ·æ€ä¸‹çš„ Linux ç¨‹åºä¸ä½¿ç”¨å±€éƒ¨æè¿°ç¬¦è¡¨ï¼Œè¿™æ ·å†…æ ¸å°±å®šä¹‰äº†ä¸€ä¸ªç¼ºçœçš„ LDT ä¾›å¤§å¤šæ•°è¿›ç¨‹å…±äº«ã€‚ç¼ºçœçš„å±€éƒ¨æè¿°ç¬¦è¡¨å­˜æ”¾åœ¨ default_ldt æ•°ç»„ä¸­ã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿›ç¨‹ä»ç„¶éœ€è¦åˆ›å»ºè‡ªå·±çš„å±€éƒ¨æè¿°ç¬¦è¡¨ï¼Œè¿™å¯¹æœ‰äº›åº”ç”¨ç¨‹åºå¾ˆæœ‰ç”¨ï¼Œå¦‚ Wine ç¨‹åºã€‚ ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:4:2","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"ç¡¬ä»¶ä¸­çš„åˆ†é¡µ åˆ†é¡µå•å…ƒ(paging unit)æŠŠçº¿æ€§åœ°å€è½¬æ¢æˆç‰©ç†åœ°å€ã€‚çº¿æ€§åœ°å€è¢«åˆ†æˆä»¥å›ºå®šé•¿åº¦ä¸ºå•ä½çš„ç»„ï¼Œç§°ä¸ºé¡µ(page)ã€‚é¡µå†…éƒ¨è¿ç»­çš„çº¿æ€§åœ°å€è¢«æ˜ å°„åˆ°è¿ç»­çš„ç‰©ç†åœ°å€ä¸­ã€‚ åˆ†é¡µå•å…ƒæŠŠæ‰€æœ‰çš„ RAM åˆ†æˆå›ºå®šé•¿åº¦çš„é¡µæ¡† (page frame) (æœ‰æ—¶å«åšç‰©ç†é¡µ)ã€‚æ¯ä¸€ä¸ªé¡µæ¡†åŒ…å«ä¸€ä¸ªé¡µ (page)ï¼Œé¡µå°±æ˜¯è¯´ä¸€ä¸ªé¡µæ¡†çš„é•¿åº¦ä¸ä¸€ä¸ªé¡µçš„é•¿åº¦ä¸€è‡´ã€‚ æŠŠçº¿æ€§åœ°å€æ˜ å°„åˆ°ç‰©ç†åœ°å€çš„æ•°æ®ç»“æ„ç§°ä¸ºé¡µè¡¨ (page table)ã€‚é¡µè¡¨æ”¾åœ¨ä¸»å­˜ä¸­ï¼Œå¹¶åœ¨å¯ç”¨åˆ†é¡µå•å…ƒä¹‹å‰å¿…é¡»ç”±å†…æ ¸å¯¹é¡µè¡¨è¿›è¡Œé€‚å½“çš„åˆå§‹åŒ–ã€‚ ä» 80386 å¼€å§‹ï¼Œæ‰€æœ‰çš„ 80x86 å¤„ç†å™¨éƒ½æ”¯æŒåˆ†é¡µï¼Œå®ƒé€šè¿‡è®¾ç½® cr0 å¯„å­˜å™¨çš„ PG æ ‡å¿—å¯ç”¨ã€‚ å½“ PG=0 æ—¶ï¼Œçº¿æ€§åœ°å€å°±è¢«è§£é‡Šæˆç‰©ç†åœ°å€ã€‚ ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:5:0","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"å¸¸è§„åˆ†é¡µ ä» 80386 èµ·ï¼ŒIntel å¤„ç†å™¨çš„åˆ†é¡µå•å…ƒå¤„ç† 4K çš„é¡µã€‚ 32 ä½çš„çº¿æ€§åœ°å€è¢«åˆ†æˆ 3 ä¸ªåŸŸ: Directory (ç›®å½•) æœ€é«˜ 10 ä½ã€‚ Table (é¡µè¡¨) ä¸­é—´ 10 ä½ã€‚ Offset (åç§»é‡) æœ€ä½ 12 ä½ã€‚ çº¿æ€§åœ°å€çš„è½¬æ¢åˆ†ä¸¤æ­¥å®Œæˆï¼Œæ¯ä¸€æ­¥éƒ½åŸºäºä¸€ç§è½¬åŒ–è¡¨ï¼Œç¬¬ä¸€ç§è½¬æ¢è¡¨ç§°ä¸ºé¡µç›®å½•è¡¨ (page directory)ï¼Œç¬¬äºŒç§è½¬æ¢è¡¨ç§°ä¸ºé¡µè¡¨ (page table)ã€‚ æ­£åœ¨ä½¿ç”¨çš„é¡µç›®å½•çš„ç‰©ç†åœ°å€å­˜æ”¾åœ¨æ§åˆ¶å¯„å­˜å™¨ cr0 ä¸­ã€‚çº¿æ€§åœ°å€å†…çš„ Directory å­—æ®µå†³å®šç›®å½•ä¸­çš„ç›®å½•é¡¹ï¼Œè€Œç›®å½•é¡¹æŒ‡å‘é€‚å½“çš„é¡µè¡¨ã€‚åœ°å€çš„ Table å­—æ®µä¾æ¬¡åˆå†³å®šé¡µè¡¨ä¸­çš„è¡¨é¡¹ï¼Œè€Œè¡¨é¡¹å«æœ‰é¡µæ‰€åœ¨é¡µæ¡†çš„ç‰©ç†åœ°å€ã€‚Offset å­—æ®µå†³å®šé¡µæ¡†ä¹Ÿçš„ç›¸å¯¹ä½ç½®ã€‚ç”±äºå®ƒæ˜¯ 12 é•¿ï¼Œæ•…æ¯ä¸€é¡µå«æœ‰ 4096 å­—èŠ‚çš„æ•°æ®ã€‚ å‡è®¾è¿›ç¨‹éœ€è¦è¯»çº¿æ€§åœ°å€ 0x20021406 ä¸­çš„å­—èŠ‚ã€‚è¿™ä¸ªåœ°å€ç”±åˆ†é¡µå•å…ƒæŒ‰ä¸‹é¢çš„æ–¹æ³•å¤„ç†: Directory å­—æ®µçš„ 0x80 ç”¨äºé€‰æ‹©é¡µç›®å½•çš„ç¬¬ 0x80 ç›®å½•é¡¹ï¼Œæ­¤ç›®å½•é¡¹æŒ‡å‘å’Œè¯¥è¿›ç¨‹çš„é¡µç›¸å…³çš„é¡µè¡¨ã€‚ Table å­—æ®µ 0x21 ç”¨äºé€‰æ‹©é¡µè¡¨çš„ç¬¬ 0x21 è¡¨é¡¹ï¼Œæ­¤è¡¨é¡¹æŒ‡å‘åŒ…å«æ‰€éœ€é¡µçš„é¡µæ¡†ã€‚ æœ€åï¼ŒOffset å­—æ®µ 0x406 ç”¨äºåœ¨ç›®æ ‡é¡µæ¡†ä¸­è¯»åç§»é‡ä¸º 0x406 ä¸­çš„å­—èŠ‚ã€‚ ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:5:1","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"ç¡¬ä»¶é«˜é€Ÿç¼“å­˜ å½“ä»Šçš„å¾®å¤„ç†å™¨æ—¶é’Ÿé¢‘ç‡æ¥è¿‘å‡ ä¸ª GHzï¼Œè€ŒåŠ¨æ€ RAM èŠ¯ç‰‡çš„å­˜å–æ—¶é—´æ˜¯æ—¶é’Ÿå‘¨æœŸçš„æ•°ç™¾å€ã€‚è¿™æ„å‘³ç€ï¼Œå½“ä» RAM ä¸­å–æ“ä½œæ•°æˆ–å‘ RAM ä¸­å­˜æ”¾ç»“æœè¿™æ ·çš„æŒ‡ä»¤æ‰§è¡Œæ—¶ï¼ŒCPU å¯èƒ½ç™»å°å¾ˆé•¿æ—¶é—´ã€‚ ä¸ºäº†ç¼©å° CPU å’Œ RAM ä¹‹é—´çš„é€Ÿåº¦ä¸åŒ¹é…ï¼Œå¼•å…¥äº†ç¡¬ä»¶é«˜é€Ÿç¼“å­˜å†…å­˜(hardware cache memory)ã€‚ç¡¬ä»¶é«˜é€Ÿç¼“å­˜åŸºäºè‘—åçš„å±€éƒ¨æ€§åŸç†(locality principle)ï¼Œè¯¥åŸç†æ—¢é€‚ç”¨ç¨‹åºç»“æ„ä¹Ÿé€‚ç”¨æ•°æ®ç»“æ„ã€‚ 80x86 ä½“ç³»ç»“æ„ä¸­å¼•å…¥äº†ä¸€ä¸ªå«è¡Œ (line) çš„æ–°å•ä½ã€‚è¡Œç”±å‡ åä¸ªè¿ç»­çš„å­—èŠ‚ç»„æˆï¼Œå®ƒä»¬ä»¥è„‰å†²çªå‘æ¨¡å¼ (burst mode) åœ¨æ…¢é€Ÿ DRAM å’Œå¿«é€Ÿçš„ç”¨æ¥å®ç°é«˜é€Ÿç¼“å­˜çš„ç‰‡ä¸Šé™æ€ RAM (SRAM) ä¹‹é—´ä¼ é€ï¼Œç”¨æ¥å®ç°é«˜é€Ÿç¼“å­˜ã€‚ å¦‚å›¾ï¼Œé«˜é€Ÿç¼“å­˜å•å…ƒæ’åœ¨åˆ†é¡µå•å…ƒå’Œä¸»å†…å­˜ä¹‹é—´ã€‚å®ƒåŒ…å«ä¸€ä¸ªç¡¬ä»¶é«˜é€Ÿç¼“å­˜å†…å­˜ (hardware cache memory) å’Œä¸€ä¸ªé«˜é€Ÿç¼“å­˜æ§åˆ¶å™¨ (cache controller)ã€‚é«˜é€Ÿç¼“å­˜å†…å­˜å­˜æ”¾å†…å­˜ä¸­çœŸæ­£çš„è¡Œã€‚é«˜é€Ÿç¼“å­˜æ§åˆ¶å™¨å­˜æ”¾ä¸€ä¸ªè¡¨é¡¹æ•°ç»„ï¼Œæ¯ä¸ªè¡¨é¡¹å¯¹åº”é«˜é€Ÿç¼“å­˜å†…å­˜ä¸­çš„ä¸€ä¸ªè¡Œã€‚æ¯ä¸ªè¡¨é¡¹æœ‰ä¸€ä¸ªæ ‡ç­¾(tag)å’Œæè¿°é«˜é€Ÿç¼“å­˜è¡ŒçŠ¶æ€çš„å‡ ä¸ªæ ‡å¿—(flag)ã€‚è¿™ç§å†…å­˜ç‰©ç†åœ°å€é€šå¸¸åˆ†ä¸º3ç»„ï¼šæœ€é«˜å‡ ä½å¯¹åº”æ ‡ç­¾ï¼Œä¸­é—´å‡ ä½å¯¹åº”é«˜é€Ÿç¼“å­˜æ§åˆ¶å™¨çš„å­é›†ç´¢å¼•ï¼Œæœ€ä½å‡ ä½å¯¹åº”è¡Œå†…çš„åç§»é‡ã€‚ å½“è®¿é—®ä¸€ä¸ª RAM å­˜å‚¨å•å…ƒæ—¶ï¼ŒCPU ä»ç‰©ç†åœ°å€ä¸­æå–å‡ºå­é›†çš„ç´¢å¼•å·å¹¶æŠŠå­é›†ä¸­æ‰€æœ‰è¡Œçš„æ ‡ç­¾ä¸ç‰©ç†åœ°å€çš„é«˜å‡ ä½ç›¸æ¯”è¾ƒã€‚å¦‚æœå‘ç°æŸä¸€ä¸ªè¡Œçš„æ ‡ç­¾ä¸è¿™ä¸ªç‰©ç†åœ°å€çš„é«˜ä½ç›¸åŒï¼Œåˆ™ CPU å‘½ä¸­ä¸€ä¸ªé«˜é€Ÿç¼“å­˜ (cache hit)ï¼›å¦åˆ™ï¼Œé«˜é€Ÿç¼“å­˜æ²¡æœ‰å‘½ä¸­ (cache miss)ã€‚ å¯¹äºè¯»æ“ä½œï¼Œæ§åˆ¶å™¨ä»é«˜é€Ÿç¼“å­˜è¡Œä¸­é€‰æ‹©æ•°æ®å¹¶é€åˆ° CPU å¯„å­˜å™¨ã€‚å¯¹äºå†™æ“ä½œï¼Œæ§åˆ¶å™¨å¯èƒ½é‡‡ç”¨ä»¥ä¸‹ä¸¤ä¸ªåŸºæœ¬ç­–ç•¥ä¹‹ä¸€: é€šå†™(write-through): æ§åˆ¶å™¨æ€»æ˜¯æ—¢å†™ RAM ä¹Ÿå†™é«˜é€Ÿç¼“å­˜è¡Œï¼Œä¸ºäº†æé«˜å†™æ“ä½œçš„æ•ˆç‡å…³é—­é«˜é€Ÿç¼“å­˜ã€‚ å›å†™(write-back): åªæ›´æ–°é«˜é€Ÿç¼“å­˜è¡Œï¼Œä¸æ”¹å˜ RAM çš„å†…å­˜ï¼Œæä¾›äº†æ›´å¿«çš„æ•ˆç‡ã€‚ å¤„ç†å™¨çš„ cr0 å¯„å­˜å™¨çš„ CD æ ‡å¿—ä½ç”¨æ¥å¯ç”¨æˆ–ç¦ç”¨é«˜é€Ÿç¼“å­˜ç”µè·¯ã€‚è¿™ä¸ªå¯„å­˜å™¨ä¸­çš„ NW æ ‡å¿—æŒ‡æ˜é«˜é€Ÿç¼“å­˜æ˜¯ä½¿ç”¨é€šå†™è¿˜æ˜¯å›å†™ç­–ç•¥ã€‚ ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:5:2","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"Linux ä¸­çš„åˆ†é¡µ Linux é‡‡ç”¨äº†ä¸€ç§åŒæ—¶é€‚ç”¨äº32ä½å’Œ64ä½çš„æ™®é€šåˆ†é¡µæ¨¡å‹ã€‚åœ¨ 2.6.10 ç‰ˆæœ¬ä¹‹å‰ï¼ŒLinux é‡‡ç”¨ä¸‰çº§åˆ†é¡µçš„æ¨¡å‹ã€‚ä» 2.6.11 ç‰ˆæœ¬å¼€å§‹ï¼Œé‡‡ç”¨äº†å››çº§åˆ†é¡µæ¨¡å‹: é¡µå…¨å±€ç›®å½• (Page Global Directory) é¡µä¸Šçº§ç›®å½• (Page Upper Directory) é¡µä¸­é—´ç›®å½• (Page Middle Directory) é¡µè¡¨ (Page Table) é¡µå…¨å±€ç›®å½•åŒ…å«è‹¥å¹²é¡µä¸Šçº§ç›®å½•çš„åœ°å€ï¼Œé¡µä¸Šçº§ç›®å½•æœ‰ä¸€æ¬¡åŒ…å«è‹¥å¹²é¡µä¸­é—´ç›®å½•çš„åœ°å€ï¼Œè€Œé¡µä¸­é—´ç›®å½•åˆåŒ…å«è‹¥å¹²é¡µè¡¨çš„åœ°å€ã€‚æ¯ä¸€ä¸ªé¡µè¡¨é¡¹æŒ‡å‘ä¸€ä¸ªé¡µæ¡†ã€‚çº¿æ€§åœ°å€å› æ­¤è¢«åˆ†æˆäº”ä¸ªéƒ¨åˆ†ã€‚ Linux çš„è¿›ç¨‹å¤„ç†å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºåˆ†é¡µã€‚äº‹å®ä¸Šï¼Œçº¿æ€§åœ°å€åˆ°ç‰©ç†åœ°å€çš„è‡ªåŠ¨è½¬æ¢ä½¿ä¸‹é¢çš„è®¾è®¡ç›®æ ‡å˜å¾—å¯è¡Œ: ç»™æ¯ä¸€ä¸ªè¿›ç¨‹åˆ†é…ä¸€å—ä¸åŒçš„ç‰©ç†åœ°å€ç©ºé—´ï¼Œè¿™ç¡®ä¿äº†å¯ä»¥æœ‰æ•ˆåœ°é˜²æ­¢å¯»å€é”™è¯¯ã€‚ åŒºåˆ«é¡µ(å³ä¸€ç»„æ•°æ®)å’Œé¡µæ¡†(å³ä¸»å­˜ä¸­çš„ç‰©ç†åœ°å€)çš„ä¸åŒã€‚è¿™å°±å…è®¸å­˜æ”¾åœ¨æŸä¸ªé¡µæ¡†ä¸­çš„ä¸€ä¸ªé¡µï¼Œç„¶åä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œä»¥åé‡æ–°è£…å…¥è¿™åŒä¸€é¡µæ˜¯åˆå¯ä»¥è¢«è£…è½½ä¸åŒçš„é¡µæ¡†ä¸­ã€‚è¿™å°±æ˜¯è™šæ‹Ÿå†…å­˜æœºåˆ¶çš„åŸºæœ¬è¦ç´ ã€‚ æ¯ä¸€ä¸ªè¿›ç¨‹æœ‰å®ƒè‡ªå·±çš„é¡µå…¨å±€ç›®å½•å’Œè‡ªå·±çš„é¡µè¡¨é›†ã€‚å½“å‘ç”Ÿè¿›ç¨‹åˆ‡æ¢æ—¶ï¼ŒLinux æŠŠ cr3 æ§åˆ¶å¯„å­˜å™¨çš„å†…å­˜ä¿å­˜åœ¨å‰ä¸€ä¸ªæ‰§è¡Œè¿›ç¨‹çš„æè¿°ç¬¦ä¸­ï¼Œç„¶åæŠŠä¸‹ä¸€ä¸ªè¦æ‰§è¡Œè¿›ç¨‹çš„æè¿°ç¬¦çš„å€¼è£…å…¥ cr3 å¯„å­˜å™¨ä¸­ã€‚ ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:6:0","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"çº¿æ€§åœ°å€å­—æ®µ ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:6:1","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"é¡µè¡¨å¤„ç† ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:6:2","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"ç‰©ç†å†…å­˜å¸ƒå±€ åœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œå†…æ ¸å¿…é¡»å»ºç«‹ä¸€ä¸ªç‰©ç†åœ°å€æ˜ å°„æ¥æŒ‡å®šå“ªäº›ç‰©ç†åœ°å€èŒƒå›´å¯¹å†…æ ¸å¯ç”¨è€Œå“ªäº›ä¸å¯ç”¨ã€‚ å†…æ ¸å°†ä¸‹åˆ—é¡µæ¡†è®°ä¸ºä¿ç•™: åœ¨ä¸å¯ç”¨çš„ç‰©ç†åœ°å€èŒƒå›´å†…çš„é¡µæ¡†ã€‚ å«æœ‰å†…æ ¸ä»£ç å’Œå·²åˆå§‹åŒ–çš„æ•°æ®ç»“æ„çš„é¡µæ¡†ã€‚ ä» 0x07ff0000 åˆ° 0x07ff2fff çš„ç‰©ç†åœ°å€èŒƒå›´ä¸­å­˜æœ‰åŠ ç”µè‡ªæ£€(POST)é˜¶æ®µç”±BIOSå†™å…¥çš„ç³»ç»Ÿç¡¬ä»¶è®¾å¤‡ä¿¡æ¯ã€‚åœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œå†…æ ¸æŠŠè¿™äº›ä¿¡æ¯æ‹·è´åˆ°ä¸€ä¸ªåˆé€‚çš„å†…æ ¸æ•°æ®ç»“æ„ä¸­ï¼Œç„¶åè®¤ä¸ºè¿™äº›é¡µæ¡†æ˜¯å¯ç”¨çš„ã€‚ç›¸åï¼Œä» 0x07ff3000 åˆ° 0x07ffffff çš„ç‰©ç†åœ°å€èŒƒå›´è¢«æ˜ å°„åˆ°ç¡¬ä»¶è®¾å¤‡çš„ ROM èŠ¯ç‰‡ã€‚ä» 0xffff0000 å¼€å§‹çš„ç‰©ç†åœ°å€èŒƒå›´æ ‡è®°ä¸ºä¿ç•™ï¼Œå› ä¸ºå®ƒç”±ç¡¬ä»¶åœ°å€æ˜ å°„åˆ° BIOS çš„ ROM èŠ¯ç‰‡ã€‚ Linux ç”¨ PC ä½“ç³»ç»“æ„æœªä¿ç•™çš„é¡µæ¡†æ¥åŠ¨æ€å­˜æ”¾æ‰€åˆ†é…çš„é¡µã€‚ ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:6:3","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"è¿›ç¨‹é¡µè¡¨ è¿›ç¨‹çš„çº¿æ€§åœ°å€ç©ºé—´åˆ†æˆä¸¤éƒ¨åˆ†: ä» 0x00000000 åˆ° 0xbfffffff çš„çº¿æ€§åœ°å€ï¼Œæ— è®ºè¿›ç¨‹è¿è¡Œåœ¨ç”¨æˆ·æ€è¿˜æ˜¯å†…æ ¸æ€éƒ½å¯ä»¥å¯»å€ã€‚ ä» 0xc0000000 åˆ° 0xffffffff çš„çº¿æ€§åœ°å€ï¼Œåªæœ‰å†…æ ¸æ€çš„è¿›ç¨‹æ‰èƒ½å¯»å€ã€‚ å½“è¿›ç¨‹è¿è¡Œåœ¨ç”¨æˆ·æ€æ—¶ï¼Œå®ƒäº§ç”Ÿçš„çº¿æ€§åœ°å€å°äº 0xc0000000ï¼›å½“è¿›ç¨‹è¿è¡Œåœ¨å†…æ ¸æ€æ—¶ï¼Œå®ƒæ‰§è¡Œå†…æ ¸ä»£ç ï¼Œæ‰€äº§ç”Ÿçš„åœ°å€å¤§äºç­‰äº 0xc0000000ã€‚ ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:6:4","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"å†…æ ¸é¡µè¡¨ å†…æ ¸ç»´æŒç€ä¸€ç»„è‡ªå·±ä½¿ç”¨çš„é¡µè¡¨ï¼Œé©»ç•™åœ¨ä¸»å†…æ ¸é¡µå…¨å±€ç›®å½•(master kernel Page Global Directory)ä¸­ã€‚ å†…æ ¸å¦‚ä½•åˆå§‹åŒ–è‡ªå·±çš„é¡µè¡¨: å†…æ ¸åˆ›å»ºä¸€ä¸ªæœ‰é™çš„åœ°å€ç©ºé—´ï¼ŒåŒ…æ‹¬å†…æ ¸çš„ä»£ç æ®µå’Œæ•°æ®æ®µã€åˆå§‹é¡µè¡¨å’Œç”¨äºå­˜æ”¾åŠ¨æ€æ•°æ®ç»“æ„çš„128KBå¤§å°çš„ç©ºé—´ã€‚è¿™ä¸ªæœ€å°é™åº¦çš„åœ°å€ç©ºé—´ä»…å¤Ÿå°†å†…æ ¸è£…å…¥RAMå’Œå¯¹å…¶åˆå§‹åŒ–çš„æ•°æ®ç»“æ„ã€‚ å†…æ ¸å……åˆ†åˆ©ç”¨å‰©ä½™çš„RAMå¹¶é€‚å½“åœ°å»ºç«‹åˆ†é¡µè¡¨ã€‚ å»ºç«‹åˆ†é¡µè¡¨çš„è¯¦ç»†æ­¥éª¤: ä¸´æ—¶é¡µå…¨å±€ç›®å½•æ”¾åœ¨ swapper_pg_dir å˜é‡ä¸­ï¼Œä¸´æ—¶é¡µè¡¨åœ¨ pg0 å˜é‡å‡ºå¼€å§‹å­˜æ”¾ï¼Œç´§æ¥åœ¨å†…æ ¸æœªåˆå§‹åŒ–çš„æ•°æ®æ®µåé¢ã€‚å†…æ ¸åœ¨åˆå§‹åŒ–çš„ç¬¬ä¸€é˜¶æ®µï¼Œå¯ä»¥é€šè¿‡ä¸ç‰©ç†åœ°å€ç›¸åŒçš„çº¿æ€§åœ°å€æˆ–è€…é€šè¿‡ä» 0xc0000000 å¼€å§‹çš„ 8MB çº¿æ€§åœ°å€å¯¹ RAM çš„å‰ 8MB è¿›è¡Œå¯»å€ã€‚ å†…æ ¸é€šè¿‡æŠŠ swapper_pg_dir æ‰€æœ‰é¡¹éƒ½å¡«å……ä¸º0æ¥åˆ›å»ºæœŸæœ›çš„æ˜ å°„ï¼Œ0ã€1ã€0x300(768)å’Œ0x301(769)é™¤å¤–ï¼Œå®ƒä»¬çš„åˆå§‹åŒ–å¦‚ä¸‹ï¼š 0 é¡¹å’Œ 0x300 é¡¹çš„åœ°å€å­—æ®µç½®ä¸º pg0 çš„ç‰©ç†åœ°å€ï¼Œè€Œ 1 é¡¹å’Œ 0x301 é¡¹çš„åœ°å€å­—æ®µç½®ä¸ºç´§éš pg0 åçš„é¡µæ¡†çš„ç‰©ç†åœ°å€ã€‚ æŠŠè¿™å››ä¸ªé¡¹ä¸­çš„ Presentã€Read/Write å’Œ User/Supervisor æ ‡å¿—ç½®é›¶ã€‚ æŠŠè¿™å››ä¸ªé¡¹ä¸­çš„ Accessedã€Dirtyã€PCDã€PWD å’Œ Page Size æ ‡å¿—è¯·0ã€‚ ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:6:5","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["ç¬”è®°"],"content":"å›ºå®šæ˜ å°„çš„çº¿æ€§åœ°å€ æˆ‘ä»¬çœ‹åˆ°å†…æ ¸çº¿æ€§åœ°å€ç¬¬å››ä¸ªGBçš„åˆå§‹åŒ–éƒ¨åˆ†æ˜ å°„ç³»ç»Ÿçš„ç‰©ç†å†…å­˜ã€‚ä½†æ˜¯ï¼Œè‡³å°‘128MBçš„çº¿æ€§åœ°å€æ€»æ˜¯ç•™ä½œå®ƒç”¨ï¼Œå› ä¸ºå†…æ ¸ä½¿ç”¨è¿™äº›çº¿æ€§åœ°å€å®ç°éè¿ç»­å†…å­˜åˆ†é…å’Œå›ºå®šæ˜ å°„çš„çº¿æ€§åœ°å€ã€‚ å›ºå®šæ˜ å°„çš„çº¿æ€§åœ°å€(fix-mapped linear address)åŸºæœ¬ä¸Šæ˜¯ä¸€ç§ç±»ä¼¼äº 0xffffc000 è¿™æ ·çš„å¸¸é‡çº¿æ€§åœ°å€ï¼Œå…¶å¯¹åº”çš„ç‰©ç†åœ°å€ä¸å¿…ç­‰äºçº¿æ€§åœ°å€å‡å» 0xc000000ã€‚å†…æ ¸ä½¿ç”¨å›ºå®šæ˜ å°„çš„çº¿æ€§åœ°å€æ¥ä»£æ›¿æŒ‡é’ˆå˜é‡ï¼Œå› ä¸ºè¿™äº›æŒ‡é’ˆå˜é‡çš„å€¼ä»ä¸æ”¹å˜ã€‚ ","date":"2021-10-10","objectID":"/linux%E5%86%85%E5%AD%98/:6:6","tags":["linux"],"title":"Linuxå†…å­˜","uri":"/linux%E5%86%85%E5%AD%98/"},{"categories":["å¼€å‘"],"content":"ä¸Šä¸€ç¯‡äº†è§£äº† tokio çš„åŸºæœ¬ç”¨æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­æ·±å…¥ tokio çš„è¯¦ç»†ç”¨æ³•ã€‚ ","date":"2021-09-14","objectID":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/:0:0","tags":["rust"],"title":"tokio é«˜çº§ç”¨æ³•","uri":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/"},{"categories":["å¼€å‘"],"content":"æ·±å…¥ async rust ä» 1.36 ç‰ˆæœ¬å¼€å§‹å¼•å…¥ async/await ä½œä¸ºæ”¯æŒå¼‚æ­¥ç›¸å…³çš„å…³é”®å­—ã€‚å…¶å†…éƒ¨æ˜¯å®ç°äº† std::future::Future è¿™ä¸ªç‰¹æ€§ã€‚ ","date":"2021-09-14","objectID":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/:1:0","tags":["rust"],"title":"tokio é«˜çº§ç”¨æ³•","uri":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/"},{"categories":["å¼€å‘"],"content":"Future std::future::Future çš„å®šä¹‰å¦‚ä¸‹: usestd::pin::Pin;usestd::task::{Context,Poll};pubtraitFuture{type Output;fn poll(self: Pin\u003c\u0026mutSelf\u003e,cx: \u0026mutContext)-\u003e Poll\u003cSelf::Output\u003e;} Output è¡¨ç¤º Future è¾“å‡ºç»“æœçš„ç±»å‹Tã€‚pin æ˜¯ rust èƒ½å¤Ÿåœ¨å¼‚æ­¥å‡½æ•°ä¸­æ”¯æŒ borrows å…³é”®ã€‚å®ƒèƒ½åœ¨å†…å­˜ä¸­åˆ’å®šä¸€ç‰‡å›ºå®šçš„åŒºåŸŸã€‚ Future å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œé€šè¿‡ Poll æ”¹å˜ Future çŠ¶æ€ã€‚ å®ç°ä¸€ä¸ªç®€å•çš„ Futureï¼Œå…·æœ‰ä»¥ä¸‹åŠŸèƒ½: ç­‰å¾…ä¸€æ®µæ—¶é—´ è¾“å‡ºå­—ç¬¦åˆ°æ ‡å‡†è¾“å‡º Yield ä¸€æ®µå­—ç¬¦ä¸² usestd::future::Future;usestd::pin::Pin;usestd::task::{Context,Poll};usestd::time::{Duration,Instant};struct Delay{when: Instant,}implFutureforDelay{type Output=\u0026'staticstr;fn poll(self: Pin\u003c\u0026mutSelf\u003e,cx: \u0026mutContext\u003c'_\u003e)-\u003e Poll\u003c\u0026'staticstr\u003e{ifInstant::now()\u003e=self.when{println!(\"Hello world\");Poll::Ready(\"done\")}else{// Ignore this line for now. // è¿™ä¸ªå¾ˆé‡è¦ cx.waker().wake_by_ref();Poll::Pending}}}#[tokio::main]asyncfn main(){letwhen=Instant::now()+Duration::from_millis(10);letfuture=Delay{when};letout=future.await;assert_eq!(out,\"done\");} é€šè¿‡è°ƒç”¨ .await è·å– Future çš„ç»“æœã€‚ ","date":"2021-09-14","objectID":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/:1:1","tags":["rust"],"title":"tokio é«˜çº§ç”¨æ³•","uri":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/"},{"categories":["å¼€å‘"],"content":"Poll rust é‡Œå…³äº Poll çš„å®šä¹‰: pubenum Poll\u003cT\u003e{/// Represents that a value is immediately ready. #[lang = \"Ready\"]#[stable(feature = \"futures_api\", since = \"1.36.0\")]Ready(#[stable(feature = \"futures_api\", since = \"1.36.0\")]T),/// Represents that a value is not ready yet. /// /// When a function returns `Pending`, the function *must* also /// ensure that the current task is scheduled to be awoken when /// progress can be made. #[lang = \"Pending\"]#[stable(feature = \"futures_api\", since = \"1.36.0\")]Pending,} Poll::Ready(T) è¡¨ç¤º Future å®Œæˆï¼ŒPoll::Pending è¡¨ç¤º Future æ­£åœ¨æ‰§è¡Œï¼Œä¸€æ®µæ—¶é—´åä¼šé‡æ–°è°ƒç”¨ pollã€‚ ","date":"2021-09-14","objectID":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/:1:2","tags":["rust"],"title":"tokio é«˜çº§ç”¨æ³•","uri":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/"},{"categories":["å¼€å‘"],"content":"Waker fn poll(self: Pin\u003c\u0026mutSelf\u003e,cx: \u0026mutContext)-\u003e Poll\u003cSelf::Output\u003e; poll å‡½æ•°çš„ Context ç±»å‹å‚æ•°ä¸­æœ‰ä¸ª waker() å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªè·Ÿå½“å‰ä»»åŠ¡ç»‘å®šçš„ Wakerï¼Œè¿™ä¸ª Waker æœ‰ä¸€ä¸ª wake() å‡½æ•°ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°å°±èƒ½å¤Ÿé€šçŸ¥æ‰§è¡Œå™¨ï¼Œæ‰§è¡Œå™¨ä¼šè°ƒåº¦ä¸è¯¥ Waker å…³è”çš„ä»»åŠ¡ï¼Œè®©ä»–ç»§ç»­æ‰§è¡Œã€‚èµ„æºåœ¨ä»–å°±ç»ªçš„æ—¶å€™å°±ä¼šè°ƒç”¨ wake() é€šçŸ¥æ‰§è¡Œå™¨è®©ä»–ç»§ç»­å¯¹è¿™ä¸ªä»»åŠ¡è°ƒç”¨ pollã€‚ å½“ä¸€ä¸ª Future è¿”å› Poll::Pending æ—¶ï¼Œä»–è¦ç¡®ä¿æ‰§è¡Œå™¨èƒ½å¤Ÿåœ¨ç¨åçš„æŸä¸ªæ—¶é—´ç‚¹æ”¶åˆ°é€šçŸ¥ï¼Œå¦‚æœæ— æ³•ä¿è¯è¿™ç‚¹ï¼Œè¯¥ä»»åŠ¡ä¼šæ— é™çš„æŒ‚èµ·å¯¼è‡´æ— æ³•è¿è¡Œã€‚è¿”å› Poll::Pending ä¹‹åæ²¡æœ‰è°ƒç”¨ wake å‘é€é€šçŸ¥æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„é”™è¯¯ã€‚ ","date":"2021-09-14","objectID":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/:1:3","tags":["rust"],"title":"tokio é«˜çº§ç”¨æ³•","uri":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/"},{"categories":["å¼€å‘"],"content":"æ€»ç»“ æ€»ç»“èµ·æ¥ Rust çš„ Future æœ‰ä»¥ä¸‹ç‰¹ç‚¹: Rust çš„å¼‚æ­¥æ“ä½œæ˜¯éœ€è¦è°ƒç”¨è€…é€šè¿‡ Poll å»æ¨è¿›çš„æƒ°æ€§æ“ä½œ Waker è¢«ä¼ é€’ç»™ Future ï¼Œ Futureå°†ä½¿ç”¨ä»–æ¥ä»»åŠ¡è¿›è¡Œå…³è” å½“èµ„æºæœªå°±ç»ªæ—¶ä¼šè¿”å› Poll::Pendingï¼Œè¿™æ—¶ä»»åŠ¡çš„ Waker ä¼šè¢«å…¶è®°å½•ä¸‹æ¥ å½“èµ„æºå°±ç»ªæ—¶ï¼Œä¼šä½¿ç”¨å·²è®°å½•çš„ Waker æ¥å‘å‡ºé€šçŸ¥ æ‰§è¡Œå™¨æ¥æ”¶åˆ°é€šçŸ¥åä¼šå°†å¯¹åº”çš„ä»»åŠ¡è°ƒåº¦æ‰§è¡Œ ä»»åŠ¡è¢«å†æ¬¡ Pollï¼Œå› ä¸ºèµ„æºæ­¤æ—¶å·²å°±ç»ªæ‰€ä»¥è¿™æ¬¡æ‰§è¡Œèƒ½å¤Ÿæ¨è¿›ä»»åŠ¡çš„çŠ¶æ€ ","date":"2021-09-14","objectID":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/:1:4","tags":["rust"],"title":"tokio é«˜çº§ç”¨æ³•","uri":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/"},{"categories":["å¼€å‘"],"content":"å…¶ä»– usestd::future::Future;usestd::pin::Pin;usestd::sync::{Arc,Mutex};usestd::task::{Context,Poll,Waker};usestd::thread;usestd::time::{Duration,Instant};struct Delay{when: Instant,// This Some when we have spawned a thread, and None otherwise. waker: Option\u003cArc\u003cMutex\u003cWaker\u003e\u003e\u003e,}implFutureforDelay{type Output=();fn poll(mutself: Pin\u003c\u0026mutSelf\u003e,cx: \u0026mutContext\u003c'_\u003e)-\u003e Poll\u003c()\u003e{// First, if this is the first time the future is called, spawn the // timer thread. If the timer thread is already running, ensure the // stored `Waker` matches the current task's waker. ifletSome(waker)=\u0026self.waker{letmutwaker=waker.lock().unwrap();// Check if the stored waker matches the current task's waker. // This is necessary as the `Delay` future instance may move to // a different task between calls to `poll`. If this happens, the // waker contained by the given `Context` will differ and we // must update our stored waker to reflect this change. if!waker.will_wake(cx.waker()){*waker=cx.waker().clone();}}else{letwhen=self.when;letwaker=Arc::new(Mutex::new(cx.waker().clone()));self.waker=Some(waker.clone());// This is the first time `poll` is called, spawn the timer thread. thread::spawn(move||{letnow=Instant::now();ifnow\u003cwhen{thread::sleep(when-now);}// The duration has elapsed. Notify the caller by invoking // the waker. letwaker=waker.lock().unwrap();waker.wake_by_ref();});}// Once the waker is stored and the timer thread is started, it is // time to check if the delay has completed. This is done by // checking the current instant. If the duration has elapsed, then // the future has completed and `Poll::Ready` is returned. ifInstant::now()\u003e=self.when{Poll::Ready(())}else{// The duration has not elapsed, the future has not completed so // return `Poll::Pending`. // // The `Future` trait contract requires that when `Pending` is // returned, the future ensures that the given waker is signalled // once the future should be polled again. In our case, by // returning `Pending` here, we are promising that we will // invoke the given waker included in the `Context` argument // once the requested duration has elapsed. We ensure this by // spawning the timer thread above. // // If we forget to invoke the waker, the task will hang // indefinitely. Poll::Pending}}} åœ¨æ¯æ¬¡è°ƒç”¨ Future::poll æ—¶æ£€æŸ¥å‚æ•°çš„ Waker æ˜¯å¦ä¸ä¹‹å‰ä¿å­˜çš„ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™ä¸éœ€è¦åšä»»ä½•å¤„ç†ï¼Œå¦åˆ™çš„è¯åˆ™éœ€è¦å°†ä¿å­˜çš„ Waker æ›¿æ¢ä¸ºæ–°çš„é‚£ä¸ªã€‚ Waker æ˜¯ Rust å¼‚æ­¥æœºåˆ¶çš„åŸºç¡€ï¼Œä½†é€šå¸¸æˆ‘ä»¬å¹¶ä¸éœ€è¦æ·±å…¥åˆ°åº•å±‚ï¼Œå¯ä»¥é€šè¿‡ async/await é…åˆ tokio::sync::Notify è¾¾åˆ°ç›¸åŒçš„ç»“æœ: usetokio::sync::Notify;usestd::sync::Arc;usestd::time::{Duration,Instant};usestd::thread;asyncfn delay(dur: Duration){letwhen=Instant::now()+dur;letnotify=Arc::new(Notify::new());letnotify2=notify.clone();thread::spawn(move||{letnow=Instant::now();ifnow\u003cwhen{thread::sleep(when-now);}notify2.notify_one();});notify.notified().await;} ","date":"2021-09-14","objectID":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/:1:5","tags":["rust"],"title":"tokio é«˜çº§ç”¨æ³•","uri":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/"},{"categories":["å¼€å‘"],"content":"select! tokio::select! å®å…è®¸æˆ‘ä»¬ç­‰å¾…å¤šä¸ªå¼‚æ­¥çš„ä»»åŠ¡ï¼Œå¹¶åœ¨å…¶ä¸­ä¸€ä¸ªå®Œæˆæ—¶è¿”å›ã€‚ usetokio::sync::oneshot;#[tokio::main]asyncfn main(){let(tx1,rx1)=oneshot::channel();let(tx2,rx2)=oneshot::channel();tokio::spawn(asyncmove{let_=tx1.send(\"one\");});tokio::spawn(asyncmove{let_=tx2.send(\"two\");});tokio::select!{val=rx1=\u003e{println!(\"rx1 completed first with {:?}\",val);}val=rx2=\u003e{println!(\"rx2 completed first with {:?}\",val);}}} Future æˆ–å…¶ä»–çš„ç±»å‹å¯ä»¥é€šè¿‡å®ç° Drop æ¥å®ç°èµ„æºæ¸…ç†çš„æ“ä½œï¼ŒTokio çš„ oneshot::Receiver é€šè¿‡å®ç° Drop æ¥ç»™ Sender å‘é€å…³é—­çš„é€šçŸ¥ï¼ŒSender ä¼šåœ¨æ”¶åˆ°é€šçŸ¥çš„æ—¶å€™å¯ä»¥é€šè¿‡ é€šè¿‡ Drop å…¶ä»–çš„èµ„æºæ¥æ¸…ç†è¿›ç¨‹å†…çš„ä¿¡æ¯ã€‚ ","date":"2021-09-14","objectID":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/:2:0","tags":["rust"],"title":"tokio é«˜çº§ç”¨æ³•","uri":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/"},{"categories":["å¼€å‘"],"content":"å†…éƒ¨å®ç° æˆ‘ä»¬é€šè¿‡ä¸€æ®µä»£ç æ¥äº†è§£ Future å®ç°: usestd::{future::Future,pin::Pin,task::{Context,Poll},};usetokio::sync::oneshot;struct MySelect{rx1: oneshot::Receiver\u003c\u0026'staticstr\u003e,rx2: oneshot::Receiver\u003c\u0026'staticstr\u003e,}implFutureforMySelect{type Output=();fn poll(mutself: Pin\u003c\u0026mutSelf\u003e,cx: \u0026mutContext\u003c'_\u003e)-\u003e Poll\u003c()\u003e{ifletPoll::Ready(val)=Pin::new(\u0026mutself.rx1).poll(cx){println!(\"rx1 completed first with {:?}\",val);returnPoll::Ready(());}ifletPoll::Ready(val)=Pin::new(\u0026mutself.rx2).poll(cx){println!(\"rx2 completed first with {:?}\",val);returnPoll::Ready(());}Poll::Pending}}#[tokio::main]asyncfn main(){let(tx1,rx1)=oneshot::channel();let(tx2,rx2)=oneshot::channel();tokio::spawn(asyncmove{tx2.send(\"two\");});tokio::spawn(asyncmove{tx1.send(\"one\");});MySelect{rx1,rx2}.await;} ","date":"2021-09-14","objectID":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/:2:1","tags":["rust"],"title":"tokio é«˜çº§ç”¨æ³•","uri":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/"},{"categories":["å¼€å‘"],"content":"è¯­æ³• select! å®èƒ½å¤Ÿå¤„ç†ä¸¤ä¸ªä»¥ä¸Šçš„åˆ†æ”¯ï¼Œäº‹å®ä¸Šå½“å‰çš„åˆ†æ”¯é™åˆ¶æ•°æ˜¯ 64 ä¸ªï¼Œæ¯ä¸ªåˆ†æ”¯çš„ç»“æ„å¦‚ä¸‹ \u003cpattern\u003e=\u003casyncexperssion\u003e=\u003e\u003chandler\u003e å®ƒçš„è¯­æ³•ç±»ä¼¼ä¸ Go è¯­è¨€ä¸­çš„ select å…³é”®å­—ã€‚å®ƒæœ‰ä»¥ä¸‹ç‰¹ç‚¹: åœ¨å¤šä¸ª ä¸­é€‰æ‹©ä¸€ä¸ªæ‰§è¡Œï¼Œè€Œé€‰æ‹©æ˜¯éšæœºçš„ï¼Œ å¯ä»¥è®¿é—® å¾—åˆ°çš„ç»‘å®šæ•°æ®ã€‚ æ”¯æŒè¿”å›å€¼ã€‚ æ”¯æŒä»»æ„çš„å¼‚æ­¥è¡¨è¾¾å¼ã€‚ ä½¿ç”¨ oneshot::Channel çš„è¾“å‡ºç»“æœåŠ TCP è¿æ¥çš„åˆ›å»ºä½œä¸º select! çš„è¡¨è¾¾å¼: usetokio::{net::TcpStream,sync::oneshot};#[tokio::main]asyncfn main(){let(tx,rx)=oneshot::channel();tokio::spawn(asyncmove{let_=tx.send(\"done\");});tokio::select!{socket=TcpStream::connect(\"localhost:3456\")=\u003e{println!(\"Socket connected: {:?}\",socket);}msg=rx=\u003e{println!(\"received message first {:?}\",msg);}}} æˆ–è€…å¯åŠ¨ TcpListener æ¥æ”¶è¿æ¥çš„å¾ªç¯ usestd::io;usetokio::{net::TcpListener,sync::oneshot};#[tokio::main]asyncfn main()-\u003e io::Result\u003c()\u003e{let(tx,rx)=oneshot::channel();tokio::spawn(asyncmove{let_=tx.send(\"done\");});letmutlistener=TcpListener::bind(\"localhost:3456\").await?;tokio::select!{_=async{loop{let(socket,_)=listener.accept().await?;tokio::spawn(asyncmove{process(socket)});}Ok::\u003c_,io::Error\u003e(())}=\u003e{}msg=rx=\u003e{println!(\"received message first {:?}\",msg);}}Ok(())} ","date":"2021-09-14","objectID":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/:2:2","tags":["rust"],"title":"tokio é«˜çº§ç”¨æ³•","uri":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/"},{"categories":["å¼€å‘"],"content":"è·å–è¿”å›å€¼ asyncfn computation1()-\u003e String {String::from(\"channel1\")}asyncfn computation2()-\u003e String {String::from(\"channel2\")}#[tokio::main]asyncfn main(){letout=tokio::select!{res1=computation1()=\u003eres1,res2=computation2()=\u003eres2,};println!(\"Got = {}\",out);} ","date":"2021-09-14","objectID":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/:2:3","tags":["rust"],"title":"tokio é«˜çº§ç”¨æ³•","uri":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/"},{"categories":["å¼€å‘"],"content":"é”™è¯¯å¤„ç† åœ¨ å—ä¸­ä½¿ç”¨ ? è¯­å¥èƒ½å¤Ÿè®©é”™è¯¯ä¼ æ’­å‡º select! è¡¨è¾¾å¼ã€‚ usestd::io;usetokio::net::TcpListener;usetokio::sync::oneshot;#[tokio::main]asyncfn main()-\u003e io::Result\u003c()\u003e{let(tx,rx)=oneshot::channel();letlistener=TcpListener::bind(\"localhost:3465\").await?;tokio::select!{res=async{loop{let(socket,_)=listener.accept().await?;tokio::spawn(asyncmove{process(sokcet)});}Ok::\u003c_,io::Error\u003e(())}=\u003e{res?;}_=rx=\u003e{println!(\"terminating accept loop\");}}Ok(())} ","date":"2021-09-14","objectID":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/:2:4","tags":["rust"],"title":"tokio é«˜çº§ç”¨æ³•","uri":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/"},{"categories":["å¼€å‘"],"content":"else select! è¡¨è¾¾å¼åŒ…å«äº†ä¸€ä¸ª else åˆ†æ”¯ï¼Œå› ä¸ºéœ€è¦å¯¹ select! è¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨æ¨¡å¼åŒ¹é…æ—¶å¯èƒ½æ‰€æœ‰çš„æ¨¡å¼éƒ½åŒ¹é…ä¸ä¸Šï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ else åˆ†æ”¯æ¥å¸®åŠ© select! æ±‚å€¼ã€‚ usetokio::sync::mpsc;#[tokio::main]asyncfn main(){let(tx1,mutrx1)=mpsc::channel(32);let(tx2,mutrx2)=mpsc::channel(32);tokio::spawn(asyncmove{// Send values on `tx1` and `tx2`. let_=tx1.send(\"tx1\").await;});tokio::spawn(asyncmove{// Send values on `tx1` and `tx2`. let_=tx2.send(\"tx2\").await;});tokio::select!{Some(v)=rx1.recv()=\u003e{println!(\"Got {:?} from rx1\",v);}Some(v)=rx2.recv()=\u003e{println!(\"Got {:?} from rx2\",v);}else=\u003e{println!(\"Bot channels closed\");}}} åœ¨æˆ‘ä»¬åˆ›å»ºä»»åŠ¡æ—¶ï¼Œæ‰€åˆ›å»ºä»»åŠ¡çš„å¼‚æ­¥ä»£ç å—å¿…é¡»æŒæœ‰ä»–ä½¿ç”¨çš„æ•°æ®ï¼Œä½† select! å¹¶æ²¡æœ‰è¿™ä¸ªé™åˆ¶ï¼Œæ¯ä¸ªåˆ†æ”¯çš„è¡¨è¾¾å¼å¯ä»¥å¯¹æ•°æ®è¿›è¡Œå€Ÿç”¨ä»¥åŠå¹¶å‘çš„è¿›è¡Œæ“ä½œï¼Œåœ¨ Rust çš„å€Ÿç”¨è§„åˆ™ä¸­ï¼Œå¤šä¸ªå¼‚æ­¥è¡¨è¾¾å¼èƒ½å¤Ÿå€Ÿç”¨åŒä¸€ä¸ªä¸å¯å˜å¼•ç”¨ï¼Œæˆ–è€…ä¸€ä¸ªä¸€æ­¥è¡¨è¾¾å¼èƒ½å¤Ÿå€Ÿç”¨ä¸€ä¸ªå¯å˜å¼•ç”¨ã€‚ ","date":"2021-09-14","objectID":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/:2:5","tags":["rust"],"title":"tokio é«˜çº§ç”¨æ³•","uri":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/"},{"categories":["å¼€å‘"],"content":"Loops select! å¯ä»¥å’Œ loop é…åˆä½¿ç”¨: usetokio::sync::mpsc;#[tokio::main]asyncfn main(){let(tx1,mutrx1)=mpsc::channel(128);let(tx2,mutrx2)=mpsc::channel(128);let(tx3,mutrx3)=mpsc::channel(128);tokio::spawn(asyncmove{tx1.send(\"tx1\").await;});tokio::spawn(asyncmove{tx2.send(\"tx2\").await;});tokio::spawn(asyncmove{tx3.send(\"tx3\").await;});loop{letmsg=tokio::select!{Some(msg)=rx1.recv()=\u003emsg,Some(msg)=rx2.recv()=\u003emsg,Some(msg)=rx3.recv()=\u003emsg,else=\u003e{break;}};println!(\"Got {}\",msg);}println!(\"All channels have been closed.\");} select! å®ä¼šéšæœºçš„é€‰æ‹©å¯è¯»çš„åˆ†æ”¯ï¼Œåœ¨ä¸Šä¾‹ä¸­å½“å¤šä¸ª Channel ä¸­éƒ½æœ‰å¯è¯»çš„æ•°æ®æ—¶ï¼Œå°†éšæœºé€‰æ‹©ä¸€ä¸ª Channel æ¥è¯»å–ã€‚è¿™ä¸ªå®ç°æ˜¯ä¸ºäº†å¤„ç†å¾ªç¯ä¸­æ¶ˆè´¹æ¶ˆæ¯çš„èƒ½åŠ›è½åäºç”Ÿäº§æ¶ˆæ¯è¿™ä¸ªåœºæ™¯æ‰€å¸¦æ¥çš„é—®é¢˜ï¼Œè¿™ä¸ªåœºæ™¯æ„å‘³ç€ Channel æ€»ä¼šè¢«å¡«æ»¡ï¼Œå¦‚æœ select! æ²¡æœ‰éšæœºçš„é€‰å–åˆ†æ”¯ï¼Œå°†å¯¼è‡´å¾ªç¯ä¸­çš„ rx1 æ°¸è¿œæ˜¯ç¬¬ä¸€ä¸ªæ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®å¯è¯»çš„åˆ†æ”¯ï¼Œå¦‚æœ rx1 ä¸€ç›´éƒ½æœ‰æ–°çš„æ¶ˆæ¯è¦å¤„ç†ï¼Œé‚£å…¶ä»–åˆ†æ”¯ä¸­çš„ Channel å°†æ°¸è¿œä¸ä¼šè¢«æ¶ˆè´¹ã€‚ å¦‚æœ select! è¢«æ±‚å€¼æ—¶ï¼Œå…¶ä¸­çš„å¤šä¸ª Channel éƒ½å­˜åœ¨æ’é˜Ÿä¸­çš„æ¶ˆæ¯ï¼Œåªæœ‰ä¸€ä¸ª Channel çš„æ¶ˆæ¯ä¼šè¢«æ¶ˆè´¹ï¼Œå…¶ä»–æ‰€æœ‰çš„ Channel éƒ½ä¸ä¼šè¿›è¡Œä»»ä½•æ£€æŸ¥ï¼Œä»–ä»¬çš„æ¶ˆæ¯ä¼šè¢«ä¸€ç›´å­˜åœ¨ Channel ä¸­ï¼Œç›´åˆ°å¾ªç¯çš„ä¸‹ä¸€è½®è¿­ä»£ï¼Œè¿™äº›æ¶ˆæ¯å¹¶ä¸ä¼šä¸¢å¤±ã€‚ ","date":"2021-09-14","objectID":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/:2:6","tags":["rust"],"title":"tokio é«˜çº§ç”¨æ³•","uri":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/"},{"categories":["å¼€å‘"],"content":"pin! usetokio::sync::mpsc;asyncfn action()-\u003e String {tokio::time::sleep(tokio::time::Duration::from_secs(1)).await;String::from(\"aa\")}#[tokio::main]asyncfn main(){let(tx,mutrx)=mpsc::channel(128);letoperation=action();tokio::pin!(operation);tokio::spawn(asyncmove{let_=tx.send(2).await;});loop{tokio::select!{v=\u0026mutoperation=\u003e{println!(\"GOT {:?}\",v);break;},Some(v)=rx.recv()=\u003e{println!(\"{:?}\",v);ifv%2==0{// break; }}}}} åœ¨ select! å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† \u0026mut operation è€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ operationã€‚è¿™ä¸ª operation å˜é‡åœ¨æ•´ä¸ªå¼‚æ­¥çš„æ“ä½œä¸­éƒ½å­˜åœ¨ï¼Œæ¯æ¬¡å¾ªç¯çš„è¿­ä»£éƒ½ä¼šä½¿ç”¨åŒä¸€ä¸ª operation è€Œä¸æ˜¯æ¯æ¬¡éƒ½è°ƒç”¨ä¸€æ¬¡ action()ã€‚ ","date":"2021-09-14","objectID":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/:2:7","tags":["rust"],"title":"tokio é«˜çº§ç”¨æ³•","uri":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/"},{"categories":["å¼€å‘"],"content":"Streams Stream è¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥çš„æ•°æ®åºåˆ—ï¼Œæˆ‘ä»¬ç”¨ Stream Trait æ¥è¡¨ç¤ºè·Ÿæ ‡å‡†åº“çš„ std::iter::Iterator ç±»ä¼¼çš„æ¦‚å¿µã€‚ Tokio æä¾›çš„ Stream æ”¯æŒæ˜¯é€šè¿‡ä¸€ä¸ªç‹¬ç«‹çš„åŒ…æ¥å®ç°çš„ï¼Œä»–å°±æ˜¯ tokio-stream tokio-stream=\"0.1\" usetokio_stream::StreamExt;#[tokio::main]asyncfn main(){letstream=tokio_stream::iter(\u0026[1,2,3,4,5]);letmutstream=stream.take(3);whileletSome(v)=\u0026stream.next().await{println!(\"GOT = {:?}\",v)}} ","date":"2021-09-14","objectID":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/:3:0","tags":["rust"],"title":"tokio é«˜çº§ç”¨æ³•","uri":"/tokio%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/"},{"categories":["å¼€å‘"],"content":"ç®€ä»‹ Tokio is an asynchronous runtime for the Rust programming language. It provides the building blocks needed for writing networking applications. It gives the flexibility to target a wide range of systems, from large servers with dozens of cores to small embedded devices. Tokio æ˜¯ rust å®ç°çš„å¼‚æ­¥åº“ï¼Œæä¾›ä¸€ä¸ªå¼‚æ­¥è¿è¡Œæ—¶ã€‚å®ƒå…·æœ‰ä»¥ä¸‹çš„ç‰¹ç‚¹: Fast: rust æœ¬èº«å°±æœ‰ C è¯­è¨€çš„æ€§èƒ½ï¼Œtokio åˆå»ºç«‹åœ¨ async/await feature ä¸Šï¼Œä½¿å¾—éå¸¸å¿«ï¼Œç‰¹åˆ«åœ¨å¤„ç† I/O é—®é¢˜ä¸Šã€‚ Reliable: å¾—ç›Šäº rust çš„ç‰¹ç‚¹ã€‚å¯é æ€§æœ‰ä¿éšœã€‚ Easy: å€ŸåŠ© Rust çš„ async/await ç‰¹æ€§ï¼Œç¼–å†™å¼‚æ­¥åº”ç”¨ç¨‹åºçš„å¤æ‚æ€§å·²å¤§å¤§é™ä½ã€‚ Flexible: Tokio æä¾›äº†å¤šç‰ˆæœ¬è¿è¡Œæ—¶ã€‚ä»å¤šçº¿ç¨‹ã€çªƒå–å·¥ä½œçš„è¿è¡Œæ—¶åˆ°è½»é‡çº§çš„å•çº¿ç¨‹è¿è¡Œæ—¶ã€‚ ","date":"2021-09-12","objectID":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/:1:0","tags":["rust"],"title":"Tokio åˆå°è¯•","uri":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/"},{"categories":["å¼€å‘"],"content":"å®‰è£… åœ¨ Cargo.toml çš„ [dependencies] åŠ å…¥: tokio = { version = \"1\", features = [\"full\"] } åœ¨ src/main.rs ä¸­æ·»åŠ ä»£ç : usestd::io::Result;asyncfn hello(){println!(\"hello\")}fn main()-\u003e Result\u003c()\u003e{letrt=tokio::runtime::Runtime::new()?;rt.block_on(hello());Ok(())} cargo run è¾“å‡ºç»“æœ: hello rust å® #[tokio::main] èƒ½å°†å¼‚æ­¥ async fn main() è½¬åŒ–æˆåŒæ­¥çš„ fn main().ä¾‹å¦‚: #[tokio::main]asyncfn main(){println!(\"hello\");} å¯ä»¥è½¬åŒ–ä¸º: fn main(){letmutrt=tokio::runtime::Runtime::new().unwrap();rt.block_on(async{println!(\"hello\");})} ","date":"2021-09-12","objectID":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/:2:0","tags":["rust"],"title":"Tokio åˆå°è¯•","uri":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/"},{"categories":["å¼€å‘"],"content":"å¹¶å‘ usetokio::net::{TcpListener,TcpStream};#[tokio::main]asyncfn main(){letlistener=TcpListener::bind(\"127.0.0.1:6379\").await.unwrap();loop{let(socket,_)=listener.accept().await.unwrap();// æ¯æ¬¡éƒ½æ–°å¯åŠ¨ task å¤„ç† tcp è¿æ¥ tokio::spawn(asyncmove{process(socket).await;});}}asyncfn process(_: TcpStream){} tokio task æ˜¯ä¸€ä¸ªå¼‚æ­¥ç»¿è‰²çº¿ç¨‹ã€‚ä½¿ç”¨ tokio::spawn åˆ›å»ºå¼‚æ­¥å—ï¼Œè¿”å›ç±»å‹ä¸º JoinHandleã€‚ä½¿ç”¨ .await è·å–è¿”å›å€¼ã€‚ #[tokio::main]asyncfn main(){lethandle=tokio::spawn(asyncmove{\"return value\"});letout=handle.await.unwrap();println!(\"GOT {}\",out);} task è¢« tokio å†…éƒ¨è°ƒåº¦å™¨ä½¿ç”¨ï¼Œ è¯·ç¡®è®¤å†…éƒ¨æœ‰äº‹å¯åšã€‚åŒæ—¶å®ƒä»¬ä¼šåœ¨ä¸åŒçº¿ç¨‹å°†æ‰§è¡Œã€‚ tokio ä¸­çš„ä»»åŠ¡éå¸¸è½»é‡çº§ã€‚å®ƒä»¬åªéœ€è¦ä¸€æ¬¡åˆ†é…å’Œ 64 å­—èŠ‚çš„å†…å­˜ã€‚åº”ç”¨ç¨‹åºå¯ä»¥éšæ„äº§ç”Ÿæ•°åƒç”šè‡³æ•°ç™¾ä¸‡ä¸ªä»»åŠ¡ã€‚ ","date":"2021-09-12","objectID":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/:3:0","tags":["rust"],"title":"Tokio åˆå°è¯•","uri":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/"},{"categories":["å¼€å‘"],"content":"â€˜static task çš„ç±»å‹æ˜¯ 'static çš„ï¼Œè¿™æ„å‘³ç€ä»»åŠ¡å†…éƒ¨çš„å˜é‡ä¸èƒ½å­˜åœ¨å¤–éƒ¨å¼•ç”¨ usetokio::task;#[tokio::main]asyncfn main(){letv=vec![1,2,3];// v å˜é‡è½¬ç§»åˆ° task å†…éƒ¨ task::spawn(asyncmove{println!(\"Here's a vec: {:?}\",v);});} ","date":"2021-09-12","objectID":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/:3:1","tags":["rust"],"title":"Tokio åˆå°è¯•","uri":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/"},{"categories":["å¼€å‘"],"content":"Send tokio::spawn äº§ç”Ÿçš„ä»»åŠ¡å¿…é¡»å®ç° Sendã€‚è¿™å…è®¸ tokio è¿è¡Œæ—¶åœ¨çº¿ç¨‹ä¹‹é—´ç§»åŠ¨ä»»åŠ¡ï¼ŒåŒæ—¶å®ƒä»¬åœ¨ .await å¤„æŒ‚èµ·ã€‚ usetokio::task::yield_now;usestd::rc::Rc;#[tokio::main]asyncfn main(){tokio::spawn(async{// The scope forces `rc` to drop before `.await`. {letrc=Rc::new(\"hello\");println!(\"{}\",rc);}// `rc` is no longer used. It is **not** persisted when // the task yields to the scheduler yield_now().await;});} ","date":"2021-09-12","objectID":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/:3:2","tags":["rust"],"title":"Tokio åˆå°è¯•","uri":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/"},{"categories":["å¼€å‘"],"content":"å…±äº«çŠ¶æ€ åœ¨ tokio ä¸­æœ‰å‡ ç§ä¸åŒçš„æ–¹å¼æ¥å…±äº«çŠ¶æ€ã€‚ ä½¿ç”¨ Mutex ä¿æŠ¤å…±äº«çŠ¶æ€ã€‚ ç”Ÿæˆä¸€ä¸ªä»»åŠ¡æ¥ç®¡ç†çŠ¶æ€å¹¶ä½¿ç”¨æ¶ˆæ¯ä¼ é€’å¯¹å…¶è¿›è¡Œæ“ä½œã€‚ é€šå¸¸ï¼Œå¯¹ç®€å•æ•°æ®ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•ï¼Œå¯¹éœ€è¦å¼‚æ­¥å·¥ä½œçš„äº‹ç‰©ï¼ˆä¾‹å¦‚ I/O åŸè¯­ï¼‰ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•ã€‚ usestd::{collections::HashMap,sync::{Arc,Mutex},};usetokio::net::{TcpListener,TcpStream};#[tokio::main]asyncfn main(){letlistener=TcpListener::bind(\"127.0.0.1:6379\").await.unwrap();println!(\"Listening\");letdb=Arc::new(Mutex::new(HashMap::new()));loop{let(socket,_)=listener.accept().await.unwrap();letdb=db.clone();println!(\"Accepted\");tokio::spawn(asyncmove{process(socket,db).await;});}}asyncfn process(_: TcpStream,_db: Arc\u003cMutex\u003cHashMap\u003ci32,i32\u003e\u003e\u003e){} æ³¨æ„ï¼Œä½¿ç”¨ std::sync::Mutex è€Œä¸æ˜¯ tokio::sync::Mutex æ¥ä¿æŠ¤ HashMapã€‚ä¸€ä¸ªå¸¸è§çš„é”™è¯¯æ˜¯åœ¨å¼‚æ­¥ä»£ç ä¸­æ— æ¡ä»¶åœ°ä½¿ç”¨ tokio::sync::Mutexã€‚å¼‚æ­¥äº’æ–¥é”æ˜¯åœ¨è°ƒç”¨ .await æ—¶é”å®šçš„äº’æ–¥é”ã€‚ ç­‰å¾…è·å–é”æ—¶ï¼ŒåŒæ­¥ mutex å°†ç­‰å¾…å½“å‰ lockã€‚è¿™åè¿‡æ¥åˆä¼šé˜»æ­¢å…¶ä»–ä»»åŠ¡çš„å¤„ç†ã€‚ä½†æ˜¯ï¼Œåˆ‡æ¢åˆ° tokio::sync::Mutex é€šå¸¸æ²¡æœ‰å¸®åŠ©ï¼Œå› ä¸ºå¼‚æ­¥ mutex åœ¨å†…éƒ¨ä½¿ç”¨åŒæ­¥ mutexã€‚æ ¹æ®ç»éªŒï¼Œåªè¦äº‰ç”¨ç‡ä¿æŒåœ¨ä½ä½ä¸”æœªåœ¨ .await ä¸­ä¸Šé”ï¼Œå³å¯ä»å¼‚æ­¥ mutex å†…ä½¿ç”¨åŒæ­¥ mutex å³å¯ã€‚æ­¤å¤–ï¼Œè€ƒè™‘ä½¿ç”¨ parking_lot::Mutex ä½œä¸º std::sync::Mutex çš„æ›´å¿«çš„æ›¿ä»£æ–¹æ³•ã€‚ ä½¿ç”¨ tokio å¼‚æ­¥ mutexã€‚ usetokio::sync::Mutex;asyncfn increment_and_do_stuff(mutex: \u0026Mutex\u003ci32\u003e){letmutlock=mutex.lock().await;*lock+=1;}#[tokio::main]asyncfn main(){letm=Mutex::new(1);increment_and_do_stuff(\u0026m).await;println!(\"GOT {:?}\",m);} ","date":"2021-09-12","objectID":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/:4:0","tags":["rust"],"title":"Tokio åˆå°è¯•","uri":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/"},{"categories":["å¼€å‘"],"content":"sync tokio æä¾›ä»¥ä¸‹å‡ ç§ channels ç±»å‹: mpsc: å¤šç”Ÿäº§è€…ï¼Œå•æ¶ˆè´¹è€…ã€‚ oneshot: å•ç”Ÿäº§è€…ï¼Œå•æ¶ˆè´¹è€…ã€‚ broadcast: å¤šç”Ÿäº§è€…ï¼Œå¤šæ¶ˆè´¹è€…ã€‚ watch: å•ç”Ÿäº§è€…ï¼Œå¤šæ¶ˆè´¹è€…ã€‚ ","date":"2021-09-12","objectID":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/:5:0","tags":["rust"],"title":"Tokio åˆå°è¯•","uri":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/"},{"categories":["å¼€å‘"],"content":"mpsc tokio::spawn ä¸­ä½¿ç”¨ Sender ä¼šè½¬ç§»ç”Ÿå‘½å‘¨æœŸæ—¶ï¼Œéœ€è¦è°ƒç”¨ clone() å…‹éš†ä¸€ä»½ã€‚ usetokio::sync::mpsc;#[tokio::main]asyncfn main(){let(tx,mutrx)=mpsc::channel(32);lettx2=tx.clone();tokio::spawn(asyncmove{let_=tx.send(\"sending from first handle\").await;});tokio::spawn(asyncmove{let_=tx2.send(\"sending from second handle\").await;});ifletSome(message)=rx.recv().await{println!(\"GOT = {}\",message);}} Receiver åœ¨ä½œç”¨åŸŸç»“æŸæ—¶ï¼Œè°ƒç”¨ close() æ–¹æ³•ã€‚ ","date":"2021-09-12","objectID":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/:5:1","tags":["rust"],"title":"Tokio åˆå°è¯•","uri":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/"},{"categories":["å¼€å‘"],"content":"oneshot usetokio::sync::oneshot;#[tokio::main]asyncfn main(){let(tx,rx)=oneshot::channel::\u003ci32\u003e();tokio::spawn(asyncmove{if!tx.is_closed(){let_=tx.send(3);}});matchrx.await{Ok(v)=\u003eprintln!(\"got = {:?}\",v),Err(e)=\u003eprintln!(\"the sender dropped: {}\",e),}} ","date":"2021-09-12","objectID":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/:5:2","tags":["rust"],"title":"Tokio åˆå°è¯•","uri":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/"},{"categories":["å¼€å‘"],"content":"broadcast usetokio::sync::broadcast;#[tokio::main]asyncfn main(){let(tx,mutrx1)=broadcast::channel(16);letmutrx2=tx.subscribe();tokio::spawn(asyncmove{assert_eq!(rx1.recv().await.unwrap(),10);assert_eq!(rx1.recv().await.unwrap(),20);});tokio::spawn(asyncmove{assert_eq!(rx2.recv().await.unwrap(),10);assert_eq!(rx2.recv().await.unwrap(),20);});tx.send(10).unwrap();tx.clone().send(20).unwrap();} ","date":"2021-09-12","objectID":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/:5:3","tags":["rust"],"title":"Tokio åˆå°è¯•","uri":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/"},{"categories":["å¼€å‘"],"content":"watch usetokio::sync::watch;#[tokio::main]asyncfn main(){let(tx,mutrx)=watch::channel(\"\");tokio::spawn(asyncmove{tx.send(\"world\").unwrap();});whilerx.changed().await.is_ok(){println!(\"received = {:?}\",*rx.borrow());}} ","date":"2021-09-12","objectID":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/:5:4","tags":["rust"],"title":"Tokio åˆå°è¯•","uri":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/"},{"categories":["å¼€å‘"],"content":"I/O tokio ä¸­çš„ I/O æ“ä½œå’Œæ ‡å‡†åº“ä¸­ä¸€è‡´ï¼Œåªæ˜¯å¼‚æ­¥åŒ–äº†ã€‚å®ƒå†…éƒ¨æä¾›ä¸€ä¸ªè¯»ç‰¹æ€§(AsyncRead)å’Œä¸€ä¸ªå†™ç‰¹æ€§(AsyncWrite)ã€‚å¹¶æä¾›å®ç°è¿™ä¸ªç‰¹æ€§çš„ç»“æ„(TcpStream, File, Stdout)ã€‚ ","date":"2021-09-12","objectID":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/:6:0","tags":["rust"],"title":"Tokio åˆå°è¯•","uri":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/"},{"categories":["å¼€å‘"],"content":"å¼‚æ­¥è¯»å†™ è¿™ä¸¤ä¸ªç‰¹å¾æä¾›äº†å¼‚æ­¥è¯»å–å’Œå†™å­—èŠ‚æµçš„è®¾æ–½ã€‚è¿™äº›ç‰¹å¾ä¸Šçš„æ–¹æ³•é€šå¸¸ä¸æ˜¯ç›´æ¥è°ƒç”¨çš„ã€‚ç›¸åï¼Œæ‚¨å°†é€šè¿‡ AsyncReadExt å’Œ AsyncWriteExt æä¾›çš„å®ç”¨æ–¹æ³•ä½¿ç”¨å®ƒä»¬ã€‚ å½“ read() è¿”å› Ok(0) æ—¶ï¼Œè¿™æ„å‘³ç€æµå·²å…³é—­ã€‚ä»»ä½•è¿›ä¸€æ­¥çš„è°ƒç”¨ read() å°†ç«‹å³è¿”å› Ok(0)ã€‚å¯¹äº TcpStream è¿æ¥ï¼Œè¿™æ„å‘³ç€è¯»å– socket å·²å…³é—­ã€‚ usestd::str;usetokio::fs::File;usetokio::io::{self,AsyncReadExt,AsyncWriteExt};#[tokio::main]asyncfn main()-\u003e io::Result\u003c()\u003e{{letmutff=File::create(\"foo.txt\").await?;ff.write_all(b\"hello world\").await?;}letmutf=File::open(\"foo.txt\").await?;letmutbuffer=[0;20];// read up to 10 bytes letn=f.read(\u0026mutbuffer[..]).await?;println!(\"The bytes: {:?}\",str::from_utf8(\u0026buffer[..n]).unwrap());Ok(())} AsyncReadExt::read_to_end å°†ä¸­æµä¸­è¯»å–æ‰€æœ‰å­—èŠ‚ç›´åˆ° EOF (æ–‡ä»¶ç»“å°¾æ ‡è¯†ç¬¦)ã€‚ #[tokio::main]asyncfn main()-\u003e io::Result\u003c()\u003e{letmutf=File::open(\"foo.txt\").await?;letmutbuffer=Vec::new();// read the whole file f.read_to_end(\u0026mutbuffer).await?;Ok(())} ","date":"2021-09-12","objectID":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/:6:1","tags":["rust"],"title":"Tokio åˆå°è¯•","uri":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/"},{"categories":["å¼€å‘"],"content":"io::copy tokio æä¾› tokoio::io æ¨¡å—ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ç³»åˆ—æœ‰ç”¨çš„æ–¹æ³•ã€‚ä¾‹å¦‚ tokio::io::copy å¼‚æ­¥ç‰ˆæœ¬çš„ io å¤åˆ¶ã€‚ usetokio::fs::File;usetokio::io;#[tokio::main]asyncfn main()-\u003e io::Result\u003c()\u003e{letmutreader: \u0026[u8]=b\"hello\";letmutfile=File::create(\"foo.txt\").await?;io::copy(\u0026mutreader,\u0026mutfile).await?;Ok(())} ä½¿ç”¨å­—èŠ‚æ•°ç»„ä¹Ÿè¦å®ç° AsyncReadã€‚ ","date":"2021-09-12","objectID":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/:6:2","tags":["rust"],"title":"Tokio åˆå°è¯•","uri":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/"},{"categories":["å¼€å‘"],"content":"io::split io::split èƒ½å¤Ÿä»æ‹†åˆ† reader å’Œ writer ç±»å‹ usetokio::{io::{self,AsyncReadExt,AsyncWriteExt},net::TcpStream};#[tokio::main]asyncfn main()-\u003e io::Result\u003c()\u003e{letsocket=TcpStream::connect(\"127.0.0.1:6142\").await?;let(mutrd,mutwr)=io::split(socket);letwrite_task=tokio::spawn(asyncmove{wr.write_all(b\"hello\\r\\n\").await?;wr.write_all(b\"world\\r\\n\").await?;Ok::\u003c_,io::Error\u003e(())});letmutbuf=vec![0;128];loop{letn=rd.read(\u0026mutbuf).await?;ifn==0{break;}println!(\"GOT {:?}\",\u0026buf[..n]);}Ok(())} ","date":"2021-09-12","objectID":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/:6:3","tags":["rust"],"title":"Tokio åˆå°è¯•","uri":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/"},{"categories":["å¼€å‘"],"content":"æ‰‹åŠ¨ coping ä½¿ç”¨ AsyncReadExt::read å’Œ AsyncWriteExt::write_all å®ç°æ•°æ®æ‹·è´: usetokio::{io::{self,AsyncReadExt,AsyncWriteExt},net::TcpListener,};#[tokio::main]asyncfn main()-\u003e io::Result\u003c()\u003e{letlistener=TcpListener::bind(\"127.0.0.1:6142\").await?;loop{let(mutsocket,_)=listener.accept().await?;tokio::spawn(asyncmove{letmutbuf=vec![0;1024];loop{matchsocket.read(\u0026mutbuf).await{// è¿”å› Ok(0) è¡¨ç¤º socket è¿æ¥å·²æ–­å¼€ Ok(0)=\u003ereturn,Ok(n)=\u003e{// æ•°æ®å†™å…¥ ifsocket.write_all(\u0026buf[..n]).await.is_err(){// é”™è¯¯è¿”å› return;}}Err(_)=\u003e{// å¤„ç†é”™è¯¯ return;}}}});}} å¿˜è®°ä»è¯»å–å¾ªç¯ä¸­ break é€šå¸¸ä¼šå¯¼è‡´ 100% CPU æ— é™å¾ªç¯æƒ…å†µã€‚å½“ socket å…³é—­æ—¶ï¼Œsocket.read() ä¼šç›´æ¥è¿”å›ã€‚å¾ªç¯ç„¶åæ°¸è¿œé‡å¤ã€‚ ","date":"2021-09-12","objectID":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/:6:4","tags":["rust"],"title":"Tokio åˆå°è¯•","uri":"/tokio%E5%88%9D%E5%B0%9D%E8%AF%95/"},{"categories":["ç¬”è®°"],"content":"ä¸€ã€è®¡ç®—æœºç³»ç»Ÿæ¼«æ¸¸ è®¡ç®—æœºç³»ç»Ÿæ˜¯ç”±ç¡¬ä»¶å’Œè½¯ä»¶ç»„æˆã€‚ ","date":"2021-08-31","objectID":"/csapp/:1:0","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"1.1 ä¿¡æ¯å°±æ˜¯ä½ + ä¸Šä¸‹æ–‡ ç³»ç»Ÿä¸­æ‰€æœ‰çš„ä¿¡æ¯â€”â€”åŒ…æ‹¬ç£ç›˜æ–‡ä»¶ã€å†…å­˜ä¸­çš„ç¨‹åºã€å†…å­˜ä¸­å­˜æ”¾çš„ç”¨æˆ·æ•°æ®ä»¥åŠç½‘ç»œä¸Šä¼ é€çš„æ•°æ®ï¼Œéƒ½æ˜¯ç”±ä¸€ä¸² bit è¡¨ç¤ºçš„ã€‚åŒºåˆ†ä¸åŒæ•°æ®å¯¹è±¡çš„å”¯ä¸€æ–¹æ³•æ˜¯æˆ‘ä»¬è¯»åˆ°è¿™äº›æ•°æ®å¯¹è±¡æ˜¯çš„ä¸Šä¸‹æ–‡ã€‚ ","date":"2021-08-31","objectID":"/csapp/:1:1","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"1.2 ç¨‹åºè¢«å…¶ä»–ç¨‹åºç¿»è¯‘æˆä¸åŒçš„æ ¼å¼ ","date":"2021-08-31","objectID":"/csapp/:1:2","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"1.3 äº†è§£ç¼–è¯‘ç³»ç»Ÿå¦‚ä½•å·¥ä½œæ˜¯å¤§æœ‰ç›Šå¤„çš„ ä¸ºä»€ä¹ˆç¨‹åºå‘˜å¿…é¡»è¦çŸ¥é“ç¼–è¯‘ç³»ç»Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„? ä¼˜åŒ–ç¨‹åºæ€§èƒ½ã€‚ ç†è§£é“¾æ¥æ—¶å‡ºç°çš„é”™è¯¯ã€‚ é¿å…å®‰å…¨æ¼æ´ã€‚ ","date":"2021-08-31","objectID":"/csapp/:1:3","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"1.4 å¤„ç†å™¨è¯»å¹¶è§£é‡Šå‚¨å­˜åœ¨å†…å­˜ä¸­æŒ‡ä»¤ ç³»ç»Ÿç¡¬ä»¶ç»„æˆ æ€»çº¿: è´¯ç©¿æ•´ä¸ªç³»ç»Ÿçš„ä¸€ç»„ç”µå­ç®¡é“ï¼Œç§°ä½œæ€»çº¿ï¼Œä»–æºå¸¦ä¿¡æ¯å­—èŠ‚å¹¶è´Ÿè´£åœ¨å„ä¸ªéƒ¨ä»¶é—´ä¼ é€’ã€‚ I/O è®¾å¤‡: ç³»ç»Ÿä¸å¤–éƒ¨ä¸–ç•Œçš„è”ç³»é€šé“ã€‚æ¯ä¸ª I/O è®¾å¤‡éƒ½é€šè¿‡ä¸€ä¸ªæ§åˆ¶å™¨æˆ–è€…é€‚é…å™¨ä¸ I/O æ€»çº¿ç›¸è¿ã€‚æ§åˆ¶å™¨å’Œé€‚é…å™¨ä¹‹é—´çš„åŒºåˆ«ä¸»è¦åœ¨äºå®ƒä»¬çš„å°è£…æ–¹å¼ã€‚æ§åˆ¶å™¨æ˜¯ I/O è®¾å¤‡æœ¬èº«æˆ–è€…ç³»ç»Ÿçš„ä¸»å°åˆ¶ç”µè·¯æ¿ä¸Šçš„èŠ¯ç‰‡ç»„ã€‚è€Œé€‚é…å™¨åˆ™æ˜¯ä¸€å—æ’åœ¨ä¸»æ¿æ’æ§½ä¸Šçš„å¡ã€‚ ä¸»å­˜: ä¸»å­˜æ˜¯ä¸€ä¸ªä¸´æ—¶å­˜å‚¨è®¾å¤‡ï¼Œåœ¨å¤„ç†æ‰§è¡Œç¨‹åºæ—¶ï¼Œç”¨æ¥å­˜æ”¾ç¨‹åºå’Œç¨‹åºå¤„ç†çš„æ•°æ®ã€‚ä»ç‰©ç†ä¸Šæ¥è¯´ï¼Œä¸»å­˜æ˜¯ç”±ä¸€ç»„åŠ¨æ€éšæœºå­˜å‚¨å­˜å‚¨å™¨ (DRAM) èŠ¯ç‰‡ç»„æˆçš„ã€‚ä»é€»è¾‘ä¸Šæ¥è¯´ï¼Œå­˜å‚¨å™¨æ˜¯ä¸€ä¸ªçº¿æ€§çš„å­—èŠ‚æ•°ç»„ï¼Œæ¯ä¸ªå­—èŠ‚éƒ½æœ‰å…¶å”¯ä¸€çš„åœ°å€(æ•°ç»„ç´¢å¼•)ï¼Œè¿™äº›åœ°å€æ˜¯ä»é›¶å¼€å§‹çš„ã€‚ å¤„ç†å™¨ï¼šä¸­å¤®å¤„ç†å•å…ƒ (CPU)ï¼Œç®€ç§°å¤„ç†å™¨ï¼Œæ˜¯è§£é‡Š(æˆ–)æ‰§è¡Œå­˜å‚¨åœ¨ä¸»å­˜ä¸­æŒ‡ä»¤çš„å¼•æ“ã€å¤„ç†å™¨çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªå¤§å°ä¸ä¸€ä¸ªå­—çš„å­˜å‚¨è®¾å¤‡(æˆ–å¯„å­˜å™¨)ï¼Œç§°ä¸ºç¨‹åºè®¡æ•°å™¨(PC)ã€‚åœ¨ä»»ä½•æ—¶åˆ»ï¼ŒPC éƒ½æŒ‡å‘ä¸»å­˜ä¸­çš„æŸæ¡æœºå™¨è¯­è¨€æŒ‡ä»¤ã€‚ ç³»ç»Ÿæ‰§è¡Œä¸€ä¸ª Hello World ç¨‹åºæ—¶ï¼Œç¡¬ä»¶è¿è¡Œæµç¨‹ã€‚ é”®ç›˜è¾“å…¥å‘½ä»¤æ—¶ï¼Œshell ç¨‹åºå°†å­—ç¬¦é€ä¸€è¯»å…¥å¯„å­˜å™¨ï¼Œå†å­˜æ”¾åˆ°å†…å­˜ä¸­ã€‚ é”®å…¥å›è½¦é”®åï¼Œshell æ‰§è¡Œä¸€ç³»åˆ—æŒ‡ä»¤æ¥åŠ è½½å¯æ‰§è¡Œçš„ hello æ–‡ä»¶ï¼Œå°† hello ç›®æ ‡æ–‡ä»¶ä¸­çš„ä»£ç å’Œæ•°æ®ä»ç£ç›˜å¤åˆ¶åˆ°å†…å­˜ã€‚ å¤„ç†å™¨å¼€å§‹æ‰§è¡Œ hello ç¨‹åº main ç¨‹åºä¸­çš„æœºå™¨è¯­è¨€æŒ‡ä»¤ã€‚ è¿™äº›æŒ‡ä»¤å°†è¾“å‡ºçš„å­—ç¬¦ä¸²ä¸­çš„å­—èŠ‚ä»ä¸»å­˜å¤åˆ¶åˆ°å¯„å­˜å™¨æ–‡ä»¶ï¼Œå†ä»å¯„å­˜å™¨æ–‡ä»¶ä¸­å¤åˆ¶åˆ°æ˜¾ç¤ºè®¾å¤‡ï¼Œæœ€ç»ˆæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚ ","date":"2021-08-31","objectID":"/csapp/:1:4","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"1.5 é«˜é€Ÿç¼“å­˜è‡³å…³é‡è¦ ç³»ç»Ÿè¿è¡Œæ—¶ä¼šé¢‘ç¹çš„æŒªåŠ¨ä¿¡æ¯ï¼Œè€Œä¸åŒå­˜å‚¨è®¾å¤‡ä¹‹é—´çš„è¯»å†™æ€§èƒ½æœ‰ä¸¥é‡åå·® (ä»å¯„å­˜å™¨ä¸­è¯»å–æ•°æ®æ¯”ä»ä¸»å­˜ä¸­è¯»å–å¿« 100 è¢«ï¼Œä»ä¸»å­˜ä¸­è¯»å–åˆæ¯”ç£ç›˜ä¸­å¿« 1000 ä¸‡å€)ã€‚æ‰€ä»¥ä¸åŒå­˜å‚¨è®¾å¤‡é—´éœ€è¦é«˜é€Ÿç¼“å­˜æ¥æä¾›ç³»ç»Ÿè¿è¡Œé€Ÿåº¦ã€‚ è¿™é‡Œçš„é«˜é€Ÿç¼“å­˜æ˜¯ç›¸å¯¹æ¦‚å¿µã€‚ ","date":"2021-08-31","objectID":"/csapp/:1:5","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"1.6 å­˜å‚¨è®¾å¤‡å½¢æˆå±‚æ¬¡ç»“æ„ ","date":"2021-08-31","objectID":"/csapp/:1:6","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"1.7 æ“ä½œç³»ç»Ÿç®¡ç†ç¡¬ä»¶ æˆ‘ä»¬å¹¶ä¸ç›´æ¥è®¿é—®ç¡¬ä»¶ï¼Œè€Œæ˜¯é€šè¿‡æ“ä½œç³»ç»Ÿã€‚æ‰€æœ‰åº”ç”¨ç¨‹åºå¯¹ç¡¬ä»¶çš„æ“ä½œå°è¯•éƒ½å¿…é¡»é€šè¿‡æ“ä½œç³»ç»Ÿã€‚ æ“ä½œç³»ç»Ÿæœ‰ä¸¤ä¸ªåŸºæœ¬åŠŸèƒ½: é˜²æ­¢ç¡¬ä»¶è¢«å¤±æ§çš„åº”ç”¨ç¨‹åºæ»¥ç”¨ã€‚ å‘åº”ç”¨ç¨‹åºæä¾›ç®€å•ä¸€è‡´çš„æœºåˆ¶æ¥æ§åˆ¶å¤æ‚è€Œåˆé€šå¸¸ä¸å¤§ç›¸åŒçš„ä½çº§ç¡¬ä»¶è®¾å¤‡ã€‚ æ“ä½œç³»ç»Ÿé€šè¿‡å‡ ä¸ªåŸºæœ¬æŠ½è±¡æ¦‚å¿µæ¥å®ç°è¿™ä¸¤ä¸ªåŠŸèƒ½ã€‚ è¿›ç¨‹: æ“ä½œç³»ç»Ÿå¯¹ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„ä¸€ç§æŠ½è±¡ã€‚ ä¸Šä¸‹æ–‡: æ“ä½œç³»ç»Ÿä¿æŒè·Ÿè¸ªè¿›ç¨‹è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰çŠ¶æ€ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…å« PC å’Œå¯„å­˜å™¨æ–‡ä»¶çš„å½“å‰å€¼ï¼Œä»¥åŠä¸»å­˜çš„å†…å­˜ã€‚ åœ¨ä»»ä½•ä¸€ä¸ªæ—¶åˆ»ï¼Œå•å¤„ç†å™¨ç³»ç»Ÿéƒ½åªèƒ½æ‰§è¡Œä¸€ä¸ªè¿›ç¨‹çš„ä»£ç ã€‚å½“æ“ä½œç³»ç»Ÿå†³å®šè¦æŠŠæ§åˆ¶æƒä»å½“å‰è¿›ç¨‹è½¬ç§»åˆ°æŸä¸ªæ–°è¿›ç¨‹æ—¶ï¼Œå°±ä¼šè¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚è¿™ä¸€è¿‡ç¨‹æœ‰æ“ä½œç³»ç»Ÿå†…æ ¸ (kernel) ç®¡ç†ã€‚ çº¿ç¨‹: ç°ä»£æ“ä½œç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªè¿›ç¨‹å®é™…ä¸Šå¯ä»¥ç”±å¤šä¸ªç§°ä¸ºçº¿ç¨‹çš„æ‰§è¡Œå•å…ƒç»„æˆï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½è£•å…´åœ¨è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå¹¶å…±äº«åŒæ ·çš„ä»£ç å’Œå…¨å±€æ•°æ®ã€‚ è™šæ‹Ÿæœºå†…å­˜æ˜¯ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå®ƒä¸ºæ¯ä¸ªè¿›ç¨‹æä¾›ä¸€ä¸ªå‡è±¡ï¼Œå³æ¯ä¸ªè¿›ç¨‹éƒ½åœ¨ç‹¬å åœ°ä½¿ç”¨ä¸»å­˜ï¼Œæ¯ä¸ªè¿›ç¨‹çœ‹åˆ°çš„å†…å­˜éƒ½æ˜¯ä¸€è‡´çš„ï¼Œç§°ä¸ºè™šæ‹Ÿåœ°å€ç©ºé—´ã€‚ è™šæ‹Ÿåœ°å€ç©ºé—´ä»ä¸‹è‡³ä¸Šä¾æ¬¡ä¸º: ç¨‹åºä»£ç å’Œæ•°æ®ã€‚å¯¹æ‰€æœ‰çš„è¿›ç¨‹æ¥è¯´ï¼Œä»£ç æ˜¯ä»åŒä¸€å›ºå®šåœ°å€å¼€å§‹ï¼Œç´§æ¥ç€çš„æ˜¯å’Œ C å…¨å±€å˜é‡ç›¸å¯¹åº”çš„æ•°æ®ä½ç½®ã€‚ä»£ç å’Œæ•°æ®åŒºæ˜¯ç›´æ¥æŒ‰ç…§å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶çš„å†…å®¹åˆå§‹åŒ–çš„ã€‚ å †ã€‚å †å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æ‰©å±•å’Œæ”¶ç¼©ã€‚ å…±äº«åº“ã€‚å­˜æ”¾ C æ ‡å‡†åº“å’Œæ•°å­¦åº“è¿™äº›å…±äº«åº“çš„ä»£ç å’Œæ•°æ®ã€‚ æ ˆã€‚ä½äºç”¨æˆ·è™šæ‹Ÿåœ°å€ç©ºé—´é¡¶éƒ¨ï¼Œç¼–è¯‘å™¨ç”¨å®ƒæ¥å®ç°å‡½æ•°è°ƒç”¨ï¼Œå®ƒå’Œå †ä¸€æ ·åœ¨ç¨‹åºè¿è¡ŒæœŸé—´å¯ä»¥åŠ¨æ€åœ°æ‰©å±•å’Œæ”¶ç¼©ã€‚æ¯æ¬¡è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œæ ˆå°±ä¼šå¢é•¿ï¼Œä»ä¸€ä¸ªå‡½æ•°è¿”å›æ—¶ï¼Œæ ˆå°±ä¼šæ”¶ç¼©ã€‚ å†…æ ¸è™šæ‹Ÿå†…å­˜ã€‚åœ°å€ç©ºé—´é¡¶éƒ¨çš„åŒºåŸŸæ˜¯ä¸ºå†…æ ¸ä¿ç•™çš„ã€‚ä¸å…è®¸åº”ç”¨ç¨‹åºè¯»å†™è¿™ä¸ªåŒºåŸŸçš„å†…å®¹æˆ–è€…ç›´æ¥è°ƒç”¨å†…æ ¸ä»£ç å®šä¹‰çš„å‡½æ•°ã€‚ç›¸åï¼Œä»–ä»¬å¿…é¡»è°ƒç”¨å†…æ ¸æ¥æ‰§è¡Œè¿™äº›æ“ä½œã€‚ æ–‡ä»¶å°±æ˜¯å­—èŠ‚åºåˆ—ï¼æ¯ä¸ª I/O è®¾å¤‡ï¼ŒåŒ…æ‹¬ç£ç›˜ã€é”®ç›˜ã€æ˜¾ç¤ºå™¨ï¼Œç”šè‡³ç½‘ç»œï¼Œéƒ½å¯ä»¥çœ‹æˆæ–‡ä»¶ã€‚ ","date":"2021-08-31","objectID":"/csapp/:1:7","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"1.8 ç³»ç»Ÿä¹‹é—´åˆ©ç”¨ç½‘ç»œé€šä¿¡ ç¡¬ä»¶å’Œè½¯ä»¶ç»„åˆæˆä¸€ä¸ªç³»ç»Ÿï¼Œè€Œé€šè¿‡ç½‘ç»œé—´ä¸åŒçš„ä¸»æœºè¿æ¥æˆä¸€ä¸ªæ›´å¹¿å¤§çš„ç°ä»£ç³»ç»Ÿã€‚ ","date":"2021-08-31","objectID":"/csapp/:1:8","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"1.9 é‡è¦ä¸»é¢˜ å¹¶å‘ (concurrency): ä¸€ä¸ªåŒæ—¶å…·æœ‰å¤šä¸ªæ´»åŠ¨çš„ç³»ç»Ÿã€‚ å¹¶è¡Œ (parallelism): ç”¨å¹¶å‘æ¥æ˜¯ä¸€ä¸ªç³»ç»Ÿè¿è¡Œå¾—æ›´å¿«ã€‚ è¶…çº¿ç¨‹ï¼šæœ‰æ—¶ç§°ä¸ºåŒæ—¶å¤šçº¿ç¨‹ (simultaneous multi-threading)ï¼Œæ˜¯ä¸€é¡¹å…è®¸ä¸€ä¸ª CPU æ‰§è¡Œå¤šä¸ªæ§åˆ¶æµçš„æŠ€æœ¯ã€‚ æŠ½è±¡çš„ä½¿ç”¨æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­æœ€ä¸ºé‡è¦çš„æ¦‚å¿µä¹‹ä¸€ã€‚è¿™é‡Œä»‹ç»å››ä¸ªæŠ½è±¡: æ–‡ä»¶æ˜¯å¯¹ I/O è®¾å¤‡çš„æŠ½è±¡ã€‚ è™šæ‹Ÿå†…å­˜æ˜¯å¯¹ç¨‹åºå­˜å‚¨å™¨çš„æŠ½è±¡ã€‚ è¿›ç¨‹æ˜¯å¯¹ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„æŠ½è±¡ã€‚ è™šæ‹Ÿæœºæ˜¯å¯¹æ•´ä¸ªè®¡ç®—æœºçš„æŠ½è±¡ã€‚ ","date":"2021-08-31","objectID":"/csapp/:1:9","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"ä¸‰ã€ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º ","date":"2021-08-31","objectID":"/csapp/:2:0","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"3.1 å†å²è§‚ç‚¹ Intel å¤„ç†å™¨ç³»åˆ—ä¿—ç§° x86ã€‚ æ‘©å°”å®šå¾‹: 1965 å¹´ï¼Œ Gordon Moore, Intel å…¬å¸çš„åˆ›å§‹äººæ ¹æ®å½“æ—¶çš„èŠ¯ç‰‡æŠ€æœ¯åšå‡ºæ¨æ–­ï¼Œé¢„æµ‹åœ¨æœªæ¥ 10 å¹´ï¼ŒèŠ¯ç‰‡ä¸Šçš„æ™¶ä½“ç®¡æ•°é‡æ¯å¹´éƒ½ä¼šç¿»ä¸€ç•ªã€‚è¿™ä¸ªé¢„æµ‹å°±æˆä¸ºæ‘©å°”å®šå¾‹ã€‚ ","date":"2021-08-31","objectID":"/csapp/:2:1","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"3.2 ç¨‹åºç¼–ç  æœºå™¨çº§ç¼–ç¨‹é‡è¦çš„ä¸¤ç§æŠ½è±¡: ç”±æŒ‡ä»¤çº§ä½“ç³»ç»“æ„æˆ–æŒ‡ä»¤é›†æ¶æ„(Instruction Set Architecture, ISA) æ¥å®šä¹‰æœºå™¨çº§ç¨‹åºçš„æ ¼å¼å’Œè¡Œä¸ºï¼Œå®ƒå®šä¹‰äº†å¤„ç†å™¨çŠ¶æ€ã€æŒ‡ä»¤çš„æ ¼å¼ï¼Œä»¥åŠæ¯æ¡æŒ‡ä»¤å¯¹çŠ¶æ€çš„å½±å“ã€‚ æœºå™¨çº§ç¨‹åºä½¿ç”¨çš„å†…å­˜åœ°å€æ˜¯è™šæ‹Ÿåœ°å€ï¼Œæä¾›çš„å†…å­˜æ¨¡å‹çœ‹ä¸Šå»æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„å­—èŠ‚æ•°ç»„ã€‚ æ±‡ç¼–ä»£ç éå¸¸æ¥è¿‘äºæœºå™¨ä»£ç ï¼Œå®ƒçš„ä¸»è¦ç‰¹ç‚¹æ˜¯å®ƒç”¨å¯è¯»æ€§æ›´å¥½çš„æ–‡æœ¬æ ¼å¼è¡¨ç¤ºã€‚ ç¨‹åºå†…å­˜åŒ…å«ï¼šç¨‹åºçš„å¯æ‰§è¡Œæœºå™¨ä»£ç ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦çš„ä¸€äº›ä¿¡æ¯ï¼Œç”¨æ¥ç®¡ç†è¿‡ç¨‹è°ƒç”¨å’Œè¿”å›çš„è¿è¡Œæ—¶æ ˆï¼Œä»¥åŠç”¨æˆ·åˆ†é…çš„å†…å­˜å—ã€‚ ä¸€æ¡æœºå™¨æŒ‡ä»¤åªèƒ½æ‰§è¡Œä¸€ä¸ªéå¸¸åŸºæœ¬çš„æ“ä½œã€‚ ","date":"2021-08-31","objectID":"/csapp/:2:2","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"3.3 æ•°æ®æ ¼å¼ Intel ä¸­æ•°æ®æ ¼å¼ï¼š å­— word: è¡¨ç¤º 16 ä½æ•°æ®ç±»å‹ åŒå­— double words: 32 ä½æ•° å››å­— qoad words: 64 ä½æ•° C è¯­è¨€æ•°æ®ç±»å‹åœ¨ x86-64 ä¸­çš„å¤§å°ã€‚åœ¨ 64 ä¸ºæœºå™¨ä¸­ï¼ŒæŒ‡é’ˆé•¿ 8 å­—èŠ‚ã€‚ å¤§å¤šæ•°GCCç”Ÿæˆçš„æ±‡ç¼–ä»£ç æŒ‡ä»¤éƒ½æœ‰ä¸€ä¸ªå­—ç¬¦çš„åç¼€ï¼Œè¡¨æ˜æ“ä½œæ•°çš„å¤§å°ã€‚ä¾‹å¦‚ã€‚æ•°æ®ä¼ é€æŒ‡ä»¤æœ‰å››ä¸ªå˜ç§ï¼š movb: ä¼ é€å­—èŠ‚ movw: ä¼ é€å­— movl: ä¼ é€åŒå­— movq: ä¼ é€å››å­— ","date":"2021-08-31","objectID":"/csapp/:2:3","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"3.4 è®¿é—®ä¿¡æ¯ ä¸€ä¸ª x86-64 çš„ä¸­å¤®å¤„ç†å•å…ƒ CPU åŒ…å«ä¸€ç»„ 16 ä¸ªå­˜å‚¨ 64 ä½å€¼çš„é€šç”¨ç›®çš„å¯„å­˜å™¨ï¼Œè¿™äº›å¯„å­˜å™¨ç”¨æ¥å­˜å‚¨æ•´æ•°æ•°æ®å’ŒæŒ‡é’ˆã€‚ å…³äºå¯„å­˜å™¨çš„è¯´æ˜å¯ä»¥å‚è€ƒ: X86-64 å¯„å­˜å™¨å’Œæ ˆå¸§ x86_64 å¯„å­˜å™¨ä»‹ç» å¤§å¤šæ•°æŒ‡ä»¤æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ“ä½œæ•°(operand)ï¼ŒæŒ‡ç¤ºå‡ºæ‰§è¡Œä¸€ä¸ªæ“ä½œä¸­è¦ä½¿ç”¨åˆ°çš„æºæ•°æ®å€¼ï¼Œä»¥åŠæ”¾ç½®ç»“æœçš„ç›®çš„ä½ç½®ã€‚ å­˜æ”¾æ“ä½œæ•°çš„ç±»å‹ï¼š ç«‹å³æ•°(immediate)ï¼Œç”¨æ¥è¡¨ç¤ºå¸¸æ•°å€¼ã€‚æ ¼å¼æ˜¯ â€˜$â€™ åé¢è·Ÿä¸€ä¸ªæ ‡å‡† C è¡¨ç¤ºæ³•è¡¨ç¤ºçš„æ•´æ•°ã€‚æ¯”å¦‚ $-577æˆ–$0x1Fã€‚ å¯„å­˜å™¨(register)ï¼Œå®ƒè¡¨ç¤ºæŸä¸ªå¯„å­˜å™¨çš„å†…å®¹ï¼Œç”¨ç¬¦å· $R_a$ è¡¨ç¤ºã€‚ å†…å­˜å¼•ç”¨ï¼Œå®ƒä¼šæ ¹æ®è®¡ç®—å‡ºæ¥çš„åœ°å€(é€šå¸¸ç§°ä¸ºæœ‰æ•ˆåœ°å€)è®¿é—®æŸä¸ªå†…å­˜ä½ç½®ã€‚ä½¿ç”¨ $M_b$[Addr] è¡¨ç¤ºå¯¹å­˜å‚¨åœ¨å†…å­˜ä¸­ä» Addr å¼€å§‹çš„ b ä¸ªå­—èŠ‚å€¼çš„å¼•ç”¨ã€‚ å¤šç§ä¸åŒçš„å¯»å€æ–¹å¼ï¼Œå…è®¸ä¸åŒå½¢å¼çš„å†…å­˜å¼•ç”¨ã€‚ Imm($r_b$, $r_i$, s) : ä¸€ä¸ªç«‹å³æ•°åç§» Immï¼Œä¸€ä¸ªåŸºå€å¯„å­˜å™¨ $r_b$ï¼Œä¸€ä¸ªå˜å€å¯„å­˜å™¨ $r_i$ å’Œä¸€ä¸ªæ¯”ä¾‹å› å­ sï¼Œs å¿…é¡»æ˜¯ 1ã€2ã€4ã€8ã€‚åŸºå€å’Œå˜å€å¯„å­˜å™¨éƒ½å¿…é¡»æ˜¯ 64 ä½å¯„å­˜å™¨ã€‚æœ‰æ•ˆåœ°å€ä¸º Imm+R[$r_b$]+R[$r_i$]*sã€‚ è®¡ç®—é¢˜: æœ‰ä»¥ä¸‹å†…å­˜åœ°å€å’Œå¯„å­˜å™¨çš„å€¼: å¾—å‡ºä»¥ä¸‹æ“ä½œæ•°çš„å€¼: æ“ä½œæ•° å€¼ æ³¨é‡Š %rax 0x100 å¯„å­˜å™¨ 0x104 0xAB ç»å¯¹åœ°å€ $0x108 0x108 ç«‹å³æ•° (%rax) 0xFF åœ°å€ 0x100 4(%rax) 0xAB åœ°å€ 0x104 9(%rax,%rdx) 0x11 åœ°å€ 0x10C 260(%rax,%rdx) 0x13 åœ°å€ 0x108 OxFC(,%rcx,4) 0xFF åœ°å€ 0x100 (%rax,%rdx,4) 0x11 åœ°å€ 0x10C æ•°æ®ä¼ é€æŒ‡ä»¤: å°†æ•°æ®ä»ä¸€ä¸ªä½ç½®å¤åˆ¶åˆ°å¦ä¸€ä¸ªä½ç½®ã€‚ æºæ“ä½œæ•°æŒ‡å®šçš„å€¼æ˜¯ä¸€ä¸ªç«‹å³æ•°ï¼Œå­˜å‚¨åœ¨å¯„å­˜å™¨æˆ–è€…å†…å­˜ä¸­ã€‚ç›®çš„æ“ä½œæ•°æŒ‡å®šä¸€ä¸ªä½ç½®ï¼Œå¯„å­˜å™¨æˆ–è€…å†…å­˜åœ°å€ã€‚ x86-64 ä¸­ä¼ é€æŒ‡ä»¤çš„ä¸¤ä¸ªæ“ä½œæ•°ä¸èƒ½éƒ½æŒ‡å‘å†…å­˜ä½ç½®ï¼Œå†…å­˜é—´çš„å¤åˆ¶éœ€è¦ä¸¤æ¡æŒ‡ä»¤ã€‚ MOV çš„äº”ç§å¯èƒ½ç»„åˆ: movl $0x4050, $eax ; Immediate -- Register, 4 bytes movw %bp, %sp ; Register -- Register, 2 bytes movb (%bp, %rcx), %al ; Memory -- Register, 1 bytes movb $-17, (%rsp) ; Immediate -- Memory, 1 bytes movq %rax, -12(%rbp) ; Register -- Memory, 8 bytes MOVZ ç±»ä¸­æŒ‡ä»¤æŠŠç›®çš„ä¸­å‰©ä½™çš„å­—èŠ‚å¡«å……ä¸º0ã€‚ MOVS ç±»ä¸­çš„æŒ‡ä»¤é€šè¿‡ç¬¦å·æ‰©å±•æ¥å¡«å……ï¼ŒæŠŠæºæ“ä½œçš„æœ€é«˜ä¸ºè¿›è¡Œå¤åˆ¶ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªæ•°æ®ä¼ é€ç¤ºä¾‹: long exchange(long *xp, long y) { long x = *xp; *xp = y; return x; } æ‰§è¡Œå‘½ä»¤ gcc -Og -S main.c ç”Ÿæˆä»¥ä¸‹æ±‡ç¼–å†…å®¹: exchange: movq (%rdi), %rax movq %rsi, (%rdi) ret å¯ä»¥çœ‹å‡º: C è¯­è¨€çš„ â€œæŒ‡é’ˆâ€ å…¶å®å°±æ˜¯åœ°å€ã€‚é—´æ¥å¼•ç”¨æŒ‡é’ˆå°±æ˜¯é—´è¯¥æŒ‡é’ˆæ”¾åœ¨ä¸€ä¸ªå¯„å­˜å™¨ä¸­ï¼Œç„¶åå†å†…å­˜å¼•ç”¨ä¸­ä½¿ç”¨è¿™ä¸ªå¯„å­˜å™¨ã€‚ æœ€åçš„ä¸¤ä¸ªæ•°æ®ä¼ é€æ“ä½œ: å°†æ•°æ®å‹å…¥ç¨‹åºæ ˆä¸­ï¼Œä»ç¨‹åºæ ˆä¸­å¼¹å‡ºæ•°æ®ã€‚ pushq %rbp ; æ ˆæŒ‡é’ˆå‡8ï¼Œç„¶åå°†å€¼å†™åˆ°æ–°çš„æ ˆé¡¶åœ°å€ã€‚ ; ç­‰åŒäº subq $8, %rsp ; Decrement stack pointer movq %rbp, (%rsp) ; Store %rbp on stack æ“ä½œç¤ºæ„å›¾: popq %rbp ; å¼¹å‡ºä¸€ä¸ªå››å­—çš„æ“ä½œåŒ…æ‹¬ä»æ ˆé¡¶ä½ç½®è¯»å‡ºæ•°æ®ï¼Œç„¶åå‡æ ˆæŒ‡é’ˆåŠ 8ã€‚ ; ç­‰åŒäº movq %rsp, (%rax) ; Read %rax from stack addq $8, %rsp ; Increment stack pointer ","date":"2021-08-31","objectID":"/csapp/:2:4","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"3.5 ç®—æœ¯å’Œé€»è¾‘æ“ä½œ æŒ‡ä»¤ç±» ADD ç”±å››æ¡åŠ æ³•æŒ‡ä»¤ç»„æˆ: addb å­—èŠ‚åŠ æ³•ã€addw å­—åŠ æ³•ã€addl åŒå­—åŠ æ³• å’Œ addq å››å­—åŠ æ³•ã€‚ è¿™äº›æ“ä½œè¢«åˆ†æˆå››ç»„: åŠ è½½æœ‰æ•ˆåœ°å€ã€ä¸€å…ƒæ“ä½œã€äºŒå…ƒæ“ä½œå’Œç§»ä½ã€‚ åŠ è½½æœ‰æ•ˆåœ°å€(load effective address)æŒ‡ä»¤ leaq å®é™…ä¸Šæ˜¯ movq æŒ‡ä»¤çš„å˜å½¢ã€‚å®ƒçš„æŒ‡ä»¤å½¢å¼æ˜¯ä»å†…å­˜è¯»æ•°æ®åˆ°å¯„å­˜å™¨ï¼Œä½†å®é™…ä¸Šå®ƒæ ¹æœ¬å°±æ²¡æœ‰å¼•ç”¨å†…å­˜ã€‚ long scale(long x, long y, long z) { long t = x + 4 * y + 12 * z; return t; } å¾—åˆ°æ±‡ç¼–å‘½ä»¤: _scale: ## @scale .cfi_startproc ## %bb.0: pushq %rbp movq %rsp, %rbp leaq (%rdi,%rsi,4), %rax leaq (%rdx,%rdx,2), %rcx leaq (%rax,%rcx,4), %rax popq %rbp retq ä¸€å…ƒæ“ä½œæ•°åªæœ‰ä¸€ä¸ªæ“ä½œæ•°ï¼Œæ—¢æ˜¯æºåˆæ˜¯ç›®çš„ã€‚å¦‚ incq (%rsp)ã€‚ äºŒå…ƒæ“ä½œæ•°ï¼Œç¬¬äºŒä¸ªæ“ä½œæ•°æ—¢æ˜¯æºåˆæ˜¯ç›®çš„ã€‚å¦‚ subq %rax,%rdxã€‚ ç§»ä½æ“ä½œï¼Œå…ˆç»™å‡ºç§»ä½é‡ï¼Œç„¶åç¬¬äºŒé¡¹æ˜¯è¦ç§»ä½ã€‚å¯ä»¥è¿›è¡Œç®—æœ¯å’Œé€»è¾‘å³ç§»ã€‚ä½ç§»é‡å¯ä»¥æ˜¯ä¸€ä¸ªç«‹å³æ•°ï¼Œæˆ–è€…æ”¾åœ¨å•å­—èŠ‚å¯„å­˜å™¨ %cl ä¸­(ç§»ä½æ“ä½œæŒ‡ä»¤åªå…è®¸ä»¥è¿™ä¸ªç‰¹å®šçš„å¯„å­˜å™¨ä½œä¸ºæ“ä½œæ•°)ã€‚ ç‰¹æ®Šçš„ç®—æœ¯æ“ä½œ ä»¥ä¸‹çš„ C ä»£ç : #include \u003cinttypes.h\u003e typedef unsigned __int128 uint128_t; void store_uprod(uint128_t *dest, uint64_t x, uint64_t y) { *dest = x * (uint128_t) y; } void remdiv(long x, long y, long *qp, long *rp) { long q = x / y; long r = x%y; *qp = q; *rp = r; } ç”Ÿæˆæ±‡ç¼– store_uprod: movq %rsp, %rbp movq %rdx, %rax ; Copy x to multiplicand mulq %rsi ; Multiply by y movq %rdx, 8(%rdi) ; Store upper 8 bytes at dest+8 movq %rax, (%rdi) ; Store lower 8 bytes at dest retq remdiv: movq %rsp, %rbp movq %rdx, %r8 ; Copy qp movq %rdi, %rax ; Move x to lower 8 bytes of dividend cqto ; Sign-extend to upper 8 bytes of dividend idivq %rsi ; Divide by y movq %rax, (%r8) ; Store remainder at rp movq %rdx, (%rcx) ; Store quotient at qp retq ","date":"2021-08-31","objectID":"/csapp/:2:5","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"3.6 æ§åˆ¶ CPU è¿˜ç»´æŠ¤ç€ä¸€ç»„å•ä¸ªä½çš„æ¡ä»¶ç  (condition code) å¯„å­˜å™¨ï¼Œå®ƒä»¬æè¿°äº†æœ€è¿‘çš„ç®—æœ¯æˆ–é€»è¾‘æ“ä½œçš„å±æ€§ã€‚å¯ä»¥æ£€æµ‹è¿™äº›å¯„å­˜å™¨æ¥æ‰§è¡Œæ¡ä»¶åˆ†æ”¯æŒ‡ä»¤ã€‚æœ€å¸¸ç”¨çš„æ¡ä»¶ç æœ‰: CF: è¿›ä½æ ‡å¿—ã€‚æœ€è¿‘çš„æ“ä½œä½¿æœ€é«˜ä½äº§ç”Ÿäº†è¿›ä½ã€‚å¯ä»¥æ¥æ£€æŸ¥æ— ç¬¦å·æ“ä½œçš„æº¢å‡ºã€‚ ZF: é›¶æ ‡å¿—ã€‚æœ€è¿‘çš„æ“ä½œå¾—å‡ºçš„ç»“æœä¸º0ã€‚ SF: ç¬¦å·æ ‡å¿—ã€‚æœ€è¿‘çš„æ“ä½œå¾—åˆ°çš„ç»“æœä¸ºè´Ÿæ•°ã€‚ OF: æº¢å‡ºæ ‡å¿—ã€‚æœ€è¿‘çš„æ“ä½œå¯¼è‡´ä¸€ä¸ªè¡¥ç æº¢å‡º â€”â€” æ­£æº¢å‡ºæˆ–è´Ÿæº¢å‡ºã€‚ æ¡ä»¶ç é€šå¸¸ä¸ä¼šç›´æ¥è¯»å–ï¼Œå¸¸ç”¨çš„ä½¿ç”¨æ–¹æ³•æœ‰ä¸‰ç§: å¯ä»¥æ ¹æ®æ¡ä»¶ç çš„æŸç§ç»„åˆï¼Œå°†ä¸€ä¸ªå­—èŠ‚è®¾ç½®ä¸º 0 æˆ–è€… 1ã€‚ å¯ä»¥æ¡ä»¶è·³è½¬åˆ°ç¨‹åºçš„æŸä¸ªå…¶ä»–éƒ¨åˆ†ã€‚ å¯ä»¥æœ‰æ¡ä»¶åœ°åˆ›é€æ•°æ®ã€‚ SET æŒ‡ä»¤æ˜¯æ ¹æ®æ¡ä»¶ç çš„æŸç§ç»„åˆï¼Œå°†ä¸€ä¸ªå­—èŠ‚è®¾ç½®ä¸º 0 æˆ–è€… 1çš„ä¸€æ•´ç±»æŒ‡ä»¤ã€‚è¿™äº›æŒ‡ä»¤çš„åç¼€è¡¨ç¤ºä¸åŒçš„æ¡ä»¶è€Œä¸æ˜¯æ“ä½œæ•°çš„å¤§å°ã€‚å¦‚ setl è¡¨ç¤º â€œå°äºæ—¶è®¾ç½® (set less)â€ã€‚ setb è¡¨ç¤º â€œä½äºæ—¶è®¾ç½® (set below)â€ã€‚ ä¸€æ¡ SET æŒ‡ä»¤çš„ç›®çš„æ“ä½œæ•°æ˜¯ä½ä½å•å­—èŠ‚å¯„å­˜å™¨å…ƒç´ ä¹‹ä¸€ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªå­—èŠ‚çš„å†…å­˜ä½ç½®ï¼ŒæŒ‡ä»¤ä¼šå°†è¿™ä¸ªå­—èŠ‚è®¾ç½®æˆ 0 æˆ–è€… 1ã€‚ è·³è½¬ (jump) æŒ‡ä»¤ä¼šå¯¼è‡´æ‰§è¡Œåˆ‡æ¢åˆ°ç¨‹åºä¸­ä¸€ä¸ªå…¨æ–°çš„ä½ç½®ã€‚åœ¨æ±‡ç¼–ä»£ç ä¸­ï¼Œè¿™äº›è·³è½¬çš„ç›®çš„åœ°é€šå¸¸ç”¨ä¸€ä¸ªæ ‡å· (label) æŒ‡æ˜ã€‚ movq $0,%rax ; Set %rax to 0 jmp .L1 ; Goto .L1 movq (%rax), %rdx ; Null pointer dereference (skipped) .L1: popq %rdx ; Jump target å®ç°æ¡ä»¶æ“ä½œçš„ä¼ ç»Ÿæ–¹æ³•æ˜¯é€šè¿‡ä½¿ç”¨æ§åˆ¶çš„æ¡ä»¶è½¬ç§»ã€‚å½“æ¡ä»¶æ»¡è¶³æ—¶ï¼Œç¨‹åºæ²¿ç€ä¸€æ¡æ‰§è¡Œè·¯å¾„æ‰§è¡Œï¼Œè€Œå½“æ¡ä»¶ä¸æ»¡è¶³æ˜¯ï¼Œå°±èµ°å¦ä¸€æ¡è·¯å¾„ã€‚ä½†è¿™ä¸ªæ–¹æ³•åœ¨ç°ä»£å¤„ç†å™¨ä¸Šå¯èƒ½ä¼šéå¸¸ä½æ•ˆã€‚ å¦ä¸€ç§ç­–ç•¥æ˜¯ä½¿ç”¨æ•°æ®çš„æ¡ä»¶è½¬ç§»ã€‚è¿™ä¸ªæ–¹æ³•è®¡ç®—ä¸€ä¸ªæ¡ä»¶æ“ä½œçš„ä¸¤ç§ç»“æœï¼Œç„¶åå†æ ¹æ®æ¡ä»¶æ˜¯å¦æ»¡è¶³ä»ä¸­é€‰å–ä¸€ä¸ªã€‚ æ±‡ç¼–ä¸­æ²¡æœ‰å¾ªç¯æŒ‡ä»¤å­˜åœ¨ï¼Œå¯ä»¥ç”¨æ¡ä»¶æµ‹è¯•å’Œè·³è½¬ç»„åˆèµ·æ¥å®ç°å¾ªç¯æ•ˆæœã€‚ long fact_do(long n) { long result = 1; do { result *= n; n = n - 1; } while (n \u003e 1); return result; } ç”Ÿæˆæ±‡ç¼–ä»£ç : _fact_do: ## @fact_do pushq %rbp movq %rsp, %rbp movl $1, %eax LBB0_1: ## =\u003eThis Inner Loop Header: Depth=1 imulq %rdi, %rax decq %rdi cmpq $1, %rdi jg LBB0_1 popq %rbp retq switch è¯­å¥å¯ä»¥æ ¹æ®ä¸€ä¸ªæ•´æ•°ç´¢å¼•å€¼è¿›è¡Œå¤šé‡åˆ†æ”¯ (multiway branching)ã€‚switch ä¼šè¢«è½¬åŒ–æˆè·³è½¬è¡¨ (jump table)ã€‚è·³è½¬è¡¨ç¤ºä¸€ä¸ªæ•°ç»„ï¼Œè¡¨é¡¹ i æ˜¯ä¸€ä¸ªä»£ç æ®µçš„åœ°å€ï¼Œè¿™ä¸ªä»£ç æ®µå®ç°å½“å¼€å…³ç´¢å¼•å€¼ç­‰äº i æ—¶ç¨‹åºåº”è¯¥é‡‡å–çš„åŠ¨ä½œã€‚ç¨‹åºä»£ç ç”¨å¼€å…³ç´¢å¼•å€¼æ¥æ‰§è¡Œä¸€ä¸ªè·³è½¬è¡¨å†…çš„æ•°ç»„å¼•ç”¨ï¼Œç¡®å®šè·³è½¬æŒ‡ä»¤çš„ç›®æ ‡ã€‚å’Œä½¿ç”¨ä¸€ç»„å¾ˆé•¿çš„ if-else è¯­å¥å¯¹æ¯”ï¼Œä½¿ç”¨è·³è½¬è¡¨çš„ä¼˜ç‚¹æ˜¯æ‰§è¡Œå¼€å…³è¯­å¥çš„æ—¶é—´ä¸å¼€å…³æƒ…å†µçš„æ•°é‡æ— å…³ã€‚ C switch ä»£ç : void switch_eg(long x, long n, long *dest) { long val = x; switch (n) { case 100: val *= 13; break; case 102: val += 10; case 103: val += 11; break; case 104: case 106: val *= val; break; default: val = 0; } *dest = val; } ç”Ÿæˆæ±‡ç¼–: .section __TEXT,__text,regular,pure_instructions .build_version macos, 10, 15, 4 sdk_version 10, 15, 4 .globl _switch_eg ## -- Begin function switch_eg .p2align 4, 0x90 _switch_eg: ## @switch_eg ## %bb.0: pushq %rbp movq %rsp, %rbp xorl %eax, %eax addq $-100, %rsi cmpq $6, %rsi ja LBB0_7 ## %bb.1: leaq LJTI0_0(%rip), %rcx movslq (%rcx,%rsi,4), %rsi addq %rcx, %rsi jmpq *%rsi LBB0_5: imulq %rdi, %rdi jmp LBB0_6 LBB0_2: leaq (%rdi,%rdi,2), %rax leaq (%rdi,%rax,4), %rax jmp LBB0_7 LBB0_3: addq $10, %rdi LBB0_4: addq $11, %rdi LBB0_6: movq %rdi, %rax LBB0_7: movq %rax, (%rdx) popq %rbp retq ","date":"2021-08-31","objectID":"/csapp/:2:6","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"3.7 è¿‡ç¨‹ è¿‡ç¨‹æ˜¯è½¯ä»¶ä¸­ä¸€ç§å¾ˆé‡è¦çš„æŠ½è±¡ã€‚å®ƒæä¾›äº†ä¸€ç§å°è£…ä»£ç çš„æ–¹å¼ï¼Œç”¨ä¸€ç»„æŒ‡å®šçš„å‚æ•°å’Œä¸€ä¸ªå¯é€‰çš„è¿”å›å€¼å®ç°äº†æŸç§åŠŸèƒ½ã€‚ç„¶åï¼Œå¯ä»¥åœ¨ç¨‹åºä¸­ä¸åŒçš„åœ°æ–¹è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚è®¾è®¡è‰¯å¥½çš„å¦‚è½¯ä»¶ç”¨è¿‡ç¨‹ä½œä¸ºæŠ½è±¡æœºåˆ¶ï¼Œéšè—æŸä¸ªè¡Œä¸ºçš„å…·ä½“å®ç°ï¼ŒåŒæ—¶åˆæä¾›æ¸…æ™°ç®€æ´çš„æ¥å£å®šä¹‰ï¼Œè¯´æ˜è¦è®¡ç®—çš„æ˜¯å“ªäº›å€¼ï¼Œè¿‡ç¨‹ä¼šå¯¹ç¨‹åºçŠ¶æ€äº§ç”Ÿè¯´æ˜æ ·çš„å½±å“ã€‚ ä¸åŒç¼–ç¨‹è¯­è¨€ä¸­ï¼Œè¿‡ç¨‹çš„å½¢å¼: å‡½æ•° (function) æ–¹æ³• (method) å­ä¾‹ç¨‹ (subroutine) å¤„ç†å‡½æ•° (handler) å‡è®¾è¿‡ç¨‹ P è°ƒç”¨è¿‡ç¨‹ Qï¼ŒQ æ‰§è¡Œåè¿”å› Pã€‚è¿‡ç¨‹å¯èƒ½ç”¨åˆ°çš„ä¸€ä¸ªæˆ–å¤šä¸ªæœºåˆ¶: ä¼ é€’æ§åˆ¶ã€‚åœ¨è¿›å…¥è¿‡ç¨‹ Q çš„æ—¶å€™ï¼Œç¨‹åºè®¡æ•°å™¨å¿…é¡»è¢«è®¾ç½®ä¸º Q çš„ä»£ç çš„èµ·å§‹åœ°å€ï¼Œç„¶åå†è¿”å›æ—¶ï¼Œè¦æŠŠç¨‹åºè®¡æ•°å™¨è®¾ç½®ä¸º P ä¸­è°ƒç”¨ Q åé¢é‚£æ¡æŒ‡ä»¤çš„åœ°å€ã€‚ ä¼ é€’æ•°æ®ã€‚P å¿…é¡»èƒ½å¤Ÿå‘ Q æä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ï¼ŒQ å¿…é¡»èƒ½å¤Ÿå‘ P è¿”å›ä¸€ä¸ªå€¼ã€‚ åˆ†é…å’Œé‡Šæ”¾å†…å­˜ã€‚åœ¨å¼€å§‹æ˜¯ï¼ŒQ å¯èƒ½éœ€è¦ä¸ºå±€éƒ¨å˜é‡åˆ†é…ç©ºé—´ï¼Œè€Œåœ¨è¿”å›å‰ï¼Œåˆå¿…é¡»é‡Šæ”¾è¿™äº›å­˜å‚¨ç©ºé—´ã€‚ 3.7.1 ä¼ é€’æ§åˆ¶ C è¯­è¨€è¿‡ç¨‹è°ƒç”¨ä¸­ä½¿ç”¨æ ˆæ•°æ®ç»“æ„æä¾›çš„åè¿›å…ˆå‡ºçš„å†…å­˜ç®¡ç†åŸåˆ™ã€‚ ç¨‹åºå¯ä»¥ç”¨æ ˆæ¥ç®¡ç†å®ƒçš„è¿‡ç¨‹æ‰€éœ€è¦çš„å­˜å‚¨ç©ºé—´ï¼Œæ ˆå’Œç¨‹åºå¯„å­˜å™¨å­˜æ”¾è¿™ä¼ é€’æ§åˆ¶å’Œæ•°æ®ã€åˆ†é…å†…å­˜æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚å½“ P è°ƒç”¨ Q æ—¶ï¼Œæ§åˆ¶å’Œæ•°æ®ä¿¡æ¯æ·»åŠ åˆ°æ ˆå°¾ã€‚å½“ P è¿”å›æ—¶ï¼Œè¿™äº›ä¿¡æ¯ä¼šé‡Šæ”¾æ‰ã€‚ å½“ x86-64 è¿‡ç¨‹éœ€è¦çš„å­˜å‚¨ç©ºé—´è¶…å‡ºå¯„å­˜å™¨èƒ½å¤Ÿå­˜æ”¾çš„å¤§å°æ—¶ï¼Œå°±ä¼šåœ¨æ ˆä¸Šåˆ†é…ç©ºé—´ã€‚è¿™ä¸ªéƒ¨åˆ†ç§°ä¸ºè¿‡ç¨‹çš„æ ˆå¸§(stack frame)ã€‚å½“å‰æ­£åœ¨æ‰§è¡Œçš„è¿‡ç¨‹çš„å¸§æ€»æ˜¯åœ¨æ ˆé¡¶ã€‚ 3.7.2 è½¬ç§»æ§åˆ¶ å°†æ§åˆ¶ä»å‡½æ•° P è½¬ç§»åˆ°å‡½æ•° Q åªéœ€è¦ç®€å•åœ°æŠŠç¨‹åºè®¡æ•°å™¨(PC)è®¾ç½®ä¸º Q çš„ä»£ç çš„èµ·å§‹ä½ç½®ã€‚ä¸è¿‡ï¼Œå½“ç¨åä» Q è¿”å›çš„æ—¶å€™ï¼Œå¤„ç†å™¨å¿…é¡»è®°å½•å¥½éœ€è¦ç»§ç»­ P çš„æ‰§è¡Œçš„ä»£ç ä½ç½®ã€‚åœ¨ x86-64 æœºå™¨ä¸­ï¼Œè¿™ä¸ªä¿¡æ¯æ˜¯ç”¨æŒ‡ä»¤ call Q è°ƒç”¨è¿‡ç¨‹ Q æ¥è®°å½•çš„ã€‚è¯¥æŒ‡ä»¤ä¼šæŠŠåœ°å€ A å‹å…¥æ ˆä¸­ï¼Œå¹¶å°† PC è®¾ç½®ä¸º Q çš„èµ·å§‹åœ°å€ã€‚å‹å…¥çš„åœ°å€ A è¢«ç§°ä¸ºè¿”å›åœ°å€ï¼Œæ˜¯ç´§è·Ÿåœ¨ call æŒ‡ä»¤åé¢çš„é‚£æ¡æŒ‡ä»¤çš„åœ°å€ã€‚å¯¹åº”çš„æŒ‡ä»¤ ret ä¼šä»æ ˆä¸­å¼¹å‡ºåœ°å€ Aï¼Œå¹¶æŠŠ PC è®¾ç½®ä¸º Aã€‚ call æŒ‡ä»¤æœ‰ä¸€ä¸ªç›®æ ‡ï¼Œå³æŒ‡æ˜è¢«è°ƒç”¨è¿‡ç¨‹èµ·å§‹çš„æŒ‡ä»¤åœ°å€ã€‚åŒè°ƒæ•´ä¸€æ ·ï¼Œè°ƒç”¨å¯èƒ½æ˜¯ç›´æ¥çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯é—´æ¥çš„ã€‚åœ¨æ±‡ç¼–ä»£ç ä¸­ï¼Œç›´æ¥è°ƒç”¨çš„ç›®æ ‡æ˜¯ä¸€ä¸ªæ ‡å·ï¼Œè€Œé—´æ¥è°ƒç”¨çš„ç›®æ ‡æ˜¯ * åé¢è·Ÿè®´æ­Œæ“ä½œæ•°æŒ‡ç¤ºç¬¦ã€‚ 3.7.3 æ•°æ®åˆ›é€ æ•°æ®ä¼ é€: å½“è°ƒç”¨ä¸€ä¸ªè¿‡ç¨‹æ—¶ï¼Œé™¤äº†è¦æŠŠæ§åˆ¶ä¼ é€’ç»™å®ƒå¹¶åœ¨è¿‡ç¨‹è¿”å›æ—¶å†ä¼ é€’å›æ¥ä¹‹å¤–ï¼Œè¿‡ç¨‹è°ƒç”¨è¿˜å¯èƒ½åŒ…æ‹¬å§æ•°æ®ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œè€Œä»è¿‡ç¨‹è¿”å›è¿˜æœ‰å¯èƒ½åŒ…æ‹¬è¿”å›ä¸€ä¸ªå€¼ã€‚ x86-64ä¸­ï¼Œå¯èƒ½é€šè¿‡å¯„å­˜å™¨æœ€å¤šä¼ é€’ 6 ä¸ªæ•´å‹(ä¾‹å¦‚æ•´æ•°å’ŒæŒ‡é’ˆ)å‚æ•°ã€‚å¯„å­˜å™¨çš„ä½¿ç”¨æ˜¯ç”±ç‰¹æ®Šé¡ºåºçš„ï¼Œå¯„å­˜å™¨ä½¿ç”¨çš„åå­—å–å†³äºè¦ä¼ é€’çš„æ•°æ®ç±»å‹çš„å¤§å°ã€‚ å¦‚æœä¸€ä¸ªå‡½æ•°æœ‰å¤§äº 6 ä¸ªæ•´å‹å‚æ•°ï¼Œè¶…å‡º 6 ä¸ªçš„éƒ¨åˆ†å°±è¦é€šè¿‡æ ˆæ¥ä¼ é€’ã€‚ void proc(long a1, long *a1p, int a2, int *a2p, short a3, short *a3p, char a4, char *a4p) { *a1p += a1; *a2p += a2; *a3p += a3; *a4p += a4; } 3.7.4 æ ˆä¸Šçš„å±€éƒ¨å­˜å‚¨ éœ€è¦æ ˆä¸Šå±€éƒ¨å­˜å‚¨çš„æƒ…å†µ: å¯„å­˜å™¨ä¸èƒ½è¶³å¤Ÿå­˜æ”¾ç´ æœ‰çš„æœ¬åœ°æ•°æ®ã€‚ å¯¹ä¸€ä¸ªå±€éƒ¨å˜é‡ä½¿ç”¨åœ°å€è¿ç®—ç¬¦ â€˜\u0026â€™, å› æ­¤å¿…é¡»èƒ½å¤Ÿä¸ºä»–äº§ç”Ÿä¸€ä¸ªåœ°å€ã€‚ æŸäº›å±€éƒ¨å˜é‡æ˜¯æ•°ç»„æˆ–ç»“æ„ï¼Œå› æ­¤å¿…é¡»èƒ½å¤Ÿé€šè¿‡æ•°æ®æˆ–ç»“æ„å¼•ç”¨è¢«è®¿é—®åˆ°ã€‚ long call_proc() { long x1 = 1; int x2 = 2; short x3 = 3; char x4 = 4; proc(x1, \u0026x1, x2, \u0026x2, x3, \u0026x3, x4, \u0026x4); // åˆ›å»ºæ ˆå¸§ return (x1 + x2) * (x3 - x4); } 3.7.5 å¯„å­˜å™¨ä¸­çš„å±€éƒ¨å­˜å‚¨ç©ºé—´ å¯„å­˜å™¨ç»„æ˜¯å”¯ä¸€è¢«æ‰€æœ‰è¿‡ç¨‹å…±äº«çš„èµ„æºï¼Œä¸ºäº†é˜²æ­¢å¯„å­˜å™¨çš„å€¼åœ¨è¢«ä¸€ä¸ªè¿‡ç¨‹ä½¿ç”¨æ—¶ï¼Œä¸è¢«å…¶ä»–è¿‡ç¨‹è°ƒç”¨å¯¼è‡´å€¼è¢«è¦†ç›–ï¼Œx86-64 é‡‡ç”¨ä¸€ç»„ç»Ÿä¸€çš„å¯„å­˜å™¨ä½¿ç”¨æƒ¯ä¾‹: å¯„å­˜å™¨ %rbxã€%rbp å’Œ %r12~%r15 è¢«åˆ’åˆ†ä¸ºè¢«è°ƒç”¨è€…å¯„å­˜å™¨ï¼ŒQ è¿‡ç¨‹å¿…é¡»ä¿è¯å¯„å­˜å™¨å€¼çš„å®‰å…¨ã€‚ é™¤äº†æ ˆæŒ‡é’ˆ %rsp, éƒ½åˆ†ç±»ä¸ºè°ƒç”¨è€…ä¿å­˜å¯„å­˜å™¨ã€‚ 3.7.6 é€’å½’è¿‡ç¨‹ é€’å½’è°ƒç”¨ä¸€ä¸ªå‡½æ•°æœ¬èº«ä¸è°ƒç”¨å…¶ä»–å‡½æ•°æ—¶ä¸€æ ·çš„ã€‚æ ˆè§„åˆ™æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œæ¯æ¬¡å‡½æ•°è°ƒç”¨éƒ½æœ‰å®ƒè‡ªå·±ç§æœ‰çš„çŠ¶æ€ä¿¡æ¯(ä¿å­˜çš„è¿”å›ä½ç½®å’Œè¢«è°ƒç”¨è€…ä¿å­˜å¯„å­˜å™¨çš„å€¼)å­˜å‚¨ç©ºé—´ã€‚å¦‚æœéœ€è¦ï¼Œå®ƒè¿˜å¯ä»¥æä¾›å±€éƒ¨å˜é‡çš„å­˜å‚¨ã€‚æ ˆåˆ†é…å’Œé‡Šæ”¾çš„è§„åˆ™å¾ˆè‡ªç„¶å°±ä¸å‡½æ•°è°ƒç”¨-è¿”å›çš„å¾ªåºåŒ¹é…ã€‚è¿™ç§å®ç°å‡½æ•°è°ƒç”¨å’Œè¿”å›çš„æ–¹æ³•ç”šè‡³å¯¹æ›´å¤æ‚çš„æƒ…å†µä¹Ÿé€‚ç”¨ï¼Œæš´æ‰£äº’ç›¸é€’å½’è°ƒç”¨ã€‚ long rfact(long n) { long result; if (n \u003c= 1) { result = 1; } else { result = n * rfact(n - 1); } return result; } å¯¹åº”æ±‡ç¼–ä»£ç : rfact: pushq %rbx movq %rdi, rbx movl $1, %eax cmpq $1, %rdi jle .L35 leaq -1(%rdi), %rdi call rfact imulq %rbx, %rax .L35: popq %rbx ret ","date":"2021-08-31","objectID":"/csapp/:2:7","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"3.8 æ•°ç»„åˆ†é…å’Œè®¿é—® C è¯­è¨€çš„æ•°ç»„æ˜¯ä¸€ç§å°†æ ‡é‡æ•°æ®èšé›†æˆæ›´å¤§æ•°æ®ç±»å‹çš„æ–¹å¼ã€‚ 3.8.1 åŸºæœ¬åŸåˆ™ å¯¹äºæ•°æ®ç±»å‹ T å’Œæ•´å‹å¸¸æ•° Nï¼Œå£°æ˜å¦‚ä¸‹: T A[N]; èµ·å§‹ä½ç½®è¡¨ç¤ºä¸º $x_A$ã€‚è¿™ä¸ªå£°æ˜æœ‰ä¸¤ä¸ªæ•ˆæœã€‚é¦–å…ˆï¼Œå®ƒåœ¨å†…å­˜ä¸­åˆ†é…ä¸€ä¸ª LÂ·N å­—èŠ‚çš„è¿ç»­åŒºåŸŸã€‚è¿™é‡Œ L æ˜¯æ•°æ®ç±»å‹ T çš„å¤§å°(å•ä½ä¸ºå­—èŠ‚)ã€‚å…¶æ¬¡ï¼Œå®ƒå¼•å…¥äº†æ ‡è¯†ç¬¦ Aï¼Œå¯ä»¥ç”¨ A æ¥ä½œä¸ºæŒ‡å‘æ•°ç»„å¼€å¤´çš„æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆçš„å€¼å°±æ˜¯ $x_A$ã€‚å¯ç”¨ç”¨ 0~N-1 çš„è¯ä¹¦ç´¢å¼•æ¥è®¿é—®è¯¥æ•°ç»„å…ƒç´ ã€‚æ•°ç»„å…ƒç´  i ä¼šè¢«å­˜æ”¾åœ¨åœ°å€ä¸º $x_A$+LÂ·i çš„åœ°æ–¹ã€‚ 3.8.2 æŒ‡é’ˆè¿ç®— C è¯­è¨€å…è®¸å¯¹æŒ‡é’ˆè¿›è¡Œè¿ç®—ï¼Œè€Œè®¡ç®—å‡ºæ¥çš„å€¼ä¼šæ ¹æ®è¯¥æŒ‡é’ˆå¼•ç”¨çš„æ•°æ®ç±»å‹çš„å¤§å°è¿›è¡Œä¼¸ç¼©ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ p æ˜¯ä¸€ä¸ªæŒ‡å‘ç±»å‹ä¸º T çš„æ•°æ®çš„æŒ‡é’ˆï¼Œp çš„å€¼ä¸º $x_p$ï¼Œé‚£ä¹ˆè¡¨è¾¾å¼ p+i çš„å€¼ä¸º $x_p$+LÂ·iï¼Œè¿™é‡Œ L æ˜¯æ•°æ®ç±»å‹ T çš„å¤§å°ã€‚ å•æ“ä½œæ•°æ“ä½œç¬¦ â€˜$â€™ å’Œ â€˜* â€™ å¯ä»¥äº§ç”ŸæŒ‡é’ˆå’Œé—´æ¥å¼•ç”¨æŒ‡é’ˆã€‚å¯¹äºä¸€ä¸ªè¡¨ç¤ºæŸä¸ªå¯¹è±¡çš„è¡¨è¾¾å¼ Exprï¼Œ\u0026Expr æ˜¯è¯¥å¯¹è±¡çš„ä¸€ä¸ªæŒ‡é’ˆã€‚å¯¹äºä¸€ä¸ªè¡¨ç¤ºåœ°å€çš„è¡¨è¾¾å¼ AExpr, *AExpr æ˜¯è¯¥åœ°å€çš„å€¼ã€‚å› æ­¤ï¼Œè¡¨è¾¾å¼ Expr ä¸ * \u0026Expr æ˜¯ç­‰ä»·çš„ã€‚å¯ä»¥å¯¹æ•°ç»„å’ŒæŒ‡é’ˆåº”ç”¨æ•°ç»„ä¸‹æ ‡æ“ä½œã€‚ 3.8.3 åµŒå¥—æ•°ç»„ è¦è®¿é—®å¤šç»´æ•°ç»„çš„å…ƒç´ ï¼Œç¼–è¯‘å™¨ä¼šä»¥æ•°ç»„èµ·å§‹ä¸ºåŸºåœ°å€ï¼Œåç§»é‡ä¸ºç´¢å¼•ï¼Œäº§ç”Ÿè®¡ç®—æœŸæœ›çš„å…ƒç´ åç§»é‡ï¼Œç„¶åä½¿ç”¨æŸç§ MOV æŒ‡ä»¤ã€‚ é€šå¸¸æ¥è¯´ï¼Œå¯¹äºä¸€ä¸ªå£°æ˜å¦‚ä¸‹çš„æ•°ç»„: T D[R][C] çš„å…ƒç´  D[i][j] çš„å†…å­˜åœ°å€ä¸º $$ D[i][j] = x_D+L(CÂ·i+j) $$ 3.8.4 å®šé•¿æ•°ç»„ Cè¯­è¨€ç¼–è¯‘å™¨èƒ½å¤Ÿä¼˜åŒ–å®šé•¿å¤šç»´æ•°ç»„ä¸Šçš„æ“ä½œä»£ç  ","date":"2021-08-31","objectID":"/csapp/:2:8","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"3.9 å¼‚è´¨çš„æ•°æ®ç»“æ„ C è¯­è¨€2æä¾›äº†ä¸¤ç§å°†ä¸åŒç±»å‹çš„å¯¹è±¡ç»„åˆåˆ°ä¸€èµ·åˆ›å»ºæ•°æ®ç±»å‹çš„æœºåˆ¶: ç»“æ„ (structure)ï¼Œå…³é”®å­— structï¼Œå°†å¤šä¸ªå¯¹è±¡é›†åˆåˆ°ä¸€ä¸ªå•ä½ä¸­ã€‚ è”åˆ (union)ï¼Œç”¨å…³é”®å­— union æ¥å£°æ˜ï¼Œå…è®¸ç”¨å‡ ç§ä¸åŒçš„ç±»å‹æ¥å¼•ç”¨ä¸€ä¸ªå¯¹è±¡ã€‚ 3.9.1 ç»“æ„ C è¯­è¨€çš„ struct å£°æ˜åˆ›å»ºä¸€ä¸ªæ•°æ®ç±»å‹ï¼Œå°†å¯èƒ½ä¸åŒç±»å‹çš„å¯¹è±¡èšåˆåˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚ç”¨åå­—æ¥å¼•ç”¨ç»“æ„çš„å„ä¸ªç»„æˆéƒ¨åˆ†ã€‚ç±»ä¼¼äºæ•°ç»„çš„å®ç°ï¼Œç»“æ„çš„æ‰€æœ‰ç»„æˆéƒ¨åˆ†éƒ½å­˜æ”¾åœ¨å†…å­˜ä¸­ä¸€æ®µè¿ç»­çš„åŒºåŸŸå†…ï¼Œè€ŒæŒ‡å‘ç»“æ„çš„æŒ‡é’ˆå°±æ˜¯ç»“æ„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åœ°å€ã€‚ struct rect { int i; int j; int a[2]; int *p; }; è¯¥ç»“æ„åœ¨å†…å­˜ä¸­çš„å¸ƒå±€: 3.9.2 è”åˆ è”åˆæä¾›äº†ä¸€ç§æ–¹å¼ï¼Œèƒ½å¤Ÿè§„é¿ C è¯­è¨€çš„ç±»å‹ç³»ç»Ÿï¼Œå…è®¸ä»¥å¤šç§ç±»å‹æ¥å¼•ç”¨ä¸€ä¸ªå¯¹è±¡ã€‚ä¸€ä¸ªè”åˆçš„æ€»çš„å¤§å°ç­‰äºå®ƒæœ€å¤§å­—æ®µçš„å¤§å°ã€‚ åœ¨ä¸€äº›ä¸Šä¸‹æ–‡ä¸­ï¼Œè”åˆååˆ†æœ‰ç”¨ã€‚ä½†æ˜¯ï¼Œå®ƒä¹Ÿèƒ½å¼•èµ·ä¸€äº›è®¨åŒçš„é”™è¯¯ï¼Œå› ä¸ºä»–ä»¬ç»•è¿‡äº† C è¯­è¨€ç±»å‹ç³»ç»Ÿæä¾›çš„å®‰å…¨æªæ–½ã€‚ä¸€ç§åº”ç”¨æƒ…å†µæ˜¯ï¼Œæˆ‘ä»¬äº‹å…ˆçŸ¥é“å¯¹ä¸€ä¸ªæ•°æ®ç»“æ„ä¸­çš„ä¸¤ä¸ªä¸åŒå­—æ®µçš„ä½¿ç”¨æ˜¯äº’æ–¥çš„ï¼Œé‚£ä¹ˆå°†è¿™ä¸¤ä¸ªå­—æ®µå£°æ˜ä¸ºè”åˆçš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯ç»“æ„çš„ä¸€éƒ¨åˆ†ï¼Œä¼šå‡å°åˆ†é…ç©ºé—´çš„æ€»é‡ã€‚ 3.9.3 æ•°æ®å¯¹é½ è®¸å¤šè®¡ç®—æœºç³»ç»Ÿå¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„åˆæ³•åœ°å€åšå‡ºäº†ä¸€äº›é™åˆ¶ï¼Œè¦æ±‚æŸç§ç±»å‹å¯¹è±¡çš„åœ°å€å¿…é¡»æ˜¯æŸä¸ªå€¼ K (é€šå¸¸æ˜¯2ã€4æˆ–8)çš„å€æ•°ã€‚è¿™ç§å¯¹é½é™åˆ¶ç®€åŒ–äº†å½¢æˆå¤„ç†å™¨å’Œå†…å­˜ç³»ç»Ÿä¹‹é—´æ¥å£çš„ç¡¬ä»¶è®¾è®¡ã€‚ æ— è®ºæ•°æ®æ˜¯å¦å¯¹é½ï¼Œx86-64 ç¡¬ä»¶éƒ½èƒ½æ­£ç¡®å·¥ä½œã€‚ä¸è¿‡ï¼ŒIntel è¿˜æ˜¯å»ºè®®è¦å¯¹é½æ•°æ®ä»¥æé«˜å†…å­˜ç³»ç»Ÿçš„æ€§èƒ½ã€‚å¯¹é½åŸåˆ™æ˜¯ä»»ä½• K å­—èŠ‚çš„åŸºæœ¬å¯¹è±¡çš„åœ°å€å¿…é¡»æ˜¯ K çš„å€æ•°ã€‚ ç¡®ä¿æ¯ç§æ•°æ®ç±»å‹éƒ½æ˜¯æŒ‰ç…§æŒ‡å®šæ–¹å¼æ¥ç»„ç»‡å’Œåˆ†é…ï¼Œå³æ¯ç§ç±»å‹çš„å¯¹è±¡éƒ½æ»¡è¶³å®ƒçš„å¯¹é½é™åˆ¶ï¼Œå°±å¯ä¿è¯å®æ–½å¯¹é½ã€‚ç¼–è¯‘å™¨åœ¨æ±‡ç¼–ä»£ç ä¸­æ”¾å…¥å‘½ä»¤ï¼ŒæŒ‡æ˜å…¨å±€æ•°æ®æ‰€éœ€çš„å¯¹é½ã€‚ .align 8 è¿™å‘½ä»¤å°±ä¿è¯äº†å®ƒåé¢çš„æ•°æ®çš„å¼€å§‹åœ°å€æ˜¯ 8 çš„å€æ•°ã€‚å› ä¸ºæ¯ä¸ªè¡¨é¡¹é•¿ 8 ä¸ªå­—èŠ‚ï¼Œåé¢çš„å…ƒç´ éƒ½ä¼šéµå®ˆ 8 å­—èŠ‚å¯¹é½çš„é™åˆ¶ã€‚ å¯¹äºåŒ…å«ç»“æ„çš„ä»£ç ï¼Œç¼–è¯‘å™¨å¯èƒ½éœ€è¦åœ¨å­—æ®µçš„åˆ†é…ä¸­æ’å…¥é—´éš™ï¼Œä»¥ä¿è¯æ¯ä¸ªç»“æ„å…ƒç´ éƒ½æ»¡è¶³å®ƒçš„å¯¹é½è¦æ±‚ã€‚è€Œç»“æ„æœ¬èº«å¯¹å®ƒçš„èµ·å§‹åœ°å€ä¹Ÿæœ‰ä¸€äº›å¯¹é½è¦æ±‚ã€‚ å‡è®¾å¦‚ä¸‹çš„ç»“æ„å£°æ˜: struct S1 { int i; char c; int j; } å¦‚æœç¼–è¯‘å™¨ç”¨æœ€å°çš„9å­—èŠ‚åˆ†é…ï¼Œå†…å­˜å¸ƒå±€ä¼šæ˜¯è¿™æ ·: ä½†æ˜¯å®ƒä¸æ»¡è¶³å­—æ®µ i å’Œ j çš„4å­—èŠ‚å¯¹é½è¦æ±‚ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨åœ¨å­—æ®µ c å’Œ j ä¹‹é—´æ’å…¥ä¸€ä¸ª 3 å­—èŠ‚çš„é—´éš™: ","date":"2021-08-31","objectID":"/csapp/:2:9","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"3.10 åœ¨æœºå™¨çº§ç¨‹åºä¸­å°†æ§åˆ¶ä¸æ•°æ®ç»“åˆèµ·æ¥ 3.10.1 ç†è§£æŒ‡é’ˆ ä¸€äº›æŒ‡é’ˆå’Œå®ƒä»¬æ˜ å°„åˆ°æœºå™¨ä»£ç çš„å…³é”®åŸåˆ™: æ¯ä¸ªæŒ‡é’ˆéƒ½å¯¹åº”ä¸€ä¸ªç±»å‹ã€‚è¿™ä¸ªç±»å‹è¡¨æ˜è¯¥æŒ‡é’ˆæŒ‡å‘çš„æ˜¯å“ªä¸€ç±»å¯¹è±¡ã€‚ æ¯ä¸ªæŒ‡é’ˆéƒ½æœ‰ä¸€ä¸ªå€¼ã€‚è¿™ä¸ªå€¼æ˜¯æŸä¸ªæŒ‡å®šç±»å‹çš„å¯¹è±¡çš„åœ°å€ã€‚ç‰¹æ®Šçš„ NULL(0) å€¼è¡¨ç¤ºè¯¥æŒ‡é’ˆæ²¡æœ‰æŒ‡å‘ä»»ä½•åœ°æ–¹ã€‚ æŒ‡é’ˆç”¨ â€˜\u0026â€™ è¿ç®—ç¬¦åˆ›å»ºã€‚ *æ“ä½œç¬¦ç”¨äºé—´æ¥å¼•ç”¨æŒ‡é’ˆã€‚å…¶ç»“æœæ˜¯ä¸€ä¸ªå€¼ï¼Œå®ƒçš„ç±»å‹ä¸è¯¥æŒ‡é’ˆçš„ç±»å‹ä¸€è‡´ã€‚é—´æ¥å¼•ç”¨æ˜¯ç”¨å†…å­˜æ¥å®ç°çš„ï¼Œè¦ä¹ˆæ˜¯å­˜å‚¨åˆ°ä¸€ä¸ªæŒ‡å®šçš„åœ°å€ï¼Œè¦ä¹ˆæ˜¯ä»æŒ‡å®šçš„åœ°å€è¯»å–ã€‚ æ•°ç»„ä¸æŒ‡é’ˆç´§å¯†è”ç³»ã€‚ä¸€ä¸ªæ•°ç»„çš„åå­—å¯ä»¥åƒä¸€ä¸ªæŒ‡é’ˆå˜é‡ä¸€æ ·å¼•ç”¨(ä½†æ˜¯ä¸èƒ½ä¿®æ”¹)ã€‚ å°†æŒ‡é’ˆä»ä¸€ç§ç±»å‹å¼ºåˆ¶è½¬åŒ–æˆå¦ä¸€ä¸ªç±»å‹ï¼Œåªæ”¹å˜å®ƒçš„ç±»å‹ï¼Œè€Œä¸æ”¹å˜å®ƒçš„å€¼ã€‚å¼ºåˆ¶ç±»å‹è½¬æ¢çš„ä¸€ä¸ªæ•ˆæœæ˜¯æ”¹å˜æŒ‡é’ˆè¿ç®—çš„ä¼¸ç¼©ã€‚ æŒ‡é’ˆä¹Ÿå¯ä»¥æŒ‡å‘å‡½æ•°ã€‚è¿™æä¾›äº†ä¸€ä¸ªå¾ˆå¼ºå¤§çš„å­˜å‚¨å’Œå‘ä»£ç ä¼ é€’å¼•ç”¨çš„åŠŸèƒ½ï¼Œè¿™ä¸ªå¼•ç”¨å¯ä»¥è¢«ç¨‹åºçš„æŸä¸ªå…¶ä»–éƒ¨åˆ†è°ƒç”¨ã€‚ å‡½æ•°æŒ‡é’ˆ: #include \u003cstdio.h\u003e int fun(int x, int *p); int (*fp)(int, int *); int main() { fp = fun; int y = 1; int result = fp(3, \u0026y); printf(\"%d\\n\", result); } int fun(int x, int *p) { *p += x; return *p; } ","date":"2021-08-31","objectID":"/csapp/:2:10","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"3.11 æµ®ç‚¹ä»£ç  å¤„ç†å™¨çš„æµ®ç‚¹ç³»ç»Ÿç»“æ„åŒ…æ‹¬å¤šä¸ªæ–¹é¢ï¼Œä¼šå½±å“å¯¹æµ®ç‚¹æ•°æ®æ“ä½œçš„ç¨‹åºå¦‚ä½•è¢«æ˜ å°„åˆ°æœºå™¨ä¸Šï¼ŒåŒ…æ‹¬: å¦‚ä½•å­˜å‚¨å’Œè®¿é—®æµ®ç‚¹æ•°æ®ã€‚é€šå¸¸æ˜¯é€šè¿‡æŸç§å¯„å­˜å™¨æ–¹å¼æ¥å®Œæˆã€‚ å¯¹æµ®ç‚¹æ•°æ®æ“ä½œçš„æŒ‡ä»¤ã€‚ å‘å‡½æ•°ä¼ é€’æµ®ç‚¹æ•°å‚æ•°å’Œä»å‡½æ•°è¿”å›æµ®ç‚¹æ•°ç»“æ„çš„è§„åˆ™ã€‚ å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­ä¿å­˜å¯„å­˜å™¨çš„è§„åˆ™ã€‚ x86-64 æµ®ç‚¹ä½“ç³»ç»“æ„çš„å†å²: å¦‚å›¾æ‰€ç¤ºï¼ŒAVX æµ®ç‚¹ä½“ç³»ç»“æ„å…è®¸æ•°æ®å­˜å‚¨åœ¨ 16 ä¸ª YMM å¯„å­˜å™¨ä¸­ï¼Œåå­—æ˜¯ %ymm0~%ymm15ã€‚æ¯ä¸ª YMM å¯„å­˜å™¨éƒ½æ˜¯ 256(32 å­—èŠ‚)ã€‚å½“å¯¹æ ‡é‡æ•°æ®æ“ä½œæ—¶ï¼Œè¿™äº›å¯„å­˜å™¨å€¼ä¿å­˜æµ®ç‚¹æ•°ï¼Œè€Œä¸”åªä½¿ç”¨ä½ 32 ä½(å¯¹äº float) æˆ– 64 ä½(å¯¹äº double)ã€‚æ±‡ç¼–ä»£ç ç”¨å¯„å­˜å™¨çš„ SSE XMM å¯„å­˜å™¨åå­— %xmm0~%xmm15 æ¥å¼•ç”¨å®ƒä»¬ï¼Œæ¯ä¸ª XMM å¯„å­˜å™¨éƒ½æ˜¯å¯¹åº”çš„ YMM å¯„å­˜å™¨çš„ä½ 128 ä½(16å­—èŠ‚)ã€‚ 3.11.1 æµ®ç‚¹ä¼ é€å’Œè½¬åŒ–æ“ä½œ GCC åªç”¨æ ‡é‡ä¼ é€æ“ä½œä»å†…å­˜ä¼ é€æ•°æ®åˆ° XMM å¯„å­˜å™¨æˆ–ä» XMM å¯„å­˜å™¨ä¼ é€æ•°æ®åˆ°å†…å­˜ã€‚å¯¹äºåœ¨ä¸¤ä¸ª XMM å¯„å­˜å™¨ä¹‹é—´ä¼ é€æ•°æ®ï¼ŒGCC ä¼šä½¿ç”¨ä¸¤ç§æŒ‡ä»¤ä¹‹ä¸€ï¼Œå³ç”¨ vmpovaps ä¼ é€å•ç²¾åº¦æ•°ï¼Œç”¨ vmovapd ä¼ é€åŒç²¾åº¦æ•°ã€‚å¯¹äºè¿™äº›æƒ…å†µï¼Œç¨‹åºå¤åˆ¶æ•´ä¸ªå¯„å­˜å™¨è¿˜æ˜¯åªå¤åˆ¶ä½ä½å€¼ã€‚æ—¢ä¸ä¼šå½±å“ç¨‹åºåŠŸèƒ½ï¼Œä¹Ÿä¸ä¼šå½±å“æ‰§è¡Œé€Ÿåº¦ï¼Œæ‰€ä»¥ä½¿ç”¨è¿™äº›æŒ‡ä»¤è¿˜æ˜¯é’ˆå¯¹æ ‡é‡æ•°æ®çš„äººæŒ‡ä»¤æ²¡æœ‰å®è´¨ä¸Šçš„å·®åˆ«ã€‚æŒ‡ä»¤åå­—ä¸­çš„å­—æ¯ â€˜aâ€™ è¡¨ç¤º â€œaligned(å¯¹é½çš„)\"ã€‚å½“ç”¨äºè¯»å†™å†…å­˜æ˜¯ï¼Œå¦‚æœåœ°å€ä¸æ»¡è¶³16å­—èŠ‚å¯¹é½ï¼Œå®ƒä»¬ä¼šå¯¼è‡´å¼‚å¸¸ã€‚åœ¨ä¸¤ä¸ªå¯„å­˜å™¨ä¹‹é—´ä¼ é€æ•°æ®ï¼Œç»ä¸ä¼šå‡ºç°é”™è¯¯å¯¹é½çš„çŠ¶å†µã€‚ æµ®ç‚¹æ•°å’Œæ•´æ•°æ•°æ®ç±»å‹ä¹‹é—´ä»¥åŠä¸åŒæµ®ç‚¹æ ¼å¼ä¹‹é—´è¿›è¡Œè½¬æ¢çš„æŒ‡ä»¤é›†åˆã€‚ æŠŠä¸€ä¸ªä» XMM å¯„å­˜å™¨æˆ–å†…å­˜ä¸­è¯»å‡ºçš„æµ®ç‚¹å€¼è¿›è¡Œè½¬æ¢ï¼Œå¹¶å°†ç»“æœå†™å…¥ä¸€ä¸ªé€šç”¨å¯„å­˜å™¨ã€‚æŠŠæµ®ç‚¹å€¼è½¬æ¢æˆæ•´æ•°æ—¶ï¼ŒæŒ‡ä»¤ä¼šæ‰§è¡Œæˆªæ–­(truncation)ï¼ŒæŠŠå€¼å‘ 0 è¿›è¡Œèˆå…¥ã€‚ 3.11.2 è¿‡ç¨‹ä¸­çš„æµ®ç‚¹ä»£ç  åœ¨ x86-64 ä¸­ï¼ŒXMM å¯„å­˜å™¨ç”¨æ¥å‘å‡½æ•°ä¼ é€’æµ®ç‚¹å‚æ•°ï¼Œä»¥åŠä»å‡½æ•°è¿”å›æµ®ç‚¹å€¼ã€‚å…·æœ‰ä»¥ä¸‹è§„åˆ™: XMM å¯„å­˜å™¨ %xmm0~%xmm7 æœ€å¤šå¯ä»¥ä¼ é€’ 8 ä¸ªæµ®ç‚¹å‚æ•°ã€‚æŒ‰ç…§å‚æ•°åˆ—å‡ºçš„é¡ºåºä½¿ç”¨è¿™äº›å¯„å­˜å™¨ã€‚å¯ä»¥é€šè¿‡æ ˆä¼ é€’é¢å¤–çš„æµ®ç‚¹å‚æ•°ã€‚ å‡½æ•°ä½¿ç”¨å¯„å­˜å™¨ %xmm0 æ¥è¿”å›æµ®ç‚¹å€¼ã€‚ æ‰€æœ‰çš„ XMM å¯„å­˜å™¨éƒ½æ˜¯è°ƒç”¨è€…ä¿å­˜çš„ã€‚è¢«è°ƒç”¨è€…å¯ä»¥ä¸åŒä¿å­˜å°±è¦†ç›–è¿™äº›å¯„å­˜å™¨ä¸­ä»»æ„ä¸€ä¸ªã€‚ å½“å‡½æ•°åŒ…å«æŒ‡é’ˆã€æ•´æ•°å’Œæµ®ç‚¹æ•°æ··åˆçš„å‚æ•°æ—¶ï¼ŒæŒ‡é’ˆå’Œæ•´æ•°é€šè¿‡é€šç”¨å¯„å­˜å™¨ä¼ é€’ï¼Œè€Œæµ®ç‚¹å€¼é€šè¿‡ XMM å¯„å­˜å™¨ä¼ é€’ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‚æ•°åˆ°å¯„å­˜å™¨çš„æ˜ å°„å–å†³äºå®ƒä»¬çš„ç±»å‹å’Œæ’åˆ—çš„é¡ºåºã€‚ä¾‹å¦‚: // è¿™ä¸ªå‡½æ•°ä¼šæŠŠ x å­˜æ”¾åœ¨ %edi ä¸­ï¼Œy æ”¾åœ¨ %xmm0 ä¸­ï¼Œz æ”¾åœ¨ %rsi ä¸­ã€‚ double f1(int x, double y, long z); // è¿™ä¸ªå‡½æ•°çš„å¯„å­˜å™¨åˆ†é…ä¸å‡½æ•° f1 ç›¸åŒã€‚ double f2(double y, int x, long z); // è¿™ä¸ªå‡½æ•°ä¼šå°† x æ”¾åœ¨ %xmm0 ä¸­ï¼Œy æ”¾åœ¨ %rdi ä¸­ï¼Œz æ”¾åœ¨ %rsi ä¸­ã€‚ double f1(float x, double *y, long *z); 3.11.3 æµ®ç‚¹è¿ç®—æ“ä½œ ä¸‹å›¾æè¿°äº†ä¸€ç»„æ‰§è¡Œç®—æœ¯è¿ç®—çš„æ ‡é‡ AVX2 æµ®ç‚¹æŒ‡ä»¤ã€‚æ¯æ¡æŒ‡ä»¤æœ‰ä¸€ä¸ª($S_1$)æˆ–ä¸¤ä¸ª($S_1, S_2$)ï¼Œå’Œä¸€ä¸ªç›®çš„æ“ä½œæ•° Dã€‚ç¬¬ä¸€ä¸ªæºæ“ä½œæ•° $S_1$ å¯ä»¥æ˜¯ä¸€ä¸ª XMM å¯„å­˜å™¨æˆ–ä¸€ä¸ªå†…å­˜ä½ç½®ã€‚ç¬¬äºŒä¸ªæºæ“ä½œæ•°å’Œç›®çš„æ“ä½œæ•°éƒ½å¿…é¡»æ˜¯ XMM å¯„å­˜å™¨ã€‚æ¯ä¸ªæ“ä½œå¤šæœ‰ä¸€æ¡é’ˆå¯¹å½“ç²¾åº¦çš„æŒ‡ä»¤å’Œä¸€æ¡é’ˆå¯¹åŒç²¾åº¦çš„æŒ‡ä»¤ã€‚ç»“æœå­˜æ”¾åœ¨ç›®çš„å¯„å­˜å™¨ä¸­ã€‚ 3.11.4 å®šä¹‰å’Œä½¿ç”¨æµ®ç‚¹å¸¸æ•° å’Œæ•´æ•°è¿ç®—æ“ä½œä¸åŒï¼ŒAVX æµ®ç‚¹æ“ä½œä¸èƒ½ä»¥ç«‹å³æ•°å€¼ä½œä¸ºæ“ä½œæ•°ã€‚ç›¸åï¼Œç¼–è¯‘å™¨å¿…é¡»ä¸ºæ‰€æœ‰çš„å¸¸é‡å€¼åˆ†é…å’Œåˆå§‹åŒ–å­˜å‚¨ç©ºé—´ã€‚ç„¶åä»£ç å†æŠŠè¿™äº›å€¼ä»å†…å­˜è¯»å…¥ã€‚ 3.11.5 åœ¨æµ®ç‚¹ä»£ç ä¸­ä½¿ç”¨ä½çº§æ“ä½œ 3.11.6 æµ®ç‚¹æ¯”è¾ƒæ“ä½œ æµ®ç‚¹æ¯”è¾ƒæŒ‡ä»¤ä¼šè®¾ç½®ä¸‰ä¸ªæ¡ä»¶ç : é›¶æ ‡å¿—ä½ ZF, è¿›ä½æ ‡å¿—ä½ CF å’Œå¥‡å¶æ ‡å¿—ä½ PFã€‚ ","date":"2021-08-31","objectID":"/csapp/:2:11","tags":["è®¡ç®—æœº"],"title":"æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ","uri":"/csapp/"},{"categories":["ç¬”è®°"],"content":"æŸ¥è¯¢æ‰€æœ‰è§¦å‘å™¨ select*fromuser_triggers; æ ¹æ®åç§°ç¦ç”¨è§¦å‘å™¨ altertriggerLOGMNRGGC_TRIGGERdisable; æŸ¥è¯¢æ‰€æœ‰ job select*fromuser_jobs; æ ¹æ® id ç¦ç”¨ job BEGINdbms_job.broken(4001,true);END; ç¦ç”¨ oracle dblink altersystemsetopen_links=0sid='$sid'scope=spfile;altersystemsetopen_links_per_instance=0sid='$sid'scope=spfile; å¯ç”¨ oracle dblink altersystemsetopen_links=4sid='$sid'scope=spfile;altersystemsetopen_links_per_instance=4sid='$sid'scope=spfile; ","date":"2021-08-30","objectID":"/dblink/:0:0","tags":["oracle"],"title":"Dblink","uri":"/dblink/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"ç®€ä»‹ libguestfs æ˜¯ä¸€å¥—ç®¡ç†è™šæ‹Ÿæœºé•œåƒçš„å·¥å…·ã€‚å®ƒæä¾›ä»¥ä¸€ç³»åˆ—å‘½ä»¤å’ŒAPIæ¥ä¿®æ”¹å’Œç®¡ç†è™šæ‹Ÿæœºçš„é•œåƒã€‚ å®‰è£… ç›´æ¥ä½¿ç”¨ yum å®‰è£… libguestfs : yum install -y libguestfs-tool libguestfs-devel é»˜è®¤ä¸æ”¯æŒä¿®æ”¹ windows é•œåƒï¼Œå¯ä»¥å®‰è£… libguestfs-winsupport : yum install -y libguestfs-winsupport libguestfs å‘½ä»¤ libguestfs çš„é€šç”¨å‚æ•° -a|â€“add image : æŒ‡å®šæŸ¥çœ‹çš„é•œåƒæ–‡ä»¶è·¯å¾„ -c|â€“connect uri : æŒ‡å®šè¿œç¨‹ libvirt åœ°å€ -d|â€“domain guest : æŒ‡å®š libvirt ä¸Šçš„ domain åç§° æ³¨: libguestfs çš„å‘½ä»¤éœ€è¦è°ƒç”¨ libvirt æ‰€ä»¥å“åº”çš„é€Ÿåº¦ä¼šæ¯”è¾ƒæ…¢ã€‚åŒæ—¶ï¼Œå¦‚æœå‘½ä»¤ä¼šä¿®æ”¹é•œåƒçš„å†…å®¹ï¼Œéœ€è¦å…ˆå…³é—­åŸŸï¼Œé¿å…é€ æˆæ•°æ®ä¸åŒæ­¥ã€‚ ","date":"2021-01-31","objectID":"/libguestfs/:0:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"virt-inspector virt-inspector å‘½ä»¤ç”¨æ¥æŸ¥çœ‹é•œåƒä¿¡æ¯ï¼Œè¾“å‡ºæ ¼å¼ä¸º xml $ virt-inspector -d centos \u003c?xml version=\"1.0\"?\u003e \u003coperatingsystems\u003e \u003coperatingsystem\u003e \u003croot\u003e/dev/centos/root\u003c/root\u003e \u003cname\u003elinux\u003c/name\u003e \u003carch\u003ex86_64\u003c/arch\u003e \u003cdistro\u003ecentos\u003c/distro\u003e \u003cproduct_name\u003eCentOS Linux release 7.6.1810 (Core) \u003c/product_name\u003e \u003cmajor_version\u003e7\u003c/major_version\u003e \u003cminor_version\u003e6\u003c/minor_version\u003e \u003cpackage_format\u003erpm\u003c/package_format\u003e \u003cpackage_management\u003eyum\u003c/package_management\u003e \u003chostname\u003elocalhost.localdomain\u003c/hostname\u003e \u003cosinfo\u003ecentos7.0\u003c/osinfo\u003e \u003cmountpoints\u003e \u003cmountpoint dev=\"/dev/centos/root\"\u003e/\u003c/mountpoint\u003e \u003cmountpoint dev=\"/dev/sda1\"\u003e/boot\u003c/mountpoint\u003e \u003c/mountpoints\u003e \u003cfilesystems\u003e \u003cfilesystem dev=\"/dev/centos/root\"\u003e \u003ctype\u003exfs\u003c/type\u003e \u003cuuid\u003e12e94e0d-93e6-4714-9c61-116fbe994936\u003c/uuid\u003e \u003c/filesystem\u003e ... ... \u003cxml\u003e ","date":"2021-01-31","objectID":"/libguestfs/:1:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"virt-watch virt-watch æŸ¥çœ‹æœ¬æœºè™šæ‹ŸåŒ–ç¯å¢ƒ $ virt-what vmware ","date":"2021-01-31","objectID":"/libguestfs/:2:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"virt-host-validator virt-host-validator æ£€æŸ¥æœ¬åœ°ç¯å¢ƒæ˜¯å¦ç¬¦åˆè™šæ‹ŸåŒ– $ virt-host-validate QEMU: æ­£åœ¨æ£€æŸ¥ for hardware virtualization : PASS QEMU: æ­£åœ¨æ£€æŸ¥ if device /dev/kvm exists : PASS QEMU: æ­£åœ¨æ£€æŸ¥ if device /dev/kvm is accessible : PASS QEMU: æ­£åœ¨æ£€æŸ¥ if device /dev/vhost-net exists : PASS ... ... ","date":"2021-01-31","objectID":"/libguestfs/:3:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"virt-get-kernel virt-get-kernel è·å–é•œåƒçš„å†…æ ¸æ–‡ä»¶ $ virt-get-kernel -d centos download: /boot/vmlinuz-3.10.0-957.el7.x86_64 -\u003e ./vmlinuz-3.10.0-957.el7.x86_64 download: /boot/initramfs-3.10.0-957.el7.x86_64.img -\u003e ./initramfs-3.10.0-957.el7.x86_64.img ","date":"2021-01-31","objectID":"/libguestfs/:4:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"virt-filesystems virt-filesystems æŸ¥çœ‹é•œåƒçš„æ–‡ä»¶ç³»ç»Ÿ $ virt-filesystems -d centos /dev/sda1 /dev/centos/root ","date":"2021-01-31","objectID":"/libguestfs/:5:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"virt-df virt-df ç”¨æ¥æŸ¥çœ‹é•œåƒçš„æ–‡ä»¶ç³»ç»Ÿå®¹é‡ï¼ŒåŒ df å‘½ä»¤ $ virt-df -d centos -h æ–‡ä»¶ç³»ç»Ÿ å¤§å° å·²ç”¨ç©ºé—´ å¯ç”¨ç©ºé—´ ä½¿ç”¨ç™¾åˆ†æ¯”% centos:/dev/sda1 1014M 100M 914M 10% centos:/dev/centos/root 17G 974M 16G 6% ","date":"2021-01-31","objectID":"/libguestfs/:6:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"virt-ls virt-ls æŸ¥çœ‹é•œåƒçš„æ–‡ä»¶ä¿¡æ¯ï¼ŒåŒ ls å‘½ä»¤ $ virt-ls -d centos /root/ -l total 28 dr-xr-x---. 2 root root 135 Jan 26 15:07 . dr-xr-xr-x. 17 root root 224 Jan 16 09:56 .. -rw-------. 1 root root 45 Jan 26 15:07 .bash_history -rw-r--r--. 1 root root 18 Dec 29 2013 .bash_logout -rw-r--r--. 1 root root 176 Dec 29 2013 .bash_profile -rw-r--r--. 1 root root 176 Dec 29 2013 .bashrc -rw-r--r--. 1 root root 100 Dec 29 2013 .cshrc -rw-r--r--. 1 root root 129 Dec 29 2013 .tcshrc -rw-------. 1 root root 1259 Jan 16 09:57 anaconda-ks.cfg ","date":"2021-01-31","objectID":"/libguestfs/:7:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"virt-cat virt-cat æŸ¥çœ‹é•œåƒå†…çš„æ–‡ä»¶å†…å®¹ï¼ŒåŒ cat å‘½ä»¤ $ virt-cat -d centos /etc/passwd root:xx:0:0:root:/root:/bin/bash ... ... ","date":"2021-01-31","objectID":"/libguestfs/:8:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"virt-log virt-log æŸ¥çœ‹é•œåƒçš„æ—¥å¿—ä¿¡æ¯ $ virt-log -d centos Jan 30 20:13:01 localhost rsyslogd: [origin software=\"rsyslogd\" swVersion=\"8.24.0-34.el7\" x-pid=\"3123\" x-info=\"http://www.rsyslog.com\"] rsyslogd was HUPed Jan 30 20:33:37 localhost qemu-ga: info: guest-shutdown called, mode: powerdown Jan 30 20:33:37 localhost systemd: Started Delayed Shutdown Service. ","date":"2021-01-31","objectID":"/libguestfs/:9:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"virt-tail virt-tail ç›‘å¬æ–‡ä»¶å†…å®¹ï¼ŒåŒ tail å‘½ä»¤ $ virt-tail -d centos /var/log/messages --- /var/log/messages --- ... ","date":"2021-01-31","objectID":"/libguestfs/:10:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"virt-alignment-scan virt-alignment-scan æŸ¥çœ‹é•œåƒåˆ†åŒºæ˜¯å¦å¯¹é½ $ virt-alignment-scan -a centos.qcow2 /dev/sda1 1048576 1024K ok /dev/sda2 1074790400 1024K ok ","date":"2021-01-31","objectID":"/libguestfs/:11:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"virt-diff virt-diff æ¯”è¾ƒé•œåƒé—´çš„ä¸åŒ $ # virt-diff -a centos.qcow2 -A centos.img - d 0550 150 /root + d 0550 135 /root # changed: st_size - - 0644 4 /root/kvm.txt - d 1777 187 /tmp + d 1777 172 /tmp # changed: st_size - - 0644 4 /tmp/kvm.txt ","date":"2021-01-31","objectID":"/libguestfs/:12:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"virt-sparisify virt-sparisify ç”¨æ¥æ¶ˆé™¤é•œåƒå†…çš„ç©ºæ´æ–‡ä»¶ï¼Œå‡å°‘é•œåƒå¤§å° $ virt-sparsify centos.qcow2 -f qcow2 centos2.qcow2 [ 0.0] Create overlay file in /tmp to protect source disk [ 0.0] Examine source disk [ 3.4] Fill free space in /dev/centos/root with zero 100% âŸ¦â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’âŸ§ 00:00 [ 33.5] Clearing Linux swap on /dev/centos/swap 100% âŸ¦â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’âŸ§ --:-- [ 36.2] Fill free space in /dev/sda1 with zero [ 38.5] Copy to destination and make sparse [ 51.4] Sparsify operation completed with no errors. virt-sparsify: Before deleting the old disk, carefully check that the target disk boots and works correctly. æ‰§è¡Œå®Œæˆåç”Ÿæˆ centos2.qcow2 æ–‡ä»¶: $ ll -h æ€»ç”¨é‡ 4.0G -rw-r--r-- 1 root root 1.1G 1æœˆ 30 23:39 centos2.qcow2 -rw-r--r-- 1 root root 1.5G 1æœˆ 30 20:33 centos.img -rw-r--r-- 1 root root 1.5G 1æœˆ 30 20:43 centos.qcow2 ","date":"2021-01-31","objectID":"/libguestfs/:13:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"virt-copy-in virt-copy-in å°†æœ¬åœ°æ–‡ä»¶å¤åˆ¶åˆ°é•œåƒä¸­ $ virt-copy-in -a centos.qcow2 kvm.txt /tmp/ $ virt-ls -a centos.qcow2 /tmp/ kvm.txt ","date":"2021-01-31","objectID":"/libguestfs/:14:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"virt-copy-out virt-copy-out å°†é•œåƒä¸­çš„æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ° $ virt-copy-out -a centos.qcow2 /tmp/kvm.txt . ","date":"2021-01-31","objectID":"/libguestfs/:15:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"virt-edit virt-edit ç¼–è¯‘é•œåƒå†…çš„æ–‡ä»¶ï¼Œé»˜è®¤ä¼šæ‰“å¼€æœ¬åœ°çš„ Vim è¿›è¡Œç¼–è¾‘ $ virt-edit -a centos.qcow2 /tmp/kvm.txt $ virt-cat -a centos.qcow2 /tmp/kvm.txt kvm kvm11 ","date":"2021-01-31","objectID":"/libguestfs/:16:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"virt-make-fs virt-make-fs æ ¹æ®æœ¬åœ°çš„ç›®å½•åˆ›å»ºä¸€ä¸ªé•œåƒ $ mkdir /input $ echo \"input\" \u003e /input/1.txt $ virt-make-fs --partition=gpt --type=ntfs --size=1G --format=qcow2 /input sdb.qcow2 ","date":"2021-01-31","objectID":"/libguestfs/:17:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"virt-tar-in virt-tar-in tar å‹ç¼©æ–‡ä»¶æ‹·è´è¿›è™šæ‹Ÿæœºå¹¶è§£å‹ $ virt-tar-in -a centos.qcow2 kvm.tar /root/ ","date":"2021-01-31","objectID":"/libguestfs/:18:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"virt-tar-out virt-tar-out é•œåƒå†…æŒ‡å®šç›®å½•æ–‡ä»¶æ‹·è´å¹¶å‹ç¼© $ virt-tar-out -a centos.qcow2 /root root.tar ","date":"2021-01-31","objectID":"/libguestfs/:19:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"guestmount guestmount å°†é•œåƒä¸­çš„æ–‡ä»¶ç³»ç»Ÿåˆ†åŒºæŒ‚è½½åˆ°æœ¬åœ°ç›®å½• $ guestmount -a centos.qcow2 -m /dev/sda1 /mnt ","date":"2021-01-31","objectID":"/libguestfs/:20:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"guestumount guestumount å¸è½½ guestmount æŒ‚è½½çš„ç›®å½• $ guestumount /mnt ","date":"2021-01-31","objectID":"/libguestfs/:21:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"virt-rescue virt-rescue è¿›å…¥æ•‘æ´æ¨¡å¼ï¼Œä¿®å¤é•œåƒ $ virt-rescue -a centos.qcow2 ","date":"2021-01-31","objectID":"/libguestfs/:22:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"virt-resize virt-resize é•œåƒåˆ†åŒºç¼©å®¹å’Œæ‰©å®¹ ç»™å…¶ä¸­æŸä¸ªåˆ†åŒºæ‰©å®¹ 5G $ virt-filesystems --long -h --all -a olddisk $ truncate -r olddisk newdisk $ truncate -s +5G newdisk $ virt-resize --expand /dev/sda2 olddisk newdisk /boot åˆ†åŒºæ‰©å®¹ 200MB bigger, å‰©ä¸‹çš„åˆ†é…ç»™ /dev/sda2: $ virt-resize --resize /dev/sda1=+200M --expand /dev/sda2 olddisk newdisk lvm åˆ†åŒºæ‰©å®¹ $ virt-resize --expand /dev/sda2 --LV-expand /dev/vg_guest/lv_root olddisk newdisk ","date":"2021-01-31","objectID":"/libguestfs/:23:0","tags":["kvm","linux"],"title":"KVMé•œåƒç®¡ç†å·¥å…·libguestfs","uri":"/libguestfs/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"qemu-img æ˜¯ QEMU çš„ç£ç›˜ç®¡ç†å·¥å…·ï¼Œå®ƒå…è®¸ç”¨æˆ·åˆ›å»ºã€è½¬åŒ–ã€ä¿®æ”¹ QEMU ç£ç›˜ã€‚ æ³¨ï¼šqemu-img æ“ä½œç£ç›˜æ—¶éœ€è¦å…³é—­ kvm è™šæ‹Ÿæœºï¼Œç›´æ¥åœ¨è™šæ‹Ÿæœºè¿è¡Œæ—¶ä¿®æ”¹ç£ç›˜å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ç”šè‡³å¯¼è‡´ç£ç›˜æŸåã€‚ qemu-img åŸºæœ¬å‘½ä»¤ ","date":"2021-01-17","objectID":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/:0:0","tags":["kvm","linux"],"title":"qemu-imgå‘½ä»¤ä½¿ç”¨","uri":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"check è¯­æ³•: check [-f fmt] filename å¯¹ç£ç›˜é•œåƒæ–‡ä»¶è¿›è¡Œä¸€è‡´æ€§æ£€æŸ¥ï¼ŒæŸ¥æ‰¾é•œåƒæ–‡ä»¶ä¸­çš„é”™è¯¯ï¼Œç›®å‰ä»…æ”¯æŒå¯¹â€œqcow2â€ã€â€œqedâ€ã€â€œvdiâ€æ ¼å¼æ–‡ä»¶çš„æ£€æŸ¥ã€‚å…¶ä¸­ï¼Œqcow2 æ˜¯ QEMU 0.8.3ç‰ˆæœ¬å¼•å…¥çš„é•œåƒæ–‡ä»¶æ ¼å¼ï¼Œä¹Ÿæ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„æ ¼å¼ã€‚qedï¼ˆQEMU enhanced diskï¼‰æ˜¯ä» QEMU 0.14 ç‰ˆå¼€å§‹åŠ å…¥çš„å¢å¼ºç£ç›˜æ–‡ä»¶æ ¼å¼ï¼Œä¸ºäº†é¿å… qcow2 æ ¼å¼çš„ä¸€äº›ç¼ºç‚¹ï¼Œä¹Ÿä¸ºäº†æé«˜æ€§èƒ½ï¼Œä¸è¿‡ç›®å‰è¿˜ä¸å¤Ÿæˆç†Ÿã€‚è€Œ vdiï¼ˆVirtual Disk Imageï¼‰æ˜¯ Oracle çš„ VirtualBox è™šæ‹Ÿæœºä¸­çš„å­˜å‚¨æ ¼å¼ã€‚å‚æ•°-f fmt æ˜¯æŒ‡å®šæ–‡ä»¶çš„æ ¼å¼ï¼Œå¦‚æœä¸æŒ‡å®šæ ¼å¼ qemu-img ä¼šè‡ªåŠ¨æ£€æµ‹ï¼Œfilename æ˜¯ç£ç›˜é•œåƒæ–‡ä»¶çš„åç§°ï¼ˆåŒ…æ‹¬è·¯å¾„ï¼‰ã€‚ # qemu-img check -f qcow2 sdb.qcow2 No errors were found on the image. Image end offset: 524288 ","date":"2021-01-17","objectID":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/:1:0","tags":["kvm","linux"],"title":"qemu-imgå‘½ä»¤ä½¿ç”¨","uri":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"create è¯­æ³•: create [-f fmt] [-o options] filename [size] åˆ›å»ºä¸€ä¸ªæ ¼å¼ä¸º fmtï¼Œå¤§å°ä¸º sizeï¼Œæ–‡ä»¶åä¸ºfilename çš„é•œåƒæ–‡ä»¶ã€‚æ ¹æ®æ–‡ä»¶æ ¼å¼ fmt çš„ä¸åŒï¼Œè¿˜å¯ä»¥æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªé€‰é¡¹ï¼ˆoptionsï¼‰æ¥é™„åŠ å¯¹è¯¥æ–‡ä»¶çš„å„ç§åŠŸèƒ½è®¾ç½®ï¼Œå¯ä»¥ä½¿ç”¨â€œ-o ?â€æ¥æŸ¥è¯¢æŸç§æ ¼å¼æ–‡ä»¶æ”¯æŒé‚£äº›é€‰é¡¹ï¼Œåœ¨â€œ-oâ€é€‰é¡¹ä¸­å„ä¸ªé€‰é¡¹ç”¨é€—å·æ¥åˆ†éš”ã€‚ å¦‚æœ â€œ-oâ€ é€‰é¡¹ä¸­ä½¿ç”¨äº† backing_file è¿™ä¸ªé€‰é¡¹æ¥æŒ‡å®šå…¶åç«¯é•œåƒæ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªåˆ›å»ºçš„é•œåƒæ–‡ä»¶ä»…è®°å½•ä¸åç«¯é•œåƒæ–‡ä»¶çš„å·®å¼‚éƒ¨åˆ†ã€‚åç«¯é•œåƒæ–‡ä»¶ä¸ä¼šè¢«ä¿®æ”¹ï¼Œé™¤éåœ¨ QEMU monitor ä¸­ä½¿ç”¨\"commit\" å‘½ä»¤æˆ–è€…ä½¿ç”¨ â€œqemu-img commitâ€ å‘½ä»¤å»æ‰‹åŠ¨æäº¤è¿™äº›æ”¹åŠ¨ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œsize å‚æ•°ä¸æ˜¯å¿…é¡»éœ€çš„ï¼Œå…¶å€¼é»˜è®¤ä¸ºåç«¯é•œåƒæ–‡ä»¶çš„å¤§å°ã€‚å¦å¤–ï¼Œç›´æ¥ä½¿ç”¨ â€œ-b backfileâ€ å‚æ•°ä¹Ÿä¸ â€œ-o backing_file=backfileâ€ æ•ˆæœç›¸åŒã€‚ size é€‰é¡¹ç”¨äºæŒ‡å®šé•œåƒæ–‡ä»¶çš„å¤§å°ï¼Œå…¶é»˜è®¤å•ä½æ˜¯å­—èŠ‚ï¼ˆbytesï¼‰ï¼Œä¹Ÿå¯ä»¥æ”¯æŒkï¼ˆæˆ–Kï¼‰ã€Mã€Gã€Tæ¥åˆ†åˆ«è¡¨ç¤ºKBã€MBã€GBã€TBå¤§å°ã€‚å¦å¤–ï¼Œé•œåƒæ–‡ä»¶çš„å¤§å°ï¼ˆsizeï¼‰ä¹Ÿå¹¶éå¿…é¡»å†™åœ¨å‘½ä»¤çš„æœ€åï¼Œå®ƒä¹Ÿå¯ä»¥è¢«å†™åœ¨ â€œ-oâ€ é€‰é¡¹ä¸­ä½œä¸ºå…¶ä¸­ä¸€ä¸ªé€‰é¡¹ã€‚ # qemu-img create -f qcow2 -o backing_file=sdb.qcow2 sdc.qcow2 10G qemu-img: warning: Deprecated use of backing file without explicit backing format (detected format of qcow2) Formatting 'sdc.qcow2', fmt=qcow2 cluster_size=65536 extended_l2=off compression_type=zlib size=10737418240 backing_file=sdb.qcow2 backing_fmt=qcow2 lazy_refcounts=off refcount_bits=16 # qemu-img create -f raw sdd.raw 10G Formatting 'sdd.raw', fmt=raw size=10737418240 ","date":"2021-01-17","objectID":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/:2:0","tags":["kvm","linux"],"title":"qemu-imgå‘½ä»¤ä½¿ç”¨","uri":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"commit è¯­æ³•: [-f fmt] [-t cache] filename æäº¤ filename æ–‡ä»¶ä¸­çš„æ›´æ”¹åˆ°åç«¯æ”¯æŒé•œåƒæ–‡ä»¶ï¼ˆåˆ›å»ºæ—¶é€šè¿‡ backing_file æŒ‡å®šçš„ï¼‰ä¸­å»ã€‚ # qemu-img commit sdc.qcow2 Image committed. ","date":"2021-01-17","objectID":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/:3:0","tags":["kvm","linux"],"title":"qemu-imgå‘½ä»¤ä½¿ç”¨","uri":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"convert è¯­æ³•: convert [-c] [-p] [-f fmt] [-t cache] [-O output_fmt] [-o options] [-s snapshot_name] [-S sparse_size] filename [filename2 [...]] output_filename å°†fmtæ ¼å¼çš„ filename é•œåƒæ–‡ä»¶æ ¹æ® options é€‰é¡¹è½¬æ¢ä¸ºæ ¼å¼ä¸º output_fmt çš„åä¸º output_filename çš„é•œåƒæ–‡ä»¶ã€‚å®ƒæ”¯æŒä¸åŒæ ¼å¼çš„é•œåƒæ–‡ä»¶ä¹‹é—´çš„è½¬æ¢ï¼Œæ¯”å¦‚å¯ä»¥ç”¨ VMware ç”¨çš„vmdk æ ¼å¼æ–‡ä»¶è½¬æ¢ä¸º qcow2 æ–‡ä»¶ï¼Œè¿™å¯¹ä»å…¶ä»–è™šæ‹ŸåŒ–æ–¹æ¡ˆè½¬ç§»åˆ° KVMä¸Š çš„ç”¨æˆ·éå¸¸æœ‰ç”¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¾“å…¥æ–‡ä»¶æ ¼å¼ fmt ç”± qemu-img å·¥å…·è‡ªåŠ¨æ£€æµ‹åˆ°ï¼Œè€Œè¾“å‡ºæ–‡ä»¶æ ¼å¼ output_fmt æ ¹æ®è‡ªå·±éœ€è¦æ¥æŒ‡å®šï¼Œé»˜è®¤ä¼šè¢«è½¬æ¢ä¸ºä¸ raw æ–‡ä»¶æ ¼å¼ï¼ˆä¸”é»˜è®¤ä½¿ç”¨ç¨€ç–æ–‡ä»¶çš„æ–¹å¼å­˜å‚¨ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´ï¼‰ã€‚ å…¶ä¸­ï¼Œ\"-c\" å‚æ•°æ˜¯å¯¹è¾“å‡ºçš„é•œåƒæ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œä¸è¿‡åªæœ‰ qcow2 å’Œ qcow æ ¼å¼çš„é•œåƒæ–‡ä»¶æ‰æ”¯æŒå‹ç¼©ï¼Œè€Œä¸”è¿™ç§å‹ç¼©æ˜¯åªè¯»çš„ï¼Œå¦‚æœå‹ç¼©çš„æ‰‡åŒºè¢«é‡å†™ï¼Œåˆ™ä¼šè¢«é‡å†™ä¸ºæœªå‹ç¼©çš„æ•°æ®ã€‚åŒæ ·å¯ä»¥ä½¿ç”¨ â€œ-o optionsâ€ æ¥æŒ‡å®šå„ç§é€‰é¡¹ï¼Œå¦‚ï¼šåç«¯é•œåƒã€æ–‡ä»¶å¤§å°ã€æ˜¯å¦åŠ å¯†ç­‰ç­‰ã€‚ä½¿ç”¨ backing_file é€‰é¡¹æ¥æŒ‡å®šåç«¯é•œåƒï¼Œè®©ç”Ÿæˆçš„æ–‡ä»¶æ˜¯ copy-on-writeçš„å¢é‡æ–‡ä»¶ï¼Œè¿™æ—¶å¿…é¡»è®©è½¬æ¢å‘½ä»¤ä¸­æŒ‡å®šçš„åç«¯é•œåƒä¸è¾“å…¥æ–‡ä»¶çš„åç«¯é•œåƒçš„å†…å®¹æ˜¯ç›¸åŒçš„ï¼Œå°½ç®¡å®ƒä»¬å„è‡ªåç«¯é•œåƒçš„ç›®å½•ã€æ ¼å¼å¯èƒ½ä¸åŒã€‚ å¦‚æœä½¿ç”¨ qcow2ã€qcowã€cow ç­‰ä½œä¸ºè¾“å‡ºæ–‡ä»¶æ ¼å¼æ¥è½¬æ¢rawæ ¼å¼çš„é•œåƒæ–‡ä»¶ï¼ˆéç¨€ç–æ–‡ä»¶æ ¼å¼ï¼‰ï¼Œé•œåƒè½¬æ¢è¿˜å¯ä»¥èµ·åˆ°å°†é•œåƒæ–‡ä»¶è½¬åŒ–ä¸ºæ›´å°çš„é•œåƒï¼Œå› ä¸ºå®ƒå¯ä»¥å°†ç©ºçš„æ‰‡åŒºåˆ é™¤ä½¿ä¹‹åœ¨ç”Ÿæˆçš„è¾“å‡ºæ–‡ä»¶ä¸­å¹¶ä¸å­˜åœ¨ã€‚ # qemu-img convert -p -f qcow2 -O raw sdc.qcow2 sdc.raw (100.00/100%) # qemu-img convert -c -p -f raw -O qcow2 sdc.raw sdcc.qcow2 (100.00/100%) ","date":"2021-01-17","objectID":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/:4:0","tags":["kvm","linux"],"title":"qemu-imgå‘½ä»¤ä½¿ç”¨","uri":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"info è¯­æ³•: [-f fmt] filename å±•ç¤º filename é•œåƒæ–‡ä»¶çš„ä¿¡æ¯ã€‚å¦‚æœæ–‡ä»¶æ˜¯ä½¿ç”¨ç¨€ç–æ–‡ä»¶çš„å­˜å‚¨æ–¹å¼ï¼Œä¹Ÿä¼šæ˜¾ç¤ºå‡ºå®ƒçš„æœ¬æ¥åˆ†é…çš„å¤§å°ä»¥åŠå®é™…å·²å ç”¨çš„ç£ç›˜ç©ºé—´å¤§å°ã€‚å¦‚æœæ–‡ä»¶ä¸­å­˜æ”¾æœ‰å®¢æˆ·æœºå¿«ç…§ï¼Œå¿«ç…§çš„ä¿¡æ¯ä¹Ÿä¼šè¢«æ˜¾ç¤ºå‡ºæ¥ã€‚ # qemu-img info sdc.qcow2 image: sdc.qcow2 file format: qcow2 virtual size: 10 GiB (10737418240 bytes) disk size: 256 KiB cluster_size: 65536 backing file: sdb.qcow2 backing file format: qcow2 Format specific information: compat: 1.1 compression type: zlib lazy refcounts: false refcount bits: 16 corrupt: false extended l2: false ","date":"2021-01-17","objectID":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/:5:0","tags":["kvm","linux"],"title":"qemu-imgå‘½ä»¤ä½¿ç”¨","uri":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"snapshot è¯­æ³•: snapshot [-l | -a snapshot | -c snapshot | -d snapshot] filename â€œ-lâ€ é€‰é¡¹æ˜¯æŸ¥è¯¢å¹¶åˆ—å‡ºé•œåƒæ–‡ä»¶ä¸­çš„æ‰€æœ‰å¿«ç…§ â€œ-a snapshotâ€ æ˜¯è®©é•œåƒæ–‡ä»¶ä½¿ç”¨æŸä¸ªå¿«ç…§ â€œ-c snapshotâ€ æ˜¯åˆ›å»ºä¸€ä¸ªå¿«ç…§ â€œ-dâ€ æ˜¯åˆ é™¤ä¸€ä¸ªå¿«ç…§ã€‚ # qemu-img snapshot -l sdb.qcow2 Snapshot list: ID TAG VM SIZE DATE VM CLOCK ICOUNT 1 sdb-ss1 0 B 2021-01-17 09:14:46 00:00:00.000 0 # qemu-img snapshot -c sdb-ss2 sdb.qcow2 # qemu-img snapshot -l sdb.qcow2 Snapshot list: ID TAG VM SIZE DATE VM CLOCK ICOUNT 1 sdb-ss1 0 B 2021-01-17 09:14:46 00:00:00.000 0 2 sdb-ss2 0 B 2021-01-17 09:15:11 00:00:00.000 0 # qemu-img snapshot -c sdb-ss3 sdb.qcow2 # qemu-img snapshot -l sdb.qcow2 Snapshot list: ID TAG VM SIZE DATE VM CLOCK ICOUNT 1 sdb-ss1 0 B 2021-01-17 09:14:46 00:00:00.000 0 2 sdb-ss2 0 B 2021-01-17 09:15:11 00:00:00.000 0 3 sdb-ss3 0 B 2021-01-17 09:15:21 00:00:00.000 0 # qemu-img snapshot -d sdb-ss2 sdb.qcow2 # qemu-img snapshot -l sdb.qcow2 Snapshot list: ID TAG VM SIZE DATE VM CLOCK ICOUNT 1 sdb-ss1 0 B 2021-01-17 09:14:46 00:00:00.000 0 3 sdb-ss3 0 B 2021-01-17 09:15:21 00:00:00.000 0 ","date":"2021-01-17","objectID":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/:6:0","tags":["kvm","linux"],"title":"qemu-imgå‘½ä»¤ä½¿ç”¨","uri":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"rebase è¯­æ³•: rebase [-f fmt] [-t cache] [-p] [-u] -b backing_file [-F backing_fmt] filename æ”¹å˜é•œåƒæ–‡ä»¶çš„åç«¯é•œåƒæ–‡ä»¶ï¼Œåªæœ‰ qcow2 å’Œ qed æ ¼å¼æ”¯æŒrebaseå‘½ä»¤ã€‚ä½¿ç”¨ â€œ-b backing_fileâ€ ä¸­æŒ‡å®šçš„æ–‡ä»¶ä½œä¸ºåç«¯é•œåƒï¼Œåç«¯é•œåƒä¹Ÿè¢«è½¬åŒ–ä¸º â€œ-F backing_fmtâ€ ä¸­æŒ‡å®šçš„åç«¯é•œåƒæ ¼å¼ã€‚ å®ƒå¯ä»¥å·¥ä½œäºä¸¤ç§æ¨¡å¼ä¹‹ä¸‹ï¼Œä¸€ç§æ˜¯å®‰å…¨æ¨¡å¼ï¼ˆSafe Modeï¼‰ä¹Ÿæ˜¯é»˜è®¤çš„æ¨¡å¼ï¼Œqemu-imgä¼šå»æ¯”è¾ƒåŸæ¥çš„åç«¯é•œåƒä¸ç°åœ¨çš„åç«¯é•œåƒçš„ä¸åŒè¿›è¡Œåˆç†çš„å¤„ç†ï¼›å¦ä¸€ç§æ˜¯éå®‰å…¨æ¨¡å¼ï¼ˆUnsafe Modeï¼‰ï¼Œæ˜¯é€šè¿‡ â€œ-uâ€ å‚æ•°æ¥æŒ‡å®šçš„ï¼Œè¿™ç§æ¨¡å¼ä¸»è¦ç”¨äºå°†åç«¯é•œåƒè¿›è¡Œäº†é‡å‘½åæˆ–è€…ç§»åŠ¨äº†ä½ç½®ä¹‹åå¯¹å‰ç«¯é•œåƒæ–‡ä»¶çš„ä¿®å¤å¤„ç†ï¼Œç”±ç”¨æˆ·å»ä¿è¯åç«¯é•œåƒçš„ä¸€è‡´æ€§ã€‚ # qemu-img rebase -f qcow2 -p -b sdc.qcow2 sdd.qcow2 qemu-img: warning: Deprecated use of backing file without explicit backing format, use of this image requires potentially unsafe format probing (100.00/100%) ","date":"2021-01-17","objectID":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/:7:0","tags":["kvm","linux"],"title":"qemu-imgå‘½ä»¤ä½¿ç”¨","uri":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"resize è¯­æ³•: resize filename [+ | -]size æ”¹å˜é•œåƒæ–‡ä»¶çš„å¤§å°ï¼Œä½¿å…¶ä¸åŒäºåˆ›å»ºä¹‹æ—¶çš„å¤§å°ã€‚\"+\" å’Œ â€œ-â€ åˆ†åˆ«è¡¨ç¤ºå¢åŠ å’Œå‡å°‘é•œåƒæ–‡ä»¶çš„å¤§å°ï¼Œè€Œ size ä¹Ÿæ˜¯æ”¯æŒ Kã€Mã€Gã€T ç­‰å•ä½çš„ä½¿ç”¨ã€‚ç¼©å°é•œåƒçš„å¤§å°ä¹‹å‰ï¼Œéœ€è¦åœ¨å®¢æˆ·æœºä¸­ä¿è¯é‡Œé¢çš„æ–‡ä»¶ç³»ç»Ÿæœ‰ç©ºä½™ç©ºé—´ï¼Œå¦åˆ™ä¼šæ•°æ®ä¸¢å¤±ï¼Œå¦å¤–ï¼Œqcow2 æ ¼å¼æ–‡ä»¶ä¸æ”¯æŒç¼©å°é•œåƒçš„æ“ä½œã€‚åœ¨å¢åŠ äº†é•œåƒæ–‡ä»¶å¤§å°åï¼Œä¹Ÿéœ€å¯åŠ¨å®¢æˆ·æœºåˆ°é‡Œé¢å»åº”ç”¨ â€œfdiskâ€ã€â€œpartedâ€ ç­‰åˆ†åŒºå·¥å…·è¿›è¡Œç›¸åº”çš„æ“ä½œæ‰èƒ½çœŸæ­£è®©å®¢æˆ·æœºä½¿ç”¨åˆ°å¢åŠ åçš„é•œåƒç©ºé—´ã€‚ä¸è¿‡ä½¿ç”¨ resize å‘½ä»¤æ—¶éœ€è¦å°å¿ƒï¼ˆæœ€å¥½åšå¥½å¤‡ä»½ï¼‰ï¼Œå¦‚æœå¤±è´¥çš„è¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´é•œåƒæ–‡ä»¶æ— æ³•æ­£å¸¸ä½¿ç”¨è€Œé€ æˆæ•°æ®ä¸¢å¤±ã€‚ # qemu-img resize sdd.qcow2 +2G Image resized. qemu-img æ”¯â€‹æŒâ€‹æ ¼â€‹å¼â€‹ ","date":"2021-01-17","objectID":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/:8:0","tags":["kvm","linux"],"title":"qemu-imgå‘½ä»¤ä½¿ç”¨","uri":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"raw Raw ç£â€‹ç›˜â€‹æ˜ â€‹åƒâ€‹æ ¼â€‹å¼â€‹ï¼ˆé»˜â€‹è®¤â€‹ï¼‰ã€‚â€‹è¿™â€‹ä¸ªâ€‹æ ¼â€‹å¼â€‹çš„â€‹ä¼˜â€‹ç‚¹â€‹æ˜¯â€‹å¯â€‹ä»¥â€‹ç®€â€‹å•â€‹ã€â€‹å®¹â€‹æ˜“â€‹åœ°â€‹å¯¼â€‹å‡ºâ€‹åˆ°â€‹å…¶â€‹å®ƒâ€‹æ¨¡â€‹æ‹Ÿâ€‹å™¨â€‹ä¸­â€‹ã€‚â€‹å¦‚â€‹æœâ€‹æ‚¨â€‹çš„â€‹æ–‡â€‹ä»¶â€‹ç³»â€‹ç»Ÿâ€‹æ”¯â€‹æŒâ€‹ä¸­â€‹æ–­â€‹ï¼ˆä¾‹â€‹å¦‚â€‹åœ¨â€‹ Linux ä¸­â€‹çš„â€‹ ext2 æˆ–â€‹è€…â€‹ ext3 ä»¥â€‹åŠâ€‹ Windows ä¸­â€‹çš„â€‹ NTFSï¼‰ï¼Œé‚£â€‹ä¹ˆâ€‹åªâ€‹æœ‰â€‹å†™â€‹å…¥â€‹çš„â€‹å­—â€‹æ®µâ€‹ä¼šâ€‹å â€‹ç”¨â€‹ç©ºâ€‹é—´â€‹ã€‚â€‹ä½¿â€‹ç”¨â€‹ qemu-img info äº†â€‹è§£â€‹ Unix/Linux ä¸­â€‹æ˜ â€‹åƒâ€‹æˆ–â€‹è€…â€‹ ls -ls ä½¿â€‹ç”¨â€‹çš„â€‹å®â€‹é™…â€‹å¤§â€‹å°â€‹ã€‚â€‹ ","date":"2021-01-17","objectID":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/:9:0","tags":["kvm","linux"],"title":"qemu-imgå‘½ä»¤ä½¿ç”¨","uri":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"qcow2 QEMU æ˜ â€‹åƒâ€‹æ ¼â€‹å¼â€‹ï¼Œæœ€â€‹ä¸‡â€‹èƒ½â€‹çš„â€‹æ ¼â€‹å¼â€‹ã€‚â€‹ä½¿â€‹ç”¨â€‹å®ƒâ€‹å¯â€‹è·â€‹å¾—â€‹è¾ƒâ€‹å°â€‹æ˜ â€‹åƒâ€‹ï¼ˆå¦‚â€‹æœâ€‹æ‚¨â€‹çš„â€‹ç³»â€‹ç»Ÿâ€‹ä¸â€‹æ”¯â€‹æŒâ€‹ä¸­â€‹æ–­â€‹ï¼Œä¾‹â€‹å¦‚â€‹åœ¨â€‹ Windows ä¸­â€‹ï¼Œå®ƒâ€‹ä¼šâ€‹å¾ˆâ€‹æœ‰â€‹ç”¨â€‹ï¼‰ã€â€‹é¢â€‹å¤–â€‹çš„â€‹ AES åŠ â€‹å¯†â€‹æ³•â€‹ã€â€‹zlib å‹â€‹ç¼©â€‹ä»¥â€‹åŠâ€‹å¯¹â€‹å¤šâ€‹ VM å¿«â€‹ç…§â€‹çš„â€‹æ”¯â€‹æŒâ€‹ã€‚â€‹ ","date":"2021-01-17","objectID":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/:10:0","tags":["kvm","linux"],"title":"qemu-imgå‘½ä»¤ä½¿ç”¨","uri":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"qcow æ—§â€‹çš„â€‹ QEMU æ˜ â€‹åƒâ€‹æ ¼â€‹å¼â€‹ã€‚â€‹åªâ€‹ç”¨â€‹äºâ€‹ä¸â€‹æ—§â€‹ç‰ˆâ€‹æœ¬â€‹å…¼â€‹å®¹â€‹ã€‚â€‹ ","date":"2021-01-17","objectID":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/:11:0","tags":["kvm","linux"],"title":"qemu-imgå‘½ä»¤ä½¿ç”¨","uri":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"cow å†™â€‹å…¥â€‹æ˜ â€‹åƒâ€‹æ ¼â€‹å¼â€‹çš„â€‹ç”¨â€‹æˆ·â€‹æ¨¡â€‹å¼â€‹ Linux å‰¯â€‹æœ¬â€‹ã€‚â€‹åŒ…â€‹å«â€‹ cow æ ¼â€‹å¼â€‹çš„â€‹ç›®â€‹çš„â€‹åªâ€‹æ˜¯â€‹ä¸ºâ€‹äº†â€‹ä¸â€‹å‰â€‹é¢â€‹çš„â€‹ç‰ˆâ€‹æœ¬â€‹å…¼â€‹å®¹â€‹ã€‚â€‹å®ƒâ€‹æ— â€‹æ³•â€‹åœ¨â€‹ Windows ä¸­â€‹ä½¿â€‹ç”¨â€‹ã€‚â€‹ ","date":"2021-01-17","objectID":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/:12:0","tags":["kvm","linux"],"title":"qemu-imgå‘½ä»¤ä½¿ç”¨","uri":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"vmdk VMware 3 å’Œâ€‹ 4 å…¼â€‹å®¹â€‹æ˜ â€‹åƒâ€‹æ ¼â€‹å¼â€‹ã€‚â€‹ ","date":"2021-01-17","objectID":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/:13:0","tags":["kvm","linux"],"title":"qemu-imgå‘½ä»¤ä½¿ç”¨","uri":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"cloop Linux å‹â€‹ç¼©â€‹å›â€‹é€â€‹æ˜ â€‹åƒâ€‹ï¼Œåªâ€‹æœ‰â€‹åœ¨â€‹é‡â€‹å¤â€‹ä½¿â€‹ç”¨â€‹ç›´â€‹æ¥â€‹å‹â€‹ç¼©â€‹çš„â€‹ CD-ROM æ˜ â€‹åƒâ€‹æ—¶â€‹æœ‰â€‹ç”¨â€‹ï¼Œæ¯”â€‹å¦‚â€‹åœ¨â€‹ Knoppix CD-ROM ä¸­â€‹ã€‚â€‹ ","date":"2021-01-17","objectID":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/:14:0","tags":["kvm","linux"],"title":"qemu-imgå‘½ä»¤ä½¿ç”¨","uri":"/qemu-img%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/"},{"categories":["åˆ†å¸ƒå¼"],"content":"æœ¬ç¯‡æä¾›ä¸€ä¸ªå®ç°åˆ†å¸ƒå¼å·¥ä½œæµçš„æ€è·¯ã€‚ ç³»ç»Ÿç»„æˆéƒ¨åˆ†ï¼š api (ç½‘å…³æ¥å£) : ä¸ºç”¨æˆ·æä¾›å·¥ä½œæµçš„apiæ¥å£ discovery (æœåŠ¡å‘ç°) : ç”¨äºæœåŠ¡çš„æ³¨å†Œå’Œå‘ç° scheduler (è°ƒåº¦ä¸­å¿ƒ) : æ•´ä½“å·¥ä½œæµçš„è°ƒåº¦ broker (æ¶ˆæ¯é˜Ÿåˆ—) : è®¢é˜…å‘å¸ƒå’Œæ•°æ®ä¼ è¾“ node (å·¥ä½œèŠ‚ç‚¹) : æ¯ä¸ªå·¥ä½œå•å…ƒçš„æä¾›è€…å’Œæ‰§è¡Œè€… å®ç°æ€è·¯ï¼š node å¯åŠ¨æ—¶ä¸Šä¼ æ¯ä¸ªå·¥ä½œå•å…ƒçš„åŸºæœ¬ä¿¡æ¯: åŒ…å«å·¥ä½œå•å…ƒè¾“å…¥è¾“å‡ºã€åç§°åŠå…¶ä»–å†…å®¹ scheduler ä¿å­˜è¿™äº›ä¿¡æ¯å¹¶æä¾›æ˜¾ç¤º scheduler æ¥æ”¶æ¥è‡ªå‰ç«¯çš„æ•°æ®å¹¶è½¬åŒ–æˆå·¥ä½œæµçš„ä¿¡æ¯ï¼Œå¹¶æ‰§è¡Œ å®ç°ç»†èŠ‚ï¼š scheduler åŠ¨æ€ç”Ÿæˆå·¥ä½œæµä¿¡æ¯ï¼Œåœ¨ broker ä¸­å¯åŠ¨ topic ä¸€ä¸ªè®¢é˜…è€…æ¥æ”¶å·¥ä½œæµçš„åŠ¨æ€ä¿¡æ¯ scheduler æ ¹æ®å·¥ä½œå•å…ƒä¿¡æ¯å¯»æ‰¾ node å¹¶ä¼ è¾“ä¿¡æ¯ node æ‰§è¡Œå¯¹åº”çš„å·¥ä½œå•å…ƒå‘å¸ƒä¿¡æ¯åˆ° broker ä¸­å·¥ä½œæµ topic scheduler æ¥æ”¶ topic ä¸­çš„ä¿¡æ¯ï¼Œå¦‚æœä¸­é—´å‘ç”Ÿé”™è¯¯ï¼Œæ‰§è¡Œå›æ»šæ“ä½œ node éœ€è¦çš„è¾“å…¥å‚æ•°ä¿å­˜åœ¨ context.Context ä¸­ï¼Œè¿”å›å‚æ•°åˆ™ publish åˆ° topic ä¸­ // å·¥ä½œå•å…ƒçš„æ¥å£ type WorkUnit interface { Do(ctx) error Undo(ctx) error String() string } type workflow struct{ units []WorkUnit } func Builder(ctx context.Context) *workflow { return \u0026workflow{} } func (w *workflow) Execute(ctx context.Context) error { undos := make([]func(ctx context.Context) error, 0) var err error defer func() { // å‘ç”Ÿé”™è¯¯åˆ™é€ä¸ªå›æ»š if err != nil { for _, undo := range undos { undo() } } } for _, unit := range w.units { err = unit.Do() if err != nil { // ä¸­é—´æŸæ­¥é”™è¯¯å°±ç»“æŸ return } // å›æ»šæ“ä½œå…¥æ ˆ undos = append(undos, unit.Undo) } } ","date":"2021-01-10","objectID":"/%E5%88%86%E5%B8%83%E5%BC%8F%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E5%AE%9E%E7%8E%B0/:0:0","tags":["golang","æƒ³æ³•"],"title":"åˆ†å¸ƒå¼çš„å·¥ä½œæµå®ç°","uri":"/%E5%88%86%E5%B8%83%E5%BC%8F%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E5%AE%9E%E7%8E%B0/"},{"categories":["å¼€å‘"],"content":"é“¾æ¥ libpcap ","date":"2021-01-09","objectID":"/golang%E7%9B%91%E6%8E%A7%E8%BF%9B%E7%A8%8B%E6%B5%81%E9%87%8F/:0:0","tags":["golang"],"title":"Golangç›‘æ§è¿›ç¨‹æµé‡","uri":"/golang%E7%9B%91%E6%8E%A7%E8%BF%9B%E7%A8%8B%E6%B5%81%E9%87%8F/"},{"categories":["è™šæ‹ŸåŒ–"],"content":" æœ¬ç¯‡æ–‡ç« ä»‹ç» KVM è™šæ‹Ÿæœºçš„ç®¡ç†ï¼ŒåŒ…æ‹¬è™šæ‹Ÿæœºçš„åˆ›å»ºã€ä¿®æ”¹ã€å¯åŠ¨ã€åˆ é™¤ç­‰å†…å®¹ å®‰è£…è™šæ‹Ÿæœº ","date":"2021-01-06","objectID":"/kvm_vm/:0:0","tags":["kvm","linux"],"title":"KVMä¹‹è™šæ‹Ÿæœºç®¡ç†","uri":"/kvm_vm/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"ä½¿ç”¨ virt-install å®‰è£… virt-install æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œä¸“é—¨ç”¨äºå®‰è£… kvm è™šæ‹Ÿæœºã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š virt-install \\ --name centos \\ --ram 1024 \\ --disk path=/data/kvm/centos.img,size=20 \\ --vcpus 1 \\ --os-type linux --os-variant rhel7 \\ --network bridge=br0 \\ --graphics vnc,listen=0.0.0.0,port=5999 --noautoconsole \\ --console pty,target_type=serial \\ --cdrom CentOS-7-x86_64-DVD-1810.iso è¿›å…¥å®‰è£…æµç¨‹ï¼š # virsh list --all Id åç§° çŠ¶æ€ ---------------------------------------------------- 2 centos running å¯ä»¥ä½¿ç”¨ vnc å®¢æˆ·ç«¯è¿æ¥è™šæ‹Ÿæœºã€‚ å‚æ•°è¯´æ˜ï¼š -â€“name æŒ‡å®šè™šæ‹Ÿæœºçš„åå­— â€“-ram æŒ‡å®šå†…å­˜åˆ†é…å¤šå°‘ â€“-disk path æŒ‡å®šè™šæ‹Ÿç£ç›˜æ”¾åˆ°å“ªé‡Œï¼Œsize=30 æŒ‡å®šç£ç›˜å¤§å°ä¸º30G,è¿™æ ·ç£ç›˜æ–‡ä»¶æ ¼å¼ä¸ºrawï¼Œrawæ ¼å¼ä¸èƒ½åšå¿«ç…§ï¼Œåé¢æœ‰è¯´æ˜ï¼Œéœ€è¦è½¬æ¢ä¸ºqcow2æ ¼å¼ï¼Œå¦‚æœè¦ä½¿ç”¨qcow2æ ¼å¼çš„è™šæ‹Ÿç£ç›˜ï¼Œéœ€è¦äº‹å…ˆåˆ›å»ºqcow2æ ¼å¼çš„è™šæ‹Ÿç£ç›˜ã€‚ å‚è€ƒ http://www.361way.com/kvm-qcow2-preallocation-metadata/3354.html ç¤ºä¾‹:qemu-img create -f qcow2 -o preallocation=metadata /data/test02.img 7G; â€“disk path=/data/test02.img,format=qcow2,size=7,bus=virtio â€“-vcpus æŒ‡å®šåˆ†é…cpuå‡ ä¸ª -â€“os-type æŒ‡å®šç³»ç»Ÿç±»å‹ä¸ºlinux â€“-os-variant æŒ‡å®šç³»ç»Ÿç‰ˆæœ¬ -â€“network æŒ‡å®šç½‘ç»œç±»å‹ -â€“graphics æŒ‡å®šå®‰è£…é€šè¿‡å“ªç§ç±»å‹ï¼Œå¯ä»¥æ˜¯vncï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰å›¾å½¢ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨å›¾å½¢ç›´æ¥ä½¿ç”¨æ–‡æœ¬æ–¹å¼ -â€“console æŒ‡å®šæ§åˆ¶å°ç±»å‹ -â€“location æŒ‡å®šå®‰è£…ä»‹è´¨åœ°å€ï¼Œå¯ä»¥æ˜¯ç½‘ç»œåœ°å€ï¼Œä¹Ÿå¯ä»¥æ˜¯æœ¬åœ°çš„ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œï¼ˆâ€“location â€˜/mnt/â€™, å…¶ä¸­/mnt/ä¸‹å°±æ˜¯æˆ‘ä»¬æŒ‚è½½çš„å…‰ç›˜é•œåƒmount /dev/cdrom /mnt)å¦‚æœæ˜¯ç»å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆåé¢è¿˜éœ€è¦æŒ‡å®šä¸€ä¸ªå®‰è£…ä»‹è´¨ï¼Œæ¯”å¦‚NFS â€“extra-args é¢å¤–å‚æ•°ï¼Œéœ€è¦å’Œ â€“location é…ç½®ä½¿ç”¨ â€“cdrom æŒ‡å®šæ“ä½œç³»ç»Ÿé•œåƒä½ç½® ","date":"2021-01-06","objectID":"/kvm_vm/:1:0","tags":["kvm","linux"],"title":"KVMä¹‹è™šæ‹Ÿæœºç®¡ç†","uri":"/kvm_vm/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"é”™è¯¯å¤„ç† å®‰è£…è¿‡ç¨‹ä¸­å‡ºç°ä¸‰ä¸ªé”™è¯¯: ","date":"2021-01-06","objectID":"/kvm_vm/:2:0","tags":["kvm","linux"],"title":"KVMä¹‹è™šæ‹Ÿæœºç®¡ç†","uri":"/kvm_vm/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"é”™è¯¯ä¸€ ç¬¬ä¸€ä¸ªé”™è¯¯å¦‚ä¸‹: CPU mode 'custom' for x86_64 kvm domain on x86_64 host is not supported by hypervisor è§£å†³æ–¹å¼æ˜¯é‡å¯å®¿ä¸»æœº ","date":"2021-01-06","objectID":"/kvm_vm/:2:1","tags":["kvm","linux"],"title":"KVMä¹‹è™šæ‹Ÿæœºç®¡ç†","uri":"/kvm_vm/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"é”™è¯¯äºŒ ç¬¬äºŒä¸ªé”™è¯¯å¦‚ä¸‹ï¼š Creating storage file centos.img | 20 GB 00:00 ERROR internal error Process exited while reading console log output: char device redirected to /dev/pts/4 2016-01-27T08:56:58.986952Z ...: Permission denied Domain installation does not appear to have been successful. If it was, you can restart your domain by running: virsh --connect qemu:///system start centos65 otherwise, please restart your installation. è§£å†³æ–¹å¼ä¿®æ”¹ /etc/libvirt/qemu.conf é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ  user å’Œ group é…ç½®ï¼š # /etc/libvirt/qemu.conf # ... user = \"root\" # ... group = \"root\" é‡å¯æœåŠ¡: systemctl restart libvirtd ","date":"2021-01-06","objectID":"/kvm_vm/:2:2","tags":["kvm","linux"],"title":"KVMä¹‹è™šæ‹Ÿæœºç®¡ç†","uri":"/kvm_vm/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"é”™è¯¯ä¸‰ ç¬¬ä¸‰ä¸ªé”™è¯¯æ˜¯æ‰§è¡Œå‘½ä»¤ virsh console centos æ—¶å¡ä½: # virsh console centos è¿æ¥åˆ°åŸŸ centos æ¢ç ç¬¦ä¸º ^] è§£å†³æ–¹å¼å¦‚ä¸‹ï¼š ç¡®è®¤ ttyS0 å­˜åœ¨åœ¨ /etc/securetty æ–‡ä»¶ä¸­ï¼Œæ²¡æœ‰å°±æ‰§è¡Œä»¥ä¸‹å‘½ä»¤: echo \"ttyS0\" \u003e\u003e /etc/securetty ä¿®æ”¹ /etc/default/grub æ–‡ä»¶ï¼š # GRUB_CMDLINE_LINUX=\"crashkernel=auto rd.lvm.lv=cl/root rd.lvm.lv=cl/swap rhgb quietâ€ # æ”¹æˆ GRUB_CMDLINE_LINUX=\"crashkernel=auto rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet net.ifnames=0 console=ttyS0,115200\" é‡æ–°ç”Ÿæˆ grub æ–‡ä»¶ï¼š grub2-mkconfig -o /boot/grub2/grub.cfg å¯åŠ¨ serial-getty æœåŠ¡: systemctl start serial-getty@ttyS0.service systemctl enable serial-getty@ttyS0.service æ“ä½œè™šæ‹Ÿæœº KVM åœ¨ Hypervisor ä¸­è¢«ç§°ä½œåŸŸ(domain)ã€‚ä½¿ç”¨ virsh å‘½ä»¤å¯ä»¥å¾ˆæœ‰æ•ˆçš„ç®¡ç†åŸŸã€‚ virsh ä¸­ç®¡ç†åŸŸçš„å‘½ä»¤: å‘½ä»¤ åŠŸèƒ½æè¿° list è·å–å½“å‰èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰åŸŸçš„åˆ—è¡¨ domstate \u003cID or Name or UUID\u003e è·å–ä¸€ä¸ªåŸŸçš„è¿è¡ŒçŠ¶æ€ dominfo \u003cID\u003e è·å–ä¸€ä¸ªåŸŸçš„åŸºæœ¬ä¿¡æ¯ domid \u003cName or UUID\u003e æ ¹æ®åŸŸçš„åç§°æˆ–UUIDè¿”å›åŸŸçš„ID domname \u003cID or UUID\u003e æ ¹æ®åŸŸçš„IDæˆ–UUIDè¿”å›åŸŸçš„åç§° dommemstat \u003cID\u003e è·å–ä¸€ä¸ªåŸŸçš„å†…å­˜ä½¿ç”¨æƒ…å†µçš„ç»Ÿè®¡ä¿¡æ¯ setmem \u003cID\u003e \u003cmem-size\u003e è®¾ç½®ä¸€ä¸ªåŸŸçš„å†…å­˜å¤§å°(é»˜è®¤å•ä½ä¸ºKB) vcpupin \u003cID\u003e \u003cvCPU\u003e \u003cpCPU\u003e å°†ä¸€ä¸ªåŸŸçš„ vCPU ç»‘å®šåˆ°æŸä¸ªç‰©ç† CPU ä¸Šè¿è¡Œ setvcpus \u003cID\u003e \u003cvCPU-num\u003e è®¾ç½®ä¸€ä¸ªåŸŸçš„ vCPU çš„ä¸ªæ•° vncdisplay \u003cID\u003e è·å–ä¸€ä¸ªåŸŸçš„ VNC è¿æ¥ IP åœ°å€çš„ç«¯å£ create \u003cdom.xml\u003e æ ¹æ®åŸŸçš„ XML é…ç½®æ–‡ä»¶åˆ›å»ºä¸€ä¸ªåŸŸ(å®¢æˆ·æœº) suspend \u003cID\u003e æš‚åœä¸€ä¸ªåŸŸ resume \u003cID\u003e å”¤é†’ä¸€ä¸ªåŸŸ shutdown \u003cID\u003e è®©ä¸€ä¸ªåŸŸæ‰§è¡Œå…³æœºæ“ä½œ reboot \u003cID\u003e è®©ä¸€ä¸ªåŸŸæ‰§è¡Œé‡å¯æ“ä½œ reset \u003cID\u003e å¼ºåˆ¶é‡å¯ä¸€ä¸ªåŸŸï¼Œç›¸å½“äºåœ¨ç‰©ç†æœºä¸ŠæŒ‰å¸¦ç”µæº â€œresetâ€ æŒ‰é’® (å¯èƒ½ä¼šç ´åè¯¥åŸŸçš„æ–‡ä»¶ç³»ç»Ÿ) destroy \u003cID\u003e ç«‹å³é”€æ¯ä¸€ä¸ªåŸŸï¼Œç›¸å½“äºç›´æ¥æ‹”æ‰ç‰©ç†æœºæœºå™¨çš„ç”µæºçº¿ï¼ˆå¯èƒ½ä¼šç ´åè¯¥åŸŸçš„æ–‡ä»¶ç³»ç»Ÿï¼‰ save \u003cID\u003e \u003cfile.img\u003e ä¿å­˜ä¸€ä¸ªè¿è¡Œä¸­çš„åŸŸçš„çŠ¶æ€åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ restore \u003cfile.img\u003e ä»ä¸€ä¸ªè¢«ä¿å­˜çš„æ–‡ä»¶ä¸­æ¢å¤ä¸€ä¸ªåŸŸçš„è¿è¡Œ migrate \u003cID\u003e \u003cdest_url\u003e å°†ä¸€ä¸ªåŸŸè¿ç§»åˆ°å¦å¤–ä¸€ä¸ªç›®çš„åœ°å€ dumpxml \u003cID\u003e ä»¥ XML æ ¼å¼è½¬å­˜å‡ºä¸€ä¸ªåŸŸçš„ä¿¡æ¯åˆ°æ ‡å‡†è¾“å‡ºä¸­ attach-device \u003cID\u003e \u003cdevice.xml\u003e å‘ä¸€ä¸ªåŸŸæ·»åŠ  XML æ–‡ä»¶ä¸­çš„è®¾å¤‡(çƒ­æ’æ‹”) detach-device \u003cID\u003e \u003cdevice.xml\u003e å°† XML æ–‡ä»¶ä¸­çš„è®¾å¤‡ä»ä¸€ä¸ªåŸŸä¸­ç§»é™¤ console \u003cID\u003e è¿æ¥åˆ°ä¸€ä¸ªåŸŸçš„æ§åˆ¶å° ","date":"2021-01-06","objectID":"/kvm_vm/:2:3","tags":["kvm","linux"],"title":"KVMä¹‹è™šæ‹Ÿæœºç®¡ç†","uri":"/kvm_vm/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"è™šæ‹Ÿæœºç”Ÿå‘½å‘¨æœŸ # å¯åŠ¨è™šæ‹Ÿæœº virsh start centos # å…³é—­è™šæ‹Ÿæœº virsh shutdown centos # é‡å¯è™šæ‹Ÿæœº virsh reboot centos # é”€æ¯è™šæ‹Ÿæœº virsh destroy centos # æš‚åœè™šæ‹Ÿæœº virsh suspend centos # æ¢å¤è™šæ‹Ÿæœº virsh resume centos # åˆ é™¤è™šæ‹Ÿæœº virsh undefine centos rm -fr /etc/libvirt/qemu/centos.xml ","date":"2021-01-06","objectID":"/kvm_vm/:3:0","tags":["kvm","linux"],"title":"KVMä¹‹è™šæ‹Ÿæœºç®¡ç†","uri":"/kvm_vm/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"é™åˆ¶å’Œä¿®æ”¹è™šæ‹Ÿæœº cpu å…ˆå…³é—­è™šæ‹Ÿæœºï¼Œä¿®æ”¹è™šæ‹Ÿæœº xml æ–‡ä»¶: # è®¾ç½® cpu æœ€å¤§ä¸ªæ•°ä¸º 4 ä¸ªï¼Œå½“å‰ä¸º 1 \u003cvcpu placement='static' current='1'\u003e4\u003c/vcpu\u003e å¼€å¯è™šæ‹Ÿæœºåï¼ŒåŠ¨æ€è®¾ç½®è™šæ‹Ÿæœº cpu # æœ€å¤§ä¸ªæ•°ä¸èƒ½è¶…è¿‡æŒ‡å®šå€¼ virsh setvcpus centos 2 ","date":"2021-01-06","objectID":"/kvm_vm/:4:0","tags":["kvm","linux"],"title":"KVMä¹‹è™šæ‹Ÿæœºç®¡ç†","uri":"/kvm_vm/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"é™åˆ¶å’Œä¿®æ”¹è™šæ‹Ÿæœºå†…å­˜ ä¿®æ”¹è™šæ‹Ÿæœºå†…å­˜æœ€å¤§å€¼éœ€è¦å…ˆå…³é—­è™šæ‹Ÿæœº # æœ€å¤§å€¼ä¸èƒ½è¶…è¿‡å®¿ä¸»æœºå†…å­˜æœ€å¤§å€¼ virsh setmaxmem centos 4G åŠ¨æ€è®¾ç½®è™šæ‹Ÿæœºå†…å­˜ virsh setmem centos 2G ","date":"2021-01-06","objectID":"/kvm_vm/:5:0","tags":["kvm","linux"],"title":"KVMä¹‹è™šæ‹Ÿæœºç®¡ç†","uri":"/kvm_vm/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"åœ¨çº¿æ·»åŠ å’Œåˆ é™¤è™šæ‹Ÿæœºç¡¬ç›˜ å…ˆåˆ›å»ºç¡¬ç›˜: # qemu-img create -f qcow2 disk1.qcow2 2G Formatting 'disk1.qcow2', fmt=qcow2 cluster_size=65536 extended_l2=off compression_type=zlib size=2147483648 lazy_refcounts=off refcount_bits=16 åˆ›å»º disk.xml æ–‡ä»¶ $ vim disk.xml \u003cdisk type='file' device='disk'\u003e \u003cdriver name='qemu' type='qcow2'/\u003e \u003csource file='/data/kvm/disk1.qcow2'/\u003e \u003ctarget dev='vdb' bus='virtio'/\u003e \u003caddress type='pci' domain='0x0000' bus='0x00' slot='0x08' function='0x0'/\u003e \u003c/disk\u003e æ·»åŠ ç¡¬ç›˜è®¾å¤‡: virsh attach-device centos disk.xml å¸è½½ç¡¬ç›˜è®¾å¤‡ virsh dettach-device centos disk.xml ","date":"2021-01-06","objectID":"/kvm_vm/:6:0","tags":["kvm","linux"],"title":"KVMä¹‹è™šæ‹Ÿæœºç®¡ç†","uri":"/kvm_vm/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"åœ¨çº¿æ·»åŠ å’Œåˆ é™¤è™šæ‹Ÿæœºç½‘å¡ æ·»åŠ  bridge ç½‘å¡ virsh attach-interface centos --type bridge --source br0 å¸è½½ç½‘å¡ virsh detach-interface centos --type bridge --mac 52:54:00:d9:90:bb ","date":"2021-01-06","objectID":"/kvm_vm/:7:0","tags":["kvm","linux"],"title":"KVMä¹‹è™šæ‹Ÿæœºç®¡ç†","uri":"/kvm_vm/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"ä¿®æ”¹è™šæ‹Ÿæœº vnc å…ˆå…³é—­è™šæ‹Ÿæœº virsh stop centos ä¿®æ”¹è™šæ‹Ÿæœºæ–‡ä»¶ # irsh edit centos \u003cgraphics type='vnc' port='6000' autoport='no' listen='0.0.0.0' passwd='123456'\u003e \u003clisten type='address' address='0.0.0.0'/\u003e \u003c/graphics\u003e æ³¨: è™šæ‹Ÿæœº vnc çš„ç«¯å£å¿…é¡»åœ¨ 5900 - 65535 ä¹‹é—´ åŠ è½½é…ç½®æ–‡ä»¶ virsh define /etc/libvirt/qemu/centos.xml æœ€åå¯åŠ¨è™šæ‹Ÿæœº virsh start centos ","date":"2021-01-06","objectID":"/kvm_vm/:8:0","tags":["kvm","linux"],"title":"KVMä¹‹è™šæ‹Ÿæœºç®¡ç†","uri":"/kvm_vm/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"KVM æ¦‚è¿° KVM (Kernal-base Virtual Machine) åŸºäºå†…æ ¸çš„è™šæ‹Ÿæœºã€‚æ˜¯ä¸€ç§é€šè¿‡ä¿®æ”¹ linux å†…æ ¸å®ç°è™šæ‹ŸåŒ–åŠŸèƒ½çš„åŠè™šæ‹ŸåŒ–æŠ€æœ¯ã€‚ç”±äºæ˜¯åœ¨å†…æ ¸åŸºç¡€ä¸Šè¿è¡Œï¼Œæ‰€æœ‰å…·æœ‰æ¥è¿‘ç‰©ç†æœºçš„é«˜æ€§èƒ½ã€‚ KVM å’Œ Qemu Qemuï¼ˆquick emulatorï¼‰å¼€æºçš„è½¯ä»¶è™šæ‹ŸåŒ–å®ç°ï¼Œé€šè¿‡è½¯ä»¶æ¥æ¨¡æ‹Ÿç¡¬ä»¶çš„åŠŸèƒ½ï¼Œä½†ç¼ºç‚¹æ˜¯æ€§èƒ½ä½ã€‚é€šè¿‡å’Œ KVM ç›¸ç»“åˆæ¥æé«˜æ€§èƒ½ã€‚ç°åœ¨çš„ç‰ˆæœ¬å·²ç»å†…ç½® KVMã€‚ å…¨è™šæ‹ŸåŒ–å’ŒåŠè™šæ‹ŸåŒ– å…¨è™šæ‹ŸåŒ–æ˜¯æŒ‡ä¸éœ€è¦ä¿®æ”¹æ“ä½œç³»ç»Ÿå†…æ ¸å®ç°è™šæ‹ŸåŒ–åŠŸèƒ½ï¼ŒåŠè™šæ‹ŸåŒ–åˆ™éœ€è¦ä¿®æ”¹å†…æ ¸æ¥å®ç°è™šæ‹ŸåŒ–ã€‚ KVM å°±æ˜¯ä¸€ç§åŠè™šæ‹ŸåŒ–å®ç°ã€‚ å…¨è™šæ‹ŸåŒ–åˆåˆ†ä¸ºè½¯ä»¶å…¨è™šæ‹ŸåŒ– (Qemu) å’Œç¡¬ä»¶å…¨è™šæ‹ŸåŒ–(Xen)ã€‚ KVM å·¥å…·é›†åˆ libvirtï¼šæ“ä½œå’Œç®¡ç†KVMè™šæœºçš„è™šæ‹ŸåŒ– APIï¼Œä½¿ç”¨ C è¯­è¨€ç¼–å†™ï¼Œå¯ä»¥ç”± Python,Ruby, Perl, PHP, Java ç­‰è¯­è¨€è°ƒç”¨ã€‚å¯ä»¥æ“ä½œåŒ…æ‹¬ KVMï¼Œvmwareï¼ŒXENï¼ŒHyper-v, LXC ç­‰åœ¨å†…çš„å¤šç§ Hypervisorã€‚ Virshï¼šåŸºäº libvirt çš„ å‘½ä»¤è¡Œå·¥å…· ï¼ˆCLIï¼‰ Virt-Managerï¼šåŸºäº libvirt çš„ GUI å·¥å…· virt-v2vï¼šè™šæœºæ ¼å¼è¿ç§»å·¥å…· virt-* å·¥å…·ï¼šåŒ…æ‹¬ Virt-install ï¼ˆåˆ›å»ºKVMè™šæœºçš„å‘½ä»¤è¡Œå·¥å…·ï¼‰ï¼Œ Virt-viewer ï¼ˆè¿æ¥åˆ°è™šæœºå±å¹•çš„å·¥å…·ï¼‰ï¼ŒVirt-cloneï¼ˆè™šæœºå…‹éš†å·¥å…·ï¼‰ï¼Œvirt-top ç­‰ sVirtï¼šå®‰å…¨å·¥å…· KVM æ–‡ç«  KVMä»‹ç» KVMæºç åˆ†æ ","date":"2021-01-04","objectID":"/kvm_detail/:0:0","tags":["kvm","linux"],"title":"KVMä»‹ç»","uri":"/kvm_detail/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"æœ¬æ–‡ä»‹ç»åœ¨ CentOS7.9 ä¸Šç¼–è¯‘å®‰è£… qemu-5.2.0 å®‰è£… Python3 ç¼–è¯‘å®‰è£… qemu-5.2.0 ä¾èµ– Python3.6 åŠä»¥ä¸Šçš„ç‰ˆæœ¬ã€‚æ‰€ä»¥é¦–å…ˆå®‰è£… Python3.6ã€‚è¿™é‡Œé€‰æ‹©ç¼–è¯‘å®‰è£…ã€‚ ","date":"2020-12-27","objectID":"/centos7_install_qemu/:0:0","tags":["kvm","linux"],"title":"CentOS7 å®‰è£… qemu-5.2.0","uri":"/centos7_install_qemu/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"ä¸‹è½½ Python3.6.12 ä» Python å®˜ç½‘ä¸‹è½½ Python3.6.12 æºç åŒ…ï¼š wget https://www.python.org/ftp/python/3.6.12/Python-3.6.12.tar.xz ","date":"2020-12-27","objectID":"/centos7_install_qemu/:1:0","tags":["kvm","linux"],"title":"CentOS7 å®‰è£… qemu-5.2.0","uri":"/centos7_install_qemu/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"è§£å‹ tar -xvf Python-3.6.12.tar.gz ","date":"2020-12-27","objectID":"/centos7_install_qemu/:2:0","tags":["kvm","linux"],"title":"CentOS7 å®‰è£… qemu-5.2.0","uri":"/centos7_install_qemu/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"å®‰è£… openssl pip ä¸‹è½½æ˜¯éœ€è¦ ssl æ”¯æŒï¼Œæ‰€ä»¥ä¸‹è½½ openssl yum install -y openssl openssl-devel zlib-devel bzip2-devel bzip2 ","date":"2020-12-27","objectID":"/centos7_install_qemu/:3:0","tags":["kvm","linux"],"title":"CentOS7 å®‰è£… qemu-5.2.0","uri":"/centos7_install_qemu/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"ç¼–è¯‘å®‰è£… cd Python-3.6.12 ./configure --prefix=/usr/local/python3 --enable-optimizations make -j8 build_all \u0026\u0026 make -j8 install ","date":"2020-12-27","objectID":"/centos7_install_qemu/:4:0","tags":["kvm","linux"],"title":"CentOS7 å®‰è£… qemu-5.2.0","uri":"/centos7_install_qemu/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"è®¾ç½®è½¯é“¾æ¥ ln -s /usr/local/python3/bin/python3 /usr/bin/python3 ln -s /usr/local/python3/bin/pip3 /usr/bin/pip3 ","date":"2020-12-27","objectID":"/centos7_install_qemu/:5:0","tags":["kvm","linux"],"title":"CentOS7 å®‰è£… qemu-5.2.0","uri":"/centos7_install_qemu/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"éªŒè¯ # python3 Python 3.6.12 (default, Dec 27 2020, 07:52:33) [GCC 4.8.5 20150623 (Red Hat 4.8.5-44)] on linux Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. \u003e\u003e\u003e å®‰è£… ninja qemu-5.2.0 ç¼–è¯‘æ—¶ä½¿ç”¨æ„å»ºå·¥å…· ninja ä¸‹è½½ ninja git clone git://github.com/ninja-build/ninja.git \u0026\u0026 cd ninja ./configure.py --bootstrap cp ninja /usr/bin/ ä½¿ç”¨ ninja --version, éªŒè¯ ninja ç‰ˆæœ¬: # ninja --version 1.10.2.git ç¼–è¯‘å®‰è£… qemu-5.2.0 å®Œæˆä»¥ä¸Šæ­¥éª¤ä¹‹åå°±å¯ä»¥å¼€å§‹å®‰è£…qemuäº†ã€‚å…¶å®å¯ä»¥é€šè¿‡ yum å®‰è£…ï¼Œä½†æ˜¯ä¼šç¼ºå°‘ä¸€äº›äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ ","date":"2020-12-27","objectID":"/centos7_install_qemu/:6:0","tags":["kvm","linux"],"title":"CentOS7 å®‰è£… qemu-5.2.0","uri":"/centos7_install_qemu/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"å®‰è£…ä¾èµ– é¦–å…ˆå®‰è£… qemu-5.2.0 æ‰€éœ€çš„ä¾èµ–ï¼Œè¿™é‡Œè¿½åŠ ä¸€ä¸ªå°æç¤ºï¼š CentOS7 ç¼–è¯‘å®‰è£…è½¯ä»¶æ—¶ç»å¸¸éœ€è¦å®‰è£…å¯¹åº”çš„ä¾èµ–ã€‚ç¼–è¯‘è¿‡ç¨‹ä¸­å¦‚æœå‘ç°ç¼ºå°‘ä¾èµ–ï¼Œåˆ™ç¼–è¯‘åæŠ¥é”™å¹¶é€€å‡ºï¼Œè¿™æ—¶å€™å°±éœ€è¦å®‰è£…ä¾èµ–åŒ…ã€‚ä»¥qemu-5.2.0å®‰è£…ä¸ºä¾‹ï¼Œç¼–è¯‘æ—¶æç¤ºç¼ºå°‘ glib2 åŒ…ã€‚è¿™æ—¶å€™ä¸æ˜¯ä¸‹è½½ glib2ï¼Œè€Œæ˜¯ä¸‹è½½å¯¹åº”çš„å¼€å‘åŒ…ï¼ŒCentOSé‡Œæ˜¯ glib2-develï¼ŒUbuntu ä¸‹åˆ™æ˜¯ glib2-devã€‚ yum install -y pkgconfig-devel glib2-devel pixman-devel è¿™é‡Œæä¾›çš„ä¾èµ–å¯èƒ½è¡¥å…¨ï¼Œç¼–è¯‘è¿‡ç¨‹ä¸­å¦‚æœæç¤ºç¼ºå°‘ä¾èµ–ï¼Œè¯·æ ¹æ®ä»¥ä¸Šç»™å‡ºçš„æç¤ºå®‰è£…å¯¹åº”ä¾èµ–ã€‚ ","date":"2020-12-27","objectID":"/centos7_install_qemu/:7:0","tags":["kvm","linux"],"title":"CentOS7 å®‰è£… qemu-5.2.0","uri":"/centos7_install_qemu/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"ä¸‹è½½ qemu-5.2.0 åœ¨ qemu å®˜ç½‘ä¸‹è½½æºç åŒ… wget https://download.qemu.org/qemu-5.2.0.tar.xz ","date":"2020-12-27","objectID":"/centos7_install_qemu/:8:0","tags":["kvm","linux"],"title":"CentOS7 å®‰è£… qemu-5.2.0","uri":"/centos7_install_qemu/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"ç¼–è¯‘å®‰è£… tar xvJf qemu-5.2.0.tar.xz cd qemu-5.2.0 ./configure --enable-debug --target-list=x86_64-softmmu --enable-kvm make \u0026\u0026 make install ","date":"2020-12-27","objectID":"/centos7_install_qemu/:9:0","tags":["kvm","linux"],"title":"CentOS7 å®‰è£… qemu-5.2.0","uri":"/centos7_install_qemu/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"éªŒè¯ # qemu- qemu-edid qemu-img qemu-nbd qemu-storage-daemon qemu-ga qemu-io qemu-pr-helper qemu-system-x86_64 ","date":"2020-12-27","objectID":"/centos7_install_qemu/:10:0","tags":["kvm","linux"],"title":"CentOS7 å®‰è£… qemu-5.2.0","uri":"/centos7_install_qemu/"},{"categories":["å¼€å‘"],"content":"åœ¨ Windows ä½¿ç”¨ Go å¼€å‘é¡¹ç›®æ˜¯ï¼Œä¸ºäº†å®ç°ç»Ÿä¸€çš„é…ç½®å’Œæ ¼å¼ç®¡ç†ï¼Œéœ€è¦è¿›è¡Œä¸€ä¸‹çš„é…ç½®ã€‚ å¼€å‘ç¯å¢ƒé€‰æ‹© Go è¯­è¨€çš„å¼€å‘ç¯å¢ƒç»Ÿä¸€ä½¿ç”¨ Jetbrain å…¬å¸çš„ Golandã€‚ä¹‹åéœ€è¦è¿›è¡Œä¸€äº›é…ç½®ã€‚ ä¿®æ”¹ç»Ÿä¸€çš„æ–‡ä»¶æ¢è¡Œç¬¦ä¸º \\nÂ ã€‚ settings \u003e Editor \u003e Code Style æ·»åŠ æ ¼å¼åŒ–å·¥å…· goimportsã€‚goimports åŒæ—¶å†…ç½®äº† gofmt çš„åŠŸèƒ½ã€‚å¯ä»¥æ ¼å¼åŒ– Go ä»£ç†ã€è‡ªåŠ¨å¯¼å…¥ä¾èµ–åŒ…ç­‰ã€‚ settings \u003e Editor \u003e Code Style \u003e Go è®¾ç½®æ–‡ä»¶è‡ªåŠ¨æ ¼å¼åŒ– settings \u003e Tools \u003e File Watch é…ç½®è¿œç¨‹ä¸»æœºä»£ç åŒæ­¥ï¼ˆå¯é€‰ï¼‰ Tools \u003e Deployment \u003e Configuration Git é…ç½® æ–‡æœ¬æ–‡ä»¶æ‰€ä½¿ç”¨çš„æ¢è¡Œç¬¦ï¼Œåœ¨ä¸åŒçš„ç³»ç»Ÿå¹³å°ä¸Šæ˜¯ä¸ä¸€æ ·çš„ã€‚ UNIX/LinuxÂ ä½¿ç”¨çš„æ˜¯ 0x0Aï¼ˆLFï¼‰Â ï¼Œæ—©æœŸçš„ Mac OSÂ ä½¿ç”¨çš„æ˜¯ 0x0Dï¼ˆCRï¼‰Â ï¼Œåæ¥çš„ OS XÂ åœ¨æ›´æ¢å†…æ ¸åä¸ UNIXÂ ä¿æŒä¸€è‡´äº†ã€‚ä½† DOS/WindowsÂ ä¸€ç›´ä½¿ç”¨ 0x0D0Aï¼ˆCRLFï¼‰Â ä½œä¸ºæ¢è¡Œç¬¦ã€‚ è·¨å¹³å°åä½œå¼€å‘æ˜¯å¸¸æœ‰çš„ï¼Œä¸ç»Ÿä¸€çš„æ¢è¡Œç¬¦ç¡®å®å¯¹è·¨å¹³å°çš„æ–‡ä»¶äº¤æ¢å¸¦æ¥äº†éº»çƒ¦ã€‚æœ€å¤§çš„é—®é¢˜æ˜¯ï¼Œåœ¨ä¸åŒå¹³å°ä¸Šï¼Œæ¢è¡Œç¬¦å‘ç”Ÿæ”¹å˜æ—¶ï¼ŒGit ä¼šè®¤ä¸ºæ•´ä¸ªæ–‡ä»¶è¢«ä¿®æ”¹ï¼Œè¿™å°±é€ æˆæˆ‘ä»¬æ²¡æ³• diffï¼Œä¸èƒ½æ­£ç¡®åæ˜ æœ¬æ¬¡çš„ä¿®æ”¹ã€‚è¿˜å¥½ Git åœ¨è®¾è®¡æ—¶å°±è€ƒè™‘äº†è¿™ä¸€ç‚¹ï¼Œå…¶æä¾›äº†ä¸€ä¸ª autocrlf çš„é…ç½®é¡¹ï¼Œç”¨äºåœ¨æäº¤å’Œæ£€å‡ºæ—¶è‡ªåŠ¨è½¬æ¢æ¢è¡Œç¬¦ï¼Œè¯¥é…ç½®æœ‰ä¸‰ä¸ªå¯é€‰é¡¹ï¼š true: æäº¤æ—¶è½¬æ¢ä¸º LFï¼Œæ£€å‡ºæ—¶è½¬æ¢ä¸º CRLF false: æäº¤æ£€å‡ºå‡ä¸è½¬æ¢ input: æäº¤æ—¶è½¬æ¢ä¸ºLFï¼Œæ£€å‡ºæ—¶ä¸è½¬æ¢ ç”¨å¦‚ä¸‹å‘½ä»¤å³å¯å®Œæˆé…ç½®ï¼š # æäº¤æ—¶è½¬æ¢ä¸ºLFï¼Œæ£€å‡ºæ—¶è½¬æ¢ä¸ºCRLF git config --global core.autocrlf true # æäº¤æ—¶è½¬æ¢ä¸ºLFï¼Œæ£€å‡ºæ—¶ä¸è½¬æ¢ git config --global core.autocrlf input # æäº¤æ£€å‡ºå‡ä¸è½¬æ¢ git config --global core.autocrlf false å¦‚æœæŠŠ autocrlf è®¾ç½®ä¸º false æ—¶ï¼Œé‚£å¦ä¸€ä¸ªé…ç½®é¡¹ safecrlf æœ€å¥½è®¾ç½®ä¸º tureã€‚è¯¥é€‰é¡¹ç”¨äºæ£€æŸ¥æ–‡ä»¶æ˜¯å¦åŒ…å«æ··åˆæ¢è¡Œç¬¦ï¼Œå…¶æœ‰ä¸‰ä¸ªå¯é€‰é¡¹ï¼š true: æ‹’ç»æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶ false: å…è®¸æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶ warn: æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶æ—¶ç»™å‡ºè­¦å‘Š é…ç½®æ–¹æ³•ï¼š # æ‹’ç»æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶ git config --global core.safecrlf true # å…è®¸æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶ git config --global core.safecrlf false # æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶æ—¶ç»™å‡ºè­¦å‘Š git config --global core.safecrlf warn ä¸ºäº†é˜²æ­¢æ··ä¹±ï¼Œç›´æ¥ä½¿ç”¨ä»¥ä¸‹é…ç½®ã€‚ $ git config --global core.autocrlf false $ git config --global core.safecrlf false ä»¥ä¸Šé…ç½®éœ€è¦æ³¨æ„: *.batã€*.ps çš„æ¢è¡Œä¿®æ”¹ä¸º CRLFï¼›*.sh æ–‡ä»¶ä¿®æ”¹ä¸º LFï¼Œå…¶ä»–çš„æ‰€æœ‰æ–‡ä»¶ç»Ÿä¸€ä¸º LFã€‚Â ","date":"2020-10-29","objectID":"/windows%E4%B8%8A%E4%BD%BF%E7%94%A8go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91/:0:0","tags":["windows","golang"],"title":"Windows ä¸Šä½¿ç”¨ Go è¯­è¨€","uri":"/windows%E4%B8%8A%E4%BD%BF%E7%94%A8go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91/"},{"categories":["æ•°æ®åº“"],"content":"å®‰è£… è¿™é‡Œç›´æ¥ä½¿ç”¨ docker å®‰è£… postgresql-13 docker run --name postgresql13 -e POSTGRES_PASSWORD=123456 -p 54322:5432 -d postgres:13 å®‰è£…æˆåŠŸåä¼šç»‘å®šä¸»æœºç«¯å£ 54322ã€‚ç›´æ¥è¿›å…¥ postgresql13 å®¹å™¨ï¼Œä½¿ç”¨ pgsqlã€‚ [root@localhost ~]# docker exec -it 3e3b03e3 /bin/bash root@3e3b03e3e442:/# psql -h localhost -p 5432 -U postgres psql (13.0 (Debian 13.0-1.pgdg100+1)) Type \"help\" for help. postgres=# psql æ˜¯ pgsql çš„å®¢æˆ·ç«¯å‘½ä»¤ï¼Œä½¿ç”¨å‚æ•°å¦‚ä¸‹ï¼š -hï¼šæŒ‡å®š pgsql çš„åœ°å€ -pï¼šæŒ‡å®š pgsql çš„ç»‘å®šç«¯å£ -Uï¼šæŒ‡å®šç™»å½•çš„ç”¨æˆ·åï¼Œé»˜è®¤ä¸º postgresã€‚åé¢å¯ä»¥ç´§æ¥ â€œdatabaseâ€ï¼Œç›´æ¥è¿›å…¥æŒ‡å®šçš„æ•°æ®åº“ã€‚ æ•°æ®åº“çš„æ“ä½œ postgresql æ”¯æŒçš„æ•°æ®åº“æ“ä½œæœ‰ å¢ã€åˆ ã€æŸ¥ã€æ”¹ ","date":"2020-10-13","objectID":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/:0:0","tags":["postgreSQL","database"],"title":"postgresql å®æˆ˜ä¸€ï¼šå®‰è£…å’Œä½¿ç”¨","uri":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/"},{"categories":["æ•°æ®åº“"],"content":"åˆ›å»ºæ•°æ®åº“ åˆ›å»ºæ•°æ®åº“çš„å‘½ä»¤ä¸ºï¼š create database \u003cdatabasename\u003e [encoding 'UTF-8']Â  postgres=#createdatabasetestencoding'UTF-8';CREATEDATABASE ","date":"2020-10-13","objectID":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/:1:0","tags":["postgreSQL","database"],"title":"postgresql å®æˆ˜ä¸€ï¼šå®‰è£…å’Œä½¿ç”¨","uri":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/"},{"categories":["æ•°æ®åº“"],"content":"æŸ¥è¯¢æ•°æ®åº“ æŸ¥è¯¢æ•°æ®åº“çš„å‘½ä»¤æœ‰ä¸¤ç§ï¼šç¬¬ä¸€ç§æ˜¯ \\lÂ ï¼Œåªèƒ½åœ¨ psql ä¸­ä½¿ç”¨ï¼š postgres=#\\lListofdatabasesName|Owner|Encoding|Collate|Ctype|Accessprivileges-----------+----------+----------+------------+------------+----------------------- postgres|postgres|UTF8|en_US.utf8|en_US.utf8|template0|postgres|UTF8|en_US.utf8|en_US.utf8|=c/postgres+|||||postgres=CTc/postgrestemplate1|postgres|UTF8|en_US.utf8|en_US.utf8|=c/postgres+|||||postgres=CTc/postgrestest|postgres|UTF8|en_US.utf8|en_US.utf8|testdb|postgres|UTF8|en_US.utf8|en_US.utf8|(5rows) å¦ä¸€ç§å‘½ä»¤ä¸ºï¼š select * from pg_databseÂ  postgres=#selectdatnamefrompg_database;datname----------- postgrestemplate1template0testdbtest(5rows) ","date":"2020-10-13","objectID":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/:2:0","tags":["postgreSQL","database"],"title":"postgresql å®æˆ˜ä¸€ï¼šå®‰è£…å’Œä½¿ç”¨","uri":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/"},{"categories":["æ•°æ®åº“"],"content":"ä¿®æ”¹æ•°æ®åº“ ä¿®æ”¹æ•°æ®åº“ä½¿ç”¨å…³é”®å­— alterÂ  postgres=#alterdatabasetestxrenametotest;ALTERDATABASE ","date":"2020-10-13","objectID":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/:3:0","tags":["postgreSQL","database"],"title":"postgresql å®æˆ˜ä¸€ï¼šå®‰è£…å’Œä½¿ç”¨","uri":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/"},{"categories":["æ•°æ®åº“"],"content":"åˆ é™¤æ•°æ®åº“ postgres=#dropdatabasetest;DROPDATABASE ","date":"2020-10-13","objectID":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/:4:0","tags":["postgreSQL","database"],"title":"postgresql å®æˆ˜ä¸€ï¼šå®‰è£…å’Œä½¿ç”¨","uri":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/"},{"categories":["æ•°æ®åº“"],"content":"é€‰æ‹©æ•°æ®åº“ é€‰æ‹©æ•°æ®å’Œåˆ‡æ¢æ•°æ®çš„å‘½ä»¤æ˜¯ç›¸åŒçš„ï¼Œä½¿ç”¨å‘½ä»¤ \\c databasenameÂ  postgres=#\\ctest;Youarenowconnectedtodatabase\"test\"asuser\"postgres\".test=#\\cpostgres;Youarenowconnectedtodatabase\"postgres\"asuser\"postgres\". è¡¨çš„æ“ä½œ ","date":"2020-10-13","objectID":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/:5:0","tags":["postgreSQL","database"],"title":"postgresql å®æˆ˜ä¸€ï¼šå®‰è£…å’Œä½¿ç”¨","uri":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/"},{"categories":["æ•°æ®åº“"],"content":"åˆ›å»ºè¡¨ åˆ›å»º postgresql è¡¨çš„è¯­æ³•ä¸ºï¼š CREATETABLEtable_name(column1datatype,column2datatype,column3datatype,.....columnNdatatype,PRIMARYKEY(oneormorecolumns)); åˆ›å»ºä¸€å¼ åä¸º COMPANY çš„è¡¨ï¼š testdb=#CREATETABLECOMPANY(IDINTPRIMARYKEYNOTNULL,NAMETEXTNOTNULL,AGEINTNOTNULL,ADDRESSCHAR(50),SALARYREAL);CREATETABLE ","date":"2020-10-13","objectID":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/:6:0","tags":["postgreSQL","database"],"title":"postgresql å®æˆ˜ä¸€ï¼šå®‰è£…å’Œä½¿ç”¨","uri":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/"},{"categories":["æ•°æ®åº“"],"content":"æŸ¥è¯¢è¡¨ æŸ¥è¯¢è¡¨ä½¿ç”¨ \\d ï¼š testdb=#\\dListofrelationsSchema|Name|Type|Owner--------+---------+-------+---------- public|company|table|postgrespublic|person|table|postgres ä½†æ˜¯è¿™ç§æ–¹å¼åªèƒ½åœ¨ psql å‘½ä»¤ä¸­ä¸­ä½¿ç”¨ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ selectÂ å‘½ä»¤ï¼š testdb=#select*frompg_tableswhereschemaname='public';schemaname|tablename|tableowner|tablespace|hasindexes|hasrules|hastriggers|rowsecurity------------+-----------+------------+------------+------------+----------+-------------+------------- public|person|postgres||f|f|f|fpublic|company|postgres||t|f|f|f(2rows ","date":"2020-10-13","objectID":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/:7:0","tags":["postgreSQL","database"],"title":"postgresql å®æˆ˜ä¸€ï¼šå®‰è£…å’Œä½¿ç”¨","uri":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/"},{"categories":["æ•°æ®åº“"],"content":"æŸ¥çœ‹è¡¨ç»“æ„ æŸ¥çœ‹è¡¨ç»“æ„ä¹Ÿæ˜¯ä½¿ç”¨ \\dÂ å‘½ä»¤ï¼š Table\"public.company\"Column|Type|Collation|Nullable|Default---------+---------------+-----------+----------+--------- id|integer||notnull|name|text||notnull|age|integer||notnull|address|character(50)|||salary|real|||Indexes:\"company_pkey\"PRIMARYKEY,btree(id) ä¹Ÿå¯ä»¥ä½¿ç”¨ sql å®ç°ï¼š testdb=#SELECTa.attnum,a.attnameASfield,t.typnameAStype,a.attlenASlength,a.atttypmodASlengthvar,a.attnotnullASnotnull,b.descriptionAScommentFROMpg_classc,pg_attributeaLEFTJOINpg_descriptionbONa.attrelid=b.objoidANDa.attnum=b.objsubid,pg_typetWHEREc.relname='company'ANDa.attnum\u003e0ANDa.attrelid=c.oidANDa.atttypid=t.oidORDERBYa.attnum;attnum|field|type|length|lengthvar|notnull|comment--------+---------+--------+--------+-----------+---------+--------- 1|id|int4|4|-1|t|2|name|text|-1|-1|t|3|age|int4|4|-1|t|4|address|bpchar|-1|54|f|5|salary|float4|4|-1|f|(5rows) ","date":"2020-10-13","objectID":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/:8:0","tags":["postgreSQL","database"],"title":"postgresql å®æˆ˜ä¸€ï¼šå®‰è£…å’Œä½¿ç”¨","uri":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/"},{"categories":["æ•°æ®åº“"],"content":"ä¿®æ”¹è¡¨ç»“æ„ ALTER TABLEÂ è¯­å¥ç”¨äºæ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤è¡¨ä¸­çš„åˆ—ï¼šåœ¨ç°æœ‰è¡¨ä¸­æ·»åŠ åˆ—ï¼š ALTERTABLEtable_nameADDcolumn_namedatatype; åœ¨ç°æœ‰è¡¨ä¸­åˆ é™¤åˆ—ï¼š ALTERTABLEtable_nameDROPCOLUMNcolume_name; åœ¨ç°æœ‰è¡¨ä¸­ä¿®æ”¹å­—æ®µç±»å‹ï¼š ALTERTABLEtable_nameALTERCOLUMNcolume_nameTYPEdatatype; å‘è¡¨ä¸­çš„åˆ—æ·»åŠ  NOT NULLÂ çº¦æŸï¼š ALTERTABLEtable_nameMODIFYcolume_namedatatypeNOTNULL; æ·»åŠ çº¦æŸï¼Œæ”¯æŒçš„çº¦æŸæœ‰ UNIQUEÂ ã€ PRIMARY KEYÂ ã€ CHECKÂ  ALTERTABLEtable_nameADDCONSTRAINTMyUniqueConstraintUNIQUE(colume_name1,colume_name2...); åˆ é™¤çº¦æŸï¼Œæ”¯æŒçš„çº¦æŸæœ‰ UNIQUE ã€ PRIMARY KEY ã€ CHECK ALTERTABLEtable_nameDROPCONSTRAINTMyUniqueConstraintUNIQUE; ","date":"2020-10-13","objectID":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/:9:0","tags":["postgreSQL","database"],"title":"postgresql å®æˆ˜ä¸€ï¼šå®‰è£…å’Œä½¿ç”¨","uri":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/"},{"categories":["æ•°æ®åº“"],"content":"åˆ é™¤è¡¨ DROPÂ ç”¨äºåˆ é™¤è¡¨ï¼š testdb=#droptablecompany;DROPTABLE JSON ç±»å‹çš„æ”¯æŒ PostgreSQL æ”¯æŒå­˜å‚¨ JSON ç±»å‹çš„æ•°æ®ï¼Œæä¾›äº†ä¸¤ç§ç±»å‹ï¼š jsonÂ å’Œ jsonbÂ ã€‚ jsonæ•°æ®ç±»å‹å­˜å‚¨è¾“å…¥æ–‡æœ¬çš„ç²¾å‡†æ‹·è´ï¼Œå¤„ç†å‡½æ•°å¿…é¡»åœ¨æ¯ æ¬¡æ‰§è¡Œæ—¶å¿…é¡»é‡æ–°è§£æè¯¥æ•°æ®ã€‚ jsonbæ•°æ®è¢«å­˜å‚¨åœ¨ä¸€ç§åˆ†è§£å¥½çš„ äºŒè¿›åˆ¶æ ¼å¼ä¸­ï¼Œå®ƒåœ¨è¾“å…¥æ—¶è¦ç¨æ…¢ä¸€äº›ï¼Œå› ä¸ºéœ€è¦åšé™„åŠ çš„è½¬æ¢ã€‚ä½†æ˜¯Â jsonbåœ¨å¤„ç†æ—¶è¦å¿«å¾ˆå¤šï¼Œå› ä¸ºä¸éœ€è¦è§£æã€‚jsonbä¹Ÿæ”¯æŒç´¢å¼•ï¼Œjsonbä¸ä¿ç•™ç©ºæ ¼ã€ä¸ ä¿ç•™å¯¹è±¡é”®çš„é¡ºåºå¹¶ä¸”ä¸ä¿ç•™é‡å¤çš„å¯¹è±¡é”®ã€‚ å…³äº JSONBÂ çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è€ƒ JSON ç±»å‹ï¼Œè¿™é‡Œåªä»‹ç» JSONBÂ ç±»å‹æ•°æ®çš„ä½¿ç”¨ã€‚ åˆ›å»º JSONB ç±»å‹çš„è¡¨ CREATETABLEposts(IDINTPRIMARYKEYNOTNULL,specJSONB); æ’å…¥æ•°æ®ï¼Œä½¿ç”¨çš„å…³é”®å­—ä¸º INSERT INTOÂ ã€‚ -- æ’å…¥ç¬¬ä¸€æ¡æ•°æ® insertintopostsvalues(1,'{\"name\": \"first posts\", \"content\": \"This is a simple post\", \"author\": \"a\", \"time\": \"2020/10/15\"}');-- æ’å…¥ç¬¬äºŒæ¡æ•°æ® insertintopostsvalues(2,'{\"name\": \"jsonb\", \"content\": \"jsonb is PostgreSQL inner type\", \"author\": \"bb\", \"time\": \"2020/10/12\", \"tag\": [\"database\", \"PgSQL\"]}'); æ·»åŠ  key/valueÂ ç´¢å¼•ï¼š -- ç»™æ‰€æœ‰ key/values æ·»åŠ ç´¢å¼• CREATEINDEXidx_posts_specONpostsUSINGgin(spec);-- ç»™æŒ‡å®šçš„ key/values æ·»åŠ ç´¢å¼• CREATEINDEXidx_posts_spec_authorONpostsUSINGgin((spec-\u003e'author')); æ•°æ®æŸ¥è¯¢ SELECTÂ ï¼Œå…¨è¡¨æŸ¥è¯¢ï¼š testdb=#select*fromposts;id|spec----+------------------------------------------------------------------------------------------------------------------------------------ 1|{\"name\":\"first posts\",\"time\":\"2020/10/15\",\"author\":\"a\",\"content\":\"This is a simple post\"}2|{\"tag\":[\"database\",\"PgSQL\"],\"name\":\"jsonb\",\"time\":\"2020/10/12\",\"author\":\"bb\",\"content\":\"jsonb is PostgreSQL inner type\"}(2rows) æŸ¥è¯¢ JSONBÂ å†…çš„æ•°æ®ï¼š -- spec-\u003e'name' è¾“å‡ºçš„æ•°æ®æ ¼å¼ä¸ºåŸç”Ÿæ ¼å¼ testdb=#selectid,spec-\u003e'name'fromposts;id|?column?----+--------------- 1|\"first posts\"2|\"jsonb\"(2rows)-- spec-\u003e\u003e'name' è¾“å‡ºæ ¼å¼ä¸º TEXT testdb=#selectid,spec-\u003e\u003e'name'fromposts;id|?column?----+------------- 1|firstposts2|jsonb(2rows)testdb=#insertintopostsvalues(3,'{\"name\": \"other\", \"content\": \"other data\", \"author\": \"bb\", \"other\": {\"name\": \"other\"}}');INSERT01-- ä½¿ç”¨ -\u003e æ“ä½œç¬¦æŸ¥è¯¢å¤šçº§ json æ ¼å¼çš„æ•°æ® testdb=#selectid,spec-\u003e'name'asspec_name,spec-\u003e'other'-\u003e'name'asspec_other_namefromposts;id|spec_name|spec_other_name----+---------------+----------------- 1|\"first posts\"|2|\"jsonb\"|3|\"other\"|\"other\"-- ä½¿ç”¨ ? æŸ¥è¯¢ key æ˜¯å¦å­˜åœ¨ testdb=#selectid,specfrompostswherespec?'tag';id|spec----+------------------------------------------------------------------------------------------------------------------------------------ 2|{\"tag\":[\"database\",\"PgSQL\"],\"name\":\"jsonb\",\"time\":\"2020/10/12\",\"author\":\"bb\",\"content\":\"jsonb is PostgreSQL inner type\"}(1row)-- ä½¿ç”¨ ? æŸ¥è¯¢ values testdb=#selectid,specfrompostswherespec-\u003e'author'?'bb';id|spec----+------------------------------------------------------------------------------------------------------------------------------------ 2|{\"tag\":[\"database\",\"PgSQL\"],\"name\":\"jsonb\",\"time\":\"2020/10/12\",\"author\":\"bb\",\"content\":\"jsonb is PostgreSQL inner type\"}3|{\"name\":\"other\",\"other\":{\"name\":\"other\"},\"author\":\"bb\",\"content\":\"other data\"}(2rows)-- ä½¿ç”¨ @\u003e æ¥ç²¾ç¡®æŸ¥è¯¢ testdb=#selectid,specfrompostswherespec@\u003e'{\"other\": {\"name\": \"other\"}}'::jsonb;id|spec----+---------------------------------------------------------------------------------------- 3|{\"name\":\"other\",\"other\":{\"name\":\"other\"},\"author\":\"bb\",\"content\":\"other data\"}(1row) JSONBÂ æ”¯æŒçš„å…¶ä»–å‡½æ•°å’Œæ“ä½œç¬¦å¯ä»¥å‚è€ƒ è¿™é‡Œã€‚ ","date":"2020-10-13","objectID":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/:10:0","tags":["postgreSQL","database"],"title":"postgresql å®æˆ˜ä¸€ï¼šå®‰è£…å’Œä½¿ç”¨","uri":"/pgsql%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/"},{"categories":["ç¬”è®°"],"content":"golang cgo åˆ° Windows çš„äº¤å‰ç¼–è¯‘ æœ¬ç¯‡è®°å½•åœ¨ MaxOS ä¸‹ cgo äº¤å‰ç¼–è¯‘çš„è§£å†³æ–¹æ¡ˆã€‚å› ä¸ºåœ¨é¡¹ç›®ä¸­ä½¿ç”¨ go-sqlite3 ï¼Œç¼–è¯‘ go-sqlite3 ä¸­éœ€è¦ä½¿ç”¨åˆ° cgoã€‚åœ¨ MacOS ä¸‹ç¼–è¯‘ Go åŸç”Ÿ Linux å’Œ Windows çš„ç¨‹åºä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š # äº¤å‰ç¼–è¯‘åˆ° linux GOOS=linux GOARCH=amd64 go build main.go # äº¤å‰ç¼–è¯‘åˆ° windows GOOS=windows GOARCH=amd64 go build -o main.exe main.go å¦‚æœä½¿ç”¨ cgo çš„è¯ï¼Œè¿˜éœ€è¦æ·»åŠ  CGO_ENABLEDÂ å‚æ•°ï¼š CGO_ENABLED=1 GOOS=windows GOARCH=amd64 go build -o main.exe main.go ä½†æ˜¯è¿™ç§ç¼–è¯‘ go-sqlite3 çš„ä»£ç ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š # runtime/cgo gcc_libinit_windows.c:7:10: fatal error: 'windows.h' file not found å› ä¸º Windows ä¸­ä½¿ç”¨ MinGWï¼ŒMacOS ä¸‹å¦‚æœäº¤å‰ç¼–è¯‘éœ€è¦å®‰è£… C/C++ äº¤å‰ç¼–è¯‘å·¥å…·ï¼š brew install FiloSottile/musl-cross/musl-cross brew install mingw-w64 å®‰è£…å®Œå·¥å…·ä¹‹åå°±å¯ä»¥ä½¿ç”¨å‘½ä»¤ï¼š CGO_ENABLED=1 CC=x86_64-w64-mingw32-gcc CXX=x86_64-w64-mingw32-g++ GOOS=windows GOARCH=amd64 go build -a -v -o store.exe store/sqlite.exe æ³¨æ„å‚æ•°ï¼š CXX=x86_64-w64-mingw32-g++Â ï¼Œå¦‚æœç¼ºå°‘è¿™ä¸ªå‚æ•°æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°é”™è¯¯ï¼š # runtime/cgo gcc: error: unrecognized command line option â€˜-mthreadsâ€™; did you mean â€˜-pthreadâ€™? ","date":"2020-09-10","objectID":"/golang%E8%B7%A8%E5%B9%B3%E5%8F%B0%E7%BC%96%E8%AF%91/:0:0","tags":["golang"],"title":"Golangè·¨å¹³å°ç¼–è¯‘","uri":"/golang%E8%B7%A8%E5%B9%B3%E5%8F%B0%E7%BC%96%E8%AF%91/"},{"categories":["è¿ç»´"],"content":"SCST æ˜¯ iscsi çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œå®ƒæ—¢å¯ä»¥ä½¿ç”¨ iscsi åè®®å…±äº«æœ¬åœ°ç£ç›˜ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒ FC åè®®ã€‚FC åè®®éœ€è¦ç¡¬ä»¶ FC HBA å¡çš„æ”¯æŒã€‚ SCST å’Œ FC çš„ç¯å¢ƒæ­å»ºå¦‚ä¸‹çœ‹è¿™é‡Œ ã€‚ ç¯å¢ƒé…ç½® æ¥ä¸‹æ¥ SCST å’Œ FC çš„ä½¿ç”¨ã€‚é¦–å…ˆéœ€è¦æœ‰ scst çš„ç¯å¢ƒï¼š ä¿è¯ linux å†…æ ¸ä¸­åŠ è½½äº† qlaã€‚ä½¿ç”¨ scstadm æŸ¥çœ‹æ‰€æ”¯æŒçš„é©±åŠ¨ï¼š å¦‚æœä½¿ç”¨ FC å»å…±äº«ç£ç›˜ï¼Œscst éœ€è¦åˆ›å»ºå’Œ FC è®¾å¤‡å¯¹åº”çš„ targetã€‚FC è®¾å¤‡å’Œ target å±äºä¸€å¯¹ä¸€å…³ç³»ï¼Œè€Œä¸”åˆ›å»º target çš„åç§°è¦å’Œ FC è®¾å¤‡çš„ ID ç›¸åŒã€‚æŸ¥çœ‹ FC è®¾å¤‡çš„ ID å¯ä»¥ç”¨ä»¥ä¸‹çš„æ–¹å¼ï¼š 1.æŸ¥çœ‹å†…æ ¸ä¸­ qla2x00t (/sys/kernel/scst_tgt/targets/qla2x00t) ç›®å½•ä¸‹çš„å†…å®¹ 2.ç›´æ¥æŸ¥çœ‹ FC è®¾å¤‡çš„ port_id (/sys/class/fc_host/hostx/port_name)ï¼Œ é…ç½® FC ","date":"2020-08-06","objectID":"/scst%E7%BB%93%E5%90%88fc/:0:0","tags":["iscsi"],"title":"Scstç»“åˆFC","uri":"/scst%E7%BB%93%E5%90%88fc/"},{"categories":["è¿ç»´"],"content":"SCST æœåŠ¡ç«¯é…ç½® åˆ›å»º target, FC è®¾å¤‡å’Œ target ä¸€å¯¹ä¸€ã€‚ scstadmin -add_target 50:01:10:a0:00:16:bf:30 -driver qla2x00t åˆ›å»º device å¯¹åº”æœ¬åœ°çš„å—æ–‡ä»¶ scstadmin -open_dev fc1 -handler vdisk_fileio -attributes filename=/dev/sdc åˆ›å»º groupï¼Œscst ä¸­çš„ group ç”¨äºé™å®šå…±äº«çš„å¯¹è±¡ã€‚ scstadmin -add_group group1 -target 50:01:10:a0:00:16:bf:30 -driver qla2x00t åˆ›å»º lunï¼Œå› ä¸º scst target å’Œ FC è®¾ç½®æ˜¯ä¸€å¯¹ä¸€å…³ç³»ï¼Œæ‰€ä»¥å½“éœ€è¦åœ¨åŒä¸€ä¸ª FC ä¸‹å…±äº«å¤šä¸ªç£ç›˜ç»™ä¸åŒçš„å®¢æˆ·ç«¯æ—¶å°±éœ€è¦åœ¨åŒä¸€ä¸ª target ä¸‹åˆ›å»ºå¤šä¸ª lunã€‚ scstadmin -add_lun 0 -target 50:01:10:a0:00:16:bf:30 -driver qla2x00t -group group1 -device fc1 æŒ‡å®šå…±äº«çš„å®¢æˆ·ç«¯ï¼Œè¿™é‡Œéœ€è¦çŸ¥é“å®¢æˆ·ç«¯ FC è®¾å¤‡å¯¹åº”çš„ IDã€‚æŸ¥çœ‹ /sys/class/fc_host/hostx/port_name scstadmin -add_init 50:01:10:a0:00:16:bf:34 --target 50:01:10:a0:00:16:bf:30 -driver qla2x00t -group group1 -device fc1 å¯åŠ¨ target scstadmin -enable_target 50:01:10:a0:00:16:bf:30 --driver qla2x00t æœ€åå°†æ”¹åŠ¨å†™å…¥é…ç½®æ–‡ä»¶ scstadmin -write_config /etc/scst.conf ï¼ˆå¦‚æœå¯¹åº”çš„å®¢æˆ·ç«¯å·²ç»å±äºæŸä¸ªå·²å­˜åœ¨çš„ groupï¼Œåˆ™å¤ç”¨è¿™ä¸ª groupï¼Œå¹¶é€‰æ‹©ä¸å­˜åœ¨çš„ lun idï¼‰ ","date":"2020-08-06","objectID":"/scst%E7%BB%93%E5%90%88fc/:1:0","tags":["iscsi"],"title":"Scstç»“åˆFC","uri":"/scst%E7%BB%93%E5%90%88fc/"},{"categories":["è¿ç»´"],"content":"å®¢æˆ·ç«¯é…ç½® æ‰«æ scst ä¸»æœº echo \"- - -\" \u003e /sys/class/scst_host/host3/scan å…¶ä¸­ \"- - -\" è¿™ä¸‰ä¸ªå€¼ä»£è¡¨é€šé“ï¼ŒSCSIç›®æ ‡IDå’ŒLUNã€‚ç ´æŠ˜å·å……å½“é€šé…ç¬¦ï¼Œè¡¨ç¤ºâ€œé‡æ–°æ‰«ææ‰€æœ‰å†…å®¹â€ã€‚host3 å’Œ /sys/class/fc_host/host3 ç›¸å¯¹åº”ã€‚æ‰§è¡Œå‘½ä»¤åå®¢æˆ·ç«¯å¢åŠ äº†ä¸€å—ç£ç›˜ã€‚ ","date":"2020-08-06","objectID":"/scst%E7%BB%93%E5%90%88fc/:2:0","tags":["iscsi"],"title":"Scstç»“åˆFC","uri":"/scst%E7%BB%93%E5%90%88fc/"},{"categories":["å¾®æœåŠ¡","ä»£ç "],"content":"GRPC ç®€ä»‹ grpc æ˜¯ç”± google å¼€å‘çš„ä¸€æ¬¾å¼€æºï¼Œé«˜æ€§èƒ½ rpcï¼ˆè¿œç¨‹è¿›ç¨‹è°ƒç”¨åè®®ï¼‰ä½¿ç”¨ Protocol Buffers ä½œä¸ºæ•°æ®äº¤æ¢æ ¼å¼ã€‚ GRPC å®‰è£… golang ä½¿ç”¨ grpc è¦å®‰è£… grpc-go, protoc å’Œ å¯¹åº”çš„æ’ä»¶ã€‚ ","date":"2020-07-31","objectID":"/grpc1/:0:0","tags":["golang","grpc"],"title":"GPRC å®æˆ˜","uri":"/grpc1/"},{"categories":["å¾®æœåŠ¡","ä»£ç "],"content":"å®‰è£…grpc-go go get -u github.com/golang/protobuf/{proto,protoc-gen-go} go get -u google.golang.org/grpc å¦‚æœæ˜¯å›½å†…ç”¨æˆ·æ— æ³•è¿æ¥åˆ° google.golang.org çš„è¯å¯ä»¥ä½¿ç”¨ VPNã€‚æˆ–è€…ç›´æ¥ä» github.com ç›´æ¥ä¸‹è½½æºä»£ç å†ç¼–è¯‘å®‰è£… git clone https://github.com/grpc/grpc-go.git $GOPATH/src/google.golang.org/grpc go get -u google.golang.org/grpc ","date":"2020-07-31","objectID":"/grpc1/:1:0","tags":["golang","grpc"],"title":"GPRC å®æˆ˜","uri":"/grpc1/"},{"categories":["å¾®æœåŠ¡","ä»£ç "],"content":"å®‰è£… protoc golang è¦ä½¿ç”¨ grpcï¼Œè¿˜éœ€è¦ä½¿ç”¨ protoc å·¥å…·ã€‚å› ä¸º golang ä¸èƒ½ç›´æ¥è¯†åˆ« .proto æ–‡ä»¶ï¼Œéœ€è¦ä½¿ç”¨ protoc å·¥å…·å°† .proto è½¬åŒ–æˆ golang ä»£ç ã€‚ä¸‹é¢ä»‹ç»å‡ ä¸ªå¹³å°ä¸‹å®‰è£… protobuf çš„æ–¹æ³•ã€‚ ","date":"2020-07-31","objectID":"/grpc1/:2:0","tags":["golang","grpc"],"title":"GPRC å®æˆ˜","uri":"/grpc1/"},{"categories":["å¾®æœåŠ¡","ä»£ç "],"content":"macos macos ä¸‹å®‰è£…ç›´æ¥ä½¿ç”¨ brew å‘½ä»¤å³å¯ã€‚ brew install protobuf ","date":"2020-07-31","objectID":"/grpc1/:2:1","tags":["golang","grpc"],"title":"GPRC å®æˆ˜","uri":"/grpc1/"},{"categories":["å¾®æœåŠ¡","ä»£ç "],"content":"linux linux ä¸‹éœ€è¦å…ˆä» github.com ä¸‹è½½ protobuf æºç æˆ–è€…äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸‹è½½åœ°å€ã€‚äºŒè¿›åˆ¶å®‰è£…çš„è¯å°±ä¸‹è½½ protobuf-all-*.tar.gz åŒ…ï¼Œè§£å‹åè¿›å…¥ç”Ÿæˆçš„ç›®å½•ã€‚ä¹‹åæ‰§è¡Œå‘½ä»¤ï¼š make \u0026\u0026 make install ","date":"2020-07-31","objectID":"/grpc1/:2:2","tags":["golang","grpc"],"title":"GPRC å®æˆ˜","uri":"/grpc1/"},{"categories":["å¾®æœåŠ¡","ä»£ç "],"content":"windows ä¸‹è½½ protobuf.all-*.zip åŒ…ï¼Œè§£å‹åå†é…ç½®ç¯å¢ƒå˜é‡ï¼Œå°† protobuf\\bin é…ç½®åˆ° $PATH å˜é‡ä¸­ã€‚ GRPCä½¿ç”¨ ","date":"2020-07-31","objectID":"/grpc1/:2:3","tags":["golang","grpc"],"title":"GPRC å®æˆ˜","uri":"/grpc1/"},{"categories":["å¾®æœåŠ¡","ä»£ç "],"content":"æ–°å»ºé¡¹ç›® æ–°å»ºä¸€ä¸ª grpc é¡¹ç›®ï¼Œå¦‚ä¸‹: ../sample â””â”€â”€ pb â””â”€â”€ echo.proto echo.proto çš„å†…å®¹ä¸º: syntax = \"proto3\"; // protobuf è¯­æ³•ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸º proto2 // // è¿™ä¸ªæ˜¯æ³¨é‡Š // .proto æ‰€åœ¨çš„åŒ…è·¯å¾„ package sample.pb;option go_package = \"pb\";// EchoRequest grpc è¯·æ±‚æŠ¥æ–‡æ ¼å¼. message EchoRequest { string message = 1;}// EchoResponse grpc å“åº”æŠ¥æ–‡æ ¼å¼. message EchoResponse { string message = 1;}// å®šä¹‰ Echo æœåŠ¡. service Echo { // UnaryEcho ä¸€å…ƒè¯·æ±‚. rpc UnaryEcho(EchoRequest) returns (EchoResponse) {} // ServerStreamingEcho æœåŠ¡ç«¯ stream è¯·æ±‚. rpc ServerStreamingEcho(EchoRequest) returns (stream EchoResponse) {} // ClientStreamingEcho å®¢æˆ·ç«¯ stream è¯·æ±‚. rpc ClientStreamingEcho(stream EchoRequest) returns (EchoResponse) {} // BidirectionalStreamingEcho åŒå‘ stream. rpc BidirectionalStreamingEcho(stream EchoRequest) returns (stream EchoResponse) {}} æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°† .proto è½¬åŒ–ä¸º golang ä»£ç : cd sample # protoc -I\u003cimportè·¯å¾„\u003e \u003c...-I$PATH\u003e --go_out=plugins=grpc:\u003cè¾“å‡ºè·¯å¾„\u003e *.proto protoc -I. --go_out=plugins=grpc:. pb/echo.proto ç®€å•æè¿°ä¸‹ protoc å‘½ä»¤çš„åŠŸèƒ½ã€‚ -I : *.proto ä¸­å¯¼å…¥çš„åŒ…çš„è·¯å¾„ï¼Œå¯¼å…¥çš„è·¯å¾„ä¸ºå…¨è·¯å¾„æ ¼å¼ã€‚. è¡¨ç¤ºå½“å‰è·¯å¾„ã€‚ â€“go_out=plugins=grpc: ï¼šæŒ‡å®š _.proto è¾“å‡ºçš„æ ¼å¼å’Œè·¯å¾„ï¼Œç”Ÿæˆ _.go æ–‡ä»¶çš„è·¯å¾„ä¸º å’Œ *.proto çš„æ‹¼æ¥ã€‚æ‰§è¡ŒæˆåŠŸåæˆä¸ºæ–‡ä»¶ echo.pb.go æ–‡ä»¶: ../sample â””â”€â”€ pb â”œâ”€â”€ echo.pb.go â””â”€â”€ echo.proto ","date":"2020-07-31","objectID":"/grpc1/:3:0","tags":["golang","grpc"],"title":"GPRC å®æˆ˜","uri":"/grpc1/"},{"categories":["å¾®æœåŠ¡","ä»£ç "],"content":"Server package main import ( \"context\" \"errors\" \"google.golang.org/grpc\" \"io\" \"log\" \"mysite/sample/pb\" \"net\" ) type server struct { pb.EchoServer } // ç®€å•è¯·æ±‚ func (s *server) UnaryEcho(ctx context.Context, request *pb.EchoRequest) (*pb.EchoResponse, error) { return \u0026pb.EchoResponse{Message: \"echo: \" + request.Message}, nil } // æœåŠ¡ç«¯æµå¼ func (s *server) ServerStreamingEcho(request *pb.EchoRequest, stream pb.Echo_ServerStreamingEchoServer) error { _ = stream.Send(\u0026pb.EchoResponse{Message: \"hello\"}) _ = stream.Send(\u0026pb.EchoResponse{Message: \" \"}) _ = stream.Send(\u0026pb.EchoResponse{Message: \"client\"}) return nil } // å®¢æˆ·ç«¯æµå¼ func (s *server) ClientStreamingEcho(stream pb.Echo_ClientStreamingEchoServer) error { for { recv, err := stream.Recv() // block ç›´åˆ°æœ‰æ•°æ®è¾“å‡º if errors.Is(err, io.EOF) { // è¡¨ç¤ºæ¶ˆæ¯ä¼ è¾“å®Œæ¯• break } if err != nil { log.Printf(\"recv error: %v\", err) return err } // client æ–­å¼€è¿æ¥ log.Printf(\"recv data: %v\", recv.Message) } // SendAndClose åªå­˜åœ¨äºå®¢æˆ·ç«¯ stream è¯·æ±‚ // å‘é€å®Œå…³é—­ stream return stream.SendAndClose(\u0026pb.EchoResponse{Message: \"bye\"}) } // åŒå‘æµå¼ func (s *server) BidirectionalStreamingEcho(stream pb.Echo_BidirectionalStreamingEchoServer) error { // å¦‚æœæœåŠ¡ç«¯ stream æ–¹æ³•é€€å‡ºï¼Œå®¢æˆ·ç«¯è¯·æ±‚ä¹Ÿç›´æ¥æ–­å¼€ for { recv, err := stream.Recv() if errors.Is(err, io.EOF) { break } if err != nil { log.Printf(\"recv error: %v\", err) return err } if recv.Message == \"bye\" { log.Printf(\"client send done!\") break } if err := stream.Send(\u0026pb.EchoResponse{Message: \"reply: \" + recv.Message}); err != nil { log.Printf(\"send message error: %v\", err) return err } } return nil } func main() { addr := \"127.0.0.1:50001\" // grpc ä¸º http2 è¯·æ±‚ï¼Œä¼ è¾“å±‚åè®®ä¸º tcp lis, err := net.Listen(\"tcp\", addr) if err != nil { log.Fatalf(\"binding at %v: %v\", addr, err) } gRPCServer := grpc.NewServer() pb.RegisterEchoServer(gRPCServer, \u0026server{}) if err := gRPCServer.Serve(lis); err != nil { log.Fatalf(\"start grpc: %v\", err) } } ","date":"2020-07-31","objectID":"/grpc1/:4:0","tags":["golang","grpc"],"title":"GPRC å®æˆ˜","uri":"/grpc1/"},{"categories":["å¾®æœåŠ¡","ä»£ç "],"content":"Client package main import ( \"context\" \"errors\" \"fmt\" \"google.golang.org/grpc\" \"io\" \"log\" \"mysite/sample/pb\" ) // ç®€å•è¯·æ±‚ func unaryEcho(cli pb.EchoClient, msg string) { recv, err := cli.UnaryEcho(context.Background(), \u0026pb.EchoRequest{Message: msg}) if err != nil { log.Fatalf(\"unaryEcho %v\", err) } log.Println(\"recv data =\u003e \" + recv.Message) } // æœåŠ¡ç«¯æµå¼ func serverStreamingEcho(cli pb.EchoClient, msg string) { stream, err := cli.ServerStreamingEcho(context.Background(), \u0026pb.EchoRequest{Message: msg}) if err != nil { log.Fatalf(\"serverStreamingEcho %v\", err) } ctx := stream.Context() for { select { case \u003c-ctx.Done(): log.Println(\"serverStreamingEcho done!\") break default: } msg, err := stream.Recv() if errors.Is(err, io.EOF) { break } if err == nil { log.Println(\"serverStreaming reply =\u003e \", msg.Message) } } } // å®¢æˆ·ç«¯æµå¼ func clientStreamingEcho(cli pb.EchoClient) { stream, err := cli.ClientStreamingEcho(context.Background()) if err != nil { log.Printf(\"connect client Streaming: %v\\n\", err) return } err = stream.Send(\u0026pb.EchoRequest{Message: \"hello\"}) if err != nil { log.Printf(\"clientStreamingEcho send data: %v\", err) return } err = stream.Send(\u0026pb.EchoRequest{Message: \" \"}) if err != nil { log.Printf(\"clientStreamingEcho send data: %v\", err) return } err = stream.Send(\u0026pb.EchoRequest{Message: \"world\"}) if err != nil { log.Printf(\"clientStreamingEcho send data: %v\", err) return } if recv, err := stream.CloseAndRecv(); err == nil { fmt.Printf(\"recv data: %v\\n\", recv.Message) } } // åŒå‘æµå¼ func bidirectionalStreamingEcho(cli pb.EchoClient) { stream, err := cli.BidirectionalStreamingEcho(context.Background()) if err != nil { log.Printf(\"bidirectionalStreamingEcho error: %v\\n\", err) return } stream.Send(\u0026pb.EchoRequest{Message: \"dataset 1\"}) recv, err := stream.Recv() if err == nil { fmt.Printf(\"recv from bidirectionalStreamingEcho =\u003e %v\\n\", recv.Message) } stream.Send(\u0026pb.EchoRequest{Message: \"dataset 2\"}) recv, err = stream.Recv() if err == nil { fmt.Printf(\"recv from bidirectionalStreamingEcho =\u003e %v\\n\", recv.Message) } stream.Send(\u0026pb.EchoRequest{Message: \"dataset 3\"}) recv, err = stream.Recv() if err == nil { fmt.Printf(\"recv from bidirectionalStreamingEcho =\u003e %v\\n\", recv.Message) } stream.Send(\u0026pb.EchoRequest{Message: \"bye\"}) stream.CloseSend() } func main() { addr := \"127.0.0.1:50001\" ctx, cancel := context.WithCancel(context.Background()) defer cancel() conn, err := grpc.DialContext(ctx, addr, grpc.WithInsecure()) if err != nil { log.Fatalf(\"connect %v: %v\", addr, err) } cli := pb.NewEchoClient(conn) unaryEcho(cli, \"hello\") serverStreamingEcho(cli, \"hello\") clientStreamingEcho(cli) bidirectionalStreamingEcho(cli) } ","date":"2020-07-31","objectID":"/grpc1/:5:0","tags":["golang","grpc"],"title":"GPRC å®æˆ˜","uri":"/grpc1/"},{"categories":["å¾®æœåŠ¡","ä»£ç "],"content":"grpc é™¤äº†æä¾›å››ç§è¯·æ±‚ç±»å‹ä¹‹å¤–ï¼Œè¿˜æ”¯æŒå¾ˆå¤šé«˜çº§åŠŸèƒ½ï¼škeepaliveã€è¯·æ±‚é‡è¯•ã€è´Ÿè½½å‡è¡¡ã€ç”¨æˆ·éªŒè¯ç­‰ã€‚æ¥ä¸‹æ¥ä¸€ä¸€ä»‹ç»ã€‚ GRPC è¿›é˜¶åŠŸèƒ½ æ¯ä¸ªgrpcè¯·æ±‚éƒ½æ˜¯ streamã€‚ ","date":"2020-07-31","objectID":"/grpc2/:0:0","tags":["golang","grpc"],"title":"GPRC è¿›é˜¶","uri":"/grpc2/"},{"categories":["å¾®æœåŠ¡","ä»£ç "],"content":"Keepalive Keepalive èƒ½å¤Ÿè®© grpc çš„æ¯ä¸ª stream ä¿æŒé•¿è¿æ¥çŠ¶æ€ï¼Œé€‚åˆä¸€äº›æ‰§è¡Œæ—¶é—´é•¿çš„è¯·æ±‚ã€‚Keepalive æ”¯æŒåœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯é…ç½®ï¼Œä¸”åªæœ‰æœåŠ¡ç«¯é…ç½®åï¼Œå®¢æˆ·ç«¯çš„é…ç½®æ‰ä¼šçœŸæ­£æœ‰æ•ˆã€‚å…ˆç»™å‡ºå®ä¾‹çš„ä»£ç åœ¨æ¥è¯´æ˜ grpc keepalive çš„ä½¿ç”¨æƒ…å†µï¼šserver å®ç°ï¼š // ... var kaep = keepalive.EnforcementPolicy{ MinTime: 5 * time.Second, // If a client pings more than once every 5 seconds, terminate the connection PermitWithoutStream: true, // Allow pings even when there are no active streams } var kasp = keepalive.ServerParameters{ MaxConnectionIdle: 15 * time.Second, // If a client is idle for 15 seconds, send a GOAWAY MaxConnectionAge: 30 * time.Second, // If any connection is alive for more than 30 seconds, send a GOAWAY MaxConnectionAgeGrace: 5 * time.Second, // Allow 5 seconds for pending RPCs to complete before forcibly closing connections Time: 5 * time.Second, // Ping the client if it is idle for 5 seconds to ensure the connection is still active Timeout: 1 * time.Second, // Wait 1 second for the ping ack before assuming the connection is dead } // server implements EchoServer. type server struct { pb.UnimplementedEchoServer } func (s *server) UnaryEcho(ctx context.Context, req *pb.EchoRequest) (*pb.EchoResponse, error) { return \u0026pb.EchoResponse{Message: req.Message}, nil } func main() { address := \"50001\" lis, err := net.Listen(\"tcp\", address) if err != nil { log.Fatalf(\"failed to listen: %v\", err) } // åˆ›å»º grpc server æ—¶é…ç½®æœåŠ¡ç«¯çš„ keepalive s := grpc.NewServer(grpc.KeepaliveEnforcementPolicy(kaep), grpc.KeepaliveParams(kasp)) pb.RegisterEchoServer(s, \u0026server{}) if err := s.Serve(lis); err != nil { log.Fatalf(\"failed to serve: %v\", err) } } client ç«¯å®ç°ï¼š // ... var kacp = keepalive.ClientParameters{ Time: 10 * time.Second, // send pings every 10 seconds if there is no activity Timeout: time.Second, // wait 1 second for ping ack before considering the connection dead PermitWithoutStream: true, // send pings even without active streams } func main() { conn, err := grpc.Dial(\"50001\", grpc.WithInsecure(), grpc.WithKeepaliveParams(kacp)) if err != nil { log.Fatalf(\"did not connect: %v\", err) } defer conn.Close() c := pb.NewEchoClient(conn) ctx, cancel := context.WithTimeout(context.Background(), 3*time.Minute) defer cancel() fmt.Println(\"Performing unary request\") res, err := c.UnaryEcho(ctx, \u0026pb.EchoRequest{Message: \"keepalive demo\"}) if err != nil { log.Fatalf(\"unexpected error from UnaryEcho: %v\", err) } fmt.Println(\"RPC response:\", res) } keepalive çš„å®ç°æ ¸å¿ƒåœ¨äº keepalive.EnforcementPolicy å’Œ keepalive.ServerParametersã€‚é¦–å…ˆæ˜¯ keepalive.ServerParametersã€‚å®ƒåŒ…å«å‡ ä¸ªå±æ€§ï¼š MaxConnectionIdle : æœ€å¤§ç©ºé—²è¿æ¥æ—¶é—´ï¼Œé»˜è®¤ä¸ºæ— é™åˆ¶ã€‚è¿™æ®µæ—¶é—´ä¸ºå®¢æˆ·ç«¯ stream è¯·æ±‚ä¸º0 æˆ–è€…å»ºç«‹è¿æ¥ã€‚è¶…å‡ºè¿™æ®µæ—¶é—´åï¼Œserve ä¼šå‘é€ä¸€ä¸ª GoWayï¼Œå¼ºåˆ¶ client stream æ–­å¼€ã€‚ MaxConnectionAgeï¼šæœ€å¤§è¿æ¥æ—¶é—´ï¼Œé»˜è®¤ä¸ºæ— é™åˆ¶ã€‚stream è¿æ¥è¶…å‡ºè¿™ä¸ªå€¼æ˜¯å‘é€ä¸€ä¸ª GoWayã€‚ MaxConnectionAgeGrace ï¼šè¶…å‡ºMaxConnectionAgeä¹‹åçš„å®½é™æ—¶é•¿ï¼Œé»˜è®¤æ— é™åˆ¶ï¼Œæœ€å°ä¸º 1sã€‚ Time ï¼šå¦‚æœä¸€æ®µæ—¶é—´å®¢æˆ·ç«¯å­˜æ´»ä½†æ²¡æœ‰ pings è¯·æ±‚ï¼ŒæœåŠ¡ç«¯å‘é€ä¸€æ¬¡ ping è¯·æ±‚ï¼Œé»˜è®¤æ˜¯ 2hourã€‚ Timeoutï¼šæœåŠ¡ç«¯å‘é€ ping è¯·æ±‚è¶…æ—¶çš„æ—¶é—´ï¼Œé»˜è®¤20sã€‚ keepalive.EnforcementPolicyåœ¨æœåŠ¡ç«¯å¼ºåˆ¶æ‰§è¡Œç­–ç•¥ï¼Œå¦‚æœå®¢æˆ·ç«¯è¿åæ”¹ç­–ç•¥åˆ™æ–­å¼€è¿æ¥ã€‚å®ƒæœ‰ä¸¤ä¸ªå±æ€§ï¼š MinTime : å¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…æ”¶åˆ° pings è¯·æ±‚å¤§äºä¸€æ¬¡ï¼Œå¼ºåˆ¶æ–­å¼€è¿æ¥ï¼Œé»˜è®¤ 5minã€‚ PermitWithoutStreamï¼šæ²¡æœ‰æ´»åŠ¨çš„ stream ä¹Ÿå…è®¸pingsã€‚é»˜è®¤å…³é—­ã€‚ keepalive.ClientParametersæ˜¯åœ¨å®¢æˆ·ç«¯è¿™ä¾§ä½¿ç”¨çš„ keepalive é…ç½®ï¼š Time ï¼špings è¯·æ±‚é—´éš”æ—¶é—´ï¼Œé»˜è®¤æ— é™åˆ¶ï¼Œæœ€å°ä¸º 10sã€‚ Timeout ï¼špings è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤æ˜¯ 20sã€‚ PermitWithoutStreamï¼šæ²¡æœ‰æ´»åŠ¨çš„ stream ä¹Ÿå…è®¸pingsã€‚é»˜è®¤å…³é—­ã€‚ ","date":"2020-07-31","objectID":"/grpc2/:1:0","tags":["golang","grpc"],"title":"GPRC è¿›é˜¶","uri":"/grpc2/"},{"categories":["å¾®æœåŠ¡","ä»£ç "],"content":"è¯·æ±‚é‡è¯• grpc æ”¯æŒè¯·æ±‚é‡è¯•ï¼Œåœ¨å®¢æˆ·ç«¯é…ç½®å¥½è§„åˆ™ä¹‹åï¼Œå®¢æˆ·ç«¯ä¼šåœ¨è¯·æ±‚å¤±è´¥ä¹‹åå°è¯•é‡æ–°å‘èµ·è¯·æ±‚ã€‚ var ( retryPolicy = `{ \"methodConfig\": [{ \"name\": [{\"service\": \"mysite.pb.Echo\"}], \"waitForReady\": true, \"retryPolicy\": { \"MaxAttempts\": 3, \"InitialBackoff\": \".01s\", \"MaxBackoff\": \"1s\", \"BackoffMultiplier\": 2.0, \"RetryableStatusCodes\": [ \"UNAVAILABLE\" ] } }]}` ) // use grpc.WithDefaultServiceConfig() to set service config func retryDial() (*grpc.ClientConn, error) { return grpc.Dial(*addr, grpc.WithInsecure(), grpc.WithDefaultServiceConfig(retryPolicy)) } // ... retry é…ç½®åªéœ€è¦åœ¨å®¢æˆ·ç«¯è®¾ç½®å³å¯ç”Ÿæ•ˆã€‚ä¸»è¦æ˜¯é…ç½®ServerConfigï¼Œæ ¼å¼ä¸ºè¯¥é“¾æ¥ MaxAttempts ï¼šé‡è¯•çš„æœ€å¤§æ¬¡æ•°ï¼Œæœ€å¤§å€¼æ˜¯5ã€‚ InitialBackoff : åˆå§‹åŒ–é‡è¯•é—´éš”æ—¶é—´ï¼Œç¬¬ä¸€æ¬¡é‡è¯•å» Randon(0,initialBackoff)ã€‚ MaxBackoff : æœ€å¤§é‡è¯•é—´éš”æ—¶é—´ï¼Œå¤šæ¬¡é‡è¯•æ˜¯ï¼Œé—´éš”æ—¶é—´å– random(0,min(initial_backoff*backoff_multiplier**(n-1), max_backoff))ã€‚ RetryableStatusCodes : è®¾ç½®éœ€è¦é‡è¯•çš„çŠ¶æ€ç ã€‚ ","date":"2020-07-31","objectID":"/grpc2/:2:0","tags":["golang","grpc"],"title":"GPRC è¿›é˜¶","uri":"/grpc2/"},{"categories":["å¾®æœåŠ¡","ä»£ç "],"content":"è´Ÿè½½å‡è¡¡ grpc æ”¯æŒå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œè´Ÿè½½å‡è¡¡åœ¨ grpc name_resolver çš„åŸºç¡€ä¸Šå®ç°ï¼š const ( exampleScheme = \"example\" exampleServiceName = \"lb.example.grpc.io\" ) // ... func main() { // ... // round_robin æŒ‡å®šè´Ÿè½½å‡è¡¡ç­–ç•¥ä¸ºè½®è¯¢ç­–ç•¥ roundrobinConn, err := grpc.Dial( fmt.Sprintf(\"%s:///%s\", exampleScheme, exampleServiceName), grpc.WithBalancerName(\"round_robin\"), // This sets the initial balancing policy. grpc.WithInsecure(), grpc.WithBlock(), ) // ... } // é…ç½® name resolver type exampleResolverBuilder struct{} func (*exampleResolverBuilder) Build(target resolver.Target, cc resolver.ClientConn, opts resolver.BuildOptions) (resolver.Resolver, error) { r := \u0026exampleResolver{ target: target, cc: cc, addrsStore: map[string][]string{ exampleServiceName: addrs, }, } r.start() return r, nil } func (*exampleResolverBuilder) Scheme() string { return exampleScheme } type exampleResolver struct { target resolver.Target cc resolver.ClientConn addrsStore map[string][]string } func (r *exampleResolver) start() { addrStrs := r.addrsStore[r.target.Endpoint] addrs := make([]resolver.Address, len(addrStrs)) for i, s := range addrStrs { addrs[i] = resolver.Address{Addr: s} } r.cc.UpdateState(resolver.State{Addresses: addrs}) } func (*exampleResolver) ResolveNow(o resolver.ResolveNowOptions) {} func (*exampleResolver) Close() {} func init() { resolver.Register(\u0026exampleResolverBuilder{}) } ä¸»è¦æ˜¯è¦å®ç° resolver.Builderæ¥å£ // Builder creates a resolver that will be used to watch name resolution updates. type Builder interface { // Build creates a new resolver for the given target. // // gRPC dial calls Build synchronously, and fails if the returned error is // not nil. Build(target Target, cc ClientConn, opts BuildOptions) (Resolver, error) // Scheme returns the scheme supported by this resolver. // Scheme is defined at \u003chttps://github.com/grpc/grpc/blob/master/doc/naming.md\u003e. Scheme() string } ä¸Šé¢çš„å®ç°æ–¹å¼ä¸æ”¯æŒåŠ¨æ€å¢å‡æœåŠ¡ç«¯åœ°å€ï¼Œå¯ä»¥ä½¿ç”¨ etcd å®ç°è´Ÿè½½å‡è¡¡ï¼š type etcdBuilder struct { prefix string endpoints []string } func ETCDBuilder(prefix string, endpoints []string) resolver.Builder { return \u0026etcdBuilder{prefix, endpoints} } func (b *etcdBuilder) Build(target resolver.Target, cc resolver.ClientConn, opts resolver.BuildOptions) (resolver.Resolver, error) { cli, err := clientv3.New(clientv3.Config{ Endpoints: b.endpoints, DialTimeout: 3 * time.Second, }) if err != nil { return nil, fmt.Errorf(\"connect to etcd endpoints error\") } ctx, cancel := context.WithCancel(context.Background()) rlv := \u0026etcdResolver{ cc: cc, cli: cli, ctx: ctx, cancel: cancel, watchKeyPrefix: b.prefix, freq: 5 * time.Second, t: time.NewTimer(0), rn: make(chan struct{}, 1), im: make(chan []resolver.Address), wg: sync.WaitGroup{}, } rlv.wg.Add(2) go rlv.watcher() go rlv.FetchBackendsWithWatch() return rlv, nil } func (b *etcdBuilder) Scheme() string { return \"etcd\" } type etcdResolver struct { retry int freq time.Duration ctx context.Context cancel context.CancelFunc cc resolver.ClientConn cli *clientv3.Client t *time.Timer watchKeyPrefix string rn chan struct{} im chan []resolver.Address wg sync.WaitGroup } func (r *etcdResolver) ResolveNow(opt resolver.ResolveNowOptions) { select { case r.rn \u003c- struct{}{}: default: } } func (r *etcdResolver) Close() { r.cancel() r.wg.Wait() r.t.Stop() } func (r *etcdResolver) watcher() { defer r.wg.Done() for { select { case \u003c-r.ctx.Done(): return case addrs := \u003c-r.im: if len(addrs) \u003e 0 { r.retry = 0 r.t.Reset(r.freq) r.cc.UpdateState(resolver.State{Addresses: addrs}) continue } case \u003c-r.t.C: case \u003c-r.rn: } result := r.FetchBackends() if len(result) == 0 { r.retry++ r.t.Reset(r.freq) } else { r.retry = 0 r.t.Reset(r.freq) } r.cc.UpdateState(resolver.State{Addresses: result}) } } func (r *etcdResolver) FetchBackendsWithWatch() { defer r.wg.Done() for { select { case \u003c-r.ctx.Done(): return case _ = \u003c-r.cli.Watch(r.ctx, r.watchKeyPrefix, clientv3.WithPrefix()): result := r.FetchBackends() r.im \u003c- result } } } func (r *etcdResolver) FetchBackends() []resolver.Address { ctx, cancel := context.WithTimeout(context.Background()","date":"2020-07-31","objectID":"/grpc2/:3:0","tags":["golang","grpc"],"title":"GPRC è¿›é˜¶","uri":"/grpc2/"},{"categories":["å¾®æœåŠ¡","ä»£ç "],"content":"grpc åŠ å¯†ä¼ è¾“ ä»¥ä¸Šçš„è¯·æ±‚ä¸­ï¼Œgrpc éƒ½æ˜¯é€šè¿‡æ˜æ–‡ä¼ è¾“æ•°æ®ã€‚ä½†è¿™ç§æ–¹å¼æ˜¯å¾ˆå®¹æ˜“æ³„éœ²æ•°æ®å†…å®¹çš„ï¼Œgrpc æ”¯æŒ TLS æ ¼å¼çš„åŠ å¯†é€šè®¯ï¼Œæ¥ä¿å­˜æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚ ","date":"2020-07-31","objectID":"/grpc2/:4:0","tags":["golang","grpc"],"title":"GPRC è¿›é˜¶","uri":"/grpc2/"},{"categories":["å¾®æœåŠ¡","ä»£ç "],"content":"TLS è¯ä¹¦ æˆ‘ä»¬é¦–å…ˆæ¥ç”Ÿæˆ TLS è¯ä¹¦ openssl ecparam -genkey -name secp384r1 -out server.key openssl req -new -x509 -sha256 -key server.key -out server.pem -days 3650 è¿™é‡Œéœ€è¦å¡«å†™ç›¸å…³ä¿¡æ¯ Country Name (2 letter code) []: State or Province Name (full name) []: Locality Name (eg, city) []: Organization Name (eg, company) []: Organizational Unit Name (eg, section) []: Common Name (eg, fully qualified host name) []: mysite Email Address []: å¡«å†™å®Œæˆåå°±ç”Ÿæˆå¯¹åº”çš„è¯ä¹¦ï¼š ssl â”œâ”€â”€ server.key â””â”€â”€ server.pem æœåŠ¡ç«¯å®ç° // ... const PORT = \"50001\" func main() { // é€šè¿‡ credentials åŠ è½½æœåŠ¡ç«¯çš„TLSè¯ä¹¦ c, err := credentials.NewServerTLSFromFile(\"../ssl/server.pem\", \"../ssl/server.key\") if err != nil { log.Fatalf(\"credentials.NewServerTLSFromFile err: %v\", err) } // æ·»åŠ  credentials é…ç½® server := grpc.NewServer(grpc.Creds(c)) pb.RegisterSearchServiceServer(server, \u0026SearchService{}) lis, err := net.Listen(\"tcp\", \":\"+PORT) if err != nil { log.Fatalf(\"net.Listen err: %v\", err) } server.Serve(lis) } å®¢æˆ·ç«¯å®ç° const PORT = \"9001\" func main() { // æ·»åŠ  credentials é…ç½® c, err := credentials.NewClientTLSFromFile(\"../ssl/server.pem\", \"mysite\") if err != nil { log.Fatalf(\"credentials.NewClientTLSFromFile err: %v\", err) } // å®¢æˆ·ç«¯å¼€å¯è¯ä¹¦éªŒè¯ conn, err := grpc.Dial(\":\"+PORT, grpc.WithTransportCredentials(c)) if err != nil { log.Fatalf(\"grpc.Dial err: %v\", err) } defer conn.Close() client := pb.NewSearchServiceClient(conn) resp, err := client.Search(context.Background(), \u0026pb.SearchRequest{ Request: \"gRPC\", }) if err != nil { log.Fatalf(\"client.Search err: %v\", err) } log.Printf(\"resp: %s\", resp.GetResponse()) } ","date":"2020-07-31","objectID":"/grpc2/:4:1","tags":["golang","grpc"],"title":"GPRC è¿›é˜¶","uri":"/grpc2/"},{"categories":["å¾®æœåŠ¡","ä»£ç "],"content":"CA TLS è¯ä¹¦ TLS è¯ä¹¦çš„å®‰å…¨æ€§è¿˜ä¸å¤Ÿé«˜ï¼Œç‰¹åˆ«åœ¨è¯ä¹¦ç”Ÿæˆä¹‹åï¼Œserver.keyæ–‡ä»¶çš„ä¼ è¾“å°±æˆä¸ºä¸€ä¸ªé—®é¢˜ã€‚æ‰€ä»¥ CA æ¥ç­¾å‘ TLS è¯ä¹¦æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½¿ç”¨å¼€æºå·¥å…· cfssl ç”Ÿæˆå¯¹åº”çš„è¯ä¹¦ï¼š1.ca é…ç½® cat \u003c\u003c EOF | tee ca-config.json { \"signing\": { \"default\": { \"expiry\": \"87600h\" }, \"profiles\": { \"mysite\": { \"expiry\": \"87600h\", \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ] } } }} EOF é…ç½® mysite æœºæ„è¯ä¹¦å¯ä»¥è¿›è¡ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åŒå‘éªŒè¯ã€‚2.ca è¯ä¹¦ cat \u003c\u003c EOF | tee ca-csr.json { \"CN\": \"mysite CA\", \"key\": { \"algo\": \"rsa\", \"size\": 2048 }, \"names\": [ { \"C\": \"CN\", \"L\": \"Beijing\", \"ST\": \"Beijing\" } ]} EOF 3.æœåŠ¡ç«¯è¯ä¹¦ cat \u003c\u003c EOF | tee server-csr.json { \"CN\": \"mysite\", \"hosts\": [ \"127.0.0.1\" ], \"key\": { \"algo\": \"rsa\", \"size\": 2048 }, \"names\": [ { \"C\": \"CN\", \"L\": \"Beijing\", \"ST\": \"Beijing\" } ]} EOF ç”Ÿæˆ mysite ca è¯ä¹¦å’Œç§é’¥ï¼Œåˆå§‹åŒ– ca cfssl gencert -initca ca-csr.json | cfssljson -bare ca ç”Ÿæˆserverè¯ä¹¦ cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=mysite -hostname=mysite server-csr.json | cfssljson -bare server æœ€åçš„ç»“æœä¸º: ../ssl â”œâ”€â”€ ca-config.json â”œâ”€â”€ ca-csr.json â”œâ”€â”€ ca-key.pem â”œâ”€â”€ ca.csr â”œâ”€â”€ ca.pem â”œâ”€â”€ server-csr.json â”œâ”€â”€ server-key.pem â”œâ”€â”€ server.csr â””â”€â”€ server.pem æ¥ä¸‹æ¥æ˜¯ä»£ç å®ç°ï¼Œå…ˆæ˜¯æœåŠ¡ç«¯ï¼š // ... type ecServer struct { pb.UnimplementedEchoServer } func (s *ecServer) UnaryEcho(ctx context.Context, req *pb.EchoRequest) (*pb.EchoResponse, error) { return \u0026pb.EchoResponse{Message: req.Message}, nil } func main() { lis, err := net.Listen(\"tcp\", \"127.0.0.1:50001\") if err != nil { log.Fatalf(\"failed to listen: %v\", err) } // Create tls based credential. cert, err := tls.LoadX509KeyPair(\"ssl/server.pem\", \"ssl/server-key.pem\") if err != nil { log.Fatalf(\"tls.LoadX509KeyPair err: %v\", err) } certPool := x509.NewCertPool() ca, err := ioutil.ReadFile(\"ssl/ca.pem\") if err != nil { log.Fatalf(\"ioutil.ReadFile err: %v\", err) } if ok := certPool.AppendCertsFromPEM(ca); !ok { log.Fatalf(\"certPool.AppendCertsFromPEM err\") } creds := credentials.NewTLS(\u0026tls.Config{ Certificates: []tls.Certificate{cert}, ClientAuth: tls.RequireAndVerifyClientCert, ClientCAs: certPool, }) s := grpc.NewServer(grpc.Creds(creds)) // Register EchoServer on the server. pb.RegisterEchoServer(s, \u0026ecServer{}) log.Println(\"server start\") if err := s.Serve(lis); err != nil { log.Fatalf(\"failed to serve: %v\", err) } } ç„¶åæ˜¯å®¢æˆ·ç«¯ï¼š // ... func callUnaryEcho(client pb.EchoClient, message string) { ctx, cancel := context.WithTimeout(context.Background(), 10*time.Second) defer cancel() resp, err := client.UnaryEcho(ctx, \u0026pb.EchoRequest{Message: message}) if err != nil { log.Fatalf(\"client.UnaryEcho(_) = _, %v: \", err) } fmt.Println(\"UnaryEcho: \", resp.Message) } func main() { // Create tls based credential. cert, err := tls.LoadX509KeyPair(\"ssl/server.pem\", \"ssl/server-key.pem\") if err != nil { log.Fatalf(\"tls.LoadX509KeyPair err: %v\", err) } certPool := x509.NewCertPool() ca, err := ioutil.ReadFile(\"ssl/ca.pem\") if err != nil { log.Fatalf(\"ioutil.ReadFile err: %v\", err) } if ok := certPool.AppendCertsFromPEM(ca); !ok { log.Fatalf(\"certPool.AppendCertsFromPEM err\") } creds := credentials.NewTLS(\u0026tls.Config{ Certificates: []tls.Certificate{cert}, ServerName: \"mysite\", RootCAs: certPool, }) // Set up a connection to the server. conn, err := grpc.Dial(\"127.0.0.1:50001\", grpc.WithTransportCredentials(creds)) if err != nil { log.Fatalf(\"did not connect: %v\", err) } defer conn.Close() // Make a echo client and send an RPC. rgc := pb.NewEchoClient(conn) callUnaryEcho(rgc, \"hello world\") } ","date":"2020-07-31","objectID":"/grpc2/:4:2","tags":["golang","grpc"],"title":"GPRC è¿›é˜¶","uri":"/grpc2/"},{"categories":["å¾®æœåŠ¡","ä»£ç "],"content":"æ‹¦æˆªå™¨ grpc æ”¯æŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„æ‹¦æˆªå™¨ï¼Œå¯ä»¥åœ¨è¯·æ±‚å‘èµ·æˆ–è¿”å›å‰è¿›è¡Œå¤„ç†ï¼Œè€Œä¸ç”¨ä¿®æ”¹åŸæ¥çš„ä»£ç ã€‚æ¥ä¸‹æ¥æ¥çœ‹æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å„è‡ªæ€ä¹ˆä½¿ç”¨æ‹¦æˆªå™¨ï¼š // unary è¯·æ±‚æ‹¦æˆªå™¨ func UnaryInterceptor(ctx context.Context, req interface{}, info *grpc.UnaryServerInfo, handler grpc.UnaryHandler, ) (resp interface{}, err error) { var ip string p, ok := peer.FromContext(ctx) if ok { ip = p.Addr.String() } md, _ := metadata.FromIncomingContext(ctx) start := time.Now() resp, err = handler(ctx, req) end := time.Now() log.Printf(\"%10s | %14s | %10v | md=%v | reply = %v\", ip, info.FullMethod, end.Sub(start), md, resp) return } // stream è¯·æ±‚æ‹¦æˆªå™¨ func StreamInterceptor(srv interface{}, ss grpc.ServerStream, info *grpc.StreamServerInfo, handler grpc.StreamHandler, ) (err error) { var ip string p, ok := peer.FromContext(ss.Context()) if ok { ip = p.Addr.String() } err = handler(srv, ss) log.Printf(\"stream %v | %v | %s\\\\n\", srv, ip, info.FullMethod) return } type server struct { pb.UnimplementedEchoServer } func (s *server) UnaryEcho(ctx context.Context, request *pb.EchoRequest) (*pb.EchoResponse, error) { return \u0026pb.EchoResponse{Message: request.Message}, nil } func (s *server) BidirectionalStreamingEcho(stream pb.Echo_BidirectionalStreamingEchoServer) error { ctx := stream.Context() for { select { case \u003c-ctx.Done(): break default: } msg, err := stream.Recv() if errors.Is(err, io.EOF) { break } if err != nil { log.Printf(\"recv failed: %v\\\\n\", err) } if err := stream.Send(\u0026pb.EchoResponse{Message: \"reply: \" + msg.Message}); err != nil { log.Printf(\"send to client: %v\\\\n\", err) } } return nil } func main() { addr := \"127.0.0.1:50001\" lis, err := net.Listen(\"tcp\", addr) if err != nil { log.Fatalf(\"network at %v: %v\\\\n\", addr, err) } s := grpc.NewServer(grpc.ChainUnaryInterceptor(UnaryInterceptor), grpc.ChainStreamInterceptor(StreamInterceptor)) pb.RegisterEchoServer(s, \u0026server{}) if err := s.Serve(lis); err != nil { log.Fatalf(\"start server at %v: %v\\\\n\", addr, err) } } grpc ä¸­çš„æ‹¦æˆªå™¨åˆ†ä¸¤ç§ï¼Œä¸€å…ƒè¯·æ±‚çš„æ‹¦æˆªå™¨å’Œæµå¼è¯·æ±‚çš„æ‹¦æˆªå™¨ã€‚å…¶ä¸­æµå¼è¯·æ±‚çš„è¿æ¥å™¨åŒæ—¶ä½œç”¨äºæœåŠ¡ç«¯æµå¼ã€å®¢æˆ·ç«¯æµå¼å’ŒåŒå‘æµå¼ä¸‰ç§è¯·æ±‚æ¨¡å¼ã€‚ æ¥ä¸‹æ¥æ˜¯å®¢æˆ·ç«¯ï¼š func clientUnaryInterceptor( ctx context.Context, method string, req, reply interface{}, cc *grpc.ClientConn, invoker grpc.UnaryInvoker, opts ...grpc.CallOption, ) (err error) { ctx = metadata.AppendToOutgoingContext(ctx, \"username\", \"OOB\") err = invoker(ctx, method, req, reply, cc, opts...) return } func clientStreamInterceptor(ctx context.Context, desc *grpc.StreamDesc, cc *grpc.ClientConn, method string, streamer grpc.Streamer, opts ...grpc.CallOption, ) (stream grpc.ClientStream, err error) { // before stream stream, err = streamer(ctx, desc, cc, method, opts...) // after stream return } func callUnaryEcho(cc pb.EchoClient, msg string) { reply, err := cc.UnaryEcho(context.Background(), \u0026pb.EchoRequest{Message: msg}) if err == nil { log.Printf(\"reply =\u003e %v\\\\n\", reply) } } func callBidirectionalEcho(cc pb.EchoClient, msg string) { stream, err := cc.BidirectionalStreamingEcho(context.TODO()) if err != nil { log.Fatalf(\"call BidirectionalEcho: %v\\\\n\", err) } _ = stream.Send(\u0026pb.EchoRequest{Message: msg}) _ = stream.CloseSend() ctx := stream.Context() for { select { case \u003c-ctx.Done(): break default: } reply, err := stream.Recv() if errors.Is(err, io.EOF) { break } if err != nil { log.Fatalf(\"stream recv: %v\\\\n\", err) } log.Printf(\"stream reply =\u003e %v\\\\n\", reply.Message) } } func main() { addr := \"127.0.0.1:50001\" ctx, cancel := context.WithCancel(context.Background()) defer cancel() conn, err := grpc.DialContext( ctx, addr, grpc.WithInsecure(), grpc.WithChainUnaryInterceptor(clientUnaryInterceptor), grpc.WithChainStreamInterceptor(clientStreamInterceptor)) if err != nil { log.Fatalf(\"connect %v: %v\\\\n\", addr, err) } cc := pb.NewEchoClient(conn) callUnaryEcho(cc, \"unary\") callBidirectionalEcho(cc, \"start\") } grpc çš„æ‹¦æˆªå™¨åŒæ—¶æ”¯æŒå•ä¸ªæ‹¦æˆªå™¨å’Œé“¾å¼æ‹¦æˆªå™¨ã€‚ ","date":"2020-07-31","objectID":"/grpc2/:5:0","tags":["golang","grpc"],"title":"GPRC è¿›é˜¶","uri":"/grpc2/"},{"categories":["å¾®æœåŠ¡","ä»£ç "],"content":"grpc æ·»åŠ  pprof æ¥å£ grpc æœ¬èº«æ˜¯ä½¿ç”¨ http2 ä½œä¸ºåº•å±‚åè®®ï¼Œæ‰€ä»¥å®ƒä¹Ÿèƒ½å’Œ golang çš„ pprof ç»“åˆæä¾› pprof æ¥å£ã€‚ä¸‹é¢ç»™å‡ºä»£ç ï¼š type server struct { pb.UnimplementedEchoServer } func (s *server) UnaryEcho(ctx context.Context, request *pb.EchoRequest) (*pb.EchoResponse, error) { return \u0026pb.EchoResponse{Message: request.Message}, nil } func (s *server) BidirectionalStreamingEcho(stream pb.Echo_BidirectionalStreamingEchoServer) error { ctx := stream.Context() for { select { case \u003c-ctx.Done(): break default: } msg, err := stream.Recv() if errors.Is(err, io.EOF) { break } if err != nil { log.Printf(\"recv failed: %v\\\\n\", err) } if err := stream.Send(\u0026pb.EchoResponse{Message: \"reply: \" + msg.Message}); err != nil { log.Printf(\"send to client: %v\\\\n\", err) } } return nil } func main() { addr := \"127.0.0.1:50001\" // è¿™é‡Œå¯ä»¥æ·»åŠ æœåŠ¡æ®µå¯åŠ¨é…ç½®å’Œå„ç§æ‹¦æˆªå™¨ s := grpc.NewServer() pb.RegisterEchoServer(s, \u0026server{}) mux := http.NewServeMux() mux.HandleFunc(\"/debug/pprof/\", pprof.Index) mux.HandleFunc(\"/debug/pprof/cmdline\", pprof.Cmdline) mux.HandleFunc(\"/debug/pprof/profile\", pprof.Profile) mux.HandleFunc(\"/debug/pprof/symbol\", pprof.Symbol) mux.HandleFunc(\"/debug/pprof/trace\", pprof.Trace) // å¯åŠ¨ http2 æœåŠ¡ï¼Œgolang http å¯åŠ¨æ—¶æ·»åŠ è¯ä¹¦ä¼šè‡ªåŠ¨è½¬åŒ–ä¸º http2 æœåŠ¡ã€‚ // å°† Content-Type ä¸º application/grpc è¯·æ±‚è½¬äº¤ç»™ grpc å³å¯ã€‚ err := http.ListenAndServeTLS( addr, \"ssl/server.pem\", \"ssl/server-key.pem\", http.HandlerFunc(func(rw http.ResponseWriter, r *http.Request) { if r.ProtoMajor == 2 \u0026\u0026 strings.Contains(r.Header.Get(\"Content-Type\"), \"application/grpc\") { log.Println(\"call grpc service\") s.ServeHTTP(rw, r) } else { mux.ServeHTTP(rw, r) } })) if err != nil { log.Fatalf(\"start server at %v: %v\", addr, err) } } ","date":"2020-07-31","objectID":"/grpc2/:6:0","tags":["golang","grpc"],"title":"GPRC è¿›é˜¶","uri":"/grpc2/"},{"categories":["å¾®æœåŠ¡","ä»£ç "],"content":"grpc è¯·æ±‚æ–­å¼€å¤„ç† grpc çš„è¯·æ±‚æ²¡æœ‰è‡ªå·±è®¾ç½®è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œè€Œæ˜¯å°†è¿™éƒ¨åˆ†çš„å¤„ç†äº¤ç»™ golang çš„ context åŒ…ã€‚é€šè¿‡ context çš„åŠŸèƒ½å®ç°å®¢æˆ·ç«¯çš„ç™»å½•è¶…æ—¶ï¼Œè¯·æ±‚è¶…æ—¶ã€‚æœåŠ¡ç«¯ä»£ç ï¼š type server struct { pb.UnimplementedEchoServer } func (s *server) BidirectionalStreamingEcho(stream pb.Echo_BidirectionalStreamingEchoServer) error { // è¯¥å‡½æ•°å†…æ˜¯ stream çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œè¯¥å‡½æ•°é€€å‡ºåï¼Œstream çš„ä¸Šä¸‹æ–‡ç»“æŸ // æ¯ä¸ªstreamå‡½æ•°ç›¸äº’ç‹¬ç«‹ // æœåŠ¡ç«¯çš„ stream ä¸èƒ½ç›´æ¥å‘èµ·è¯·æ±‚ç»ˆæ­¢ï¼Œä½†å¯ä»¥é€šè¿‡æå‰ç»“æŸè¯¥å‡½æ•°ï¼Œåœæ­¢è¯¥ stream for { in, err := stream.Recv() if err != nil { fmt.Printf(\"server: error receiving from stream: %v\\n\", err) if err == io.EOF { return nil } return err } fmt.Printf(\"echoing message %q\\n\", in.Message) stream.Send(\u0026pb.EchoResponse{Message: in.Message}) } } func main() { lis, err := net.Listen(\"tcp\", \"127.0.0.1:10050\") if err != nil { log.Fatalf(\"failed to listen: %v\", err) } fmt.Printf(\"server listening at port %v\\n\", lis.Addr()) s := grpc.NewServer() pb.RegisterEchoServer(s, \u0026server{}) s.Serve(lis) } å®¢æˆ·ç«¯: func sendMessage(stream pb.Echo_BidirectionalStreamingEchoClient, msg string) error { fmt.Printf(\"sending message %q\\n\", msg) return stream.Send(\u0026pb.EchoRequest{Message: msg}) } func recvMessage(stream pb.Echo_BidirectionalStreamingEchoClient, wantErrCode codes.Code) { res, err := stream.Recv() if status.Code(err) != wantErrCode { log.Fatalf(\"stream.Recv() = %v, %v; want _, status.Code(err)=%v\", res, err, wantErrCode) } if err != nil { fmt.Printf(\"stream.Recv() returned expected error %v\\n\", err) return } fmt.Printf(\"received message %q\\n\", res.Message) } func main() { addr := \"127.0.0.1:10050\" // å»ºç«‹è¿æ¥ // å»ºç«‹è¿æ¥çš„ ctx å’Œè¯·æ±‚çš„ ctx æ˜¯ç‹¬ç«‹çš„ conn, err := grpc.DialContext(context.Background(), addr, grpc.WithInsecure()) if err != nil { log.Fatalf(\"did not connect: %v\", err) } defer conn.Close() c := pb.NewEchoClient(conn) // Initiate the stream with a context that supports cancellation. ctx, cancel := context.WithTimeout(context.Background(), 10*time.Second) stream, err := c.BidirectionalStreamingEcho(ctx) if err != nil { log.Fatalf(\"error creating stream: %v\", err) } // Send some test messages. if err := sendMessage(stream, \"hello\"); err != nil { log.Fatalf(\"error sending on stream: %v\", err) } if err := sendMessage(stream, \"world\"); err != nil { log.Fatalf(\"error sending on stream: %v\", err) } // Ensure the RPC is working. recvMessage(stream, codes.OK) recvMessage(stream, codes.OK) fmt.Println(\"cancelling context\") cancel() // This Send may or may not return an error, depending on whether the // monitored context detects cancellation before the call is made. sendMessage(stream, \"closed\") // This Recv should never succeed. recvMessage(stream, codes.Canceled) } GRPC æ€§èƒ½ä¼˜åŒ– è™½ç„¶ grpc çš„å®˜æ–¹è‡ªè¯©æ˜¯é«˜æ€§èƒ½çš„æ¡†æ¶ï¼Œä½†æ˜¯ grpc å†…éƒ¨ä½¿ç”¨å¤§é‡çš„åå°„ï¼Œä½¿å¾— grpc åœ¨æ€§èƒ½ä¸Šå¹¶ä¸ç®—å¾ˆå¥½ï¼Œæ‰€ä»¥è¿˜æ˜¯æœ‰å¿…è¦ä¼˜åŒ–ã€‚grpc çš„ä¼˜åŒ–æ€è·¯æ¯”è¾ƒç®€å•ï¼Œä¸éœ€è¦ç›´æ¥ä¿®æ”¹æºç ï¼Œåªéœ€è¦åœ¨ protoc å‘½ä»¤ç”Ÿæˆ golang ä»£ç æ˜¯ï¼Œå°† golang/protobuf æ¢æˆç¬¬ä¸‰æ–¹çš„ gogo/protobuf ã€‚gogoåº“åŸºäºå®˜æ–¹åº“å¼€å‘ï¼Œå¢åŠ äº†å¾ˆå¤šçš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š å¿«é€Ÿçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ– æ›´è§„èŒƒçš„Goæ•°æ®ç»“æ„ goprotobufå…¼å®¹ å¯é€‰æ‹©çš„äº§ç”Ÿä¸€äº›è¾…åŠ©æ–¹æ³•ï¼Œå‡å°‘ä½¿ç”¨ä¸­çš„ä»£ç è¾“å…¥ å¯ä»¥é€‰æ‹©äº§ç”Ÿæµ‹è¯•ä»£ç å’Œbenchmarkä»£ç  å…¶å®ƒåºåˆ—åŒ–æ ¼å¼ æ¯”å¦‚etcdã€k8sã€dgraphã€docker swarmkitéƒ½ä½¿ç”¨å®ƒã€‚åŸºäºé€Ÿåº¦å’Œå®šåˆ¶åŒ–çš„è€ƒè™‘ï¼Œgogoæœ‰ä¸‰ç§äº§ç”Ÿä»£ç çš„æ–¹å¼ gofast: é€Ÿåº¦ä¼˜å…ˆï¼Œä¸æ”¯æŒå…¶å®ƒgogoprotobuf extensionsã€‚ go get github.com/gogo/protobuf/protoc-gen-gofast protoc --gofast_out=. myproto.proto gogofastç±»ä¼¼gofast,ä½†æ˜¯ä¼šå¯¼å…¥gogoprotobuf gogofasterç±»ä¼¼gogofast, ä¸ä¼šäº§ç”ŸXXX_unrecognizedæŒ‡é’ˆå­—æ®µï¼Œå¯ä»¥å‡å°‘åƒåœ¾å›æ”¶æ—¶é—´ã€‚ gogoslickç±»ä¼¼gogofaster,ä½†æ˜¯å¯ä»¥å¢åŠ ä¸€äº›é¢å¤–çš„æ–¹æ³•gostringå’Œequalç­‰ç­‰ã€‚ go get github.com/gogo/protobuf/proto go get github.com/gogo/protobuf/{binary} //protoc-gen-gogofastã€protoc-gen-gogofaster ã€protoc-gen-gogoslick go get github.com/gogo/protobuf/gogoproto protoc -I=. -I=$GOPATH/src -I=$GOPATH/src/github.com/gogo/protobuf/protobuf --{binary}_out=. myproto.proto protoc-gen-gogo: æœ€å¿«çš„é€Ÿåº¦ï¼Œæœ€å¤šçš„å¯å®šåˆ¶åŒ– ä½ å¯ä»¥é€šè¿‡æ‰©å±•å®šåˆ¶åºåˆ—åŒ–: æ‰©å±•. go get github.com/gogo/protobuf/proto go get github.com/gogo/protobuf/jsonpb go get github.com/gogo/protobuf/protoc-gen-gogo go get github.com/gogo/protobuf/gogoproto gogoåŒæ ·æ”¯æŒgrpc: protoc --gofast_out=plugins=grpc:. my.protoã€‚åŒæ—¶è¿˜æœ‰ protobuf å¯¹åº”çš„æ•™ç¨‹ ã€‚ ","date":"2020-07-31","objectID":"/grpc2/:7:0","tags":["golang","grpc"],"title":"GPRC è¿›é˜¶","uri":"/grpc2/"},{"categories":["è¿ç»´"],"content":"SCST å…±äº«çš„ç£ç›˜æ”¯æŒåœ¨çº¿æ‰©å®¹ã€‚æ“ä½œå¦‚ä¸‹ï¼š scst æœåŠ¡ç«¯ é¦–å…ˆæœ‰ä¸€å— zfs å­˜å‚¨å·ï¼Œç°åœ¨å°†å…¶å®¹é‡ä» 15G æ‰©å±•åˆ° 20Gã€‚ zfs set volsize=20G tank/vol ä¿®æ”¹ scst ä¸­ device çš„ size å±æ€§ scstadmin -set_dev_attr device1 -attributes size=21474836480 -noprompt iscsi å®¢æˆ·ç«¯ é‡æ–°æ‰«æ target iscsiadm -m node --target \u003ctarget_name\u003e -R æ‰©å±•ç£ç›˜å®¹é‡ï¼Œå¦‚æœç£ç›˜å­˜å‚¨ mount çŠ¶æ€åˆ™å…ˆ umountã€‚ resize2fs /dev/sdX e2fsck -f /dev/sdX resize2fs /dev/sdX é‡æ–°æŒ‚è½½ï¼Œä½¿ç”¨ dfÂ å³å¯å‘ç°ç£ç›˜çš„å®¹é‡è¢«ä¿®æ”¹ã€‚ FC å®¢æˆ·ç«¯ é‡æ–°æ‰«æ FC host echo \"- - -\" \u003e /sys/class/scst_host/hostX/scan æ‰©å±•ç£ç›˜å®¹é‡å¦‚ä¸Šã€‚ ","date":"2020-04-09","objectID":"/scst%E5%9C%A8%E7%BA%BF%E6%89%A9%E5%AE%B9/:0:0","tags":["iscsi"],"title":"Scståœ¨çº¿æ‰©å®¹","uri":"/scst%E5%9C%A8%E7%BA%BF%E6%89%A9%E5%AE%B9/"},{"categories":["è¿ç»´"],"content":"å®‰è£… scst å®‰è£… scst wget https://ncu.dl.sourceforge.net/project/scst/scst-3.2.0.7058.tar.bz2 yum install bzip2 bunzip2 scst-3.2.0.7058.tar.bz2 tar xf scst-3.2.0.7058.tar ç¼–è¯‘å®‰è£…scst make 2perf make scst make scst_install make iscsi make iscsi_install make scstadm make scstadm_install æŸ¥çœ‹æ˜¯å¦è¢«åŠ è½½åˆ°å†…æ ¸äº† lsmod |grep scst modinfo scst å¯åŠ¨ scst modprobe scst modprobe scst_vdisk modprobe scst_disk modprobe scst_user modprobe scst_modisk modprobe scst_processor modprobe scst_raid modprobe scst_tape modprobe scst_cdrom modprobe scst_changer modprobe iscsi-scst iscsi-scstd åˆ›å»ºæµç¨‹ åˆ›å»º target scstadmin -add_target iqn.1994-05.com.redhat:pv -driver iscsi åˆ›å»º block scstadmin -open_dev pv -handler vdisk_blockio -attributes filename=/dev/zvol/tank/pv åˆ›å»º group åšè®¿é—®æ§åˆ¶ scstadmin -add_group pv -driver iscsi -target iqn.1994-05.com.redhat:pv æ·»åŠ å®¢æˆ·ç«¯ scstadmin -add_init iqn.1994-05.com.redhat:48d51365d2b -driver iscsi -target iqn.1994-05.com.redhat:pv -group pv æ·»åŠ  lun scstadmin -add_lun 0 -driver iscsi -target iqn.1994-05.com.redhat:pv -group pv -device pv å¯ç”¨ target scstadmin -enable_target iqn.1994-05.com.redhat:pv -driver iscsi ä½¿ç”¨ iscsi driver scstadmin -set_drv_attr iscsi -attributes enabled=1 -noprompt å†™å…¥åˆ°é…ç½®æ–‡ä»¶ scstadmin -write_config /etc/scst.conf åˆ é™¤æµç¨‹ ç¦ç”¨ target scstadmin -disable_target iqn.1994-05.com.redhat:pv -driver iscsi -noprompt åˆ é™¤ target scstadmin -rem_target iqn.1994-05.com.redhat:pv -driver iscsi -noprompt åˆ é™¤ block scstadmin -close_dev pv -handler vdisk_blockio -noprompt ","date":"2020-04-08","objectID":"/scst%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/:0:0","tags":["iscsi"],"title":"Scst å®‰è£…å’Œä½¿ç”¨","uri":"/scst%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/"},{"categories":["å…¶ä»–"],"content":"ä¸€ã€ä»‹ç» oh-my-zsh æ˜¯ä¸€æ¬¾å‘½ä»¤è¡Œå·¥å…·ï¼Œåœ¨zshçš„åŸºç¡€ä¸Šæ·»åŠ äº†è®¸å¤šçš„æ–°åŠŸèƒ½ã€‚æ¥ä¸‹æ¥å°±æ¥å®‰è£…å¹¶ä½¿ç”¨ä»–ã€‚ äºŒã€å®‰è£… oh-my-zsh oh-my-zsh æ˜¯åœ¨ zsh çš„åŸºç¡€ä¸Šä½¿ç”¨çš„ï¼Œæ‰€ä»¥è¦å°±å®‰è£…zshã€‚ä¸€èˆ¬linuxå‘è¡Œç‰ˆé»˜è®¤ä½¿ç”¨bashã€‚ä»¥ä¸‹ç¯å¢ƒä¸ºCentOS7ã€‚ä½¿ç”¨ yum å®‰è£… zsh $ yum install zsh å®‰è£…å®Œæˆåï¼Œæ›¿æ¢é»˜è®¤çš„ bash ä¸º zshã€‚éœ€è¦åœ¨ root ç”¨æˆ·ä¸‹ä½¿ç”¨ $ chsh -s /bin/zsh Changing shell for root. Shell changed. # åœ¨æ–°ç»ˆç«¯ä¸­éªŒè¯ $ echo $SHELL /bin/zsh æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è‡ªåŠ¨å®‰è£… oh-my-zsh $ wget https://github.com/robbyrussell/oh-my-zsh/raw/master/tools/install.sh -O - | sh # çœç•¥è¾“å‡º... $ source .zshrc # .zshrc ä¸º zsh çš„é…ç½®æ–‡ä»¶ ä¸‰ã€é…ç½® oh-my-zsh æ¥ä¸‹æ¥è¿˜è¦æ·»åŠ é¢å¤–çš„åŠŸèƒ½ã€‚oh-my-zsh æ”¯æŒå¾ˆå¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½éƒ½æ˜¯ä»¥æ’ä»¶çš„æ–¹å¼å®ç°ã€‚æ’ä»¶æ”¾åœ¨ç›®å½•~/.oh-my-zsh/plugins ä¸‹ã€‚è¦è®©æ’ä»¶å¼€å§‹å·¥ä½œè¿˜éœ€è¦åœ¨ .zshrc ä¸­é…ç½®ç›¸å…³å‚æ•°ã€‚ plugins=(git textmate ruby autojump osx mvn gradle) ","date":"2020-02-09","objectID":"/%E5%AE%89%E8%A3%85oh-my-zsh/:0:0","tags":["linux","ç»ˆç«¯"],"title":"linux å®‰è£… oh-my-zsh","uri":"/%E5%AE%89%E8%A3%85oh-my-zsh/"},{"categories":["å…¶ä»–"],"content":"autojump ä½œç”¨ç›®å½•é—´å¿«é€Ÿè·³è½¬,ä¸ç”¨å†ä¸€ç›´ cd äº† ğŸ˜**ä½¿ç”¨Â **ä½¿ç”¨ autojump çš„ç¼©å†™ j``cd å‘½ä»¤è¿›å…¥ ~/user/github/Youthink æ–‡ä»¶å¤¹ï¼Œä¸‹ä¸€æ¬¡å†æƒ³è¿›å…¥ Yourhink æ–‡ä»¶å¤¹çš„æ—¶å€™,ç›´æ¥ j youthink å³å¯, æˆ–è€…åªè¾“å…¥ youthink çš„ä¸€éƒ¨åˆ† youth éƒ½è¡Œåˆ é™¤æ— æ•ˆè·¯å¾„ $ j --purge æ— æ•ˆè·¯å¾„ éœ€è¦é¢å¤–ä¸‹è½½ autojump å¹¶é…ç½®é¦–å…ˆå®‰è£… autojumpï¼Œå¦‚æœä½ ç”¨ Macï¼Œå¯ä»¥ä½¿ç”¨ brew å®‰è£…ï¼š $ brew install autojump å¦‚æœæ˜¯ Linuxï¼Œå¯ä»¥ä½¿ç”¨ git å®‰è£…ï¼Œæ¯”å¦‚ï¼š $ git clone git://github.com/joelthelion/autojump.git è¿›å…¥ç›®å½•ï¼Œæ‰§è¡Œ $ ./install.sh æœ€åæŠŠä»¥ä¸‹ä»£ç åŠ å…¥ .zshrcï¼š [[ -s ~/.autojump/etc/profile.d/autojump.sh ]] \u0026\u0026 . ~/.autojump/etc/profile.d/autojump.sh ","date":"2020-02-09","objectID":"/%E5%AE%89%E8%A3%85oh-my-zsh/:1:0","tags":["linux","ç»ˆç«¯"],"title":"linux å®‰è£… oh-my-zsh","uri":"/%E5%AE%89%E8%A3%85oh-my-zsh/"},{"categories":["å…¶ä»–"],"content":"zsh-syntax-highlighting ä½œç”¨å¹³å¸¸ç”¨çš„lsã€cd ç­‰å‘½ä»¤è¾“å…¥æ­£ç¡®ä¼šç»¿è‰²é«˜äº®æ˜¾ç¤ºï¼Œè¾“å…¥é”™è¯¯ä¼šæ˜¾ç¤ºå…¶ä»–çš„é¢œè‰²ã€‚ å®‰è£… $ git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting åœ¨ ~/.zshrc ä¸­é…ç½® plugins=(å…¶ä»–çš„æ’ä»¶ zsh-syntax-highlighting) ä½¿é…ç½®ç”Ÿæ•ˆ source ~/.zshrc ","date":"2020-02-09","objectID":"/%E5%AE%89%E8%A3%85oh-my-zsh/:2:0","tags":["linux","ç»ˆç«¯"],"title":"linux å®‰è£… oh-my-zsh","uri":"/%E5%AE%89%E8%A3%85oh-my-zsh/"},{"categories":["å…¶ä»–"],"content":"zsh-autosuggestions ä½œç”¨ å¦‚å›¾è¾“å…¥å‘½ä»¤æ—¶ï¼Œä¼šç»™å‡ºå»ºè®®çš„å‘½ä»¤ï¼ˆç°è‰²éƒ¨åˆ†ï¼‰æŒ‰é”®ç›˜ â†’ è¡¥å…¨ å¦‚æœæ„Ÿè§‰ â†’ è¡¥å…¨ä¸æ–¹ä¾¿ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰è¡¥å…¨çš„å¿«æ·é”®ï¼Œæ¯”å¦‚æˆ‘è®¾ç½®çš„é€—å·è¡¥å…¨ bindkey ',' autosuggest-accept åœ¨ .zshrc æ–‡ä»¶æ·»åŠ è¿™å¥è¯å³å¯ã€‚å®‰è£… $ git clone git://github.com/zsh-users/zsh-autosuggestions $ZSH_CUSTOM/plugins/zsh-autosuggestions åœ¨ ~/.zshrc ä¸­é…ç½® plugins=(å…¶ä»–çš„æ’ä»¶ zsh-autosuggestions) ä½¿é…ç½®ç”Ÿæ•ˆ source ~/.zshrc ","date":"2020-02-09","objectID":"/%E5%AE%89%E8%A3%85oh-my-zsh/:3:0","tags":["linux","ç»ˆç«¯"],"title":"linux å®‰è£… oh-my-zsh","uri":"/%E5%AE%89%E8%A3%85oh-my-zsh/"},{"categories":["ç¬”è®°"],"content":" Aixä¸º6.1ç‰ˆæœ¬ ä½¿ç”¨iscsiå­˜å‚¨ é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªiscsi targetï¼Œå¹¶å…±äº«åˆ°IBM Aixä¸Šã€‚ ","date":"2019-10-22","objectID":"/aix1/:0:0","tags":["aix"],"title":"Aixæ·»åŠ å’Œåˆ é™¤Iscsiå­˜å‚¨å·","uri":"/aix1/"},{"categories":["ç¬”è®°"],"content":"æ£€æŸ¥iscsiæ˜¯å¦è¢«å®‰è£… $ lslpp -L | grep -i iscsi devices.common.IBM.iscsi.rte 6.1.5.0 C F Common iSCSI Files devices.iscsi.disk.rte 6.1.5.0 C F iSCSI Disk Software ... ","date":"2019-10-22","objectID":"/aix1/:1:0","tags":["aix"],"title":"Aixæ·»åŠ å’Œåˆ é™¤Iscsiå­˜å‚¨å·","uri":"/aix1/"},{"categories":["ç¬”è®°"],"content":"é…ç½®iscsi $ vi /etc/iscsi/targets ... # æ·»åŠ target 172.16.1.169 3260 iqn.2018-11.com.howlink.wbrt.portal.backup ","date":"2019-10-22","objectID":"/aix1/:2:0","tags":["aix"],"title":"Aixæ·»åŠ å’Œåˆ é™¤Iscsiå­˜å‚¨å·","uri":"/aix1/"},{"categories":["ç¬”è®°"],"content":"é‡æ–°æ‰«ç›˜ $ cfgmgr -l iscsi0 cfgmgr: 0514-621 WARNING: The following device packages are required for device support but are not currently installed. devices.iscsi.array ","date":"2019-10-22","objectID":"/aix1/:3:0","tags":["aix"],"title":"Aixæ·»åŠ å’Œåˆ é™¤Iscsiå­˜å‚¨å·","uri":"/aix1/"},{"categories":["ç¬”è®°"],"content":"æŸ¥çœ‹iscsiç›˜ $ lsdev -Cc disk | grep iSCSI hdisk18 Available Other iSCSI Disk Drive ","date":"2019-10-22","objectID":"/aix1/:4:0","tags":["aix"],"title":"Aixæ·»åŠ å’Œåˆ é™¤Iscsiå­˜å‚¨å·","uri":"/aix1/"},{"categories":["ç¬”è®°"],"content":"åˆ›å»ºç‰©ç†å· $ chdev -l hdisk18 -a pv=yes ","date":"2019-10-22","objectID":"/aix1/:5:0","tags":["aix"],"title":"Aixæ·»åŠ å’Œåˆ é™¤Iscsiå­˜å‚¨å·","uri":"/aix1/"},{"categories":["ç¬”è®°"],"content":"åˆ›å»ºvg $ mkvg -y wbrt_portal_bg hdisk18 ","date":"2019-10-22","objectID":"/aix1/:6:0","tags":["aix"],"title":"Aixæ·»åŠ å’Œåˆ é™¤Iscsiå­˜å‚¨å·","uri":"/aix1/"},{"categories":["ç¬”è®°"],"content":"åˆ›å»ºlv $ mklv -t jfs2 -y wbrt_portal_bl wbrt_portal_bg 700 æ³¨:lvçš„å¤§å°å¯ä»¥ä½¿ç”¨å‘½ä»¤ $ lsvg wbrt_portal_bg | grep \"TOTAL PPs\" | awk -F' ' '{ print $6}' 703 ä½†ä¸è¦å…¨éƒ¨ä½¿ç”¨ï¼Œéœ€è¦ä¸€äº›å‰©ä½™ç©ºé—´ã€‚ ","date":"2019-10-22","objectID":"/aix1/:7:0","tags":["aix"],"title":"Aixæ·»åŠ å’Œåˆ é™¤Iscsiå­˜å‚¨å·","uri":"/aix1/"},{"categories":["ç¬”è®°"],"content":"åˆ›å»ºæŒ‚è½½ç›®å½• $ mkdir /mnt/iscsi ","date":"2019-10-22","objectID":"/aix1/:8:0","tags":["aix"],"title":"Aixæ·»åŠ å’Œåˆ é™¤Iscsiå­˜å‚¨å·","uri":"/aix1/"},{"categories":["ç¬”è®°"],"content":"æ ¼å¼åŒ–å¹¶æŒ‚è½½ $ crfs -v jfs2 -m /mnt/iscsi -d wbrt_portal_bl $ mount /mnt/iscsi åˆ é™¤å­˜å‚¨ç›˜ ","date":"2019-10-22","objectID":"/aix1/:9:0","tags":["aix"],"title":"Aixæ·»åŠ å’Œåˆ é™¤Iscsiå­˜å‚¨å·","uri":"/aix1/"},{"categories":["ç¬”è®°"],"content":"å¸è½½ç£ç›˜ $ umount /mnt/iscsi ","date":"2019-10-22","objectID":"/aix1/:10:0","tags":["aix"],"title":"Aixæ·»åŠ å’Œåˆ é™¤Iscsiå­˜å‚¨å·","uri":"/aix1/"},{"categories":["ç¬”è®°"],"content":"lv $ rmlv wbrt_portal_bl ","date":"2019-10-22","objectID":"/aix1/:11:0","tags":["aix"],"title":"Aixæ·»åŠ å’Œåˆ é™¤Iscsiå­˜å‚¨å·","uri":"/aix1/"},{"categories":["ç¬”è®°"],"content":"åˆ é™¤æ–‡ä»¶ç³»ç»Ÿ $ rmfs -r /dev/wbrt_portal_bl ","date":"2019-10-22","objectID":"/aix1/:12:0","tags":["aix"],"title":"Aixæ·»åŠ å’Œåˆ é™¤Iscsiå­˜å‚¨å·","uri":"/aix1/"},{"categories":["ç¬”è®°"],"content":"åˆ é™¤vg $ reducevg -d wbrt_portal_bg hdisk18 ","date":"2019-10-22","objectID":"/aix1/:13:0","tags":["aix"],"title":"Aixæ·»åŠ å’Œåˆ é™¤Iscsiå­˜å‚¨å·","uri":"/aix1/"},{"categories":["ç¬”è®°"],"content":"åˆ é™¤ç‰©ç†ç›˜ $ rmdev -dl hdisk18 -R ","date":"2019-10-22","objectID":"/aix1/:14:0","tags":["aix"],"title":"Aixæ·»åŠ å’Œåˆ é™¤Iscsiå­˜å‚¨å·","uri":"/aix1/"},{"categories":["ç¬”è®°"],"content":"åˆ é™¤iscsi target $ vi /etc/iscsi/targets ... # æ·»åŠ target # 172.16.1.169 3260 iqn.2018-11.com.howlink.wbrt.portal.backup é‡è¯»ç£ç›˜ $ cfgmgr -l iscsi0 ","date":"2019-10-22","objectID":"/aix1/:15:0","tags":["aix"],"title":"Aixæ·»åŠ å’Œåˆ é™¤Iscsiå­˜å‚¨å·","uri":"/aix1/"},{"categories":["äº‘åŸç”Ÿ"],"content":"ç¯å¢ƒç‰ˆæœ¬è¯´æ˜ï¼š ä¸‰å°vmwareè™šæ‹Ÿæœºï¼Œç³»ç»Ÿç‰ˆæœ¬CentOS7.6ã€‚ Kubernetes 1.16.0ï¼Œå½“å‰æœ€æ–°ç‰ˆã€‚ flannel v0.11 docker 18.09 ä½¿ç”¨kubeadmå¯ä»¥ç®€å•çš„æ­å»ºä¸€å¥—k8sé›†ç¾¤ç¯å¢ƒï¼Œè€Œä¸ç”¨å…³æ³¨å®‰è£…éƒ¨ç½²çš„ç»†èŠ‚ï¼Œè€Œä¸”ç°åœ¨k8sçš„ç‰ˆæœ¬æ›´æ–°é¢‘ç‡å¾ˆå¿«ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•ååˆ†æ¨èã€‚ ç›¸å…³å‡†å¤‡ æ³¨ï¼šæœ¬èŠ‚ç›¸å…³æ“ä½œè¦åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ‰§è¡Œã€‚ ","date":"2019-10-19","objectID":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/:0:0","tags":["k8s"],"title":"ä½¿ç”¨kubeadmå®‰è£…kubernetes1.16","uri":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/"},{"categories":["äº‘åŸç”Ÿ"],"content":"ç¡¬ä»¶ç¯å¢ƒ ä½¿ç”¨ä¸‰å°vmwareè™šæ‹Ÿæœºï¼Œé…ç½®ç½‘ç»œï¼Œå¹¶ä¿è¯å¯ä»¥è”ç½‘ã€‚ k8s-master 4G 4æ ¸ CentOS7 192.168.10.20 k8s-node1 2G 2æ ¸ CentOS7 192.168.10.21 k8s-node2 2G 2æ ¸ CentOS7 192.168.10.22 ","date":"2019-10-19","objectID":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/:1:0","tags":["k8s"],"title":"ä½¿ç”¨kubeadmå®‰è£…kubernetes1.16","uri":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/"},{"categories":["äº‘åŸç”Ÿ"],"content":"ä¸»æœºåˆ’åˆ† k8s-masterä½œä¸ºé›†ç¾¤ç®¡ç†èŠ‚ç‚¹ï¼šetcd kubeadm kube-apiserver kube-scheduler kube-controller-manager kubelet flanneld docker k8s-node1ä½œä¸ºå·¥ä½œèŠ‚ç‚¹ï¼škubeadm kubelet flanneld docker k8s-node2ä½œä¸ºå·¥ä½œèŠ‚ç‚¹ï¼škubeadm kubelet flanneld docker ","date":"2019-10-19","objectID":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/:2:0","tags":["k8s"],"title":"ä½¿ç”¨kubeadmå®‰è£…kubernetes1.16","uri":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/"},{"categories":["äº‘åŸç”Ÿ"],"content":"å‡†å¤‡å·¥ä½œ å®‰è£…å¿…è¦çš„rpmè½¯ä»¶ï¼š yum install -y wget vim net-tools epel-release å…³é—­é˜²ç«å¢™ systemctl disable firewalld systemctl stop firewalld å…³é—­selinux # ä¸´æ—¶ç¦ç”¨selinux setenforce 0 # æ°¸ä¹…å…³é—­ ä¿®æ”¹/etc/sysconfig/selinuxæ–‡ä»¶è®¾ç½® sed -i 's/SELINUX=permissive/SELINUX=disabled/' /etc/sysconfig/selinux sed -i \"s/SELINUX=enforcing/SELINUX=disabled/g\" /etc/selinux/config ç¦ç”¨äº¤æ¢åˆ†åŒº swapoff -a # æ°¸ä¹…ç¦ç”¨ï¼Œæ‰“å¼€/etc/fstabæ³¨é‡Šæ‰swapé‚£ä¸€è¡Œã€‚ sed -i 's/.*swap.*/#\u0026/' /etc/fstab ä¿®æ”¹ /etc/hosts cat \u003c\u003cEOF \u003e\u003e /etc/host 192.168.10.20 k8s-master 192.168.10.21 k8s-node1 192.168.10.22 k8s-node2 EOF ä¿®æ”¹å†…æ ¸å‚æ•° cat \u003c\u003cEOF \u003e /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF sysctl --system å®‰è£…docker18.09 ","date":"2019-10-19","objectID":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/:3:0","tags":["k8s"],"title":"ä½¿ç”¨kubeadmå®‰è£…kubernetes1.16","uri":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/"},{"categories":["äº‘åŸç”Ÿ"],"content":"é…ç½®yumæº ## é…ç½®é»˜è®¤æº ## å¤‡ä»½ mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup ## ä¸‹è½½é˜¿é‡Œæº wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo ## åˆ·æ–° yum makecache fast ## é…ç½®k8sæº cat \u003c\u003cEOF \u003e /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64 enabled=1 gpgcheck=0 EOF ## é‡å»ºyumç¼“å­˜ yum clean all yum makecache fast yum -y update ","date":"2019-10-19","objectID":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/:4:0","tags":["k8s"],"title":"ä½¿ç”¨kubeadmå®‰è£…kubernetes1.16","uri":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/"},{"categories":["äº‘åŸç”Ÿ"],"content":"å®‰è£…docker ä¸‹è½½dockerçš„yumæºæ–‡ä»¶ yum -y install yum-utils device-mapper-persistent-data lvm2 yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo è¿™é‡ŒæŒ‡å®šdockerç‰ˆæœ¬ï¼Œå¯ä»¥å…ˆæŸ¥çœ‹æ”¯æŒçš„ç‰ˆæœ¬ [root@localhost ~]# yum list docker-ce --showduplicates |sort -r * updates: mirrors.aliyun.com Loading mirror speeds from cached hostfile Loaded plugins: fastestmirror * extras: mirrors.aliyun.com * epel: hkg.mirror.rackspace.com docker-ce.x86_64 3:19.03.2-3.el7 docker-ce-stable docker-ce.x86_64 3:19.03.1-3.el7 docker-ce-stable docker-ce.x86_64 3:19.03.0-3.el7 docker-ce-stable docker-ce.x86_64 3:18.09.9-3.el7 docker-ce-stable ... * base: mirrors.aliyun.com ç›®å‰æœ€æ–°ç‰ˆæœ¬ä¸º19.03ï¼ŒæŒ‡å®šä¸‹è½½18.09 yum install -y docker-ce-18.09.9-3.el7 systemctl enable docker systemctl start docker ","date":"2019-10-19","objectID":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/:5:0","tags":["k8s"],"title":"ä½¿ç”¨kubeadmå®‰è£…kubernetes1.16","uri":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/"},{"categories":["äº‘åŸç”Ÿ"],"content":"ä¿®æ”¹dockerçš„å¯åŠ¨å‚æ•° cat \u003e /etc/docker/daemon.json \u003c\u003cEOF { \"registry-mirrors\": [\"https://xxxx.mirror.aliyuncs.com\"], \"exec-opts\": [\"native.cgroupdriver=systemd\"], \"log-driver\": \"json-file\", \"log-opts\": { \"max-size\": \"100m\" }, \"storage-driver\": \"overlay2\", \"storage-opts\": [ \"overlay2.override_kernel_check=true\" ] } EOF systemctl restart docker å®‰è£…k8s ","date":"2019-10-19","objectID":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/:6:0","tags":["k8s"],"title":"ä½¿ç”¨kubeadmå®‰è£…kubernetes1.16","uri":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/"},{"categories":["äº‘åŸç”Ÿ"],"content":"ç®¡ç†èŠ‚ç‚¹é…ç½® å…ˆåœ¨k8s-masterä¸Šå®‰è£…ç®¡ç†èŠ‚ç‚¹ ","date":"2019-10-19","objectID":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/:7:0","tags":["k8s"],"title":"ä½¿ç”¨kubeadmå®‰è£…kubernetes1.16","uri":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/"},{"categories":["äº‘åŸç”Ÿ"],"content":"ä¸‹è½½kubeadmï¼Œkubelet yum install -y kubeadm kubelet ","date":"2019-10-19","objectID":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/:7:1","tags":["k8s"],"title":"ä½¿ç”¨kubeadmå®‰è£…kubernetes1.16","uri":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/"},{"categories":["äº‘åŸç”Ÿ"],"content":"åˆå§‹åŒ–kubeadm è¿™é‡Œä¸ç›´æ¥åˆå§‹åŒ–ï¼Œå› ä¸ºå›½å†…ç”¨æˆ·ä¸èƒ½ç›´æ¥æ‹‰å–ç›¸å…³çš„é•œåƒï¼Œæ‰€ä»¥è¿™é‡Œæƒ³æŸ¥çœ‹éœ€è¦çš„é•œåƒç‰ˆæœ¬ [root@k8s-master ~]# kubeadm config images list k8s.gcr.io/kube-apiserver:v1.16.0 k8s.gcr.io/kube-controller-manager:v1.16.0 k8s.gcr.io/kube-scheduler:v1.16.0 k8s.gcr.io/kube-proxy:v1.16.0 k8s.gcr.io/pause:3.1 k8s.gcr.io/etcd:3.3.15-0 k8s.gcr.io/coredns:1.6.2 æ ¹æ®éœ€è¦çš„ç‰ˆæœ¬ï¼Œç›´æ¥æ‹‰å–å›½å†…é•œåƒï¼Œå¹¶ä¿®æ”¹tag # vim kubeadm.sh #!/bin/bash ## ä½¿ç”¨å¦‚ä¸‹è„šæœ¬ä¸‹è½½å›½å†…é•œåƒï¼Œå¹¶ä¿®æ”¹tagä¸ºgoogleçš„tag set -e KUBE_VERSION=v1.16.0 KUBE_PAUSE_VERSION=3.1 ETCD_VERSION=3.3.15-0 CORE_DNS_VERSION=1.6.2 GCR_URL=k8s.gcr.io ALIYUN_URL=registry.cn-hangzhou.aliyuncs.com/google_containers images=(kube-proxy:${KUBE_VERSION} kube-scheduler:${KUBE_VERSION} kube-controller-manager:${KUBE_VERSION} kube-apiserver:${KUBE_VERSION} pause:${KUBE_PAUSE_VERSION} etcd:${ETCD_VERSION} coredns:${CORE_DNS_VERSION}) for imageName in ${images[@]} ; do docker pull $ALIYUN_URL/$imageName docker tag $ALIYUN_URL/$imageName $GCR_URL/$imageName docker rmi $ALIYUN_URL/$imageName done è¿è¡Œè„šæœ¬ï¼Œæ‹‰å–é•œåƒ sh ./kubeadm.sh masterèŠ‚ç‚¹æ‰§è¡Œ sudo kubeadm init \\ --apiserver-advertise-address 192.168.10.20 \\ --kubernetes-version=v1.16.0 \\ --pod-network-cidr=10.244.0.0/16 æ³¨ï¼šè¿™é‡Œçš„pod-network-cidrï¼Œæœ€å¥½ä¸è¦æ”¹åŠ¨ï¼Œå’Œä»¥ä¸‹çš„æ­¥éª¤æ˜¯å…³è”çš„ã€‚ ç»“æœè¿”å› ... ... mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config ... ## æ·»åŠ èŠ‚ç‚¹éœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ kubeadm token create --print-join-command æ¥è·å– kubeadm join 192.168.10.20:6443 --token lixsl8.v1auqmf91ty0xl0k \\ --discovery-token-ca-cert-hash sha256:c3f92a6ed9149ead327342f48a545e7e127a455d5b338129feac85893d918a55 å¦‚æœæ˜¯è¦å®‰è£…å¤šä¸ªmasterèŠ‚ç‚¹ï¼Œåˆ™åˆå§‹åŒ–å‘½ä»¤ä½¿ç”¨ kubeadm init --apiserver-advertise-address 192.168.10.20 --control-plane-endpoint 192.168.10.20 --kubernetes-version=v1.16.0 --pod-network-cidr=10.244.0.0/16 --upload-certs æ·»åŠ masterèŠ‚ç‚¹ä½¿ç”¨å‘½ä»¤: kubeadm join 192.168.10.20:6443 --token z34zii.ur84appk8h9r3yik --discovery-token-ca-cert-hash sha256:dae426820f2c6073763a3697abeb14d8418c9268288e37b8fc25674153702801 --control-plane --certificate-key 1b9b0f1fdc0959a9decef7d812a2f606faf69ca44ca24d2e557b3ea81f415afe æ³¨ï¼šè¿™é‡Œçš„tokenä¼šä¸åŒï¼Œä¸è¦ç›´æ¥å¤åˆ¶ã€‚kubeadm initæˆåŠŸåä¼šè¾“å‡ºæ·»åŠ masterèŠ‚ç‚¹çš„å‘½ä»¤ ","date":"2019-10-19","objectID":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/:7:2","tags":["k8s"],"title":"ä½¿ç”¨kubeadmå®‰è£…kubernetes1.16","uri":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/"},{"categories":["äº‘åŸç”Ÿ"],"content":"å·¥ä½œèŠ‚ç‚¹é…ç½® ","date":"2019-10-19","objectID":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/:8:0","tags":["k8s"],"title":"ä½¿ç”¨kubeadmå®‰è£…kubernetes1.16","uri":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/"},{"categories":["äº‘åŸç”Ÿ"],"content":"ä¸‹è½½kubeadm kubelet ä¸‰å°èŠ‚ç‚¹éƒ½è¦è¿è¡Œ yum install -y kubeadm kubelet ","date":"2019-10-19","objectID":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/:8:1","tags":["k8s"],"title":"ä½¿ç”¨kubeadmå®‰è£…kubernetes1.16","uri":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/"},{"categories":["äº‘åŸç”Ÿ"],"content":"æ·»åŠ èŠ‚ç‚¹ ä¸‰å°èŠ‚ç‚¹éƒ½è¦è¿è¡Œï¼Œè¿™é‡Œå…ˆå¿½ç•¥é”™è¯¯ kubeadm join 192.168.10.20:6443 --token lixsl8.v1auqmf91ty0xl0k \\ --discovery-token-ca-cert-hash sha256:c3f92a6ed9149ead327342f48a545e7e127a455d5b338129feac85893d918a55 \\ --ignore-preflight-errors=all å¦‚æœæ·»åŠ èŠ‚ç‚¹å¤±è´¥ï¼Œæˆ–æ˜¯æƒ³é‡æ–°æ·»åŠ ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ kubeadm reset æ³¨ï¼šä¸è¦åœ¨è½»æ˜“masterä¸Šä½¿ç”¨ï¼Œå®ƒä¼šåˆ é™¤æ‰€æœ‰kubeadmé…ç½® è¿™æ—¶åœ¨èŠ‚ç‚¹ä¸Šå°±å¯ä»¥ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹æ·»åŠ çš„èŠ‚ç‚¹ä¿¡æ¯äº† [root@k8s-master ~]# kubectl get nodes NAME STATUS ROLES AGE VERSION k8s-master NotReady master 45m v1.16.0 k8s-node1 NotReady \u003cnone\u003e 26s v1.16.0 k8s-node2 NotReady \u003cnone\u003e 12s v1.16.0 ä½†èŠ‚ç‚¹çš„çŠ¶æ€å°±æ˜¯ NotReadyï¼Œè¿˜éœ€è¦ä¸€äº›æ“ä½œ ","date":"2019-10-19","objectID":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/:8:2","tags":["k8s"],"title":"ä½¿ç”¨kubeadmå®‰è£…kubernetes1.16","uri":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/"},{"categories":["äº‘åŸç”Ÿ"],"content":"å®‰è£…flanneld åœ¨masterä¸Šæ“ä½œï¼Œæ‹·è´é…ç½®ï¼Œä»¤kubectlå¯ç”¨ mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config ä¸‹è½½flannelé…ç½®æ–‡ä»¶ wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml å› ä¸ºkube-flannel.ymlæ–‡ä»¶ä¸­ä½¿ç”¨çš„é•œåƒä¸ºquay.ioçš„ï¼Œå›½å†…æ— æ³•æ‹‰å–ï¼Œæ‰€ä»¥åŒæ ·çš„å…ˆä»å›½å†…æºä¸Šä¸‹è½½ï¼Œå†ä¿®æ”¹tagï¼Œè„šæœ¬å¦‚ä¸‹ # vim flanneld.sh #!/bin/bash set -e FLANNEL_VERSION=v0.11.0 # åœ¨è¿™é‡Œä¿®æ”¹æº QUAY_URL=quay.io/coreos QINIU_URL=quay-mirror.qiniu.com/coreos images=(flannel:${FLANNEL_VERSION}-amd64 flannel:${FLANNEL_VERSION}-arm64 flannel:${FLANNEL_VERSION}-arm flannel:${FLANNEL_VERSION}-ppc64le flannel:${FLANNEL_VERSION}-s390x) for imageName in ${images[@]} ; do docker pull $QINIU_URL/$imageName docker tag $QINIU_URL/$imageName $QUAY_URL/$imageName docker rmi $QINIU_URL/$imageName done è¿è¡Œè„šæœ¬ï¼Œè¿™ä¸ªè„šæœ¬éœ€è¦åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œ sh flanneld.sh å®‰è£…flanneld kubectl apply -f kube-flanneld.yaml flanneldé»˜è®¤å®‰è£…åœ¨kube-system Namespaceä¸­ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹: # kubectl -n kube-system get pods NAME READY STATUS RESTARTS AGE coredns-5644d7b6d9-h9bxt 0/1 Pending 0 57m coredns-5644d7b6d9-pkhls 0/1 Pending 0 57m etcd-k8s-master 1/1 Running 0 57m kube-apiserver-k8s-master 1/1 Running 0 57m kube-controller-manager-k8s-master 1/1 Running 0 57m kube-flannel-ds-amd64-c4hnf 1/1 Running 1 38s kube-flannel-ds-amd64-djzmx 1/1 Running 0 38s kube-flannel-ds-amd64-mdg8b 1/1 Running 1 38s kube-flannel-ds-amd64-tjxql 0/1 Terminating 0 5m34s kube-proxy-4n5dr 0/1 ErrImagePull 0 13m kube-proxy-dc68d 1/1 Running 0 57m kube-proxy-zplgt 0/1 ErrImagePull 0 13m kube-scheduler-k8s-master 1/1 Running 0 57m å‡ºç°é”™è¯¯ï¼ŒåŸå› æ˜¯ä¸¤ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸èƒ½æ‹‰å–pauseå’Œkube-proxyé•œåƒï¼Œå¯ä»¥ç›´æ¥ä»masterä¸Šæ‰“åŒ…ï¼Œåœ¨nodeä¸Šä½¿ç”¨ ## masterä¸Šæ‰§è¡Œ docker save -o pause.tar k8s.gcr.io/pause:3.1 docker save -o kube-proxy.tar k8s.gcr.io/kube-proxy ## nodeä¸Šæ‰§è¡Œ docker load -i pause.tar docker load -i kube-proxy.tar é‡æ–°å®‰è£…flanneld kubectl delete -f kube-flannel.yml kubectl create -f kube-flannel.yml ","date":"2019-10-19","objectID":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/:8:3","tags":["k8s"],"title":"ä½¿ç”¨kubeadmå®‰è£…kubernetes1.16","uri":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/"},{"categories":["äº‘åŸç”Ÿ"],"content":"ä¿®æ”¹kubelet ä½¿ç”¨kubeadmæ·»åŠ nodeåï¼ŒèŠ‚ç‚¹ä¸€ç›´å¤„äºNotReadyçŠ¶æ€ï¼ŒæŠ¥é”™ä¿¡æ¯ä¸ºï¼š runtime network not ready: NetworkReady=false reason:NetworkPluginNotReady message:docker: network plugin is not ready: cni config uninitialized Addresses: è§£å†³æ–¹å¼æ˜¯ä¿®æ”¹/var/lib/kubelet/kubeadm-flags.envæ–‡ä»¶ï¼Œåˆ é™¤å‚æ•° --network-plugin=cni cat \u003c\u003c EOF \u003e /var/lib/kubelet/kubeadm-flags.env KUBELET_KUBEADM_ARGS=\"--cgroup-driver=systemd --pod-infra-container-image=k8s.gcr.io/pause:3.1\" EOF systemctl restart kubelet [root@k8s-master ~]# kubectl get nodes NAME STATUS ROLES AGE VERSION k8s-master Ready master 79m v1.16.0 k8s-node1 Ready \u003cnone\u003e 34m v1.16.0 k8s-node2 Ready \u003cnone\u003e 34m v1.16.0 é”™è¯¯è§£å†³ å…³äºé”™è¯¯cni config uninitialized Addressesï¼Œè¿™é‡Œä¹‹å‰æ˜¯ç›´æ¥åˆ é™¤å‚æ•°--network-plugin=cniï¼Œä½†è¿™æ ·åªèƒ½è®©èŠ‚ç‚¹çŠ¶æ€ä¿®æ”¹ä¸º readyï¼Œä½†æ˜¯åœ¨Podä¹‹é—´ç½‘ç»œä¾ç„¶ä¸å¯ç”¨ã€‚ æ­£ç¡®çš„è§£å†³æ–¹æ³•ï¼šä¿®æ”¹kube-flannel.yamlï¼Œåœ¨111è¡Œæ·»åŠ å‚æ•°cniVersionï¼š vim kube-flanneld.yaml { \"name\": \"cbr0\", \"cniVersion\": \"0.3.1\", .... å®‰è£…flannel ## å¦‚æœä¹‹å‰å®‰è£…äº†ï¼Œå…ˆåˆ é™¤ ## kubectl delete -f kube-flannel.yaml kubectl apply -f kube-flannel.yaml ","date":"2019-10-19","objectID":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/:8:4","tags":["k8s"],"title":"ä½¿ç”¨kubeadmå®‰è£…kubernetes1.16","uri":"/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85kubernetes1.16/"},{"categories":["åˆ†å¸ƒå¼"],"content":"etcd æœ‰å¦‚ä¸‹çš„ä½¿ç”¨åœºæ™¯ï¼š æœåŠ¡å‘ç°ï¼ˆService Discoveryï¼‰ æ¶ˆæ¯å‘å¸ƒä¸è®¢é˜… è´Ÿè½½å‡è¡¡ åˆ†å¸ƒå¼é€šçŸ¥ä¸åè°ƒ åˆ†å¸ƒå¼é” åˆ†å¸ƒå¼é˜Ÿåˆ— é›†ç¾¤ç›‘æ§äºLeaderç«é€‰ã€‚ ä¸€ã€æœåŠ¡å‘ç° etcd çš„å¸¸è§ä½¿ç”¨åœºæ™¯ä¹‹ä¸€å°±æ˜¯æœåŠ¡å‘ç°ã€‚å®ç°æ€è·¯å¦‚ä¸‹ï¼šå…ˆå‡†å¤‡ etcd æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯çš„ç¨‹åºåœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨ä¹‹åä¼šè¿æ¥åˆ° etcd æœåŠ¡å™¨å¹¶è®¾ç½®ä¸€ä¸ªæ ¼å¼ä¸º ip:port çš„é”®å€¼å¯¹ï¼Œå¹¶ç»‘å®šä¸€ä¸ª leaseã€‚ä¹‹åçš„æœåŠ¡ç«¯å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªå®šæ—¶å™¨ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å°±æ›´æ–°æœåŠ¡ç«¯æ³¨å†Œä¸­å¿ƒçš„ lease çš„ TTLã€‚å¦å¤–ä¸€ä¸ªç»„ä»¶å°±æ˜¯æœåŠ¡å‘ç°ç»„ä»¶ï¼Œdiscovery ä¼š watch æœåŠ¡ç«¯çš„ keyã€‚æ¯æ¬¡è¯¥ key å˜åŒ–æ—¶ï¼Œdiscovery å°±å¯ä»¥æ£€æµ‹åˆ°æ—¶é—´å¹¶åšå‡ºå¯¹åº”çš„æ“ä½œã€‚ä»£ç çš„å®ç°å¦‚ä¸‹ï¼š // server.go package main import ( \"context\" \"crypto/md5\" \"encoding/json\" \"errors\" \"flag\" \"fmt\" \"github.com/coreos/etcd/clientv3\" \"github.com/coreos/etcd/etcdserver/api/v3rpc/rpctypes\" \"log\" \"net\" \"os\" \"os/signal\" \"strings\" \"syscall\" \"time\" ) var ( prefix = \"register\" client *clientv3.Client stopSignal = make(chan struct{}, 1) srvKey string ) var ( serv = flag.String(\"name\", \"hello\", \"service name\") port = flag.Int(\"port\", 30000, \"service port\") endpoint = flag.String(\"endpoints\", \"http://127.0.0.1:2379\", \"etcd endpoints\") ) type SvConfig struct { Name string `json:\"name\"` Host string `json:\"host\"` Port int `json:\"port\"` } func Register(endpoints string, config *SvConfig, interval time.Duration, ttl int) error { // è§£ææœåŠ¡ç«¯çš„å€¼ srvValue, _ := json.Marshal(config) srvKey = fmt.Sprintf(\"%s/%x\", prefix, md5.Sum(srvValue)) var err error client, err = clientv3.New(clientv3.Config{ Endpoints: strings.Split(endpoints, \",\"), DialTimeout: time.Second * 2, }) if err != nil { return fmt.Errorf(\"register service failed: %v\", err) } go func() { timer := time.NewTicker(interval) for { resp, _ := client.Grant(context.TODO(), int64(ttl)) _, err = client.Get(context.TODO(), srvKey) if err != nil { // æ•è· key ä¸å­˜åœ¨çš„åœºåˆ if errors.Is(err, rpctypes.ErrKeyNotFound) { _, err = client.Put(context.TODO(), srvKey, string(srvValue), clientv3.WithLease(resp.ID)) if err != nil { log.Printf(\"register service %s at %s:%d\\n\", config.Name, config.Host, config.Port) } } } else { // å¦‚æœkeyå­˜åœ¨å°±æ›´æ–°ttl _, err = client.Put(context.TODO(), srvKey, string(srvValue), clientv3.WithLease(resp.ID)) } select { case \u003c-stopSignal: return case \u003c-timer.C: } } }() return err } func Unregister() error { stopSignal \u003c- struct{}{} stopSignal = make(chan struct{}, 1) _, err := client.Delete(context.TODO(), srvKey) return err } func main() { flag.Parse() // ç»‘å®šæœåŠ¡åœ°å€å’Œç«¯å£ lis, err := net.Listen(\"tcp\", fmt.Sprintf(\"127.0.0.1:%d\", *port)) if err != nil { panic(err) } config := \u0026SvConfig{ Name: *serv, Host: \"127.0.0.1\", Port: *port, } Register(*endpoint, config, time.Second*10, 15) ch := make(chan os.Signal, 1) signal.Notify(ch, syscall.SIGTERM, syscall.SIGINT, syscall.SIGKILL, syscall.SIGHUP, syscall.SIGQUIT) go func() { \u003c-ch Unregister() os.Exit(1) }() log.Printf(\"service %s start at %d\", *serv, *port) // server todo for { lis.Accept() } } // discovery.go package main import ( \"context\" \"encoding/json\" \"flag\" \"fmt\" \"github.com/coreos/etcd/clientv3\" \"log\" \"net\" \"os\" \"os/signal\" \"strings\" \"syscall\" \"time\" ) var ( prefix = \"register\" client *clientv3.Client ) var ( port = flag.Int(\"port\", 30001, \"service port\") endpoint = flag.String(\"endpoints\", \"http://127.0.0.1:2379\", \"etcd endpoints\") ) type SvConfig struct { Name string `json:\"name\"` Host string `json:\"host\"` Port int `json:\"port\"` } func watcher() error { var err error client, err = clientv3.New(clientv3.Config{ Endpoints: strings.Split(*endpoint, \",\"), DialTimeout: time.Second * 3, }) if err != nil { return fmt.Errorf(\"connect etcd cluster failed: %v\", err.Error()) } go func() { resp := client.Watch(context.TODO(), prefix, clientv3.WithPrefix()) for ch := range resp { for _, event := range ch.Events { switch event.Type { case clientv3.EventTypePut: if event.IsCreate() { srv := parseSrv(event.Kv.Value) log.Printf(\"discovery service %s at %s:%d\", srv.Name, srv.Host, srv.Port) } case clientv3.EventTypeDelete: log.Printf(\"delete service %s\", event.Kv.Key) } } } }() return err } func parseSrv(text []byte) *SvConfig { svc := \u0026SvConfig{} json.Unmarshal(text, \u0026svc) return svc } func main() { flag.Parse() // ç»‘å®šæœåŠ¡åœ°å€å’Œç«¯å£ lis, err := net.Listen(\"tcp\", fmt.Sprintf(\"127.0.0.1:%d\", *port)) if err != nil { panic(err) } ch := make(chan os","date":"2019-09-11","objectID":"/etcd%E7%9A%84%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B/:0:0","tags":["golang","etcd"],"title":"etcdçš„ä½¿ç”¨å®ä¾‹","uri":"/etcd%E7%9A%84%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B/"},{"categories":["åˆ†å¸ƒå¼","ä»£ç "],"content":"å…³äº etcd çš„å®‰è£…å’Œä»‹ç»çœ‹Â è¿™é‡ŒÂ ã€‚å®˜æ–¹çš„å®ä¾‹å¯ä»¥çœ‹Â è¿™é‡Œ ä¸€ã€è¿æ¥ é¦–å…ˆæ˜¯å…³äº golang å¦‚ä½•è¿æ¥ etcd ï¼Œå…ˆæ˜¯ç®€å•çš„è¿æ¥ã€‚ package main import ( \"github.com/coreos/etcd/clientv3\" \"log\" \"time\" ) func connect() { cli, err := clientv3.New(clientv3.Config{ // etcd é›†ç¾¤çš„åœ°å€é›†åˆ Endpoints: []string{\"192.168.10.10:2379\"}, // è¯·æ±‚è¶…æ—¶æ—¶é—´ DialTimeout: time.Second * 3, }) if err != nil { log.Fatal(\"connect etcd cluster: \" + err.Error()) } cli.Close() } è¿˜æœ‰å¸¦ https å’Œ å¼€å¯ç”¨æˆ·éªŒè¯çš„è¿æ¥ func connectTlsAuth() { tlsInfo := transport.TLSInfo{ CertFile: \"/tmp/cert.pem\", KeyFile: \"/tmp/key.pem\", TrustedCAFile: \"/tmp/ca.pem\", } tlsConfig, err := tlsInfo.ClientConfig() if err != nil { log.Fatal(\"parse tls config file: \" + err.Error()) } cli, err := clientv3.New(clientv3.Config{ Endpoints: []string{\"192.168.10.10:2379\"}, DialTimeout: time.Second * 3, TLS: tlsConfig, Username: \"root\", Password: \"root\", }) if err != nil { log.Fatal(\"connect etcd cluster: \" + err.Error()) } cli.Close() } äºŒã€KV æ“ä½œ ","date":"2019-09-10","objectID":"/go%E7%BB%93%E5%90%88etcd/:0:0","tags":["golang","etcd"],"title":"Go ç»“åˆ etcd","uri":"/go%E7%BB%93%E5%90%88etcd/"},{"categories":["åˆ†å¸ƒå¼","ä»£ç "],"content":"2.1 ç®€å•çš„ curd åœ¨è¿æ¥åŸºç¡€ä¸Šï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å¯¹keyåšæ“ä½œäº†ã€‚å¯¹keyåš curd func kv() { cli, _ := clientv3.New(clientv3.Config{ // etcd é›†ç¾¤çš„åœ°å€é›†åˆ Endpoints: []string{\"192.168.10.10:2379\"}, // è¯·æ±‚è¶…æ—¶æ—¶é—´ DialTimeout: time.Second * 3, }) defer cli.Close() ctx, cancel := context.WithCancel(context.Background()) defer cancel() // etcdctl put foo 1 _, err := cli.Put(ctx, \"foo\", \"1\") if err != nil { log.Fatal(\"put key:\" + err.Error()) } // etcdctl get foo --prefix // å¸¦å‚æ•°çš„è¯·æ±‚ resp, err := cli.Get(ctx, \"foo\", clientv3.WithPrefix()) if err != nil { log.Fatal(\"get key: \" + err.Error()) } for _, v := range resp.Kvs { log.Printf(\"get %s =\u003e %s\\n\", v.Key, string(v.Value)) } kvcli := clientv3.NewKV(cli) // etcdctl del foo _, err = kvcli.Delete(ctx, \"foo\") if err != nil { log.Fatal(\"delete key: \" + err.Error()) } } ","date":"2019-09-10","objectID":"/go%E7%BB%93%E5%90%88etcd/:1:0","tags":["golang","etcd"],"title":"Go ç»“åˆ etcd","uri":"/go%E7%BB%93%E5%90%88etcd/"},{"categories":["åˆ†å¸ƒå¼","ä»£ç "],"content":"2.2 äº‹åŠ¡ ä½¿ç”¨äº‹åŠ¡å¦‚ä¸‹ï¼š func txn() { cli, _ := clientv3.New(clientv3.Config{ // etcd é›†ç¾¤çš„åœ°å€é›†åˆ Endpoints: []string{\"192.168.10.10:2379\"}, // è¯·æ±‚è¶…æ—¶æ—¶é—´ DialTimeout: time.Second * 3, }) defer cli.Close() ctx, cancel := context.WithCancel(context.Background()) defer cancel() kvc := clientv3.NewKV(cli) _, err := kvc.Put(ctx, \"foo\", \"xyz\") if err != nil { log.Fatal(\"put key: \" + err.Error()) } _, err = kvc.Txn(ctx). // txn value comparisons are lexical If(clientv3.Compare(clientv3.Value(\"foo\"), \"\u003e\", \"abc\")). // the \"Then\" runs, since \"xyz\" \u003e \"abc\" Then(clientv3.OpPut(\"foo\", \"XYZ\")). // the \"Else\" does not run Else(clientv3.OpPut(\"foo\", \"ABC\")). Commit() if err != nil { log.Fatal(\"run txn: \" + err.Error()) } } ","date":"2019-09-10","objectID":"/go%E7%BB%93%E5%90%88etcd/:2:0","tags":["golang","etcd"],"title":"Go ç»“åˆ etcd","uri":"/go%E7%BB%93%E5%90%88etcd/"},{"categories":["åˆ†å¸ƒå¼","ä»£ç "],"content":"2.3 æ‰¹é‡æ“ä½œ æ‰¹é‡æŒ‡å®šæ“ä½œ func do() { cli, _ := clientv3.New(clientv3.Config{ // etcd é›†ç¾¤çš„åœ°å€é›†åˆ Endpoints: []string{\"192.168.10.10:2379\"}, // è¯·æ±‚è¶…æ—¶æ—¶é—´ DialTimeout: time.Second * 3, }) defer cli.Close() ctx, cancel := context.WithCancel(context.Background()) defer cancel() ops := []clientv3.Op{ clientv3.OpPut(\"key1\", \"123\"), clientv3.OpGet(\"key1\"), clientv3.OpPut(\"key2\", \"456\"), } for _, op := range ops { if _, err := cli.Do(ctx, op); err != nil { log.Fatal(err.Error()) } } } ","date":"2019-09-10","objectID":"/go%E7%BB%93%E5%90%88etcd/:3:0","tags":["golang","etcd"],"title":"Go ç»“åˆ etcd","uri":"/go%E7%BB%93%E5%90%88etcd/"},{"categories":["åˆ†å¸ƒå¼","ä»£ç "],"content":"2.3 watch ç›‘è§†key func watch() { cli, _ := clientv3.New(clientv3.Config{ // etcd é›†ç¾¤çš„åœ°å€é›†åˆ Endpoints: []string{\"192.168.10.10:2379\"}, // è¯·æ±‚è¶…æ—¶æ—¶é—´ DialTimeout: time.Second * 3, }) defer cli.Close() ctx, cancel := context.WithCancel(context.Background()) defer cancel() go func() { timer := time.NewTicker(time.Second) for { select { case \u003c-timer.C: // change foo value every second _, _ = cli.Put(context.TODO(), \"foo\", time.Now().String()) _, _ = cli.Put(context.TODO(), \"foo1\", time.Now().String()) _, _ = cli.Put(context.TODO(), \"foo2\", time.Now().String()) _, _ = cli.Put(context.TODO(), \"foo3\", time.Now().String()) _, _ = cli.Put(context.TODO(), \"foo4\", time.Now().String()) } } }() //rch := cli.Watch(ctx, \"foo\") rch := cli.Watch(ctx, \"foo\", clientv3.WithPrefix()) //rch := cli.Watch(ctx, \"foo\", clientv3.WithRange(\"foo4\")) for wresp := range rch { for _, ev := range wresp.Events { fmt.Printf(\"%s %q: %q\\n\", ev.Type, ev.Kv.Key, ev.Kv.Value) } } } func watchWithProcessNotify() { cli, _ := clientv3.New(clientv3.Config{ // etcd é›†ç¾¤çš„åœ°å€é›†åˆ Endpoints: []string{\"192.168.10.10:2379\"}, // è¯·æ±‚è¶…æ—¶æ—¶é—´ DialTimeout: time.Second * 3, }) defer cli.Close() ctx, cancel := context.WithCancel(context.Background()) defer cancel() rch := cli.Watch(ctx, \"foo\", clientv3.WithProgressNotify()) wresp := \u003c- rch fmt.Printf(\"wresp.Header.Revision: %d\\n\", wresp.Header.Revision) fmt.Println(\"wresp.IsProgressNotify:\", wresp.IsProgressNotify()) } ä¸‰ã€lease ","date":"2019-09-10","objectID":"/go%E7%BB%93%E5%90%88etcd/:4:0","tags":["golang","etcd"],"title":"Go ç»“åˆ etcd","uri":"/go%E7%BB%93%E5%90%88etcd/"},{"categories":["åˆ†å¸ƒå¼","ä»£ç "],"content":"2.1 åˆ›å»º lease func grant() { cli, _ := clientv3.New(clientv3.Config{ // etcd é›†ç¾¤çš„åœ°å€é›†åˆ Endpoints: []string{\"192.168.10.10:2379\"}, // è¯·æ±‚è¶…æ—¶æ—¶é—´ DialTimeout: time.Second * 3, }) defer cli.Close() ctx, cancel := context.WithCancel(context.Background()) defer cancel() // etcdctl lease grant 5 // grant lease 5s resp, err := cli.Grant(ctx, 5) if err != nil { log.Fatal(\"grant lease: \" + err.Error()) } // after 5 seconds, the key 'foo' will be removed _, err = cli.Put(ctx, \"foo\", \"bar\", clientv3.WithLease(resp.ID)) if err != nil { log.Fatal(\"put key with lease: \" + err.Error()) } } ","date":"2019-09-10","objectID":"/go%E7%BB%93%E5%90%88etcd/:5:0","tags":["golang","etcd"],"title":"Go ç»“åˆ etcd","uri":"/go%E7%BB%93%E5%90%88etcd/"},{"categories":["åˆ†å¸ƒå¼","ä»£ç "],"content":"2.2 åˆ é™¤ lease func revoke() { cli, _ := clientv3.New(clientv3.Config{ // etcd é›†ç¾¤çš„åœ°å€é›†åˆ Endpoints: []string{\"192.168.10.10:2379\"}, // è¯·æ±‚è¶…æ—¶æ—¶é—´ DialTimeout: time.Second * 3, }) defer cli.Close() ctx, cancel := context.WithCancel(context.Background()) defer cancel() resp, err := cli.Grant(ctx, 5) if err != nil { log.Fatal(\"grant lease: \" + err.Error()) } _, err = cli.Put(ctx, \"foo\", \"bar\", clientv3.WithLease(resp.ID)) if err != nil { log.Fatal(err) } // revoking lease expires the key attached to its lease ID _, err = cli.Revoke(ctx, resp.ID) if err != nil { log.Fatal(err) } } ","date":"2019-09-10","objectID":"/go%E7%BB%93%E5%90%88etcd/:6:0","tags":["golang","etcd"],"title":"Go ç»“åˆ etcd","uri":"/go%E7%BB%93%E5%90%88etcd/"},{"categories":["åˆ†å¸ƒå¼","ä»£ç "],"content":"2.3 ç»­ç§Ÿ func keepAlive() { cli, _ := clientv3.New(clientv3.Config{ // etcd é›†ç¾¤çš„åœ°å€é›†åˆ Endpoints: []string{\"192.168.10.10:2379\"}, // è¯·æ±‚è¶…æ—¶æ—¶é—´ DialTimeout: time.Second * 3, }) defer cli.Close() ctx, cancel := context.WithCancel(context.Background()) defer cancel() resp, err := cli.Grant(ctx, 5) if err != nil { log.Fatal(\"grant lease: \" + err.Error()) } _, err = cli.Put(ctx, \"foo\", \"bar\", clientv3.WithLease(resp.ID)) if err != nil { log.Fatal(err) } ch, err := cli.KeepAlive(ctx, resp.ID) if err != nil { log.Fatal(err.Error()) } ka := \u003c- ch fmt.Println(\"ttl:\", ka.TTL) // å®˜æ–¹æç¤ºï¼šå¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨ KeepAlive æ¥ä»£æ›¿ KeepAliveOnce kaa, err := cli.KeepAliveOnce(ctx, resp.ID) if err != nil { log.Fatal(err) } fmt.Println(\"ttl:\", kaa.TTL) } ","date":"2019-09-10","objectID":"/go%E7%BB%93%E5%90%88etcd/:7:0","tags":["golang","etcd"],"title":"Go ç»“åˆ etcd","uri":"/go%E7%BB%93%E5%90%88etcd/"},{"categories":["åˆ†å¸ƒå¼","ä»£ç "],"content":"2.4 æŸ¥è¯¢ lease func leases() { cli, _ := clientv3.New(clientv3.Config{ // etcd é›†ç¾¤çš„åœ°å€é›†åˆ Endpoints: []string{\"192.168.10.10:2379\"}, // è¯·æ±‚è¶…æ—¶æ—¶é—´ DialTimeout: time.Second * 3, }) defer cli.Close() ctx, cancel := context.WithCancel(context.Background()) defer cancel() _, err := cli.Grant(ctx, 5) if err != nil { log.Fatal(\"grant lease: \" + err.Error()) } _, err = cli.Grant(ctx, 10) if err != nil { log.Fatal(\"grant lease: \" + err.Error()) } _, err = cli.Grant(ctx, 15) if err != nil { log.Fatal(\"grant lease: \" + err.Error()) } resp, err := cli.Lease.Leases(ctx) if err != nil { log.Fatal(err) } for _, lease := range resp.Leases { ttl, err := cli.Lease.TimeToLive(ctx, lease.ID, clientv3.WithAttachedKeys()) if err == nil { fmt.Printf(\"lease: %d, ttl: %d, grantedTTL: %d\\n\", ttl.ID, ttl.TTL, ttl.GrantedTTL) } } } å››ã€è®¿é—®æ§åˆ¶ func auth() { cli, _ := clientv3.New(clientv3.Config{ // etcd é›†ç¾¤çš„åœ°å€é›†åˆ Endpoints: []string{\"192.168.10.10:2379\"}, // è¯·æ±‚è¶…æ—¶æ—¶é—´ DialTimeout: time.Second * 3, }) defer cli.Close() ctx, cancel := context.WithCancel(context.Background()) defer cancel() auth := clientv3.NewAuth(cli) // create role if _, err := auth.RoleAdd(ctx, \"root\"); err != nil { log.Fatal(err) } // create role if _, err := auth.UserAdd(ctx, \"root\", \"123\"); err != nil { log.Fatal(err) } // grant role root to user root if _, err := auth.UserGrantRole(ctx, \"root\", \"root\"); err != nil { log.Fatal(err) } if _, err := auth.UserChangePassword(ctx, \"root\", \"123\"); err != nil { log.Fatal(err) } if _, err := auth.RoleAdd(ctx, \"guest\"); err != nil { log.Fatal(err) } if _, err := auth.UserAdd(ctx, \"xingyys\", \"\"); err != nil { log.Fatal(err) } if _, err := auth.UserGrantRole(ctx, \"xingyys\", \"guest\"); err != nil { log.Fatal(err) } // ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œéœ€è¦åœ¨grantåæ›´æ–°å¯†ç  // å¦åˆ™å¯†ç æ— æ•ˆ if _, err := auth.UserChangePassword(ctx, \"xingyys\", \"123\"); err != nil { log.Fatal(err) } // æ·»åŠ æŒ‡å®škeyçš„è®¿é—®æƒé™ // read, write, readwrite if _, err := auth.RoleGrantPermission(ctx, \"guest\", \"foo\", \"zoo\", clientv3.PermissionType(clientv3.PermReadWrite)); err != nil { log.Fatal(err) } if _, err := auth.AuthEnable(ctx); err != nil { log.Fatal(err) } authCli, _ := clientv3.New(clientv3.Config{ // etcd é›†ç¾¤çš„åœ°å€é›†åˆ Endpoints: []string{\"192.168.10.10:2379\"}, // è¯·æ±‚è¶…æ—¶æ—¶é—´ DialTimeout: time.Second * 3, Username: \"xingyys\", Password: \"123\", }) defer authCli.Close() _, _ = authCli.Put(ctx, \"foo\", \"1\") resp, _ := authCli.Get(ctx, \"foo\") for _, v := range resp.Kvs { log.Printf(\"%s =\u003e %q\\n\", v.Key, v.Value) } _, err := authCli.Txn(ctx). If(clientv3.Compare(clientv3.Value(\"zoo1\"), \"\u003e\", \"abc\")). Then(clientv3.OpPut(\"zoo1\", \"XYZ\")). Else(clientv3.OpPut(\"zoo1\", \"ABC\")). Commit() log.Println(err) } äº”ã€é›†ç¾¤ func member() { cli, _ := clientv3.New(clientv3.Config{ // etcd é›†ç¾¤çš„åœ°å€é›†åˆ Endpoints: []string{\"192.168.10.10:2379\"}, // è¯·æ±‚è¶…æ—¶æ—¶é—´ DialTimeout: time.Second * 3, }) defer cli.Close() ctx, cancel := context.WithCancel(context.Background()) defer cancel() cluster := clientv3.NewCluster(cli) resp, err := cluster.MemberList(ctx) if err != nil { log.Fatal(err) } for _, member := range resp.Members { fmt.Printf(\"ID: %d | Name: %s | ClientURL: %q | PeerURL: %q\\n\", member.ID, member.Name, member.ClientURLs, member.PeerURLs) } //_, _ = cluster.MemberAdd(ctx, []string{\"192.168.10.10:2370\", \"192.168.10.11:2379\"}) //_, _ = cluster.MemberRemove(ctx, // id) //_, _ = cluster.MemberUpdate(ctx, // id, // peer) } å…­ã€å¹¶å‘ ","date":"2019-09-10","objectID":"/go%E7%BB%93%E5%90%88etcd/:8:0","tags":["golang","etcd"],"title":"Go ç»“åˆ etcd","uri":"/go%E7%BB%93%E5%90%88etcd/"},{"categories":["åˆ†å¸ƒå¼","ä»£ç "],"content":"6.1 é” func lock() { cli, err := clientv3.New(clientv3.Config{ Endpoints: []string{\"192.168.10.10:2379\"}, }) if err != nil { log.Fatal(err) } defer cli.Close() // æ³¨å†Œsession s1, err := concurrency.NewSession(cli) if err != nil { log.Fatal(err) } defer s1.Close() m1 := concurrency.NewMutex(s1, \"/lock\") s2, err := concurrency.NewSession(cli) if err != nil { log.Fatal(err) } defer s2.Close() m2 := concurrency.NewMutex(s2, \"/lock\") // acquired lock for s1 if err := m1.Lock(context.TODO()); err != nil { log.Fatal(err) } fmt.Println(\"acquired lock for s1\") m2Locked := make(chan struct{}) go func() { defer close(m2Locked) // wait util s1 is locks /lock if err := m2.Lock(context.TODO()); err != nil { log.Fatal(err) } }() if err := m1.Unlock(context.TODO()); err != nil { log.Fatal(err) } fmt.Println(\"release lock for s1\") \u003c-m2Locked fmt.Println(\"acquired lock for s2\") } func tryLock() { cli, err := clientv3.New(clientv3.Config{ Endpoints: []string{\"192.168.10.10:2379\"}, }) if err != nil { log.Fatal(err) } defer cli.Close() // æ³¨å†Œsession s1, err := concurrency.NewSession(cli) if err != nil { log.Fatal(err) } defer s1.Close() m1 := concurrency.NewMutex(s1, \"/lock\") s2, err := concurrency.NewSession(cli) if err != nil { log.Fatal(err) } defer s2.Close() m2 := concurrency.NewMutex(s2, \"/lock\") // acquire lock for s1 if err = m1.Lock(context.TODO()); err != nil { log.Fatal(err) } fmt.Println(\"acquired lock for s1\") if err = m2.TryLock(context.TODO()); err == nil { log.Fatal(\"should not acquire lock\") } if err == concurrency.ErrLocked { fmt.Println(\"cannot acquire lock for s2, as already locked in another session\") } if err = m1.Unlock(context.TODO()); err != nil { log.Fatal(err) } fmt.Println(\"released lock for s1\") if err = m2.TryLock(context.TODO()); err != nil { log.Fatal(err) } fmt.Println(\"acquired lock for s2\") } ","date":"2019-09-10","objectID":"/go%E7%BB%93%E5%90%88etcd/:9:0","tags":["golang","etcd"],"title":"Go ç»“åˆ etcd","uri":"/go%E7%BB%93%E5%90%88etcd/"},{"categories":["åˆ†å¸ƒå¼","ä»£ç "],"content":"6.2 é¢†å¯¼é€‰ä¸¾ func election() { cli, err := clientv3.New(clientv3.Config{Endpoints: []string{\"192.168.10.10:2379\"}}) if err != nil { log.Fatal(err) } defer cli.Close() // create two separate sessions for election competition s1, err := concurrency.NewSession(cli) if err != nil { log.Fatal(err) } defer s1.Close() e1 := concurrency.NewElection(s1, \"/my-election/\") s2, err := concurrency.NewSession(cli) if err != nil { log.Fatal(err) } defer s2.Close() e2 := concurrency.NewElection(s2, \"/my-election/\") // create competing candidates, with e1 initially losing to e2 var wg sync.WaitGroup wg.Add(2) electc := make(chan *concurrency.Election, 2) go func() { defer wg.Done() // delay candidacy so e2 wins first time.Sleep(3 * time.Second) if err := e1.Campaign(context.Background(), \"e1\"); err != nil { log.Fatal(err) } electc \u003c- e1 }() go func() { defer wg.Done() if err := e2.Campaign(context.Background(), \"e2\"); err != nil { log.Fatal(err) } electc \u003c- e2 }() cctx, cancel := context.WithCancel(context.TODO()) defer cancel() e := \u003c-electc fmt.Println(\"completed first election with\", string((\u003c-e.Observe(cctx)).Kvs[0].Value)) // resign so next candidate can be elected if err := e.Resign(context.TODO()); err != nil { log.Fatal(err) } e = \u003c-electc fmt.Println(\"completed second election with\", string((\u003c-e.Observe(cctx)).Kvs[0].Value)) wg.Wait() } ","date":"2019-09-10","objectID":"/go%E7%BB%93%E5%90%88etcd/:10:0","tags":["golang","etcd"],"title":"Go ç»“åˆ etcd","uri":"/go%E7%BB%93%E5%90%88etcd/"},{"categories":["åˆ†å¸ƒå¼","ä»£ç "],"content":"6.3 è½¯ä»¶äº‹åŠ¡å†…å­˜ func stm() { cli, err := clientv3.New(clientv3.Config{Endpoints: []string{\"192.168.10.10:2379\"}}) if err != nil { log.Fatal(err) } defer cli.Close() // set up \"accounts\" totalAccounts := 5 for i := 0; i \u003c totalAccounts; i++ { k := fmt.Sprintf(\"accts/%d\", i) if _, err = cli.Put(context.TODO(), k, \"100\"); err != nil { log.Fatal(err) } } exchange := func(stm concurrency.STM) error { from, to := rand.Intn(totalAccounts), rand.Intn(totalAccounts) if from == to { // nothing to do return nil } // read values fromK, toK := fmt.Sprintf(\"accts/%d\", from), fmt.Sprintf(\"accts/%d\", to) fromV, toV := stm.Get(fromK), stm.Get(toK) fromInt, toInt := 0, 0 fmt.Sscanf(fromV, \"%d\", \u0026fromInt) fmt.Sscanf(toV, \"%d\", \u0026toInt) // transfer amount xfer := fromInt / 2 fromInt, toInt = fromInt-xfer, toInt+xfer // write back stm.Put(fromK, fmt.Sprintf(\"%d\", fromInt)) stm.Put(toK, fmt.Sprintf(\"%d\", toInt)) return nil } // concurrently exchange values between accounts var wg sync.WaitGroup wg.Add(10) for i := 0; i \u003c 10; i++ { go func() { defer wg.Done() if _, serr := concurrency.NewSTM(cli, exchange); serr != nil { log.Fatal(serr) } }() } wg.Wait() // confirm account sum matches sum from beginning. sum := 0 accts, err := cli.Get(context.TODO(), \"accts/\", clientv3.WithPrefix()) if err != nil { log.Fatal(err) } for _, kv := range accts.Kvs { v := 0 fmt.Sscanf(string(kv.Value), \"%d\", \u0026v) sum += v } fmt.Println(\"account sum is\", sum) } ","date":"2019-09-10","objectID":"/go%E7%BB%93%E5%90%88etcd/:11:0","tags":["golang","etcd"],"title":"Go ç»“åˆ etcd","uri":"/go%E7%BB%93%E5%90%88etcd/"},{"categories":["æ•°æ®åº“"],"content":"æŸ¥çœ‹æ˜¯å¦å¼€å¯é—ªå› SQL\u003eselectflashback_onfromv$database;FLASHBACK_ON------------------ NO æŸ¥çœ‹æ˜¯å¦é…ç½®äº†db_recover_file_dest SQL\u003eshowparameterdb_recoveryNAMETYPEVALUE------------------------------------ ----------- ------------------------------ db_recovery_file_deststringdb_recovery_file_dest_sizebiginteger0 æ²¡æœ‰é…ç½®çš„è¯ï¼Œå…ˆåˆ›å»ºå¯¹åº”çš„ç›®å½•ï¼Œæ³¨æ„ç›®å½•çš„æƒé™å’Œoracleæ•°æ®åº“çš„ä¸€è‡´ mkdir /u01/flashback chown oracle:oinstall /u01/flashback SQL\u003ealtersystemsetdb_recovery_file_dest_size=30Gscope=both;SQL\u003ealtersystemsetdb_recovery_file_dest='/u01/flashback'scope=both;Systemaltered. å…³é—­ oracle SQL\u003eshutdownimmediate;Databaseclosed.Databasedismounted.ORACLEinstanceshutdown. å¯åŠ¨åˆ° mount çŠ¶æ€ SQL\u003estartupmount;ORACLEinstancestarted.TotalSystemGlobalArea1603411968bytesFixedSize2253664bytesVariableSize905972896bytesDatabaseBuffers687865856bytesRedoBuffers7319552bytesDatabasemounted. å¼€å¯ archeve log SQL\u003ealterdatabasearchivelog;Databasealtered. å¼€å¯é—ªå›åŠŸèƒ½ SQL\u003ealterdatabaseflashbackon;Databasealtered. å¯åŠ¨æ•°æ®åº“åˆ° open çŠ¶æ€ SQL\u003ealterdatabaseopen;Databasealtered. SQL\u003eselectflashback_onfromv$database;FLASHBACK_ON------------------ YES ","date":"2019-08-21","objectID":"/%E5%BC%80%E5%90%AForacle%E7%9A%84%E9%97%AA%E5%9B%9E%E5%8A%9F%E8%83%BD/:0:0","tags":["oracle"],"title":"å¼€å¯oracleçš„é—ªå›åŠŸèƒ½","uri":"/%E5%BC%80%E5%90%AForacle%E7%9A%84%E9%97%AA%E5%9B%9E%E5%8A%9F%E8%83%BD/"},{"categories":["ç¬”è®°"],"content":"æœ€è¿‘åœ¨å­¦ä¹ Javaè¯­è¨€ï¼Œä»è€Œä¹Ÿå­¦ä¹ äº†SpringFramework è¿™ä¸ªå¤§åé¼é¼çš„æ¡†æ¶ã€‚ä»è€Œåšä¸€äº›çš„è®°å½•ã€‚ é¢˜å¤–è¯: å­¦ä¹ è¿‡å‡ ç§ä¸åŒçš„è¯­è¨€ï¼Œåæ¥çŸ¥é“æ‰€æœ‰çš„ç¼–ç¨‹è¯­è¨€é‡Œæ‰€æœ‰çš„æ¦‚å¿µç¿»æ¥è¦†å»éƒ½æ˜¯ä¸€æ ·çš„äº‹ç‰©ï¼Œåªæ˜¯å®ƒä»¬è¢«ä¸åŒçš„æœ¯è¯­æ‰€æè¿°ï¼ŒåŠ ä¸Šå¤§éƒ¨åˆ†ä¸­æ–‡ç¿»è¯‘ï¼Œåˆæ‰¯ä¸Šä¸€äº›ä¸“æœ‰åè¯ï¼Œè®©ä¸€äº›æœ¬æ¥ç®€å•çš„æ¦‚å¿µå˜å¾—å¤æ‚è€Œæ·±å¥¥ã€‚ä¸çŸ¥æ˜¯å› äººçš„æœ‰é™ï¼Œè¿˜æ˜¯é‚£äº›ä¹¦ç±çš„ä½œè€…æœ‰æ„ä¸ºä¹‹ï¼Œå…¶å®å¾ˆå¤šçš„ä¸œè¥¿æœ¬æ¥éƒ½æ˜¯å¾ˆç®€å•äº†ï¼Œè¿™äº›å¥‡æ€ªçš„åè¯åè€Œè®©åˆå­¦è€…ç³Šæ¶‚èµ·æ¥ã€‚å¦‚æœæœ‰åˆšå¼€å§‹å­¦ä¹ ç¼–ç¨‹çš„åŒå­¦çœ‹åˆ°è¿™é‡Œï¼Œä¹Ÿè¯·æ³¨æ„äº†ï¼Œä¸è¦è¢«ä¸€äº›æ¦‚å¿µå’Œåå­—å¸¦åäº†ï¼Œç©¶å…¶æœ¬è´¨ï¼Œä¹Ÿå°±é‚£æ ·ã€‚ Spring åŸºæœ¬æ¦‚å¿µ å…¶å®ç¼–ç¨‹è¯­è¨€å’Œæ¡†æ¶çš„å‘å±•éƒ½æ˜¯ä¸ºäº†å®é™…ä½¿ç”¨è€Œæ¥çš„ï¼Œæ—¢ç„¶æ˜¯ä½¿ç”¨ï¼Œæ€ä¹ˆä½¿ç”¨ï¼Œæ€ä¹ˆç®€å•çš„ä½¿ç”¨ï¼Œæ€ä¹ˆç”¨æ›´èˆ’æœå°±æˆä¸ºäº†å…¶å‘å±•çš„ä¸»è¦åŠ¨åŠ›äº†ã€‚Javaæ¡†æ¶çš„å‘å±•ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæ‰€ä»¥springä»£æ›¿äº†Java EEï¼Œå†åˆ°åæ¥ Spring Boot çš„çƒ­é—¨ï¼Œçš†æ˜¯å¦‚æ­¤ã€‚å› æ­¤æ¡†æ¶çš„ä½œè€…å°±ä¼šæƒ³æ³•è®¾æ³•ç®€åŒ–ä¸€äº›ä¸å¿…è¦å’Œç¹ççš„ä¸œè¥¿ã€‚è€Œ Spring çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼šç®€åŒ– Java å¼€å‘ã€‚ ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œå°±æœ‰äº†ä»¥ä¸‹çš„å››ä¸ªç­–ç•¥ï¼š åŸºäºPOJOçš„è½»é‡çº§å’Œæœ€å°å…¥ä¾µæ€§ç¼–ç¨‹ é€šè¿‡ä¾èµ–æ³¨å…¥å’Œé¢å‘æ¥å£å®ç°æ¾è€¦åˆ åŸºäºåˆ‡é¢çš„æƒ¯ä¾‹è¿›è¡Œå£°æ˜å¼ç¼–ç¨‹ é€šè¿‡åˆ‡é¢å’Œæ¨¡æ¿å‡å°‘æ ·æ¿å¼ä»£ç  ","date":"2019-08-19","objectID":"/spring%E6%A1%86%E6%9E%B6%E7%9A%84%E6%A0%B8%E5%BF%83%E6%80%BB%E7%BB%93/:0:0","tags":["java","spring"],"title":"Springæ¡†æ¶çš„æ ¸å¿ƒæ€»ç»“","uri":"/spring%E6%A1%86%E6%9E%B6%E7%9A%84%E6%A0%B8%E5%BF%83%E6%80%BB%E7%BB%93/"},{"categories":["ç¬”è®°"],"content":"POJO è¿™ä¸ªåç§°å°±æ˜¯ç¬¦åˆä¸Šé¢æåˆ°çš„é—®é¢˜ã€‚POJO (Plain Old Java Object) â€¦â€¦ å…¶å®å°±æ˜¯ä¸ªæ™®é€šJava ç±»ï¼Œæ²¡æœ‰å…¶ä»–çš„ä¸œè¥¿äº†ï¼Œåªä¸è¿‡æ˜¯ä½œè€…ä¸ºäº†åº”ä»˜é‚£äº›åå¯¹å«åš£çš„äººè€Œæ‰¯å‡ºæ¥çš„èŠ±é‡Œèƒ¡å“¨çš„åç§°ã€‚ å› ä¸ºä½œè€…çš„æ„å›¾å°±æ˜¯ä¸è®©æ¡†æ¶æœ¬èº«çš„APIå¹²æ‰°åˆ°ä¸šåŠ¡ä»£ç ä¸­ä¸€äº›å®šä¹‰çš„ç±»ï¼Œè¿™æ ·å¯ä»¥å°½é‡æ˜¯ä¸šåŠ¡çš„ä»£ç æ›´åŠ å¹²å‡€ï¼Œè€¦åˆåº¦ä½ï¼Œå®¹æ˜“ä¿®æ”¹å’Œæµ‹è¯•ï¼Œä¹Ÿå°±æ˜¯æ‰€ä»¥çš„â€œæœ€å°å…¥ä¾µæ€§â€ã€‚ä½†æ˜¯ç»å¯¹çš„å¹²å‡€è¿˜æ˜¯åšä¸åˆ°çš„ï¼Œæ‰€ä»¥ä¸€èˆ¬çš„ä¸šåŠ¡ä»£ç ä¸Šå°±å¸¸å¸¸å‡ºç°äº†æ³¨è§£ã€‚ ","date":"2019-08-19","objectID":"/spring%E6%A1%86%E6%9E%B6%E7%9A%84%E6%A0%B8%E5%BF%83%E6%80%BB%E7%BB%93/:1:0","tags":["java","spring"],"title":"Springæ¡†æ¶çš„æ ¸å¿ƒæ€»ç»“","uri":"/spring%E6%A1%86%E6%9E%B6%E7%9A%84%E6%A0%B8%E5%BF%83%E6%80%BB%E7%BB%93/"},{"categories":["ç¬”è®°"],"content":"ä¾èµ–æ³¨å…¥å’Œæ§åˆ¶åè½¬ åˆæ˜¯çœ‹èµ·æ¥å°± é«˜å¤§ä¸Š çš„è¯æ±‡ã€‚ä¾èµ–æ³¨å…¥(dependency injection)å’Œæ§åˆ¶åè½¬(inversion of control) è¿™ä¸¤è€…å…¶å®å°±æ˜¯åŒä¸€ä¸ªä¸œè¥¿ï¼Œåªæ˜¯å®ƒä»¬çš„è¡¨è¿°ä¸åŒè€Œå·²ã€‚å› ä¸ºä¸€èˆ¬çš„åº”ç”¨ä¸­ï¼Œè¦å®Œæˆä¸€ä¸ªå®é™…çš„åŠŸèƒ½ï¼ŒåŸºæœ¬ä¸å¯èƒ½åªæœ‰ä¸€ä¸ªç±»ï¼Œè€Œæ˜¯å¤šä¸ªç±»åŒæ—¶ä½¿ç”¨ï¼Œä½¿ç”¨ä¸­å°±ä¼šäº’ç›¸å½±å“ã€‚ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜å§ï¼Œæˆ‘ä»¬åšä¸€ä¸ªåŠŸèƒ½ï¼Œéœ€è¦Aç±»å’ŒBç±»ï¼Œç°åœ¨éœ€è¦ç”¨Aç±»åˆ›å»ºBï¼Œä¿®æ”¹Bï¼Œåˆ é™¤Bï¼ŒAæ˜¯ä¾èµ–Bçš„ï¼Œä½†æ˜¯åšçš„åŠŸèƒ½åªæ˜¯è¾“å…¥Bçš„ä¿¡æ¯è€Œå·²ï¼Œè¿™æ ·å¤ªéº»çƒ¦äº†ï¼Œè€Œä¸”å®ƒä»¬ä¹‹é—´è”ç³»å¤ªå¤šï¼Œå¦‚æœBéœ€è¦ä¿®æ”¹ï¼Œé‚£Aä¹Ÿå°±è¦ä¿®æ”¹ã€‚æ‰€ä»¥åœ¨ spring ä¸­ï¼ŒAå¦‚æœéœ€è¦Bï¼Œå®ƒä¸æ˜¯ç›´æ¥åˆ›å»ºBï¼Œè€Œæ˜¯æ‰¾ springï¼Œè¿™å°±æ˜¯å°† B çš„æ§åˆ¶ç»™äº† springï¼Œ å®ç°æ§åˆ¶åè½¬ã€‚å¯¹spring æ¥è¯´ï¼Œå½“Aéœ€è¦Bæ—¶ï¼Œå®ƒä¸ºAæä¾›ï¼Œè¿™å°±æ˜¯ä¾èµ–æ³¨å…¥ï¼Œçœ‹ï¼åªæ˜¯è¡¨è¿°ä¸åŒè€Œå·²ã€‚ spring çš„å‡ºç°ï¼Œè§£è€¦å’Œä¸åŒç±»ä¹‹é—´çš„ä¾èµ–ï¼Œè°éœ€è¦è°ï¼Œéƒ½éœ€è¦æ‰¾ springäº†ã€‚ ","date":"2019-08-19","objectID":"/spring%E6%A1%86%E6%9E%B6%E7%9A%84%E6%A0%B8%E5%BF%83%E6%80%BB%E7%BB%93/:2:0","tags":["java","spring"],"title":"Springæ¡†æ¶çš„æ ¸å¿ƒæ€»ç»“","uri":"/spring%E6%A1%86%E6%9E%B6%E7%9A%84%E6%A0%B8%E5%BF%83%E6%80%BB%E7%BB%93/"},{"categories":["ç¬”è®°"],"content":"AOP åˆæ˜¯ spring çš„æ ¸å¿ƒæ¦‚å¿µã€‚ AOP (aspect-oriented programming) é¢å‘åˆ‡é¢ç¼–ç¨‹â€¦â€¦ï¼Œé¢å‘â€¦..ç¼–ç¨‹ è¿™ç±»åˆå®¹æ˜“è®©äººæ··ä¹±ï¼Œå…¶å®å°±æ˜¯å®ƒä»¬çš„å…³æ³¨ç‚¹ä¸åŒè€Œå·²ã€‚ç¨‹åºå‘˜å†™ä»£ç çš„æ€æƒ³ï¼Œæˆ–è€…ä¹ æƒ¯ã€‚ é¢å‘è¿‡ç¨‹ç¼–ç¨‹: æˆ‘å°±çœ‹å®ç°ä¸€ä¸ªåŠŸèƒ½éœ€è¦ä»€ä¹ˆæ­¥éª¤ï¼Œç„¶åç”¨ä»£ç è¡¨ç¤ºå‡ºè¿™äº›æ­¥éª¤å°±å¥½äº†ï¼Œæˆ‘ä¸ç®¡ä»£ç çš„é‡ç”¨ï¼Œè€¦åˆæ€§é—®é¢˜ã€‚å…³æ³¨ç‚¹æ˜¯ æ­¥éª¤ã€è¿‡ç¨‹ã€‚ é¢å‘å¯¹è±¡ç¼–ç¨‹: æˆ‘éœ€è¦å®ç°è¯¥åŠŸèƒ½ï¼Œä½†æ˜¯æˆ‘éœ€è¦è€ƒè™‘åˆ°æµç¨‹çš„ç»“æ„ï¼Œä»£ç é‡ç”¨ï¼Œè€¦åˆé—®é¢˜ã€‚æˆ‘éœ€è¦å…ˆå»ºç«‹ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è¿™ä¸ªå¯¹è±¡å®ä¾‹åŒ–å®ç°åŠŸèƒ½ã€‚å…³æ³¨ç‚¹æ˜¯ å¯¹è±¡ã€‚ é¢å‘åˆ‡é¢ç¼–ç¨‹: è¿™ä¸ªæ˜¯åœ¨ spring é‡Œç¬¬ä¸€æ¬¡è§åˆ°çš„ï¼Œå®ƒå…³æ³¨äºåº”ç”¨ä¸­çš„ æ ¸å¿ƒä¸šåŠ¡ æ¨¡å—ï¼Œè€Œè®¾æ³•å°†ä¸€äº›æ¬¡è¦çš„ï¼Œè¾…åŠ©çš„åŠŸèƒ½ç»Ÿä¸€ç®¡ç†ï¼Œå¦‚æ—¥å¿—ã€å®‰å…¨ã€éªŒè¯ç­‰ã€‚ spring Bean è€Œåœ¨ spring ä¸­å®ç°äº† ioc çš„å°±æ˜¯è¿™ä¸ª beanã€‚å®ƒæ˜¯springä¸­çš„å®¹å™¨ï¼Œç”¨æ¥ç®¡ç†æ„æˆåº”ç”¨çš„ç»„ä»¶å’Œä¸šåŠ¡ä»£ç ç±»ã€‚å®ƒæ˜¯springçš„æ ¸å¿ƒã€‚ ","date":"2019-08-19","objectID":"/spring%E6%A1%86%E6%9E%B6%E7%9A%84%E6%A0%B8%E5%BF%83%E6%80%BB%E7%BB%93/:3:0","tags":["java","spring"],"title":"Springæ¡†æ¶çš„æ ¸å¿ƒæ€»ç»“","uri":"/spring%E6%A1%86%E6%9E%B6%E7%9A%84%E6%A0%B8%E5%BF%83%E6%80%BB%E7%BB%93/"},{"categories":["ç¬”è®°"],"content":"Beançš„åˆ›å»º åˆ›å»º Bean æœ‰ä¸‰ç§ä¸åŒçš„æ–¹å¼ï¼š ä½¿ç”¨ xml é…ç½®æ–‡ä»¶åˆ›å»º ä½¿ç”¨ java æ³¨è§£åˆ›å»º ä½¿ç”¨ java Config åˆ›å»º ","date":"2019-08-19","objectID":"/spring%E6%A1%86%E6%9E%B6%E7%9A%84%E6%A0%B8%E5%BF%83%E6%80%BB%E7%BB%93/:4:0","tags":["java","spring"],"title":"Springæ¡†æ¶çš„æ ¸å¿ƒæ€»ç»“","uri":"/spring%E6%A1%86%E6%9E%B6%E7%9A%84%E6%A0%B8%E5%BF%83%E6%80%BB%E7%BB%93/"},{"categories":["ç¬”è®°"],"content":"Bean çš„ç”Ÿå‘½å‘¨æœŸ å…·ä½“è¿‡ç¨‹ä¸ºï¼š Spring å¯¹ bean è¿›è¡Œå®ä¾‹åŒ– Spring å°†å€¼å’Œ bean çš„å¼•ç”¨æ³¨å…¥åˆ° bean å¯¹åº”çš„å±æ€§ä¸­ å¦‚æœ bean å®ç°äº† BeanNameAware æ¥å£ï¼Œ Spring å°† bean çš„ ID ä¼ é€’ç»™ setBeanName() æ–¹æ³• å¦‚æœ bean å®ç°äº†BeanFactoryAwareæ¥å£ï¼Œ Spring å°†è°ƒç”¨ setBeanFactory() æ–¹æ³•ï¼Œå°† BeanFactory å®¹å™¨å®ä¾‹ä¼ å…¥ å¦‚æœ bean å®ç°äº†ApplicationContextAwareæ¥å£ï¼Œ Spring å°†è°ƒç”¨ setApplicationContext() æ–¹æ³•ï¼Œå°† bean æ‰€åœ¨çš„åº”ç”¨ä¸Šä¸‹æ–‡å¼•ç”¨ä¼ è¿›æ¥ å¦‚æœ bean å®ç°äº†BeanPostProcesseræ¥å£ï¼Œ Spring å°†è°ƒç”¨å®ƒä»¬çš„ postProcessBeforeInitialization() æ–¹æ³• å¦‚æœ bean å®ç°äº†InitializationBean æ¥å£ï¼ŒSpring å°†è°ƒç”¨å®ƒä»¬çš„ afterPropertiesSet() æ–¹æ³•ã€‚ç±»ä¼¼åœ°ï¼Œå¦‚æœ bean ä½¿ç”¨ init-method å£°æ˜äº†åˆå§‹åŒ–æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¹Ÿä¼šè¢«è°ƒç”¨ å¦‚æœ bean å®ç°äº†BeanPostProcessoræ¥å£ï¼ŒSpring å°†è°ƒç”¨å®ƒä»¬çš„ postProcessAfterInitialization() æ–¹æ³• æ­¤æ—¶ï¼Œbean å·²ç»å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥è¢«åº”ç”¨ç¨‹åºä½¿ç”¨äº†ï¼Œå®ƒä»¬å°†ä¸€ç›´é©»ç•™åœ¨åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œç›´åˆ°è¯¥åº”ç”¨ä¸Šä¸‹æ–‡è¢«é”€æ¯ å¦‚æœ bean å®ç°äº† DisposableBean æ¥å£ï¼ŒSpring å°†è°ƒç”¨å®ƒä»¬çš„ destroy() æ¥å£æ–¹æ³•ã€‚åŒæ ·ï¼Œå¦‚æœ bean ä½¿ç”¨ destroy-method å£°æ˜äº†é”€æ¯æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¹Ÿä¼šè¢«è°ƒç”¨ ","date":"2019-08-19","objectID":"/spring%E6%A1%86%E6%9E%B6%E7%9A%84%E6%A0%B8%E5%BF%83%E6%80%BB%E7%BB%93/:5:0","tags":["java","spring"],"title":"Springæ¡†æ¶çš„æ ¸å¿ƒæ€»ç»“","uri":"/spring%E6%A1%86%E6%9E%B6%E7%9A%84%E6%A0%B8%E5%BF%83%E6%80%BB%E7%BB%93/"},{"categories":["å¾®æœåŠ¡"],"content":"åœ¨spring cloud 2.xä»¥å,ç”±äºzuulä¸€ç›´åœæ»åœ¨1.xç‰ˆæœ¬,æ‰€ä»¥springå®˜æ–¹å°±è‡ªå·±å¼€å‘äº†ä¸€ä¸ªé¡¹ç›® Spring Cloud Gateway.ä½œä¸ºspring cloudå¾®æœåŠ¡çš„ç½‘å…³ç»„ä»¶. æ³¨:è¿™ä¸€ä¸ªç³»åˆ—çš„å¼€å‘ç¯å¢ƒç‰ˆæœ¬ä¸º java1.8, spring boot2.x, spring cloud Greenwich.SR2, IDEä¸º Intelli IDEA spring cloud gateway å…¥é—¨ æ ¹æ®å®˜æ–¹çš„ç®€ä»‹,å®ƒæ˜¯spring mvcåŸºç¡€ä¹‹ä¸Š,æ—¨åœ¨æä¾›ä¸€ä¸ªç®€å•æœ‰æ•ˆçš„è·¯ç”±ç®¡ç†æ–¹å¼,å¦‚ å®‰å…¨ï¼Œç›‘æ§/æŒ‡æ ‡ï¼Œå’Œé™æµç­‰. ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:0:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"ç›¸å…³æ¦‚å¿µ Routeï¼ˆè·¯ç”±ï¼‰ï¼šè¿™æ˜¯ç½‘å…³çš„åŸºæœ¬æ„å»ºéƒ¨åˆ†ã€‚å®ƒç”±ä¸€ä¸ª IDï¼Œä¸€ä¸ªç›®æ ‡ URIï¼Œä¸€ç»„æ–­è¨€å’Œä¸€ç»„è¿‡æ»¤å™¨å®šä¹‰ã€‚å¦‚æœæ–­è¨€ä¸ºçœŸï¼Œåˆ™è·¯ç”±åŒ¹é…ã€‚ Predicateï¼ˆæ–­è¨€ï¼‰ï¼šè¿™æ˜¯ä¸€ä¸ª Java 8 çš„ Predicateã€‚è¾“å…¥ç±»å‹æ˜¯ä¸€ä¸ª ServerWebExchangeã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥åŒ¹é…æ¥è‡ª HTTP è¯·æ±‚çš„ä»»ä½•å†…å®¹ï¼Œä¾‹å¦‚ headers æˆ–å‚æ•°ã€‚ Filterï¼ˆè¿‡æ»¤å™¨ï¼‰ï¼šè¿™æ˜¯org.springframework.cloud.gateway.filter.GatewayFilterçš„å®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒä¿®æ”¹è¯·æ±‚å’Œå“åº”ã€‚ ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:1:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"å·¥ä½œæµç¨‹ å®¢æˆ·ç«¯å‘ Spring Cloud Gateway å‘å‡ºè¯·æ±‚ã€‚å¦‚æœ Gateway Handler Mapping ä¸­æ‰¾åˆ°ä¸è¯·æ±‚ç›¸åŒ¹é…çš„è·¯ç”±ï¼Œå°†å…¶å‘é€åˆ° Gateway Web Handlerã€‚Handler å†é€šè¿‡æŒ‡å®šçš„è¿‡æ»¤å™¨é“¾æ¥å°†è¯·æ±‚å‘é€åˆ°æˆ‘ä»¬å®é™…çš„æœåŠ¡æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œç„¶åè¿”å›ã€‚ è¿‡æ»¤å™¨ä¹‹é—´ç”¨è™šçº¿åˆ†å¼€æ˜¯å› ä¸ºè¿‡æ»¤å™¨å¯èƒ½ä¼šåœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰ï¼ˆâ€œpreâ€ï¼‰æˆ–ä¹‹åï¼ˆâ€œpostâ€ï¼‰æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚ Spring Cloud Gateway çš„ç‰¹å¾ï¼š åŸºäº Spring Framework 5ï¼ŒProject Reactor å’Œ Spring Boot 2.0 åŠ¨æ€è·¯ç”± Predicates å’Œ Filters ä½œç”¨äºç‰¹å®šè·¯ç”± é›†æˆ Hystrix æ–­è·¯å™¨ é›†æˆ Spring Cloud DiscoveryClient æ˜“äºç¼–å†™çš„ Predicates å’Œ Filters é™æµ è·¯å¾„é‡å†™ æ³¨: ä»¥ä¸Šå¼•è‡ª: http://www.ityouknow.com ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:2:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"ç®€å•ä½¿ç”¨ ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:3:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"æ·»åŠ ä¾èµ– \u003cproperties\u003e \u003cjava.version\u003e1.8\u003c/java.version\u003e \u003cspring-cloud.version\u003eGreenwich.SR2\u003c/spring-cloud.version\u003e \u003c/properties\u003e \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-gateway\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-test\u003c/artifactId\u003e \u003cscope\u003etest\u003c/scope\u003e \u003c/dependency\u003e \u003c/dependencies\u003e \u003cdependencyManagement\u003e \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-dependencies\u003c/artifactId\u003e \u003cversion\u003e${spring-cloud.version}\u003c/version\u003e \u003ctype\u003epom\u003c/type\u003e \u003cscope\u003eimport\u003c/scope\u003e \u003c/dependency\u003e \u003c/dependencies\u003e \u003c/dependencyManagement\u003e ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:3:1","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"é…ç½®æ–‡ä»¶ spring cloud gatewayåº•å±‚ä½¿ç”¨netty+webflux, ä¸å†ä¾èµ–webäº† server: port: 8080 spring: cloud: gateway: routes: - id: iyk_route uri: http://www.ityouknow.com predicates: - Path=/spring-cloud è¯´æ˜ä¸‹è¯¥é…ç½®: idï¼šè‡ªå®šä¹‰çš„è·¯ç”± IDï¼Œä¿æŒå”¯ä¸€ uriï¼šç›®æ ‡æœåŠ¡åœ°å€ predicatesï¼šè·¯ç”±æ¡ä»¶ï¼ŒPredicate æ¥å—ä¸€ä¸ªè¾“å…¥å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ç»“æœã€‚è¯¥æ¥å£åŒ…å«å¤šç§é»˜è®¤æ–¹æ³•æ¥å°† Predicate ç»„åˆæˆå…¶ä»–å¤æ‚çš„é€»è¾‘ï¼ˆæ¯”å¦‚ï¼šä¸ï¼Œæˆ–ï¼Œéï¼‰ã€‚ filtersï¼šè¿‡æ»¤è§„åˆ™ åŒæ ·çš„,è½¬å‘åŠŸèƒ½ä¹Ÿå¯ä»¥ä½¿ç”¨ä»£ç æ¥å®ç°: // ç›´æ¥å†™åœ¨å¯åŠ¨ç±»ä¸­ @Bean public RouteLocator customRouteLocator(RouteLocatorBuilder builder) { return builder.routes() .route(\"path_route\", r -\u003e r.path(\"/about\") .uri(\"http://ityouknow.com\")) .build(); } æ³¨: è™½ç„¶ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥,ä½†è¿˜æ˜¯å»ºè®®å†™åœ¨é…ç½®æ–‡ä»¶ä¸­ ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:3:2","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"è·¯ç”±è§„åˆ™ Spring Cloud Gateway æ˜¯é€šè¿‡ Spring WebFlux çš„ HandlerMapping åšä¸ºåº•å±‚æ”¯æŒæ¥åŒ¹é…åˆ°è½¬å‘è·¯ç”±ï¼ŒSpring Cloud Gateway å†…ç½®äº†å¾ˆå¤š Predicates å·¥å‚ï¼Œè¿™äº› Predicates å·¥å‚é€šè¿‡ä¸åŒçš„ HTTP è¯·æ±‚å‚æ•°æ¥åŒ¹é…ï¼Œå¤šä¸ª Predicates å·¥å‚å¯ä»¥ç»„åˆä½¿ç”¨ã€‚ ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:4:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"predicates Predicate æ¥æºäº Java 8ï¼Œæ˜¯ Java 8 ä¸­å¼•å…¥çš„ä¸€ä¸ªå‡½æ•°ï¼ŒPredicate æ¥å—ä¸€ä¸ªè¾“å…¥å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ç»“æœã€‚è¯¥æ¥å£åŒ…å«å¤šç§é»˜è®¤æ–¹æ³•æ¥å°† Predicate ç»„åˆæˆå…¶ä»–å¤æ‚çš„é€»è¾‘ï¼ˆæ¯”å¦‚ï¼šä¸ï¼Œæˆ–ï¼Œéï¼‰ã€‚å¯ä»¥ç”¨äºæ¥å£è¯·æ±‚å‚æ•°æ ¡éªŒã€åˆ¤æ–­æ–°è€æ•°æ®æ˜¯å¦æœ‰å˜åŒ–éœ€è¦è¿›è¡Œæ›´æ–°æ“ä½œã€‚ åœ¨ Spring Cloud Gateway ä¸­ Spring åˆ©ç”¨ Predicate çš„ç‰¹æ€§å®ç°äº†å„ç§è·¯ç”±åŒ¹é…è§„åˆ™ï¼Œæœ‰é€šè¿‡ Headerã€è¯·æ±‚å‚æ•°ç­‰ä¸åŒçš„æ¡ä»¶æ¥è¿›è¡Œä½œä¸ºæ¡ä»¶åŒ¹é…åˆ°å¯¹åº”çš„è·¯ç”±ã€‚ç½‘ä¸Šæœ‰ä¸€å¼ å›¾æ€»ç»“äº† Spring Cloud å†…ç½®çš„å‡ ç§ Predicate çš„å®ç°ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹çœ‹è¿™äº›è§„åˆ™çš„å…·ä½“ä½¿ç”¨æ–¹æ³•: ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:4:1","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"æ—¶é—´åŒ¹é… predicate æ”¯æŒè®¾ç½®ä¸€ä¸ªæ—¶é—´,ä»¥è¿™ä¸ªæ—¶é—´ä¸ºåˆ†ç•Œçº¿,è¿™ä¸ªæ—¶é—´å‰çš„ä¸èƒ½è®¿é—®,è¿™ä¸ªæ—¶é—´ä¹‹åçš„å¯ä»¥è®¿é—®. spring: cloud: gateway: routes: - id: time_route uri: http://example.com predicates: - After=2019-08-17T12:00:00+08:00[Asia/Shanghai] Spring æ˜¯é€šè¿‡ ZonedDateTime æ¥å¯¹æ—¶é—´è¿›è¡Œçš„å¯¹æ¯”ï¼ŒZonedDateTime æ˜¯ Java 8 ä¸­æ—¥æœŸæ—¶é—´åŠŸèƒ½é‡Œï¼Œç”¨äºè¡¨ç¤ºå¸¦æ—¶åŒºçš„æ—¥æœŸä¸æ—¶é—´ä¿¡æ¯çš„ç±»ï¼ŒZonedDateTime æ”¯æŒé€šè¿‡æ—¶åŒºæ¥è®¾ç½®æ—¶é—´ï¼Œä¸­å›½çš„æ—¶åŒºæ˜¯ï¼šAsia/Shanghaiã€‚ After Route Predicate æ˜¯æŒ‡åœ¨è¿™ä¸ªæ—¶é—´ä¹‹åçš„è¯·æ±‚éƒ½è½¬å‘åˆ°ç›®æ ‡åœ°å€ã€‚ä¸Šé¢çš„ç¤ºä¾‹æ˜¯æŒ‡ï¼Œè¯·æ±‚æ—¶é—´åœ¨ 2018å¹´1æœˆ20æ—¥6ç‚¹6åˆ†6ç§’ä¹‹åçš„æ‰€æœ‰è¯·æ±‚éƒ½è½¬å‘åˆ°åœ°å€http://example.comã€‚+08:00æ˜¯æŒ‡æ—¶é—´å’ŒUTCæ—¶é—´ç›¸å·®å…«ä¸ªå°æ—¶ï¼Œæ—¶é—´åœ°åŒºä¸ºAsia/Shanghaiã€‚ æ·»åŠ å®Œè·¯ç”±è§„åˆ™ä¹‹åï¼Œè®¿é—®åœ°å€http://localhost:8080ä¼šè‡ªåŠ¨è½¬å‘åˆ°http://example.comã€‚ Before Route Predicate åˆšå¥½ç›¸åï¼Œåœ¨æŸä¸ªæ—¶é—´ä¹‹å‰çš„è¯·æ±‚çš„è¯·æ±‚éƒ½è¿›è¡Œè½¬å‘ã€‚æˆ‘ä»¬æŠŠä¸Šé¢è·¯ç”±è§„åˆ™ä¸­çš„ After æ”¹ä¸º Beforeï¼Œå¦‚ä¸‹ï¼š spring: cloud: gateway: routes: - id: before_route uri: http://example.com predicates: - Before=2019-08-17T12:00:00+08:00[Asia/Shanghai] æ—¢ç„¶æœ‰è¿™ä¸ªæ—¶é—´å‰Afterå’Œè¿™ä¸ªæ—¶é—´åBefore,predicateè¿˜æ”¯æŒåœ¨ä¸€æ®µæ—¶é—´ä¹‹å†…åŒ¹é…,é‚£å°±éœ€è¦ä½¿ç”¨Between spring: cloud: gateway: routes: - id: after_route uri: http://example.com predicates: - Between=2019-08-17T08:00:00+08:00[Asia/Shanghai], 2019-08-17T09:00:00+08:00[Asia/Shanghai] è¿™ä¸ªåŠŸèƒ½åˆšå¥½å¯ä»¥ä½¿ç”¨åœ¨ä¸€äº›æŠ¢è´­æ´»åŠ¨ä¸­. ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:4:2","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"Cookie åŒ¹é… Cookie Route Predicate å¯ä»¥æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ Cookie name ,ä¸€ä¸ªæ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œè·¯ç”±è§„åˆ™ä¼šé€šè¿‡è·å–å¯¹åº”çš„ Cookie name å€¼å’Œæ­£åˆ™è¡¨è¾¾å¼å»åŒ¹é…ï¼Œå¦‚æœåŒ¹é…ä¸Šå°±ä¼šæ‰§è¡Œè·¯ç”±ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…ä¸Šåˆ™ä¸æ‰§è¡Œã€‚ spring: cloud: gateway: routes: - id: cookie_route uri: http://example.com predicates: - Cookie=a,b.c è¿™è¡¨ç¤ºè¯·æ±‚çš„cookieéœ€è¦æºå¸¦ a=b.c æ‰å¯ä»¥è®¿é—®,å¦åˆ™å°±æŠ¥404é”™è¯¯,å¯ä»¥ä½¿ç”¨ curl http://localhost:8080 --cookie \"a=b.c\" ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:4:3","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"Header åŒ¹é… Header Route Predicate å’Œ Cookie Route Predicate ä¸€æ ·ï¼Œä¹Ÿæ˜¯æ¥æ”¶ 2 ä¸ªå‚æ•°ï¼Œä¸€ä¸ª header ä¸­çš„å±æ€§åç§°å’Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿™ä¸ªå±æ€§å€¼å’Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åˆ™æ‰§è¡Œã€‚ spring: cloud: gateway: routes: - id: header_route uri: http://example.com predicates: - Header=X-Request-Id, \\d+ åŒæ ·çš„å¯ä»¥ä½¿ç”¨å‘½ä»¤url http://localhost:8080 --header \"X-Request-Id:11\"æ¥æµ‹è¯•. ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:4:4","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"Host åŒ¹é… Host Route Predicate æ¥æ”¶ä¸€ç»„å‚æ•°ï¼Œä¸€ç»„åŒ¹é…çš„åŸŸååˆ—è¡¨ï¼Œè¿™ä¸ªæ¨¡æ¿æ˜¯ä¸€ä¸ª ant åˆ†éš”çš„æ¨¡æ¿ï¼Œç”¨.å·ä½œä¸ºåˆ†éš”ç¬¦ã€‚å®ƒé€šè¿‡å‚æ•°ä¸­çš„ä¸»æœºåœ°å€ä½œä¸ºåŒ¹é…è§„åˆ™ spring: cloud: gateway: routes: - id: header_route uri: http://example.com predicates: - Host=**.example.com ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:4:5","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"è¯·æ±‚æ–¹æ³•åŒ¹é… å¯ä»¥é€šè¿‡è¯·æ±‚æ–¹å¼GETï¼ŒPOSTï¼ŒPATHå’ŒDELETEæ–¹æ³•è¿›è¡ŒåŒ¹é…ï¼š spring: cloud: gateway: routes: - id: method_route uri: https://example.org predicates: - Method=GET ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:4:6","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"è¯·æ±‚è·¯å¾„åŒ¹é… predicateæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªPathMatcher è¡¨è¾¾å¼ å’Œä¸€ä¸ªå¯é€‰å‚æ•° matchOptionalTrailingSeparator spring: cloud: gateway: routes: - id: host_route uri: https://example.org predicates: - Path=/foo/{segment},/bar/{segment} èƒ½åŒ¹é…åˆ°/foo/1, /foo/bar æˆ– /bar/bazç­‰è·¯å¾„ã€‚ åŒæ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨ä»£ç è·å–ï¼š Map\u003cString, String\u003e uriVariables = ServerWebExchangeUtils.getPathPredicateVariables(exchange); String segment = uriVariables.get(\"segment\"); ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:4:7","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"è¯·æ±‚å‚æ•°åŒ¹é… Query Route Predicate æ”¯æŒä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å±æ€§åä¸€ä¸ªä¸ºå±æ€§å€¼ï¼Œå±æ€§å€¼å¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚ spring: cloud: gateway: routes: - id: query_route uri: https://example.org predicates: - Query=baz ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:4:8","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"ipåœ°å€åŒ¹é… RemoteAddr Route Predicate æ”¯æŒåŒ¹é…ç›¸åº”çš„ipåœ°å€ï¼Œå¦‚(IPv4 or IPv6)ï¼Œæˆ–è€…ä¸€ä¸ªç½‘æ®µ192.168.0.1/16ï¼Œä¸€ä¸ªåœ°å€192.168.0.1 spring: cloud: gateway: routes: - id: remoteaddr_route uri: https://example.org predicates: - RemoteAddr=192.168.1.1/24 ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:4:9","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"æƒé‡åŒ¹é… Weight Route Predicate æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†ç»„å’Œæƒé‡ï¼š spring: cloud: gateway: routes: - id: weight_high uri: https://weighthigh.org predicates: - Weight=group1, 8 - id: weight_low uri: https://weightlow.org predicates: - Weight=group1, 2 ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:4:10","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"ç»„åˆä½¿ç”¨ é™¤æ­¤ä¹‹å¤–ï¼Œè¿™äº›åŒ¹é…è¿˜å¯ä»¥ç»„åˆèµ·æ¥ä½¿ç”¨ spring: cloud: gateway: routes: - id: host_foo_path_headers_to_httpbin uri: http://example.com predicates: - Host=**.foo.org - Path=/headers - Method=GET - Header=X-Request-Id, \\d+ - Query=foo, ba. - Query=baz - Cookie=chocolate, ch.p - After=2019-08-18T12:00:00+08:00[Asia/Shanghai] å„ç§ Predicates åŒæ—¶å­˜åœ¨äºåŒä¸€ä¸ªè·¯ç”±æ—¶ï¼Œè¯·æ±‚å¿…é¡»åŒæ—¶æ»¡è¶³æ‰€æœ‰çš„æ¡ä»¶æ‰è¢«è¿™ä¸ªè·¯ç”±åŒ¹é…ã€‚ ä¸€ä¸ªè¯·æ±‚æ»¡è¶³å¤šä¸ªè·¯ç”±çš„è°“è¯æ¡ä»¶æ—¶ï¼Œè¯·æ±‚åªä¼šè¢«é¦–ä¸ªæˆåŠŸåŒ¹é…çš„è·¯ç”±è½¬å‘ æœåŠ¡åŒ– å‰é¢å·²ç»ä»‹ç»äº†spring cloud gateway çš„ç®€å•ä½¿ç”¨ï¼Œç°åœ¨æˆ‘ä»¬å°±æŠŠå®ƒèå…¥åˆ°å¾®æœåŠ¡ä¸­ï¼Œ ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:4:11","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"æ·»åŠ ä¾èµ– \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-netflix-eureka-client\u003c/artifactId\u003e \u003c/dependency\u003e ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:5:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"é…ç½®æ–‡ä»¶ ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ discoveryçš„é…ç½® server: port: 8888 spring: application: name: gateway cloud: gateway: discovery: locator: enabled: true eureka: client: service-url: defaultZone: http://localhost:8000/eureka/ logging: level: org.springframework.cloud.gateway: debug é…ç½®è¯´æ˜ï¼š spring.cloud.gateway.discovery.locator.enabledï¼šæ˜¯å¦ä¸æœåŠ¡æ³¨å†Œäºå‘ç°ç»„ä»¶è¿›è¡Œç»“åˆï¼Œé€šè¿‡ serviceId è½¬å‘åˆ°å…·ä½“çš„æœåŠ¡å®ä¾‹ã€‚é»˜è®¤ä¸º falseï¼Œè®¾ä¸º true ä¾¿å¼€å¯é€šè¿‡æœåŠ¡ä¸­å¿ƒçš„è‡ªåŠ¨æ ¹æ® serviceId åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ã€‚ eureka.client.service-url.defaultZoneæŒ‡å®šæ³¨å†Œä¸­å¿ƒçš„åœ°å€ï¼Œä»¥ä¾¿ä½¿ç”¨æœåŠ¡å‘ç°åŠŸèƒ½ logging.level.org.springframework.cloud.gateway è°ƒæ•´ç›¸ gateway åŒ…çš„ log çº§åˆ«ï¼Œä»¥ä¾¿æ’æŸ¥é—®é¢˜ ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:6:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"å¯åŠ¨ç±» @SpringBootApplication @EnableDiscoveryClient public class GatewayApplication { public static void main(String[] args) { SpringApplication.run(GatewayApplication.class, args); } } ä¿®æ”¹å®Œæˆåå¯åŠ¨é¡¹ç›®ï¼Œè®¿é—®æ³¨å†Œä¸­å¿ƒåœ°å€ http://localhost:8000/ å³å¯çœ‹åˆ°åä¸ºGATEWAYçš„æœåŠ¡ã€‚ ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:7:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"æµ‹è¯• å°† spring cloud gateway æ³¨å†Œåˆ°æœåŠ¡ä¸­å¿ƒä¹‹åï¼Œç½‘å…³ä¼šè‡ªåŠ¨ä»£ç†æ‰€æœ‰çš„åœ¨æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ï¼Œè®¿é—®è¿™äº›æœåŠ¡çš„è¯­æ³•ä¸ºï¼šhttp://ç½‘å…³åœ°å€:ç«¯å£/æœåŠ¡ä¸­å¿ƒæ³¨å†ŒserviceId/å…·ä½“çš„urlã€‚ å‡å¦‚ producer æœ‰ä¸€ä¸ª hello æœåŠ¡ï¼Œé‚£ä½¿ç”¨ gateway è®¿é—®å°±å˜æˆ http://localhost:8888/producer/helloã€‚ åŸºäºFilterå®ç°çš„åŠŸèƒ½ Spring Cloud Gateway çš„ Filter çš„ç”Ÿå‘½å‘¨æœŸæœ‰ä¸¤ä¸ªï¼šâ€œpreâ€ å’Œ â€œpostâ€ã€‚ PREï¼š è¿™ç§è¿‡æ»¤å™¨åœ¨è¯·æ±‚è¢«è·¯ç”±ä¹‹å‰è°ƒç”¨ã€‚æˆ‘ä»¬å¯åˆ©ç”¨è¿™ç§è¿‡æ»¤å™¨å®ç°èº«ä»½éªŒè¯ã€åœ¨é›†ç¾¤ä¸­é€‰æ‹©è¯·æ±‚çš„å¾®æœåŠ¡ã€è®°å½•è°ƒè¯•ä¿¡æ¯ç­‰ã€‚ POSTï¼šè¿™ç§è¿‡æ»¤å™¨åœ¨è·¯ç”±åˆ°å¾®æœåŠ¡ä»¥åæ‰§è¡Œã€‚è¿™ç§è¿‡æ»¤å™¨å¯ç”¨æ¥ä¸ºå“åº”æ·»åŠ æ ‡å‡†çš„ HTTP Headerã€æ”¶é›†ç»Ÿè®¡ä¿¡æ¯å’ŒæŒ‡æ ‡ã€å°†å“åº”ä»å¾®æœåŠ¡å‘é€ç»™å®¢æˆ·ç«¯ç­‰ã€‚ Spring Cloud Gateway çš„ Filter åˆ†ä¸ºä¸¤ç§ï¼šGatewayFilter ä¸ GlobalFilterã€‚GlobalFilter ä¼šåº”ç”¨åˆ°æ‰€æœ‰çš„è·¯ç”±ä¸Šï¼Œè€Œ GatewayFilter å°†åº”ç”¨åˆ°å•ä¸ªè·¯ç”±æˆ–è€…ä¸€ä¸ªåˆ†ç»„çš„è·¯ç”±ä¸Šã€‚ Spring Cloud Gateway å†…ç½®äº†9ç§ GlobalFilterï¼Œæ¯”å¦‚ Netty Routing Filterã€LoadBalancerClient Filterã€Websocket Routing Filter ç­‰ï¼Œå…·ä½“å¤§å®¶å‚è€ƒå®˜ç½‘å†…å®¹ã€‚ åˆ©ç”¨ GatewayFilter å¯ä»¥ä¿®æ”¹è¯·æ±‚çš„ Http çš„è¯·æ±‚æˆ–è€…å“åº”ï¼Œæˆ–è€…æ ¹æ®è¯·æ±‚æˆ–è€…å“åº”åšä¸€äº›ç‰¹æ®Šçš„é™åˆ¶ã€‚ ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:8:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"ä¿®æ”¹è¯·æ±‚å‚æ•° æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ AddRequestParameter GatewayFilteræ¥åœ¨è½¬å‘æ—¶æ·»åŠ è¯·æ±‚çš„å‚æ•°ã€‚ application.xml spring: cloud: gateway: routes: - id: add_request_parameter_route uri: http://example.org filters: - AddRequestParameter=foo, bar è¿™æ ·ä»¥æ¥å°±ä¼šç»™æ¯ä¸ªè¯·æ±‚éƒ½åŠ ä¸Šfoo=bar ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:9:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"è·¯ç”±è½¬å‘ æˆ‘ä»¬åœ¨é…ç½®ä¸­ï¼ŒæŒ‡å®šè½¬å‘çš„å¯¹è±¡éƒ½æ˜¯ç›´æ¥ä½¿ç”¨uriçš„ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“å¾®æœåŠ¡ä¸­æœåŠ¡æä¾›è€…é€šå¸¸éƒ½æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œæ‰€ä»¥ä¸ºäº†åº”å¯¹è¿™æ ·çš„æƒ…å†µï¼Œå¯ä»¥ä¿®æ”¹uriä¸ºæŒ‡å®šåº”ç”¨çš„åç§°ã€‚ #æ ¼å¼ä¸ºï¼šlb://åº”ç”¨æ³¨å†ŒæœåŠ¡å uri: lb://producer è¿™é‡Œå…¶å®é»˜è®¤ä½¿ç”¨äº†å…¨å±€è¿‡æ»¤å™¨ LoadBalancerClient ï¼Œå½“è·¯ç”±é…ç½®ä¸­ uri æ‰€ç”¨çš„åè®®ä¸º lb æ—¶ï¼ˆä»¥uri: lb://producerä¸ºä¾‹ï¼‰ï¼Œgateway å°†ä½¿ç”¨ LoadBalancerClient æŠŠ spring-cloud-producer é€šè¿‡ eureka è§£æä¸ºå®é™…çš„ä¸»æœºå’Œç«¯å£ï¼Œå¹¶è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚ ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:10:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"ä¿®æ”¹è¯·æ±‚è·¯å¾„ StripPrefix Filter æ˜¯ä¸€ä¸ªè¯·æ±‚è·¯å¾„æˆªå–çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªåŠŸèƒ½æ¥åšç‰¹æ®Šä¸šåŠ¡çš„è½¬å‘ application.xml spring: cloud: gateway: routes: - id: nameRoot uri: http://nameservice predicates: - Path=/name/** filters: - StripPrefix=2 ä¸Šé¢è¿™ä¸ªé…ç½®çš„ä¾‹å­è¡¨ç¤ºï¼Œå½“è¯·æ±‚è·¯å¾„åŒ¹é…åˆ°/name/**ä¼šå°†åŒ…å«nameå’Œåè¾¹çš„å­—ç¬¦ä¸²æ¥å»æ‰è½¬å‘ï¼Œ StripPrefix=2å°±ä»£è¡¨æˆªå–è·¯å¾„çš„ä¸ªæ•°ï¼Œè¿™æ ·é…ç½®åå½“è¯·æ±‚/name/bar/fooåç«¯åŒ¹é…åˆ°çš„è¯·æ±‚è·¯å¾„å°±ä¼šå˜æˆhttp://nameservice/fooã€‚ PrefixPath Filter çš„ä½œç”¨å’Œ StripPrefix æ­£ç›¸åï¼Œæ˜¯åœ¨ URL è·¯å¾„å‰é¢æ·»åŠ ä¸€éƒ¨åˆ†çš„å‰ç¼€ã€‚ ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:11:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"è·¯ç”±é™æµ ä¸ºäº†åº”å¯¹æœåŠ¡ä¸­é™é€Ÿçš„éœ€æ±‚ï¼Œspring cloud gateway æä¾›äº†ç»“åˆ redis æ•°æ®åº“çš„é™æµæ–¹æ¡ˆï¼Œå®ƒéœ€è¦æ·»åŠ å¯¹åº”çš„ä¾èµ–åŒ…spring-boot-starter-data-redis-reactive pom.xml \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-data-redis-reactive\u003c/artifactId\u003e \u003c/dependency\u003e application.yml spring: application: name: gateway redis: host: localhost password: port: 6379 cloud: gateway: discovery: locator: enabled: true routes: - id: requestratelimiter_route uri: http://example.org filters: - name: RequestRateLimiter args: redis-rate-limiter.replenishRate: 10 redis-rate-limiter.burstCapacity: 20 key-resolver: \"#{@userKeyResolver}\" predicates: - Method=GET filter åç§°å¿…é¡»æ˜¯ RequestRateLimiter redis-rate-limiter.replenishRateï¼šå…è®¸ç”¨æˆ·æ¯ç§’å¤„ç†å¤šå°‘ä¸ªè¯·æ±‚ redis-rate-limiter.burstCapacityï¼šä»¤ç‰Œæ¡¶çš„å®¹é‡ï¼Œå…è®¸åœ¨ä¸€ç§’é’Ÿå†…å®Œæˆçš„æœ€å¤§è¯·æ±‚æ•° key-resolverï¼šä½¿ç”¨ SpEL æŒ‰åç§°å¼•ç”¨ bean æ·»åŠ é…ç½®ç±»Config.java @Component public class Config { // æ ¹æ®è¯·æ±‚å‚æ•°ä¸­çš„ user å­—æ®µæ¥é™æµ @Primary @Bean public KeyResolver userKeyResolver() { return exchange -\u003e Mono.just(exchange.getRequest().getQueryParams().getFirst(\"user\")); } // è®¾ç½®æ ¹æ®è¯·æ±‚ IP åœ°å€æ¥é™æµ @Bean public KeyResolver ipKeyResolver() { return exchange -\u003e Mono.just(exchange.getRequest().getRemoteAddress().getHostName()); } } ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:12:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"ç†”æ–­å™¨ åŒæ ·çš„ï¼Œä½¿ç”¨Filterçš„ç‰¹æ€§ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å®ç°ç†”æ–­å™¨çš„åŠŸèƒ½ã€‚é¦–å…ˆæ·»åŠ ä¾èµ–åŒ…ï¼š pom.xml \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-netflix-hystrix\u003c/artifactId\u003e \u003c/dependency\u003e ç„¶åæ·»åŠ ç†”æ–­å™¨çš„é…ç½® application.yml spring: cloud: gateway: routes: - id: hystrix_route uri: lb://producer predicates: - Path=/consumingserviceendpoint filters: - Hystrix=myCommandName - name: Hystrix args: name: fallbackcmd fallbackUri: forward:/incaseoffailureusethis é…ç½®ågateway å°†ä½¿ç”¨ myCommandName ä½œä¸ºåç§°ç”Ÿæˆ HystrixCommand å¯¹è±¡æ¥è¿›è¡Œç†”æ–­ç®¡ç†ï¼ŒfallbackUri: forward:/incaseoffailureusethisé…ç½®äº† fallback æ—¶è¦ä¼šè°ƒçš„è·¯å¾„ï¼Œå½“è°ƒç”¨ Hystrix çš„ fallback è¢«è°ƒç”¨æ—¶ï¼Œè¯·æ±‚å°†è½¬å‘åˆ°/incaseoffailureusetè¿™ä¸ª URIã€‚ ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:13:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"è·¯ç”±é‡è¯• RetryGatewayFilter æ˜¯ Spring Cloud Gateway å¯¹è¯·æ±‚é‡è¯•æä¾›çš„ä¸€ä¸ª GatewayFilter Factory æ·»åŠ é…ç½® application.yml spring: cloud: gateway: routes: - id: retry_test uri: http://localhost:8080/flakey predicates: - Host=*.retry.com filters: - name: Retry args: retries: 3 statuses: BAD_GATEWAY backoff: firstBackoff: 10ms maxBackoff: 50ms factor: 2 basedOnPreviousValue: false retriesï¼šåº”å°è¯•çš„é‡è¯•æ¬¡æ•° statusesï¼šåº”è¯¥é‡è¯•çš„HTTPçŠ¶æ€ä»£ç ï¼Œå–å€¼å‚è€ƒorg.springframework.http.HttpStatus methodsï¼šåº”è¯¥é‡è¯•çš„HTTPæ–¹æ³•ï¼Œå–å€¼å‚è€ƒorg.springframework.http.HttpMethod seriesï¼šè¦é‡è¯•çš„ä¸€ç³»åˆ—çŠ¶æ€ä»£ç ï¼Œå–å€¼å‚è€ƒorg.springframework.http.HttpStatus.Series exceptionsï¼šåº”è¯¥é‡è¯•çš„å¼‚å¸¸åˆ—è¡¨ backoffï¼šé‡è¯•æ—¶é—´é—´éš”ã€‚ åœ¨firstBackoff xï¼ˆå› å­nï¼‰çš„é—´éš”ä¹‹åæ‰§è¡Œé‡è¯•ï¼Œå…¶ä¸­næ˜¯é‡è¯•çš„æ¬¡æ•°ã€‚ å¦‚æœé…ç½®äº†maxBackoffï¼Œåˆ™åº”ç”¨çš„æœ€å¤§é—´éš”å°†é™åˆ¶ä¸ºmaxBackoffã€‚ å¦‚æœbasedOnPreviousValueä¸ºtrueï¼Œåˆ™ä½¿ç”¨prevBackoff x factorè®¡ç®—é—´éš”ã€‚ ","date":"2019-08-18","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/:14:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸ƒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%83/"},{"categories":["å¾®æœåŠ¡"],"content":"æœ¬ç¯‡æˆ‘ä»¬å°±æ¥è®¤è¯†ä¸‹spring cloudä¸­çš„zuulç»„ä»¶. æ³¨:è¿™ä¸€ä¸ªç³»åˆ—çš„å¼€å‘ç¯å¢ƒç‰ˆæœ¬ä¸º java1.8, spring boot2.x, spring cloud Greenwich.SR2, IDEä¸º Intelli IDEA zuulç®€ä»‹ ","date":"2019-08-16","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/:0:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå…­","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/"},{"categories":["å¾®æœåŠ¡"],"content":"å…³äºzuul å…¶å®åœ¨å‰é¢çš„å†…å®¹ä¸­,æˆ‘ä»¬å·²ç»æ­å»ºäº†ä¸€ä¸ªå¾®æœåŠ¡å¹³å°,ä¹Ÿå®ç°äº†è¯¥æœ‰çš„åŠŸèƒ½.ä½†æ˜¯ä¸€èˆ¬çš„å¾®æœåŠ¡æ¶æ„ä¸­è¿˜ä¼šæœ‰api gateway.é‚£ä¹ˆapi gateway(ç½‘å…³)åˆæ˜¯åšä»€ä¹ˆç”¨çš„å‘¢? 1ã€ç®€åŒ–å®¢æˆ·ç«¯è°ƒç”¨å¤æ‚åº¦ åœ¨å¾®æœåŠ¡æ¶æ„æ¨¡å¼ä¸‹åç«¯æœåŠ¡çš„å®ä¾‹æ•°ä¸€èˆ¬æ˜¯åŠ¨æ€çš„ï¼Œå¯¹äºå®¢æˆ·ç«¯è€Œè¨€å¾ˆéš¾å‘ç°åŠ¨æ€æ”¹å˜çš„æœåŠ¡å®ä¾‹çš„è®¿é—®åœ°å€ä¿¡æ¯ã€‚å› æ­¤åœ¨åŸºäºå¾®æœåŠ¡çš„é¡¹ç›®ä¸­ä¸ºäº†ç®€åŒ–å‰ç«¯çš„è°ƒç”¨é€»è¾‘ï¼Œé€šå¸¸ä¼šå¼•å…¥API Gatewayä½œä¸ºè½»é‡çº§ç½‘å…³ï¼ŒåŒæ—¶API Gatewayä¸­ä¹Ÿä¼šå®ç°ç›¸å…³çš„è®¤è¯é€»è¾‘ä»è€Œç®€åŒ–å†…éƒ¨æœåŠ¡ä¹‹é—´ç›¸äº’è°ƒç”¨çš„å¤æ‚åº¦ã€‚ 2ã€æ•°æ®è£å‰ªä»¥åŠèšåˆ é€šå¸¸è€Œè¨€ä¸åŒçš„å®¢æˆ·ç«¯å¯¹äºæ˜¾ç¤ºæ—¶å¯¹äºæ•°æ®çš„éœ€æ±‚æ˜¯ä¸ä¸€è‡´çš„ï¼Œæ¯”å¦‚æ‰‹æœºç«¯æˆ–è€…Webç«¯åˆæˆ–è€…åœ¨ä½å»¶è¿Ÿçš„ç½‘ç»œç¯å¢ƒæˆ–è€…é«˜å»¶è¿Ÿçš„ç½‘ç»œç¯å¢ƒã€‚ å› æ­¤ä¸ºäº†ä¼˜åŒ–å®¢æˆ·ç«¯çš„ä½¿ç”¨ä½“éªŒï¼ŒAPI Gatewayå¯ä»¥å¯¹é€šç”¨æ€§çš„å“åº”æ•°æ®è¿›è¡Œè£å‰ªä»¥é€‚åº”ä¸åŒå®¢æˆ·ç«¯çš„ä½¿ç”¨éœ€æ±‚ã€‚åŒæ—¶è¿˜å¯ä»¥å°†å¤šä¸ªAPIè°ƒç”¨é€»è¾‘è¿›è¡Œèšåˆï¼Œä»è€Œå‡å°‘å®¢æˆ·ç«¯çš„è¯·æ±‚æ•°ï¼Œä¼˜åŒ–å®¢æˆ·ç«¯ç”¨æˆ·ä½“éªŒ 3ã€å¤šæ¸ é“æ”¯æŒ å½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥é’ˆå¯¹ä¸åŒçš„æ¸ é“å’Œå®¢æˆ·ç«¯æä¾›ä¸åŒçš„API Gateway,å¯¹äºè¯¥æ¨¡å¼çš„ä½¿ç”¨ç”±å¦å¤–ä¸€ä¸ªå¤§å®¶ç†ŸçŸ¥çš„æ–¹å¼å«Backend for front-end, åœ¨Backend for front-endæ¨¡å¼å½“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é’ˆå¯¹ä¸åŒçš„å®¢æˆ·ç«¯åˆ†åˆ«åˆ›å»ºå…¶BFFï¼Œè¿›ä¸€æ­¥äº†è§£BFFå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼šPattern: Backends For Frontends 4ã€é—ç•™ç³»ç»Ÿçš„å¾®æœåŠ¡åŒ–æ”¹é€  å¯¹äºç³»ç»Ÿè€Œè¨€è¿›è¡Œå¾®æœåŠ¡æ”¹é€ é€šå¸¸æ˜¯ç”±äºåŸæœ‰çš„ç³»ç»Ÿå­˜åœ¨æˆ–å¤šæˆ–å°‘çš„é—®é¢˜ï¼Œæ¯”å¦‚æŠ€æœ¯å€ºåŠ¡ï¼Œä»£ç è´¨é‡ï¼Œå¯ç»´æŠ¤æ€§ï¼Œå¯æ‰©å±•æ€§ç­‰ç­‰ã€‚API Gatewayçš„æ¨¡å¼åŒæ ·é€‚ç”¨äºè¿™ä¸€ç±»é—ç•™ç³»ç»Ÿçš„æ”¹é€ ï¼Œé€šè¿‡å¾®æœåŠ¡åŒ–çš„æ”¹é€ é€æ­¥å®ç°å¯¹åŸæœ‰ç³»ç»Ÿä¸­çš„é—®é¢˜çš„ä¿®å¤ï¼Œä»è€Œæå‡å¯¹äºåŸæœ‰ä¸šåŠ¡å“åº”åŠ›çš„æå‡ã€‚é€šè¿‡å¼•å…¥æŠ½è±¡å±‚ï¼Œé€æ­¥ä½¿ç”¨æ–°çš„å®ç°æ›¿æ¢æ—§çš„å®ç°ã€‚ åœ¨Spring Cloudä½“ç³»ä¸­ï¼Œ Spring Cloud Zuulå°±æ˜¯æä¾›è´Ÿè½½å‡è¡¡ã€åå‘ä»£ç†ã€æƒé™è®¤è¯çš„ä¸€ä¸ªAPI gatewayã€‚ æ³¨: ä»¥ä¸Šå¼•ç”¨äº http://www.ityouknow.com/springcloud/2017/06/01/gateway-service-zuul.html Spring Cloud Zuulè·¯ç”±æ˜¯å¾®æœåŠ¡æ¶æ„çš„ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ï¼Œæä¾›åŠ¨æ€è·¯ç”±ï¼Œç›‘æ§ï¼Œå¼¹æ€§ï¼Œå®‰å…¨ç­‰çš„è¾¹ç¼˜æœåŠ¡ã€‚Zuulæ˜¯Netflixå‡ºå“çš„ä¸€ä¸ªåŸºäºJVMè·¯ç”±å’ŒæœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡å™¨ã€‚ spring cloud zuul åˆä½¿ç”¨ åœ¨äº†è§£äº†gatewayçš„ä½œç”¨å’Œzuulä¹‹å,æˆ‘ä»¬å°±æ¥å®ç°å®ƒ: ","date":"2019-08-16","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/:1:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå…­","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/"},{"categories":["å¾®æœåŠ¡"],"content":"æ·»åŠ ä¾èµ– \u003cproperties\u003e \u003cjava.version\u003e1.8\u003c/java.version\u003e \u003cspring-cloud.version\u003eGreenwich.SR2\u003c/spring-cloud.version\u003e \u003c/properties\u003e \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-netflix-zuul\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-test\u003c/artifactId\u003e \u003cscope\u003etest\u003c/scope\u003e \u003c/dependency\u003e \u003c/dependencies\u003e \u003cdependencyManagement\u003e \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-dependencies\u003c/artifactId\u003e \u003cversion\u003e${spring-cloud.version}\u003c/version\u003e \u003ctype\u003epom\u003c/type\u003e \u003cscope\u003eimport\u003c/scope\u003e \u003c/dependency\u003e \u003c/dependencies\u003e \u003c/dependencyManagement\u003e ","date":"2019-08-16","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/:2:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå…­","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/"},{"categories":["å¾®æœåŠ¡"],"content":"é…ç½®æ–‡ä»¶ spring.application.name=zuul server.port=8888 #è¿™é‡Œçš„é…ç½®è¡¨ç¤ºï¼Œè®¿é—®/producer/** ç›´æ¥é‡å®šå‘åˆ°http://localhost:9000/** zuul.routes.producer.path=/producer/** zuul.routes.producer.url=http://localhost:9000/ ","date":"2019-08-16","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/:3:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå…­","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/"},{"categories":["å¾®æœåŠ¡"],"content":"å¯åŠ¨ç±» @SpringBootApplication @EnableZuulProxy public class ZuulApplication { public static void main(String[] args) { SpringApplication.run(ZuulApplication.class, args); } } ","date":"2019-08-16","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/:4:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå…­","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/"},{"categories":["å¾®æœåŠ¡"],"content":"æµ‹è¯• ç¼–è¯‘,å¯åŠ¨producerå’Œzuulè®¿é—®http://localhost:8888/producer/hello?name=xingyys, è¿”å›Hello xingyys ! æœåŠ¡åŒ– ä¸Šé¢çš„é…ç½®æœ‰å¾ˆå¤§çš„å±€é™æ€§,å› ä¸ºæ¯ä¸€ä¸ªæœåŠ¡éƒ½éœ€è¦å•ç‹¬çš„æ·»åŠ é…ç½®ä¿¡æ¯,å¦‚æœæœåŠ¡æ˜¯åŠ¨æ€çš„,å°±æ›´ä¸æ–¹ä¾¿äº†.å…¶å®æœåŠ¡å’Œurlçš„æ˜ å°„å…³ç³»åœ¨discoveryé‡Œå·²ç»å­˜åœ¨äº†,æ‰€ä»¥åªéœ€è¦å°†Zuulæ³¨å†Œåˆ°eureka serverä¸Šå»å‘ç°å…¶ä»–æœåŠ¡ï¼Œå°±å¯ä»¥å®ç°å¯¹serviceIdçš„æ˜ å°„.ä¸‹é¢æˆ‘ä»¬å°±æ¥å®ç°å®ƒ! ","date":"2019-08-16","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/:5:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå…­","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/"},{"categories":["å¾®æœåŠ¡"],"content":"æ·»åŠ ä¾èµ– \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-netflix-eureka-server\u003c/artifactId\u003e \u003c/dependency\u003e ","date":"2019-08-16","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/:6:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå…­","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/"},{"categories":["å¾®æœåŠ¡"],"content":"é…ç½®æ–‡ä»¶ ä¿®æ”¹é…ç½®æ–‡ä»¶,æ·»åŠ discoveryçš„é…ç½® spring.application.name=zuul server.port=8888 eureka.client.service-url.defaultZone=http://localhost:8000/eureka/ #è¿™é‡Œçš„é…ç½®è¡¨ç¤ºï¼Œè®¿é—®/producer/** ç›´æ¥é‡å®šå‘åˆ°http://localhost:9000/** # zuul.routes.producer.path=/producer/** # zuul.routes.producer.url=http://localhost:9000/ å› ä¸ºæœåŠ¡å’Œurlçš„æ˜ å°„ä¿¡æ¯å·²ç»å­˜åœ¨,æ‰€æœ‰åŸæ¥çš„é…ç½®å¯ä»¥åˆ é™¤. ","date":"2019-08-16","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/:7:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå…­","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/"},{"categories":["å¾®æœåŠ¡"],"content":"å¯åŠ¨ç±» å¼€å¯æœåŠ¡æ³¨å†Œ @SpringBootApplication @EnableZuulProxy @EnableDiscoveryClient public class ZuulApplication { public static void main(String[] args) { SpringApplication.run(ZuulApplication.class, args); } } ","date":"2019-08-16","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/:8:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå…­","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/"},{"categories":["å¾®æœåŠ¡"],"content":"æµ‹è¯• é‡æ–°ç¼–è¯‘,å¯åŠ¨discovery, producerå’Œzuul,è®¿é—®http://localhost:8888/producer/hello?name=xingyys, è¿”å›Hello xingyys ! zuul é«˜çº§åº”ç”¨ zuulé™¤äº†ä¹‹å‰ä½¿ç”¨çš„ç½‘å…³å’Œè·¯ç”±è½¬å‘ä¹‹å¤–,è¿˜æœ‰æ›´å¤šçš„ä½¿ç”¨åœºæ™¯,å¦‚é‰´æƒ,æµé‡è½¬å‘,è¯·æ±‚ç»Ÿè®¡ç­‰ç­‰. ","date":"2019-08-16","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/:9:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå…­","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/"},{"categories":["å¾®æœåŠ¡"],"content":"zuul çš„ Filter Filteræ˜¯Zuulçš„æ ¸å¿ƒï¼Œç”¨æ¥å®ç°å¯¹å¤–æœåŠ¡çš„æ§åˆ¶ã€‚Filterçš„ç”Ÿå‘½å‘¨æœŸæœ‰4ä¸ªï¼Œåˆ†åˆ«æ˜¯â€œPREâ€ã€â€œROUTINGâ€ã€â€œPOSTâ€ã€â€œERRORâ€ï¼Œæ•´ä¸ªç”Ÿå‘½å‘¨æœŸå¯ä»¥ç”¨ä¸‹å›¾æ¥è¡¨ç¤ºã€‚ Zuulå¤§éƒ¨åˆ†åŠŸèƒ½éƒ½æ˜¯é€šè¿‡è¿‡æ»¤å™¨æ¥å®ç°çš„ï¼Œè¿™äº›è¿‡æ»¤å™¨ç±»å‹å¯¹åº”äºè¯·æ±‚çš„å…¸å‹ç”Ÿå‘½å‘¨æœŸã€‚ PREï¼š è¿™ç§è¿‡æ»¤å™¨åœ¨è¯·æ±‚è¢«è·¯ç”±ä¹‹å‰è°ƒç”¨ã€‚æˆ‘ä»¬å¯åˆ©ç”¨è¿™ç§è¿‡æ»¤å™¨å®ç°èº«ä»½éªŒè¯ã€åœ¨é›†ç¾¤ä¸­é€‰æ‹©è¯·æ±‚çš„å¾®æœåŠ¡ã€è®°å½•è°ƒè¯•ä¿¡æ¯ç­‰ã€‚ ROUTINGï¼šè¿™ç§è¿‡æ»¤å™¨å°†è¯·æ±‚è·¯ç”±åˆ°å¾®æœåŠ¡ã€‚è¿™ç§è¿‡æ»¤å™¨ç”¨äºæ„å»ºå‘é€ç»™å¾®æœåŠ¡çš„è¯·æ±‚ï¼Œå¹¶ä½¿ç”¨Apache HttpClientæˆ–Netfilx Ribbonè¯·æ±‚å¾®æœåŠ¡ã€‚ POSTï¼šè¿™ç§è¿‡æ»¤å™¨åœ¨è·¯ç”±åˆ°å¾®æœåŠ¡ä»¥åæ‰§è¡Œã€‚è¿™ç§è¿‡æ»¤å™¨å¯ç”¨æ¥ä¸ºå“åº”æ·»åŠ æ ‡å‡†çš„HTTP Headerã€æ”¶é›†ç»Ÿè®¡ä¿¡æ¯å’ŒæŒ‡æ ‡ã€å°†å“åº”ä»å¾®æœåŠ¡å‘é€ç»™å®¢æˆ·ç«¯ç­‰ã€‚ ERRORï¼šåœ¨å…¶ä»–é˜¶æ®µå‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡Œè¯¥è¿‡æ»¤å™¨ã€‚ é™¤äº†é»˜è®¤çš„è¿‡æ»¤å™¨ç±»å‹ï¼ŒZuulè¿˜å…è®¸æˆ‘ä»¬åˆ›å»ºè‡ªå®šä¹‰çš„è¿‡æ»¤å™¨ç±»å‹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®šåˆ¶ä¸€ç§STATICç±»å‹çš„è¿‡æ»¤å™¨ï¼Œç›´æ¥åœ¨Zuulä¸­ç”Ÿæˆå“åº”ï¼Œè€Œä¸å°†è¯·æ±‚è½¬å‘åˆ°åç«¯çš„å¾®æœåŠ¡ã€‚ ","date":"2019-08-16","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/:10:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå…­","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/"},{"categories":["å¾®æœåŠ¡"],"content":"zuulä¸­é»˜è®¤çš„filter ","date":"2019-08-16","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/:11:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå…­","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/"},{"categories":["å¾®æœåŠ¡"],"content":"è‡ªå®šä¹‰Filter å¦‚æœè¦è‡ªå®šä¹‰Filter,éœ€è¦ç»§æ‰¿ZuulFiilterç±»,å¹¶å®ç°ä»¥ä¸‹æ–¹æ³•: public class MyFilter extends ZuulFilter { @Override String filterType() { return \"pre\"; //å®šä¹‰filterçš„ç±»å‹ï¼Œæœ‰preã€routeã€postã€errorå››ç§ } @Override int filterOrder() { return 10; //å®šä¹‰filterçš„é¡ºåºï¼Œæ•°å­—è¶Šå°è¡¨ç¤ºé¡ºåºè¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œ } @Override boolean shouldFilter() { return true; //è¡¨ç¤ºæ˜¯å¦éœ€è¦æ‰§è¡Œè¯¥filterï¼Œtrueè¡¨ç¤ºæ‰§è¡Œï¼Œfalseè¡¨ç¤ºä¸æ‰§è¡Œ } @Override Object run() { return null; //filteréœ€è¦æ‰§è¡Œçš„å…·ä½“æ“ä½œ } } æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è‡ªå®šä¹‰ä¸€ä¸ªFilter,è®©è¯·æ±‚å¿…é¡»å¸¦ä¸Štoken public class TokenFilter extends ZuulFilter { private final Logger logger = LoggerFactory.getLogger(TokenFilter.class); @Override public String filterType() { return \"pre\"; // å¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±ä¹‹å‰è°ƒç”¨ } @Override public int filterOrder() { return 0; // filteræ‰§è¡Œé¡ºåºï¼Œé€šè¿‡æ•°å­—æŒ‡å®š ,ä¼˜å…ˆçº§ä¸º0ï¼Œæ•°å­—è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šä½ } @Override public boolean shouldFilter() { return true; // æ˜¯å¦æ‰§è¡Œè¯¥è¿‡æ»¤å™¨ï¼Œæ­¤å¤„ä¸ºtrueï¼Œè¯´æ˜éœ€è¦è¿‡æ»¤ } @Override public Object run() throws ZuulException { RequestContext ctx = RequestContext.getCurrentContext(); HttpServletRequest request = ctx.getRequest(); logger.info(\"---\u003e\u003e\u003e TokenFilter {},{}\", request.getMethod(), request.getRequestURL().toString()); String token = request.getParameter(\"token\"); if (StringUtils.isNotBlank(token)) { ctx.setSendZuulResponse(true); //å¯¹è¯·æ±‚è¿›è¡Œè·¯ç”± ctx.setResponseStatusCode(200); ctx.set(\"isSuccess\", true); } else { ctx.setSendZuulResponse(false); //ä¸å¯¹è¯·æ±‚è¿›è¡Œè·¯ç”± ctx.setResponseStatusCode(400); ctx.setResponseBody(\"token is empty\"); ctx.set(\"isSuccess\", false); } return null; } } å°†è¯·æ±‚æ·»åŠ åˆ°æ‹¦æˆªåˆ—é˜Ÿ @SpringBootApplication @EnableZuulProxy @EnableDiscoveryClient public class ZuulApplication { @Bean public TokenFilter tokenFilter() { return new TokenFilter(); } public static void main(String[] args) { SpringApplication.run(ZuulApplication.class, args); } } ç„¶åæˆ‘ä»¬ä¾æ¬¡å¯åŠ¨discovery,producerå’Œzuul, è®¿é—®http://localhost:8888/producer/hello?name=xingyysè¿”å›token is empty. è®¿é—®http://localhost:8888/producer/hello?name=xingyys\u0026token=xingyys, è¿”å›Hello xingyys !,è¯´æ˜Filterå·²ç»ç”Ÿæ•ˆäº†. ç”±æ­¤çœ‹å‡º,PREè¿è¡Œåœ¨è¯·æ±‚å‰,åˆ©ç”¨å®ƒæˆ‘ä»¬å¯ä»¥ç»“åˆä¸€ä¸ªé‰´æƒçš„ç¬¬ä¸‰æ–¹åº“ä½œç”¨æˆ·éªŒè¯. ","date":"2019-08-16","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/:12:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå…­","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/"},{"categories":["å¾®æœåŠ¡"],"content":"è·¯ç”±çš„ç†”æ–­ æœ‰æ—¶å½“è¯·æ±‚é”™è¯¯æ—¶,æˆ‘ä»¬ä¸å¸Œæœ›å°†å¼‚å¸¸ç›´æ¥æŠ›ç»™æœ€å¤–å±‚,è€Œæ˜¯è®©é”™è¯¯é™ä¸€çº§,zuulå°±æä¾›äº†æ­¤åŠŸèƒ½,å½“åç«¯æœåŠ¡å¼‚å¸¸æ—¶,æŠ›å‡ºæˆ‘ä»¬é¢„è®¾çš„ä¿¡æ¯. zuulä½¿ç”¨fallbackå®ç°å¼‚å¸¸çš„é™çº§,é€šè¿‡è‡ªå®šä¹‰çš„fallbackæ–¹æ³•,å¹¶ä¸”å°†å…¶æŒ‡å®šç»™æŸä¸ªrouteæ¥å®ç°è¯¥routeè®¿é—®å‡ºé—®é¢˜çš„ç†”æ–­å¤„ç†ã€‚ä¸»è¦ç»§æ‰¿ZuulFallbackProvideræ¥å£æ¥å®ç°ï¼ŒZuulFallbackProvideré»˜è®¤æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªç”¨æ¥æŒ‡æ˜ç†”æ–­æ‹¦æˆªå“ªä¸ªæœåŠ¡ï¼Œä¸€ä¸ªå®šåˆ¶è¿”å›å†…å®¹ã€‚ public interface ZuulFallbackProvider { /** * The route this fallback will be used for. * @return The route the fallback will be used for. */ public String getRoute(); /** * Provides a fallback response. * @return The fallback response. */ public ClientHttpResponse fallbackResponse(); } å®ç°ç±»é€šè¿‡å®ç°getRouteæ–¹æ³•ï¼Œå‘Šè¯‰Zuulå®ƒæ˜¯è´Ÿè´£å“ªä¸ªrouteå®šä¹‰çš„ç†”æ–­ã€‚è€ŒfallbackResponseæ–¹æ³•åˆ™æ˜¯å‘Šè¯‰ Zuul æ–­è·¯å‡ºç°æ—¶ï¼Œå®ƒä¼šæä¾›ä¸€ä¸ªä»€ä¹ˆè¿”å›å€¼æ¥å¤„ç†è¯·æ±‚ã€‚ åæ¥Springåˆæ‰©å±•äº†æ­¤ç±»ï¼Œä¸°å¯Œäº†è¿”å›æ–¹å¼ï¼Œåœ¨è¿”å›çš„å†…å®¹ä¸­æ·»åŠ äº†å¼‚å¸¸ä¿¡æ¯ï¼Œå› æ­¤æœ€æ–°ç‰ˆæœ¬å»ºè®®ç›´æ¥ç»§æ‰¿ç±»FallbackProvider ã€‚ æˆ‘ä»¬ä»¥ä¸Šé¢çš„produceræœåŠ¡ä¸ºä¾‹ï¼Œå®šåˆ¶å®ƒçš„ç†”æ–­è¿”å›å†…å®¹ã€‚ @Component public class ProducerFallBack implements FallbackProvider { private final Logger logger = LoggerFactory.getLogger(FallbackProvider.class); // æŒ‡å®šè¦å¤„ç†çš„service @Override public String getRoute() { return \"producer\"; } public ClientHttpResponse fallbackResponse() { return new ClientHttpResponse() { @Override public HttpStatus getStatusCode() throws IOException { return HttpStatus.OK; } @Override public int getRawStatusCode() throws IOException { return 200; } @Override public String getStatusText() throws IOException { return \"OK\"; } @Override public void close() { } @Override public InputStream getBody() throws IOException { return new ByteArrayInputStream(\"The service is unavailable\".getBytes()); } @Override public HttpHeaders getHeaders() { HttpHeaders headers = new HttpHeaders(); headers.setContentType(MediaType.APPLICATION_JSON); return headers; } }; } @Override public ClientHttpResponse fallbackResponse(String route, Throwable cause) { if (cause != null \u0026\u0026 cause.getCause() != null) { String reason = cause.getCause().getMessage(); logger.info(\"Exception {}\", reason); } return fallbackResponse(); } } é‡æ–°ç¼–è¯‘å¯åŠ¨zuulå,æˆ‘ä»¬å…³é—­producer,å¹¶è®¿é—®http://localhost:8888/producer/hello?name=xingyys\u0026token=xingyys, è¿”å›The service is unavailable.å¯è§é”™è¯¯å¤„ç†æˆåŠŸäº†. Zuul ç›®å‰åªæ”¯æŒæœåŠ¡çº§åˆ«çš„ç†”æ–­ï¼Œä¸æ”¯æŒå…·ä½“åˆ°æŸä¸ªURLè¿›è¡Œç†”æ–­ã€‚ æ³¨: ä»¥ä¸Šå¤§é‡å‡ºè‡ª http://www.ityouknow.com ","date":"2019-08-16","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/:13:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå…­","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/"},{"categories":["å¾®æœåŠ¡"],"content":"è·¯ç”±é‡è¯• ç”±äºæœ¬ç³»åˆ—çš„å¼€å‘ç¯å¢ƒæ˜¯spring boot 2.xçš„, è€Œzuulè¿˜æ˜¯1.xç‰ˆæœ¬çš„,ä»¥ä¸Šçš„åŠŸèƒ½è¿˜æ˜¯å¯ä»¥ä½¿ç”¨çš„.ä½†æ˜¯è·¯ç”±é‡è¯•åŠŸèƒ½ç»æµ‹è¯•ä¸èƒ½ç”Ÿæ•ˆ,æ‰€ä»¥å°±å±•ç¤ºé…ç½®å’Œä»£ç . ","date":"2019-08-16","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/:14:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå…­","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/"},{"categories":["å¾®æœåŠ¡"],"content":"ä¾èµ– \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.retry\u003c/groupId\u003e \u003cartifactId\u003espring-retry\u003c/artifactId\u003e \u003c/dependency\u003e ","date":"2019-08-16","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/:14:1","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå…­","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/"},{"categories":["å¾®æœåŠ¡"],"content":"é…ç½® #æ˜¯å¦å¼€å¯é‡è¯•åŠŸèƒ½ zuul.retryable=true #å¯¹å½“å‰æœåŠ¡çš„é‡è¯•æ¬¡æ•° ribbon.MaxAutoRetries=2 #åˆ‡æ¢ç›¸åŒServerçš„æ¬¡æ•° ribbon.MaxAutoRetriesNextServer=0 spring cloud 2.xç‰ˆæœ¬å·²ç»æ‹¥æœ‰è‡ªå·±çš„gatewayç»„ä»¶äº†,æ‰€ä»¥ä¸‹ä¸€ç¯‡æˆ‘ä»¬å°±æ¥å°è¯•spring cloud gateway ","date":"2019-08-16","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/:14:2","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå…­","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%85%AD/"},{"categories":["å¾®æœåŠ¡"],"content":"æœ¬ç¯‡æˆ‘ä»¬æ¥çœ‹çœ‹æ€ä¹ˆå®ç°spring cloudçš„é…ç½®ä¸­å¿ƒ. åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­,ç‰¹åˆ«æ˜¯å¾®æœåŠ¡æ¶æ„ä¸‹,å¯èƒ½ä¼šå­˜åœ¨è®¸å¤šçš„æœåŠ¡,æ¯ä¸ªæœåŠ¡éƒ½ä¼šå­˜åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªçš„é…ç½®æ–‡ä»¶.é‚£æ€ä¹ˆå¤šçš„é…ç½®æ–‡ä»¶çš„ç®¡ç†å°±ä¼šæˆä¸ºä¸€ä¸ªå¤§é—®é¢˜.åŒæ—¶,å¾®æœåŠ¡è¿è¡Œè¿‡ç¨‹ä¸­è¿˜éœ€è¦åŠ¨æ€çš„ä¿®æ”¹é…ç½®å‚æ•°.æ‰€ä»¥spring cloud configå°±æ˜¯åœ¨spring cloudå¾®æœåŠ¡æ¶æ„ä¸­è§£å†³é…ç½®æ–‡ä»¶çš„ç®¡ç†,åˆ·æ–°,æŸ¥çœ‹ç­‰é—®é¢˜çš„. æ³¨:è¿™ä¸€ä¸ªç³»åˆ—çš„å¼€å‘ç¯å¢ƒç‰ˆæœ¬ä¸º java1.8, spring boot2.x, spring cloud Greenwich.SR2, IDEä¸º Intelli IDEA spring cloud configå’Œgit æˆ‘ä»¬å…ˆæ¥ä¸€ä¸ªç®€å•çš„é…ç½®,åªæœ‰serverå’Œconfigçš„. ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:0:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"æ·»åŠ é…ç½®æ–‡ä»¶ åˆ›å»ºä¸€ä¸ªç›®å½•,ç›®å½•ä¸‹åˆ†åˆ«æ·»åŠ 3ä¸ªä¸åŒçš„é…ç½®æ–‡ä»¶ neo-config-dev.properties neo-config-pro.properties neo-config-test.properties é‡Œé¢çš„é…ç½®åˆ†åˆ«ä¸ºneo.hello=hello in dev/pro/test å¹¶å°†ç›®å½•ä¿å­˜åˆ°gitlee/githubä¸Š. è¿™é‡Œæˆ‘çš„åœ°å€æ˜¯ https://gitlee.com/xingyys/config-repo ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:1:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"server ç«¯ æ¥ä¸‹æ¥å¼€å§‹é…ç½®server ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:2:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"pom \u003cproperties\u003e \u003cjava.version\u003e1.8\u003c/java.version\u003e \u003cspring-cloud.version\u003eGreenwich.SR2\u003c/spring-cloud.version\u003e \u003c/properties\u003e \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-config-server\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-test\u003c/artifactId\u003e \u003cscope\u003etest\u003c/scope\u003e \u003c/dependency\u003e \u003c/dependencies\u003e \u003cdependencyManagement\u003e \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-dependencies\u003c/artifactId\u003e \u003cversion\u003e${spring-cloud.version}\u003c/version\u003e \u003ctype\u003epom\u003c/type\u003e \u003cscope\u003eimport\u003c/scope\u003e \u003c/dependency\u003e \u003c/dependencies\u003e \u003c/dependencyManagement\u003e ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:2:1","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"é…ç½®æ–‡ä»¶ server: port: 8001 spring: application: name: config-server cloud: config: server: git: uri: https://gitee.com/xingyys/config-repo # é…ç½®æ–‡ä»¶ä¿å­˜çš„ç›®å½•,ç”¨,åˆ†éš” search-paths: config-repo username: username password: password # å¿½ç•¥ssl, æˆ–è€…è‡ªè¡Œé…ç½®ç§˜é’¥ skip-ssl-validation: true Spring Cloud Configä¹Ÿæä¾›æœ¬åœ°å­˜å‚¨é…ç½®çš„æ–¹å¼ã€‚æˆ‘ä»¬åªéœ€è¦è®¾ç½®å±æ€§spring.profiles.active=nativeï¼ŒConfig Serverä¼šé»˜è®¤ä»åº”ç”¨çš„src/main/resourceç›®å½•ä¸‹æ£€ç´¢é…ç½®æ–‡ä»¶ã€‚ä¹Ÿå¯ä»¥é€šè¿‡spring.cloud.config.server.native.searchLocations=file:E:/properties/å±æ€§æ¥æŒ‡å®šé…ç½®æ–‡ä»¶çš„ä½ç½®ã€‚è™½ç„¶Spring Cloud Configæä¾›äº†è¿™æ ·çš„åŠŸèƒ½ï¼Œä½†æ˜¯ä¸ºäº†æ”¯æŒæ›´å¥½çš„ç®¡ç†å†…å®¹å’Œç‰ˆæœ¬æ§åˆ¶çš„åŠŸèƒ½ï¼Œè¿˜æ˜¯æ¨èä½¿ç”¨gitçš„æ–¹å¼ã€‚ ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:2:2","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"å¯åŠ¨ç±» æ·»åŠ æ³¨è§£@EnableConfigServer,å¯åŠ¨é…ç½®ä¸­å¿ƒæœåŠ¡ç«¯åŠŸèƒ½ @SpringBootApplication @EnableConfigServer public class ConfigServerApplication { public static void main(String[] args) { SpringApplication.run(ConfigServerApplication.class, args); } } ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:2:3","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"æµ‹è¯• ç›´æ¥ç¼–è¯‘æ‰“åŒ…å°±å¯ä»¥æµ‹è¯•äº†,ç›´æ¥è®¿é—®http://localhost:8001/neo-config/devè¿”å›: { \"name\": \"neo-config\", \"profiles\": [ \"dev\" ], \"label\": null, \"version\": null, \"state\": null, \"propertySources\": [ { \"name\": \"https://gitee.com/xingyys/config-repo/config-repo/neo-config-dev.properties\", \"source\": { \"neo.hello\": \"hello im dev\" } } ] } ä¸Šè¿°çš„è¿”å›çš„ä¿¡æ¯åŒ…å«äº†é…ç½®æ–‡ä»¶çš„ä½ç½®ã€ç‰ˆæœ¬ã€é…ç½®æ–‡ä»¶çš„åç§°ä»¥åŠé…ç½®æ–‡ä»¶ä¸­çš„å…·ä½“å†…å®¹ï¼Œè¯´æ˜serverç«¯å·²ç»æˆåŠŸè·å–äº†gitä»“åº“çš„é…ç½®ä¿¡æ¯ã€‚ ä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶ä¼šè¢«è½¬æ¢æˆwebæ¥å£ï¼Œè®¿é—®å¯ä»¥å‚ç…§ä»¥ä¸‹çš„è§„åˆ™ï¼š /{application}/{profile}[/{label}] /{application}-{profile}.yml /{label}/{application}-{profile}.yml /{application}-{profile}.properties /{label}/{application}-{profile}.properties ä»¥neo-config-dev.propertiesä¸ºä¾‹å­ï¼Œå®ƒçš„applicationæ˜¯neo-configï¼Œprofileæ˜¯devã€‚clientä¼šæ ¹æ®å¡«å†™çš„å‚æ•°æ¥é€‰æ‹©è¯»å–å¯¹åº”çš„é…ç½®ã€‚ ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:2:4","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"client ç«¯ ç”¨æ¥è·å–serverç«¯ä¸Šçš„é…ç½®ä¿¡æ¯ ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:3:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"pom \u003cproperties\u003e \u003cjava.version\u003e1.8\u003c/java.version\u003e \u003cspring-cloud.version\u003eGreenwich.SR2\u003c/spring-cloud.version\u003e \u003c/properties\u003e \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-config\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-web\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-test\u003c/artifactId\u003e \u003cscope\u003etest\u003c/scope\u003e \u003c/dependency\u003e \u003c/dependencies\u003e \u003cdependencyManagement\u003e \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-dependencies\u003c/artifactId\u003e \u003cversion\u003e${spring-cloud.version}\u003c/version\u003e \u003ctype\u003epom\u003c/type\u003e \u003cscope\u003eimport\u003c/scope\u003e \u003c/dependency\u003e \u003c/dependencies\u003e \u003c/dependencyManagement\u003e ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:3:1","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"é…ç½®æ–‡ä»¶ config clientçš„é…ç½®æ–‡ä»¶ä¸º bootstrap.properties spring.cloud.config.name=neo-config spring.cloud.config.profile=dev spring.cloud.config.uri=http://localhost:8001/ spring.cloud.config.label=master spring.application.name=config-client server.port=8002 spring.application.nameï¼šå¯¹åº”{application}éƒ¨åˆ† spring.cloud.config.profileï¼šå¯¹åº”{profile}éƒ¨åˆ† spring.cloud.config.labelï¼šå¯¹åº”gitçš„åˆ†æ”¯ã€‚å¦‚æœé…ç½®ä¸­å¿ƒä½¿ç”¨çš„æ˜¯æœ¬åœ°å­˜å‚¨ï¼Œåˆ™è¯¥å‚æ•°æ— ç”¨ spring.cloud.config.uriï¼šé…ç½®ä¸­å¿ƒçš„å…·ä½“åœ°å€ spring.cloud.config.discovery.service-idï¼šæŒ‡å®šé…ç½®ä¸­å¿ƒçš„service-idï¼Œä¾¿äºæ‰©å±•ä¸ºé«˜å¯ç”¨é…ç½®é›†ç¾¤ã€‚ è¿™äº›ä¸spring-cloudç›¸å…³çš„å±æ€§å¿…é¡»é…ç½®åœ¨bootstrap.propertiesä¸­ï¼Œconfigéƒ¨åˆ†å†…å®¹æ‰èƒ½è¢«æ­£ç¡®åŠ è½½ã€‚å› ä¸ºconfigçš„ç›¸å…³é…ç½®ä¼šå…ˆäºapplication.propertiesï¼Œè€Œbootstrap.propertiesçš„åŠ è½½ä¹Ÿæ˜¯å…ˆäºapplication.propertiesã€‚ ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:3:2","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"å¯åŠ¨ç±» @SpringBootApplication public class ConfigClientApplication { public static void main(String[] args) { SpringApplication.run(ConfigClientApplication.class, args); } } ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:3:3","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"æ¥å£ç±» @RestController public class HelloController { @Value(\"${neo.hello}\") private String hello; @RequestMapping(\"/hello\") public String from() { return this.hello; } } ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:3:4","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"æµ‹è¯• ç¼–è¯‘å¯åŠ¨config client, è®¿é—®http://192.168.1.13:8002/helloè¿”å›: hello im dev é…ç½®æˆåŠŸ! é…ç½®ä¸­å¿ƒ å‰é¢æˆ‘ä»¬å·²ç»é…ç½®config serverå’Œconfig client,è€Œä¸”ä¹Ÿå·²ç»å¯ä»¥ä½¿ç”¨äº†,ä½†æ˜¯å®ƒè¿˜åªèƒ½å•ç‹¬ä½¿ç”¨,æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œä¸€äº›æ”¹é€ ,ç”¨åœ¨å¾®æœåŠ¡æ¶æ„ä¸­. ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:3:5","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"æ³¨å†Œä¸­å¿ƒ è¿™é‡Œçš„æ³¨å†Œä¸­å¿ƒç›´æ¥ä½¿ç”¨å‰å‡ ç¯‡ç•™ä¸‹çš„å°±å¯ä»¥. ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:4:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"server ç«¯çš„æ”¹é€  ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:5:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"æ·»åŠ ä¾èµ– ... \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-netflix-eureka-server\u003c/artifactId\u003e \u003c/dependency\u003e ... ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:5:1","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"ä¿®æ”¹é…ç½®æ–‡ä»¶ ... eureka: client: service-url: defaultZone: http://localhost:8000/eureka/ ... ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:5:2","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"å¯åŠ¨ç±» æ·»åŠ æ³¨è§£@EnableDiscoveryClient: @SpringBootApplication @EnableConfigServer @EnableDiscoveryClient public class ConfigServerApplication { public static void main(String[] args) { SpringApplication.run(ConfigServerApplication.class, args); } } è®°å¾—é‡æ–°ç¼–è¯‘,å¯åŠ¨ ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:5:3","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"client ç«¯çš„æ”¹é€  ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:6:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"æ·»åŠ ä¾èµ– ... \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-netflix-eureka-server\u003c/artifactId\u003e \u003c/dependency\u003e ... ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:6:1","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"ä¿®æ”¹é…ç½®æ–‡ä»¶ åŒæ ·æ˜¯ bootstrap.properties spring.cloud.config.name=neo-config spring.cloud.config.profile=dev spring.cloud.config.label=master spring.cloud.config.discovery.enabled=true spring.cloud.config.discovery.serviceId=config-server eureka.client.serviceUrl.defaultZone=http://localhost:8000/eureka/ spring.application.name=config-client server.port=8002 ä¸»è¦æ˜¯å»æ‰äº†spring.cloud.config.uriç›´æ¥æŒ‡å‘serverç«¯åœ°å€çš„é…ç½®ï¼Œå¢åŠ äº†æœ€åçš„ä¸‰ä¸ªé…ç½®ï¼š spring.cloud.config.discovery.enabled ï¼šå¼€å¯ConfigæœåŠ¡å‘ç°æ”¯æŒ spring.cloud.config.discovery.serviceId ï¼šæŒ‡å®šserverç«¯çš„name,ä¹Ÿå°±æ˜¯serverç«¯spring.application.nameçš„å€¼ eureka.client.serviceUrl.defaultZone ï¼šæŒ‡å‘æ³¨å†Œä¸­å¿ƒçš„åœ°å€ ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:7:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"å¯åŠ¨ç±» @SpringBootApplication @EnableDiscoveryClient public class ConfigClientApplication { public static void main(String[] args) { SpringApplication.run(ConfigClientApplication.class, args); } } ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:7:1","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"æµ‹è¯• ä¸€æ¬¡å¯åŠ¨ discovery, config-serverå’Œconfig-client, è®¿é—®http://127.0.0.1:8000/ è®¿é—®http://localhost8002/hello, è¿”å›hello im dev . ç»“åˆæ¶ˆæ¯æ€»çº¿ å…¶å®ä¸Šé¢çš„é…ç½®è¿˜æœ‰ä¸€ä¸ªé—®é¢˜,å°±æ˜¯é…ç½®æ–‡ä»¶æ›´æ–°å,config clientä¸èƒ½åŒæ­¥æ›´æ–°,éœ€è¦é‡å¯.é’ˆå¯¹è¿™ä¸ªé—®é¢˜,å·²ç»æœ‰ä¸€äº›çš„è§£å†³æ–¹æ³•äº†,ä¸€ç§æ˜¯é…ç½® gitleeæˆ–githubçš„webhook,å¦ä¸€ç§å°±æ˜¯ä½¿ç”¨æ¶ˆæ¯æ€»çº¿.æˆ‘ä»¬å°±æ¥å°è¯•åè€…. spring cloudä¸­å¯ä»¥å’Œrabbitmqç»“åˆå®ç°. ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:8:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"å®‰è£…rabbitmq rabbitmqçš„å®‰è£…æ•™ç¨‹ç½‘ä¸Šæœ‰å¾ˆå¤š,è¿™é‡Œä¸ºäº†ç®€å•,æˆ‘ä»¬å°±ç›´æ¥ä½¿ç”¨dockeræ¥å®‰è£…. è¿™é‡Œæˆ‘å‡†å¤‡äº†ä¸€ä¸ªè™šæ‹Ÿæœº192.168.1.10, ä¸Šé¢å®‰è£…äº†docker # æ‹‰å–rabbitmqé•œåƒ docker pull rabbitmq:management # å¯åŠ¨é•œåƒ docker run -d -p 5672:5672 -p 15672:15672 --name rabbitmq rabbitmq:management æ‰§è¡ŒæˆåŠŸåç™»å½•rabbitmq, http://192.168.1.10/15672, ç”¨æˆ·å/å¯†ç ä¸º guest/guest. ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:9:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"client ç«¯çš„æ”¹é€  æ¥ä¸‹æ¥å°±æ˜¯ä¿®æ”¹clientç«¯äº† ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:10:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"æ·»åŠ ä¾èµ– ... \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-bus-amqp\u003c/artifactId\u003e \u003c/dependency\u003e ... ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:10:1","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"é…ç½®æ–‡ä»¶ ... ## æ·»åŠ é…ç½®åˆ·æ–°çš„æ¥å£url management.endpoints.web.exposure.include=bus-refresh ## å¼€å¯æ¶ˆæ¯è·Ÿè¸ª spring.cloud.bus.trace.enabled=true spring.rabbitmq.host=192.168.1.10 ## rabbitmqç™»å½•ä½¿ç”¨5672, 15672æ˜¯webç«¯å£,åˆ«æé”™äº†! spring.rabbitmq.port=5672 spring.rabbitmq.username=guest spring.rabbitmq.password=guest ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:10:2","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"æ¥å£ ä¿®æ”¹æ¥å£HelloController, æ·»åŠ æ³¨è§£@RefreshScope @RestController @RefreshScope public class HelloController { @Value(\"${neo.hello}\") private String hello; @RequestMapping(\"/hello\") public String from() { return this.hello; } } ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:10:3","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"æµ‹è¯• ä¿®æ”¹é…ç½®æ–‡ä»¶,ä½¿ç”¨å‘½ä»¤curl -X POST http://localhost:8002/actuator/bus-refreshæ›´æ–°,åœ¨è®¿é—®http://localhost:8002/hello å¦‚æœè¿”å›500é”™è¯¯,è¯·æ£€æŸ¥rabbitmqè¿æ¥ ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:10:4","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"æ”¹è¿› server ä¸Šé¢çš„é…ç½®åªæ˜¯é’ˆå¯¹å•ä¸ªclientçš„,å¦‚æœè¦è®©æ‰€æœ‰çš„clientéƒ½æ›´æ–°,å°±éœ€è¦ä½¿ç”¨curlå¯¹æ¯ä¸ªclientæ“ä½œ.æ‰€æœ‰æˆ‘ä»¬å°†ä¿®æ”¹server, å½“é…ç½®æ–‡ä»¶ä¿®æ”¹å,åˆ·æ–°serveræ—¶,åŒæ—¶åˆ·æ–°æ‰€æœ‰çš„client. ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:11:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"æ·»åŠ ä¾èµ– \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-bus-amqp\u003c/artifactId\u003e \u003c/dependency\u003e ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:11:1","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"é…ç½®æ–‡ä»¶ server: port: 8001 spring: application: name: config-server cloud: config: server: git: uri: https://gitee.com/xingyys/config-repo search-paths: config-repo username: username password: password skip-ssl-validation: true bus: trace: enabled: true rabbitmq: host: 192.168.1.10 port: 5672 username: guest password: guest management: endpoints: web: exposure: include: bus-refresh eureka: client: service-url: defaultZone: http://localhost:8000/eureka/ ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:11:2","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"æµ‹è¯• ä¿®æ”¹é…ç½®æ–‡ä»¶,æ‰§è¡Œå‘½ä»¤ curl -X POST http://localhost:8001/actuator/bus-refresh. ","date":"2019-08-14","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/:11:3","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäº”","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%94/"},{"categories":["å¾®æœåŠ¡"],"content":"spring cloudçš„hystrixè¿˜æœ‰ä¸€ä¸ªé…æ­çš„åº“hystrix-dashboard,å®ƒæ˜¯hystrixçš„ä¸€æ¬¾ç›‘æ§å·¥å…·,èƒ½ç›´è§‚çš„æ˜¾ç¤ºhystrixå“åº”ä¿¡æ¯,è¯·æ±‚æˆåŠŸç‡ç­‰.ä½†æ˜¯hystrix-dashboardåªèƒ½æŸ¥çœ‹å•æœºå’Œé›†ç¾¤çš„ä¿¡æ¯,å¦‚æœéœ€è¦å°†å¤šå°çš„ä¿¡æ¯æ±‡æ€»èµ·æ¥çš„è¯å°±éœ€è¦ä½¿ç”¨turbine. æ³¨:è¿™ä¸€ä¸ªç³»åˆ—çš„å¼€å‘ç¯å¢ƒç‰ˆæœ¬ä¸º java1.8, spring boot2.x, spring cloud Greenwich.SR2, IDEä¸º Intelli IDEA hystrix-dashboard hystrix-dashboardåªè¦åœ¨ä¸Šä¸€ç¯‡çš„hystrixçš„åŸºç¡€ä¸Šç¨å¾®ä¿®æ”¹ä¸‹å°±å¯ä»¥äº†. ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/:0:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå››","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/"},{"categories":["å¾®æœåŠ¡"],"content":"æ·»åŠ ä¾èµ– ä¾èµ–æ–‡ä»¶pom.xmléœ€è¦æ·»åŠ ä¸€äº›ä¿¡æ¯. \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-netflix-hystrix\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-netflix-hystrix-dashboard\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-netflix-eureka-server\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-actuator\u003c/artifactId\u003e \u003c/dependency\u003e ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/:1:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå››","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/"},{"categories":["å¾®æœåŠ¡"],"content":"éœ€æ”¹å¯åŠ¨ç±» @SpringBootApplication @EnableDiscoveryClient @EnableFeignClients(basePackages = \"com.xingyys.hystrix.remote\") // æ·»åŠ ä»¥ä¸‹æ³¨è§£ @EnableHystrixDashboard @EnableCircuitBreaker public class HystrixApplication { public static void main(String[] args) { SpringApplication.run(HystrixApplication.class, args); } } ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/:2:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå››","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/"},{"categories":["å¾®æœåŠ¡"],"content":"ä¿®æ”¹é…ç½®æ–‡ä»¶ spring cloud 2.xç‰ˆæœ¬å’Œ1.xç‰ˆæœ¬ä¸åŒ,éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ # ...... # application.properties management.endpoints.web.exposure.include=hystrix.stream management.endpoints.web.base-path=/ ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/:3:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå››","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/"},{"categories":["å¾®æœåŠ¡"],"content":"æµ‹è¯• é‡æ–°ç¼–è¯‘åå¼€å§‹æµ‹è¯• æµè§ˆå™¨è®¿é—®http://127.0.0.1:9002/hystrixå‡ºç°ä»¥ä¸‹é¡µé¢: æµè§ˆå™¨è®¿é—®: http://127.0.0.1:9002/hystrix.streamå‡ºç°ä»¥ä¸‹ä¿¡æ¯ ping: data: {...} data: {...} åŒæ—¶åœ¨http://192.168.1.13:9002/hystrixé¡µé¢ä¸­æ£€æµ‹http://127.0.0.1:9002/hystrix.stream ,ç‚¹å‡»monitor streamè·³è½¬é¡µé¢: hystrix-dashboardæ˜¾ç¤ºçš„å„é¡¹ä¿¡æ¯å«ä¹‰: åˆ°è¿™é‡Œ,å•èŠ‚ç‚¹çš„ç›‘æ§å°±å®Œæˆäº†. æ³¨:å¦‚æœä¸€ç›´æ˜¾ç¤ºLoadingâ€¦, åˆ·æ–° http://127.0.0.1:9002/hello/xxxé¡µé¢å³å¯. turbine æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹åœ¨å¤šå°èŠ‚ç‚¹ä¸­çš„ç›‘æ§å·¥å…·Turbineæ˜¯å¦‚ä½•é…ç½®. ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/:4:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå››","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/"},{"categories":["å¾®æœåŠ¡"],"content":"åˆ›å»ºå·¥ç¨‹ é¦–å…ˆæˆ‘ä»¬è¿˜æ˜¯å…ˆæ¥åˆ›å»ºä¸€ä¸ªå·¥ç¨‹åº”ç”¨,å‘½åä¸ºturbine ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/:5:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå››","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/"},{"categories":["å¾®æœåŠ¡"],"content":"ä¾èµ–æ–‡ä»¶ ä¿®æ”¹ä¾èµ–æ–‡ä»¶pom.xml \u003cproperties\u003e \u003cjava.version\u003e1.8\u003c/java.version\u003e \u003cspring-cloud.version\u003eGreenwich.SR2\u003c/spring-cloud.version\u003e \u003c/properties\u003e \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-netflix-turbine\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-netflix-hystrix-dashboard\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-netflix-eureka-server\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-actuator\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-test\u003c/artifactId\u003e \u003cscope\u003etest\u003c/scope\u003e \u003c/dependency\u003e \u003c/dependencies\u003e \u003cdependencyManagement\u003e \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-dependencies\u003c/artifactId\u003e \u003cversion\u003e${spring-cloud.version}\u003c/version\u003e \u003ctype\u003epom\u003c/type\u003e \u003cscope\u003eimport\u003c/scope\u003e \u003c/dependency\u003e \u003c/dependencies\u003e \u003c/dependencyManagement\u003e ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/:6:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå››","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/"},{"categories":["å¾®æœåŠ¡"],"content":"é…ç½®æ–‡ä»¶ ä¿®æ”¹é…ç½®æ–‡ä»¶application.propertoes spring.application.name=turbine server.port=8081 # é…ç½®Eurekaä¸­çš„serviceIdåˆ—è¡¨ï¼Œè¡¨æ˜ç›‘æ§å“ªäº›æœåŠ¡ turbine.app-config=node01,node02 # æŒ‡å®šèšåˆå“ªäº›é›†ç¾¤ï¼Œå¤šä¸ªä½¿ç”¨â€,â€åˆ†å‰²ï¼Œé»˜è®¤ä¸ºdefaultã€‚å¯ä½¿ç”¨http://.../turbine.stream?cluster={clusterConfigä¹‹ä¸€}è®¿é—® turbine.aggregator.cluster-config=default # 1. clusterNameExpressionæŒ‡å®šé›†ç¾¤åç§°ï¼Œé»˜è®¤è¡¨è¾¾å¼appNameï¼›æ­¤æ—¶ï¼šturbine.aggregator.clusterConfigéœ€è¦é…ç½®æƒ³è¦ç›‘æ§çš„åº”ç”¨åç§°ï¼› # 2. å½“clusterNameExpression: defaultæ—¶ï¼Œturbine.aggregator.clusterConfigå¯ä»¥ä¸å†™ï¼Œå› ä¸ºé»˜è®¤å°±æ˜¯defaultï¼› # 3. å½“clusterNameExpression: metadata[â€˜clusterâ€™]æ—¶ï¼Œå‡è®¾æƒ³è¦ç›‘æ§çš„åº”ç”¨é…ç½®äº†eureka.instance.metadata-map.cluster: ABCï¼Œ # åˆ™éœ€è¦é…ç½®ï¼ŒåŒæ—¶turbine.aggregator.clusterConfig: ABC turbine.cluster-name-expression=new String(\"default\") eureka.client.service-url.defaultZone=http://localhost:8000/eureka # spring cloud 2.xç‰ˆæœ¬éœ€è¦ä½œçš„æ”¹åŠ¨ management.endpoints.web.exposure.include=turbine.stream management.endpoints.web.base-path=/ ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/:7:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå››","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/"},{"categories":["å¾®æœåŠ¡"],"content":"å¯åŠ¨ç±» @SpringBootApplication @EnableHystrixDashboard // æ¿€æ´»å¯¹turbineçš„æ”¯æŒ @EnableTurbine public class TurbineApplication { public static void main(String[] args) { SpringApplication.run(TurbineApplication.class, args); } } ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/:8:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå››","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/"},{"categories":["å¾®æœåŠ¡"],"content":"æµ‹è¯• å¼€å§‹æµ‹è¯•å‰,éœ€è¦å¯¹hystrixåº”ç”¨åšä¿®æ”¹,æ·»åŠ ä¸¤ä¸ªé…ç½®æ–‡ä»¶application-node01.properiteså’Œapplication-node02.properties. ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/:9:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå››","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/"},{"categories":["å¾®æœåŠ¡"],"content":"application-node01.properites spring.application.name=node01 server.port=9003 # å…¶ä»–å’Œconsumerç›¸åŒ,ä¸»è¦æ˜¯hystrixçš„é…ç½® feign.hystrix.enabled=true eureka.client.service-url.defaultZone=http://localhost:8000/eureka/ management.endpoints.web.exposure.include=hystrix.stream management.endpoints.web.base-path=/ ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/:10:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå››","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/"},{"categories":["å¾®æœåŠ¡"],"content":"application-node02.properites spring.application.name=node02 server.port=9004 # å…¶ä»–å’Œconsumerç›¸åŒ,ä¸»è¦æ˜¯hystrixçš„é…ç½® feign.hystrix.enabled=true eureka.client.service-url.defaultZone=http://localhost:8000/eureka/ management.endpoints.web.exposure.include=hystrix.stream management.endpoints.web.base-path=/ ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/:11:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå››","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/"},{"categories":["å¾®æœåŠ¡"],"content":"hystrixå¯åŠ¨ç±» @SpringBootApplication @EnableDiscoveryClient @EnableFeignClients(basePackages = \"com.xingyys.hystrix.remote\") @EnableHystrixDashboard @EnableCircuitBreaker public class HystrixApplication { // spring cloud 2.xéœ€è¦è‡ªå·±æŒ‡å®š @Bean(name = \"HystrixMetricsStreamServlet\") public ServletRegistrationBean getServlet(){ HystrixMetricsStreamServlet streamServlet = new HystrixMetricsStreamServlet(); ServletRegistrationBean registrationBean = new ServletRegistrationBean(streamServlet); registrationBean.setLoadOnStartup(1); registrationBean.addUrlMappings(\"/actuator/hystrix.stream\"); registrationBean.setName(\"HystrixMetricsStreamServlet\"); return registrationBean; } public static void main(String[] args) { SpringApplication.run(HystrixApplication.class, args); } } ä»¥æ­¤å¯åŠ¨åº”ç”¨: java -jar target/discovery-0.0.1-SNAPSHOT.jar java -jar target/hystrix-0.0.1-SNAPSHOT.jar --spring.profiles.active=node01 java -jar target/hystrix-0.0.1-SNAPSHOT.jar --spring.profiles.active=node02 java -jar target/turbine-0.0.1-SNAPSHOT.jar è®¿é—®http://127.0.0.1:8081/turbine.stream,è¿”å› : ping : ping è®¿é—®http://127.0.0.1:8081/hystrixå¹¶å¡«å†™è¡¨å•,å‡ºç°ä»¥ä¸‹é¡µé¢: æ³¨:å‡å¦‚ä¸€ç›´åœ¨loading,è¯·åˆ·æ–°node01æˆ–node02èŠ‚ç‚¹çš„/hello/neoé¡µé¢,ä½†è¦ä¿è¯æœåŠ¡çš„æä¾›åº”ç”¨å…³é—­. ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/:12:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µå››","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E5%9B%9B/"},{"categories":["å¾®æœåŠ¡"],"content":"ä¸Šç¯‡æ–‡ç« é‡Œæˆ‘ä»¬å®ç°äº†spring cloudä¸­çš„æœåŠ¡æä¾›è€…å’Œä½¿ç”¨è€….æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹çœ‹spring cloudä¸­å¾®æœåŠ¡çš„å…¶ä»–ç»„ä»¶. æ³¨:è¿™ä¸€ä¸ªç³»åˆ—çš„å¼€å‘ç¯å¢ƒç‰ˆæœ¬ä¸º java1.8, spring boot2.x, spring cloud Greenwich.SR2, IDEä¸º Intelli IDEA ç†”æ–­å™¨ spring cloudæ¶æ„æˆå‘˜ä¸­æœ‰ä¸€ä¸ªå«\"ç†”æ–­å™¨\".å¾®æœåŠ¡ä¸­ä¸€ä¸ªæœåŠ¡é€šå¸¸å­˜åœ¨å¤šçº§è°ƒç”¨æƒ…å†µ,åœ¨è¿™ç§æƒ…å†µä¸‹å°±å‡ºç°äº†ä¸€äº›ä¸¥é‡çš„é—®é¢˜.å‡å¦‚å…¶ä¸­çš„ä¸€ä¸ªæœåŠ¡æ•…éšœäº†,é‚£ä¹ˆè°ƒç”¨è¿™ä¸ªæœåŠ¡çš„ä½¿ç”¨è€…å°±ä¼šå¤„äºç­‰å¾…çŠ¶æ€ä¸­,ç”±äºå¤šçº§è”è°ƒç”¨,æ‰€ä»¥åç»­çš„è°ƒç”¨è€…ä¹Ÿä¼šå¤„äºè¿™ç§æƒ…å†µ.å› æ­¤é”™è¯¯å°±ä¼šåœ¨ä¸€ä¸ªç³»ç»Ÿä¸­è¢«æ”¾å¤§,ä»è€Œå‡ºç°äº†æœåŠ¡çš„\"é›ªå´©æ•ˆåº”\".ä¸ºäº†åº”å¯¹è¿™ç§æ•ˆåº”,å°±æœ‰äº†\"ç†”æ–­å™¨\". æ‰€è°“ç†”æ–­å™¨,å°±æ˜¯å½“æœåŠ¡æä¾›è€…å‡ºç°é—®é¢˜æ—¶,è°ƒç”¨è€…å‘ç°äº†è¿™ä¸ªé—®é¢˜,å®ƒä¼šå¿«é€Ÿå“åº”æŠ¥é”™. å¦‚æœå®ƒåœ¨ä¸€æ®µæ—¶é—´å†…ä¾¦æµ‹åˆ°è®¸å¤šç±»ä¼¼çš„é”™è¯¯ï¼Œä¼šå¼ºè¿«å…¶ä»¥åçš„å¤šä¸ªè°ƒç”¨å¿«é€Ÿå¤±è´¥ï¼Œä¸å†è®¿é—®è¿œç¨‹æœåŠ¡å™¨ï¼Œä»è€Œé˜²æ­¢åº”ç”¨ç¨‹åºä¸æ–­åœ°å°è¯•æ‰§è¡Œå¯èƒ½ä¼šå¤±è´¥çš„æ“ä½œï¼Œä½¿å¾—åº”ç”¨ç¨‹åºç»§ç»­æ‰§è¡Œè€Œä¸ç”¨ç­‰å¾…ä¿®æ­£é”™è¯¯ï¼Œæˆ–è€…æµªè´¹CPUæ—¶é—´å»ç­‰åˆ°é•¿æ—¶é—´çš„è¶…æ—¶äº§ç”Ÿã€‚ç†”æ–­å™¨ä¹Ÿå¯ä»¥ä½¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿè¯Šæ–­é”™è¯¯æ˜¯å¦å·²ç»ä¿®æ­£ï¼Œå¦‚æœå·²ç»ä¿®æ­£ï¼Œåº”ç”¨ç¨‹åºä¼šå†æ¬¡å°è¯•è°ƒç”¨æ“ä½œ. ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/:0:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸‰","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/"},{"categories":["å¾®æœåŠ¡"],"content":"Hystrixç‰¹æ€§ ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/:1:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸‰","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/"},{"categories":["å¾®æœåŠ¡"],"content":"1.æ–­è·¯å™¨æœºåˆ¶ æ–­è·¯å™¨å¾ˆå¥½ç†è§£, å½“Hystrix Commandè¯·æ±‚åç«¯æœåŠ¡å¤±è´¥æ•°é‡è¶…è¿‡ä¸€å®šæ¯”ä¾‹(é»˜è®¤50%), æ–­è·¯å™¨ä¼šåˆ‡æ¢åˆ°å¼€è·¯çŠ¶æ€(Open). è¿™æ—¶æ‰€æœ‰è¯·æ±‚ä¼šç›´æ¥å¤±è´¥è€Œä¸ä¼šå‘é€åˆ°åç«¯æœåŠ¡. æ–­è·¯å™¨ä¿æŒåœ¨å¼€è·¯çŠ¶æ€ä¸€æ®µæ—¶é—´å(é»˜è®¤5ç§’), è‡ªåŠ¨åˆ‡æ¢åˆ°åŠå¼€è·¯çŠ¶æ€(HALF-OPEN). è¿™æ—¶ä¼šåˆ¤æ–­ä¸‹ä¸€æ¬¡è¯·æ±‚çš„è¿”å›æƒ…å†µ, å¦‚æœè¯·æ±‚æˆåŠŸ, æ–­è·¯å™¨åˆ‡å›é—­è·¯çŠ¶æ€(CLOSED), å¦åˆ™é‡æ–°åˆ‡æ¢åˆ°å¼€è·¯çŠ¶æ€(OPEN). Hystrixçš„æ–­è·¯å™¨å°±åƒæˆ‘ä»¬å®¶åº­ç”µè·¯ä¸­çš„ä¿é™©ä¸, ä¸€æ—¦åç«¯æœåŠ¡ä¸å¯ç”¨, æ–­è·¯å™¨ä¼šç›´æ¥åˆ‡æ–­è¯·æ±‚é“¾, é¿å…å‘é€å¤§é‡æ— æ•ˆè¯·æ±‚å½±å“ç³»ç»Ÿååé‡, å¹¶ä¸”æ–­è·¯å™¨æœ‰è‡ªæˆ‘æ£€æµ‹å¹¶æ¢å¤çš„èƒ½åŠ›. ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/:1:1","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸‰","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/"},{"categories":["å¾®æœåŠ¡"],"content":"2.Fallback Fallbackç›¸å½“äºæ˜¯é™çº§æ“ä½œ. å¯¹äºæŸ¥è¯¢æ“ä½œ, æˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªfallbackæ–¹æ³•, å½“è¯·æ±‚åç«¯æœåŠ¡å‡ºç°å¼‚å¸¸çš„æ—¶å€™, å¯ä»¥ä½¿ç”¨fallbackæ–¹æ³•è¿”å›çš„å€¼. fallbackæ–¹æ³•çš„è¿”å›å€¼ä¸€èˆ¬æ˜¯è®¾ç½®çš„é»˜è®¤å€¼æˆ–è€…æ¥è‡ªç¼“å­˜ ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/:1:2","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸‰","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/"},{"categories":["å¾®æœåŠ¡"],"content":"3.èµ„æºéš”ç¦» åœ¨Hystrixä¸­, ä¸»è¦é€šè¿‡çº¿ç¨‹æ± æ¥å®ç°èµ„æºéš”ç¦». é€šå¸¸åœ¨ä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬ä¼šæ ¹æ®è°ƒç”¨çš„è¿œç¨‹æœåŠ¡åˆ’åˆ†å‡ºå¤šä¸ªçº¿ç¨‹æ± . ä¾‹å¦‚è°ƒç”¨äº§å“æœåŠ¡çš„Commandæ”¾å…¥Açº¿ç¨‹æ± , è°ƒç”¨è´¦æˆ·æœåŠ¡çš„Commandæ”¾å…¥Bçº¿ç¨‹æ± . è¿™æ ·åšçš„ä¸»è¦ä¼˜ç‚¹æ˜¯è¿è¡Œç¯å¢ƒè¢«éš”ç¦»å¼€äº†. è¿™æ ·å°±ç®—è°ƒç”¨æœåŠ¡çš„ä»£ç å­˜åœ¨bugæˆ–è€…ç”±äºå…¶ä»–åŸå› å¯¼è‡´è‡ªå·±æ‰€åœ¨çº¿ç¨‹æ± è¢«è€—å°½æ—¶, ä¸ä¼šå¯¹ç³»ç»Ÿçš„å…¶ä»–æœåŠ¡é€ æˆå½±å“. ä½†æ˜¯å¸¦æ¥çš„ä»£ä»·å°±æ˜¯ç»´æŠ¤å¤šä¸ªçº¿ç¨‹æ± ä¼šå¯¹ç³»ç»Ÿå¸¦æ¥é¢å¤–çš„æ€§èƒ½å¼€é”€. å¦‚æœæ˜¯å¯¹æ€§èƒ½æœ‰ä¸¥æ ¼è¦æ±‚è€Œä¸”ç¡®ä¿¡è‡ªå·±è°ƒç”¨æœåŠ¡çš„å®¢æˆ·ç«¯ä»£ç ä¸ä¼šå‡ºé—®é¢˜çš„è¯, å¯ä»¥ä½¿ç”¨Hystrixçš„ä¿¡å·æ¨¡å¼(Semaphores)æ¥éš”ç¦»èµ„æº. è¿™æ®µæ¥è‡ª: http://www.ityouknow.com Feign Hystrix spring cloudä¸­ç†”æ–­å™¨ç»„ä»¶æ˜¯ç»“åˆFeignåº“ä¸€èµ·ä½¿ç”¨çš„.æ‰€ä»¥å®ƒçš„ä»£ç æ˜¯åœ¨ä¸Šä¸€ç¯‡ä¸­çš„consumeråŸºç¡€ä¸Šæ·»åŠ çš„. ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/:1:3","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸‰","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/"},{"categories":["å¾®æœåŠ¡"],"content":"åˆ›å»ºå·¥ç¨‹é¡¹ç›® åˆ›å»ºä¸€ä¸ªspring cloudå·¥ç¨‹é¡¹ç›®,å‘½åä¸ºhystrix. ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/:2:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸‰","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/"},{"categories":["å¾®æœåŠ¡"],"content":"ä¾èµ–æ–‡ä»¶ pom ä¿®æ”¹ä¾èµ–æ–‡ä»¶ pom.xml \u003cproperties\u003e \u003cjava.version\u003e1.8\u003c/java.version\u003e \u003cspring-cloud.version\u003eGreenwich.SR2\u003c/spring-cloud.version\u003e \u003c/properties\u003e \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-openfeign\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-netflix-hystrix\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-netflix-eureka-server\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-test\u003c/artifactId\u003e \u003cscope\u003etest\u003c/scope\u003e \u003c/dependency\u003e \u003c/dependencies\u003e \u003cdependencyManagement\u003e \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-dependencies\u003c/artifactId\u003e \u003cversion\u003e${spring-cloud.version}\u003c/version\u003e \u003ctype\u003epom\u003c/type\u003e \u003cscope\u003eimport\u003c/scope\u003e \u003c/dependency\u003e \u003c/dependencies\u003e \u003c/dependencyManagement\u003e ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/:3:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸‰","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/"},{"categories":["å¾®æœåŠ¡"],"content":"é…ç½®æ–‡ä»¶ ä¿®æ”¹é…ç½®æ–‡ä»¶ application.properties spring.application.name=hystrix server.port=9002 # å…¶ä»–å’Œconsumerç›¸åŒ,ä¸»è¦æ˜¯hystrixçš„é…ç½® feign.hystrix.enabled=true eureka.client.service-url.defaultZone=http://localhost:8000/eureka/ ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/:4:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸‰","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/"},{"categories":["å¾®æœåŠ¡"],"content":"è¿œç¨‹è°ƒç”¨ // com/xingyys/hystrix/remote/HelloRemote.java // æŒ‡å®šfallbackå±æ€§ @FeignClient(name = \"producer\", fallback = HelloRemoteHystrix.class) public interface HelloRemote { @RequestMapping(value = \"/hello\") public String hello(@RequestParam(value = \"name\") String name); } ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/:5:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸‰","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/"},{"categories":["å¾®æœåŠ¡"],"content":"hystrixç†”æ–­å™¨ // com/xingyys/hystrix/remote/HelloRemoteHystrix @Component public class HelloRemoteHystrix implements HelloRemote { @Override public String hello(@RequestParam String name) { return \"hello \" + name + \" failed!\"; } } ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/:6:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸‰","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/"},{"categories":["å¾®æœåŠ¡"],"content":"æ§åˆ¶å™¨ // com/xingyys/hystrix/controller/HystrixController.java @RestController public class HystrixController { // @Autowired ä¹Ÿå¯ä»¥, å› ä¸ºideaçš„é—®é¢˜, ä¼šæ˜¾ç¤ºçº¢è‰² @Resource HelloRemote helloRemote; @RequestMapping(\"/hello/{name}\") public String hello(@PathVariable(\"name\") String name) { return helloRemote.hello(name); } } ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/:7:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸‰","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/"},{"categories":["å¾®æœåŠ¡"],"content":"å¯åŠ¨ç±» @SpringBootApplication @EnableDiscoveryClient @EnableFeignClients(basePackages = \"com.xingyys.hystrix.remote\") public class HystrixApplication { public static void main(String[] args) { SpringApplication.run(HystrixApplication.class, args); } } ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/:8:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸‰","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/"},{"categories":["å¾®æœåŠ¡"],"content":"ç¼–è¯‘,æ‰“åŒ…,å¯åŠ¨ cd hystrix mvn clean package -Dmaven.test.skip=true java -jar target/hystrix-0.0.1-SNAPSHOT.jar æµ‹è¯• ä¾æ¬¡å¯åŠ¨discovery,producer,consumerå’Œhystrix è®¿é—®http://127.0.0.1:8000,åº”ç”¨åˆ—è¡¨ä¸­æ–°å¢äº†HYSTRIX. è®¿é—®http://127.0.0.1:9002/hello/xingyys,è¿”å›hello xingyys!,consumerçš„åŠŸèƒ½ä¾ç„¶å¯ç”¨. ç„¶åæ–­å¼€producer,è¿”å›http://127.0.0.1:9001/hello/xingyys,åŸæ¥çš„consumerå·²ç»500é”™è¯¯. è€Œè®¿é—®http://127.0.0.1:9002/hello/xingyysè¿”å›ä¸º:hello xingyys failed!,ç†”æ–­å™¨åŠŸèƒ½å¯ç”¨! ","date":"2019-08-11","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/:9:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸‰","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%89/"},{"categories":["å¾®æœåŠ¡"],"content":"åœ¨ä¸Šä¸€ç¯‡,æˆ‘ä»¬å·²ç»æ­å»ºäº†spring cloudå¾®æœåŠ¡ä¸­çš„æ³¨å†Œä¸­å¿ƒ.ä½†åªæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒè¿˜è¿œè¿œä¸å¤Ÿ. æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å°è¯•æä¾›æœåŠ¡. æ³¨:è¿™ä¸€ä¸ªç³»åˆ—çš„å¼€å‘ç¯å¢ƒç‰ˆæœ¬ä¸º java1.8, spring boot2.x, spring cloud Greenwich.SR2, IDEä¸º Intelli IDEA æœåŠ¡æä¾› å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä¸ªéœ€æ±‚,éœ€è¦ä¸€ä¸ªæ¥å£,å½“æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªåå­—,å®ƒä¼šè¿”å›ä¸€å¥é—®å¥½çš„è¯.å¦‚ä¼ å…¥body,è¾“å…¥åˆ™ä¸ºhello body!. ","date":"2019-08-09","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/:0:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäºŒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/"},{"categories":["å¾®æœåŠ¡"],"content":"åˆ›å»ºä¸€ä¸ªspring cloudçš„å·¥ç¨‹é¡¹ç›® å…·ä½“çš„æ­¥éª¤è¿™é‡Œå°±ä¸åœ¨è¯¦ç»†ä»‹ç»äº†,éœ€è¦çš„å¯ä»¥çœ‹[spring cloudå¾®æœåŠ¡å®è·µäºŒ]é‡Œé¢çš„å†…å®¹. æ­¥éª¤å¦‚ä¸‹: Ideaä¸­é€‰æ‹©ä¹‹å‰çš„ç›®å½•firstCloud, å³å‡»\u003eNew\u003eModule, é€‰æ‹© Spring Initialzr. å·¥ç¨‹ä¸­ Group Project Metadataä¸­Groupä¸ºcom.xingyys, Artifactä¸ºproducer ç›´æ¥next,ç›´åˆ°å®Œæˆ. ","date":"2019-08-09","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/:1:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäºŒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/"},{"categories":["å¾®æœåŠ¡"],"content":"pom é…ç½® åœ¨producerç›®å½•ä¸‹,ä¿®æ”¹ pom.xmlæ–‡ä»¶,æ·»åŠ ä¾èµ–: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e \u003cproject xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"\u003e \u003cmodelVersion\u003e4.0.0\u003c/modelVersion\u003e \u003cparent\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-parent\u003c/artifactId\u003e \u003cversion\u003e2.1.7.RELEASE\u003c/version\u003e \u003crelativePath/\u003e \u003c!-- lookup parent from repository --\u003e \u003c/parent\u003e \u003cgroupId\u003ecom.xingyys\u003c/groupId\u003e \u003cartifactId\u003eproducer\u003c/artifactId\u003e \u003cversion\u003e0.0.1-SNAPSHOT\u003c/version\u003e \u003cname\u003eproducer\u003c/name\u003e \u003cdescription\u003eDemo project for Spring Boot\u003c/description\u003e \u003cproperties\u003e \u003cjava.version\u003e1.8\u003c/java.version\u003e \u003cspring-cloud.version\u003eGreenwich.SR2\u003c/spring-cloud.version\u003e \u003c/properties\u003e \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-netflix-eureka-server\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-test\u003c/artifactId\u003e \u003cscope\u003etest\u003c/scope\u003e \u003c/dependency\u003e \u003c/dependencies\u003e \u003cdependencyManagement\u003e \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-dependencies\u003c/artifactId\u003e \u003cversion\u003e${spring-cloud.version}\u003c/version\u003e \u003ctype\u003epom\u003c/type\u003e \u003cscope\u003eimport\u003c/scope\u003e \u003c/dependency\u003e \u003c/dependencies\u003e \u003c/dependencyManagement\u003e \u003cbuild\u003e \u003cplugins\u003e \u003cplugin\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-maven-plugin\u003c/artifactId\u003e \u003c/plugin\u003e \u003c/plugins\u003e \u003c/build\u003e \u003c/project\u003e ","date":"2019-08-09","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/:2:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäºŒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/"},{"categories":["å¾®æœåŠ¡"],"content":"é…ç½®æ–‡ä»¶ ä¿®æ”¹ resourcesä¸‹çš„é…ç½®æ–‡ä»¶ application.properties. spring.application.name=producer server.port=9000 eureka.client.service-url.defaultZone=http://localhost:8000/eureka/ ","date":"2019-08-09","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/:3:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäºŒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/"},{"categories":["å¾®æœåŠ¡"],"content":"å¯åŠ¨ç±» ä¿®æ”¹com.xingyys.producerä¸‹çš„ ProducerApplication.java: @SpringBootApplication @EnableDiscoveryClient public class ProducerApplication { public static void main(String[] args) { SpringApplication.run(ProducerApplication.class, args); } } æœ‰äº†@EnableDiscoveryClient,å°±è¡¨ç¤ºproducerå…·æœ‰æ³¨å†ŒæœåŠ¡çš„åŠŸèƒ½äº†. ","date":"2019-08-09","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/:4:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäºŒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/"},{"categories":["å¾®æœåŠ¡"],"content":"æ·»åŠ Controller è¿™é‡Œæ·»åŠ ä¸€ä¸ªcontrolleræä¾›æˆ‘ä»¬éœ€è¦çš„æœåŠ¡ com.xingyys.producer/controller/HelloController.java: @RestController public class HelloController { @RequestMapping(\"/hello\") public String hello(@RequestParam String name) { return \"Hello \" + name + \" !\"; } } ","date":"2019-08-09","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/:5:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäºŒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/"},{"categories":["å¾®æœåŠ¡"],"content":"ç¼–è¯‘è¿è¡Œ producerä»£ç å’Œé…ç½®æ–‡ä»¶è¿™æ ·å°±å¯ä»¥äº†,æ¥ä¸‹æ¥è¿è¡Œproducerçœ‹çœ‹æ•ˆæœ: cd producer mvn clean package -Dmaven.test.skip=true java -jar target/producer-0.0.1-SNAPSHOT.jar è®¿é—®http://localhost:9000/hello?name=xingyys,è¿”å›Hello xingyys !,è¡¨ç¤ºæ³¨å†ŒæˆåŠŸ,producerå¯ä»¥æä¾›æœåŠ¡äº†. æœåŠ¡è°ƒç”¨ æ—¢ç„¶æœåŠ¡çš„æä¾›è€…æœ‰äº†,æ¥ç€æˆ‘ä»¬å°±æ¥è®¾ç½®ä¸€ä¸ªæœåŠ¡çš„ä½¿ç”¨è€…. ","date":"2019-08-09","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/:6:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäºŒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/"},{"categories":["å¾®æœåŠ¡"],"content":"åˆ›å»ºé¡¹ç›® é¡¹ç›®å‘½åä¸ºconsumer,æ­¥éª¤åŒä¸Š,ä¸åœ¨è¯´æ˜â€¦ ","date":"2019-08-09","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/:7:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäºŒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/"},{"categories":["å¾®æœåŠ¡"],"content":"pomé…ç½® \u003cproperties\u003e \u003cjava.version\u003e1.8\u003c/java.version\u003e \u003cspring-cloud.version\u003eGreenwich.SR2\u003c/spring-cloud.version\u003e \u003c/properties\u003e \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-netflix-eureka-server\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-openfeign\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-test\u003c/artifactId\u003e \u003cscope\u003etest\u003c/scope\u003e \u003c/dependency\u003e \u003c/dependencies\u003e \u003cdependencyManagement\u003e \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-dependencies\u003c/artifactId\u003e \u003cversion\u003e${spring-cloud.version}\u003c/version\u003e \u003ctype\u003epom\u003c/type\u003e \u003cscope\u003eimport\u003c/scope\u003e \u003c/dependency\u003e \u003c/dependencies\u003e \u003c/dependencyManagement\u003e ","date":"2019-08-09","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/:8:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäºŒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/"},{"categories":["å¾®æœåŠ¡"],"content":"è¿œç¨‹è°ƒç”¨ spring cloudä½¿ç”¨ feign è¿›è¡Œè¿œç¨‹è°ƒç”¨. Feignæ˜¯ä¸€ä¸ªå£°æ˜å¼Web Serviceå®¢æˆ·ç«¯ã€‚ä½¿ç”¨Feignèƒ½è®©ç¼–å†™Web Serviceå®¢æˆ·ç«¯æ›´åŠ ç®€å•, å®ƒçš„ä½¿ç”¨æ–¹æ³•æ˜¯å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œç„¶ååœ¨ä¸Šé¢æ·»åŠ æ³¨è§£ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒJAX-RSæ ‡å‡†çš„æ³¨è§£ã€‚Feignä¹Ÿæ”¯æŒå¯æ‹”æ’å¼çš„ç¼–ç å™¨å’Œè§£ç å™¨ã€‚Spring Cloudå¯¹Feignè¿›è¡Œäº†å°è£…ï¼Œä½¿å…¶æ”¯æŒäº†Spring MVCæ ‡å‡†æ³¨è§£å’ŒHttpMessageConvertersã€‚Feignå¯ä»¥ä¸Eurekaå’ŒRibbonç»„åˆä½¿ç”¨ä»¥æ”¯æŒè´Ÿè½½å‡è¡¡ã€‚ // com.xingyys.consumer.remote.HelloRemote.java // name ä¸º æœåŠ¡ç«¯çš„å®ä¾‹å @FeignClient(name = \"producer\") public interface HelloRemote { @RequestMapping(value = \"/hello\") public String hello(@RequestParam(value = \"name\") String name); } ","date":"2019-08-09","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/:9:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäºŒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/"},{"categories":["å¾®æœåŠ¡"],"content":"åˆ›å»ºæœåŠ¡ æ³¨æ„: è¿™é‡Œçš„æœåŠ¡æŒ‡çš„æ˜¯å¾®æœåŠ¡ä¸­å¯¹å¤–çš„æš´éœ²çš„æ¥å£ // com.xingyys.consumer.controller.ConsumerController.java @RestController public class ConsumerController { @Autowired HelloRemote helloRemote; @RequestMapping(\"/hello/{name}\") public String hello(@PathVariable(\"name\") String name) { return helloRemote.hello(name); } } ","date":"2019-08-09","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/:10:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäºŒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/"},{"categories":["å¾®æœåŠ¡"],"content":"å¯åŠ¨ç±» // ConsumerApplication.java @SpringBootApplication @EnableDiscoveryClient // æ³¨æ„è¿™é‡Œæ¥å£å’Œä½ç‰ˆæœ¬æœ‰ä¸åŒ,éœ€è¦åœ¨è¿™é‡ŒæŒ‡å®šè¿œç¨‹è°ƒç”¨æ¥å£çš„è·¯å¾„ @EnableFeignClients(basePackages = \"com.xingyys.consumer.remote\") public class ConsumerApplication { public static void main(String[] args) { SpringApplication.run(ConsumerApplication.class, args); } } ","date":"2019-08-09","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/:11:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäºŒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/"},{"categories":["å¾®æœåŠ¡"],"content":"é…ç½®æ–‡ä»¶ spring.application.name=consumer server.port=9001 eureka.client.service-url.defaultZone=http://localhost:8000/eureka/ ","date":"2019-08-09","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/:12:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäºŒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/"},{"categories":["å¾®æœåŠ¡"],"content":"ç¼–è¯‘è¿è¡Œ cd consumer mvn clean package -Dmaven.test.skip=true java -jar target/consumer-0.0.1-SNAPSHOT.jar ","date":"2019-08-09","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/:13:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäºŒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/"},{"categories":["å¾®æœåŠ¡"],"content":"æµ‹è¯• æµè§ˆå™¨è®¿é—®: http://localhost:9001/hello/xingyys,è¿”å›Hello xingyys ! ","date":"2019-08-09","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/:14:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µäºŒ","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%BA%8C/"},{"categories":["å¾®æœåŠ¡"],"content":"æœ€è¿‘åœ¨å­¦ä¹ springæ¡†æ¶.å…¶ä¸­spring cloudåœ¨å¾®æœåŠ¡æ–¹é¢å¾ˆç«,æ‰€ä»¥åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­,ä¹Ÿåšä¸€äº›è®°å½•. æ³¨:è¿™ä¸€ä¸ªç³»åˆ—çš„å¼€å‘ç¯å¢ƒç‰ˆæœ¬ä¸º java1.8, spring boot2.x, spring cloud Greenwich.SR2, IDEä¸º Intelli IDEA spring cloudçš„ç®€ä»‹ å…³äºspring cloudæ˜¯ä»€ä¹ˆ,åšä»€ä¹ˆçš„é—®é¢˜è¿™é‡Œå°±ä¸å†è¯¦ç»†è¯´æ˜äº†.éœ€è¦çš„å¯ä»¥çœ‹ è¿™ç¯‡æ–‡ç« [http://www.ityouknow.com/springcloud/2017/05/01/simple-springcloud.html] (åšå®¢å›­markdownä¸æ”¯æŒè¶…é“¾æ¥). æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å®è·µspring cloudçš„å‡ ä¸ªæ ¸å¿ƒç»„ä»¶. æ³¨å†Œä¸­å¿ƒEureka Eurekaæ˜¯Netflixå¼€æºçš„ä¸€æ¬¾æä¾›æœåŠ¡æ³¨å†Œå’Œå‘ç°çš„äº§å“.å®ƒæ˜¯spring cloudæœ€æ ¸å¿ƒçš„ç»„ä»¶ä¹‹ä¸€. æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å…·ä½“çš„æ„å»ºæ­¥éª¤: ","date":"2019-08-08","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%80/:0:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸€","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%80/"},{"categories":["å¾®æœåŠ¡"],"content":"æ„å»ºæ­¥éª¤ 1.åˆ›å»ºspring cloudé¡¹ç›® é€‰æ‹©èœå• File\u003eNew\u003eProject, é€‰æ‹© Spring Initializr,ç„¶å next. 2.è¾“å…¥é¡¹ç›®åç§° Group ä¸ºç»„ç»‡å, Artifact ä¸ºé¡¹ç›®å, è¾“å‡ºå®Œæ¯•å next. 3.é€‰æ‹©ä¾èµ– æ¥ä¸‹æ¥é€‰æ‹©ä¾èµ–,ç›´æ¥Spring Cloud, ç„¶å next. 4.é€‰æ‹©é¡¹ç›®è·¯å¾„ é€‰å¥½è·¯å¾„,ç›´æ¥ next. 5.å®Œæˆåˆ›å»º åˆ°è¿™é‡Œ,ä¸€ä¸ªæ ‡å‡†çš„spring cloudé¡¹ç›®å°±å‡ºæ¥äº† 6.è¡¥å……ä»£ç  æ¥ä¸‹æ¥å°±æ˜¯è¡¥å……ä»£ç äº†. ","date":"2019-08-08","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%80/:1:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸€","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%80/"},{"categories":["å¾®æœåŠ¡"],"content":"å®ä¾‹ä»£ç  1.é¦–å…ˆçš„ä¾èµ–å…³ç³»: pom.xml \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e \u003cproject xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"\u003e \u003cmodelVersion\u003e4.0.0\u003c/modelVersion\u003e \u003cparent\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-parent\u003c/artifactId\u003e \u003cversion\u003e2.1.6.RELEASE\u003c/version\u003e \u003crelativePath/\u003e \u003c!-- lookup parent from repository --\u003e \u003c/parent\u003e \u003cgroupId\u003ecom.xingyys.firstCloud\u003c/groupId\u003e \u003cartifactId\u003ediscovery\u003c/artifactId\u003e \u003cversion\u003e0.0.1-SNAPSHOT\u003c/version\u003e \u003cname\u003ediscovery\u003c/name\u003e \u003cdescription\u003eDemo project for Spring Cloud Discovery\u003c/description\u003e \u003cproperties\u003e \u003cjava.version\u003e1.8\u003c/java.version\u003e \u003cspring-cloud.version\u003eGreenwich.SR2\u003c/spring-cloud.version\u003e \u003c/properties\u003e \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-netflix-eureka-server\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-test\u003c/artifactId\u003e \u003cscope\u003etest\u003c/scope\u003e \u003c/dependency\u003e \u003c/dependencies\u003e \u003cdependencyManagement\u003e \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-dependencies\u003c/artifactId\u003e \u003cversion\u003e${spring-cloud.version}\u003c/version\u003e \u003ctype\u003epom\u003c/type\u003e \u003cscope\u003eimport\u003c/scope\u003e \u003c/dependency\u003e \u003c/dependencies\u003e \u003c/dependencyManagement\u003e \u003cbuild\u003e \u003cplugins\u003e \u003cplugin\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-maven-plugin\u003c/artifactId\u003e \u003c/plugin\u003e \u003c/plugins\u003e \u003c/build\u003e \u003c/project\u003e è¦æ³¨æ„çš„æ˜¯spring boot2.xç‰ˆæœ¬å’Œ1.xç‰ˆæœ¬åœ¨ä¾èµ–ä¸Šæœ‰ä¸€äº›ä¸åŒ,æ‰€ä»¥ç‰¹åˆ«æ³¨æ„ propertiesä¸­çš„\u003cspring-cloud.version\u003eGreenwich.SR2\u003c/spring-cloud.version\u003e 2.å¯åŠ¨ä»£ç ä¸­æ·»åŠ @EnableEurekaServeræ³¨è§£ @SpringBootApplication @EnableEurekaServer public class DiscoveryApplication { public static void main(String[] args) { SpringApplication.run(DiscoveryApplication.class, args); } } 3.é…ç½®æ–‡ä»¶ application.properties spring.application.name=spring-cloud-eureka server.port=8000 eureka.client.register-with-eureka=false eureka.client.fetch-registry=false eureka.client.serviceUrl.defaultZone=http://localhost:${server.port}/eureka/ eureka.client.register-with-eureka ï¼šè¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°Eureka Serverï¼Œé»˜è®¤ä¸ºtrueã€‚ eureka.client.fetch-registry ï¼šè¡¨ç¤ºæ˜¯å¦ä»Eureka Serverè·å–æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚ eureka.client.serviceUrl.defaultZone ï¼šè®¾ç½®ä¸Eureka Serveräº¤äº’çš„åœ°å€ï¼ŒæŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€ã€‚é»˜è®¤æ˜¯http://localhost:8761/eureka ï¼›å¤šä¸ªåœ°å€å¯ä½¿ç”¨ , åˆ†éš”ã€‚ 4.ç¼–è¯‘æ‰“åŒ… è¿›å…¥åˆ°discoveryç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤: # å¿½ç•¥æµ‹è¯• mvn clean package -Dmaven.test.skip=true ç¼–è¯‘æˆåŠŸåä¼šåœ¨ targetç›®å½•ä¸‹ç”Ÿæˆ discovery.xx.jaråŒ… 5.è¿è¡Œdiscovery java -jar target/discovery-0.0.1-SNAPSHOT.jar éƒ½æˆåŠŸçš„è¯,æµè§ˆå™¨è®¿é—® http://localhost:8000: æ³¨å†Œä¸­å¿ƒçš„é«˜å¯ç”¨ æ—¢ç„¶æ³¨å†Œä¸­å¿ƒè¿™ä¹ˆé‡è¦,é‚£ä¹ˆå•æœºè¿è¡Œæ€ä¹ˆèƒ½ä¿è¯æœåŠ¡çš„å¯é æ€§å‘¢.æ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦å¯¹æ³¨å†Œä¸­å¿ƒåšé›†ç¾¤. Eurekaé€šè¿‡äº’ç›¸æ³¨å†Œçš„æ–¹å¼æ¥å®ç°é«˜å¯ç”¨çš„éƒ¨ç½²ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†Eureke Serveré…ç½®å…¶ä»–å¯ç”¨çš„serviceUrlå°±èƒ½å®ç°é«˜å¯ç”¨éƒ¨ç½². æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹çœ‹æ€ä¹ˆå®ç°å§: ","date":"2019-08-08","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%80/:2:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸€","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%80/"},{"categories":["å¾®æœåŠ¡"],"content":"åŒæ´»é…ç½® 1.åˆ›å»ºapplication-node1.propertiesï¼Œä½œä¸ºnode1æœåŠ¡ä¸­å¿ƒçš„é…ç½®ï¼Œå¹¶å°†serviceUrlæŒ‡å‘node2`, : spring.application.name=discovery-node1 server.port=8001 eureka.client.register-with-eureka=true eureka.client.fetch-registry=true eureka.instance.hostname=node1 eureka.client.serviceUrl.defaultZone=http://node2:8002/eureka/ 2.åˆ›å»ºapplication-node2.propertiesï¼Œä½œä¸ºnode2æœåŠ¡ä¸­å¿ƒçš„é…ç½®ï¼Œå¹¶å°†serviceUrlæŒ‡å‘node1: spring.application.name=discovery-node2 server.port=8002 eureka.client.register-with-eureka=true eureka.client.fetch-registry=true eureka.instance.hostname=node2 eureka.client.serviceUrl.defaultZone=http://node1:8001/eureka/ 3.ä¿®æ”¹hosts 127.0.0.1 node1 127.0.0.1 node2 4.ä¿®æ”¹ä»£ç ,æ·»åŠ @EnableEurekaClientæ³¨è§£: @SpringBootApplication @EnableEurekaServer @EnableEurekaClient public class DiscoveryApplication { public static void main(String[] args) { SpringApplication.run(DiscoveryApplication.class, args); } } 5.æ‰“åŒ…å¯åŠ¨ ä¾æ¬¡æ‰§è¡Œä¸‹é¢å‘½ä»¤ #æ‰“åŒ… mvn clean package -Dmaven.test.skip=true # åˆ†åˆ«ä»¥node1å’Œnode2 é…ç½®ä¿¡æ¯å¯åŠ¨eureka # --spring.profiles.active æŒ‡å®šå¯åŠ¨ä¸åŒçš„é…ç½®æ–‡ä»¶ java -jar target/discovery-0.0.1-SNAPSHOT.jar --spring.profiles.active=node1 java -jar target/discovery-0.0.1-SNAPSHOT.jar --spring.profiles.active=node2 æˆåŠŸåè®¿é—®æµè§ˆå™¨å°±ä¼šå˜æˆè¿™æ ·: ","date":"2019-08-08","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%80/:3:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸€","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%80/"},{"categories":["å¾®æœåŠ¡"],"content":"æ›´å¤šé›†ç¾¤ å¦‚æœæ˜¯ä¸‰ä¸ªåŠä»¥ä¸Šçš„èŠ‚ç‚¹åˆè¦æ€ä¹ˆé…åˆå‘¢,å…¶å®ä¹Ÿæ˜¯åŒæ ·çš„åŸç†.ä»¥ä¸‰ä¸ªèŠ‚ç‚¹ä¸ºä¾‹,æ¯ä¸ªèŠ‚ç‚¹æ³¨å†Œä¸ºå…¶ä»–èŠ‚ç‚¹çš„clientå°±å¯ä»¥äº†. å› ä¸ºspring cloudä¹Ÿæ”¯æŒyamlæ ¼å¼çš„é…ç½®æ–‡ä»¶,æ‰€ä»¥ä¸‰ä¸ªèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶å¯ä»¥å†™åœ¨ä¸€ä¸ªyamlæ–‡ä»¶ä¸­: ---spring:application:name:discoveryprofiles:nodes1server:port:8000eureka:instance:hostname:node1client:serviceUrl:defaultZone:http://node2:8001/eureka/,http://node3:8002/eureka/---spring:application:name:discoveryprofiles:nodes2server:port:8001eureka:instance:hostname:node2client:serviceUrl:defaultZone:http://node1:8000/eureka/,http://node3:8002/eureka/---spring:application:name:discoveryprofiles:nodes3server:port:8002eureka:instance:hostname:node3client:serviceUrl:defaultZone:http://node1:8000/eureka/,http://node2:8001/eureka/ åˆ†åˆ«å¯åŠ¨: java -jar target/discovery-0.0.1-SNAPSHOT.jar --spring.profiles.active=nodes1 java -jar target/discovery-0.0.1-SNAPSHOT.jar --spring.profiles.active=nodes2 java -jar target/discovery-0.0.1-SNAPSHOT.jar --spring.profiles.active=nodes3 æµè§ˆå™¨è®¿é—®: ","date":"2019-08-08","objectID":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%80/:4:0","tags":["java","spring"],"title":"Spring Cloudå¾®æœåŠ¡å®è·µä¸€","uri":"/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E8%B7%B5%E4%B8%80/"},{"categories":["ä»£ç "],"content":"éœ€æ±‚å’Œæ€è·¯ åœ¨ä¸€èˆ¬çš„å°é¡¹ç›®æˆ–è€…ä¸€ä¸ªå°è½¯ä»¶,ä¾‹å¦‚å®¢æˆ·ç«¯ä¹‹ç±»çš„å°ç¨‹åºä¸­,å¯èƒ½ä¼šéœ€è¦æ•°æ®çš„æŒä¹…åŒ–.ä½†æ˜¯ä½¿ç”¨ä¸€èˆ¬çš„æ•°æ®åº“(Mysql)ä¹‹ç±»çš„ä¸åˆé€‚.ä½¿ç”¨sqlite3è¿™ç§åµŒå…¥å¼çš„æ˜¯ä¸ªè¾ƒå¥½çš„æ–¹æ³•,ä½†æ˜¯Goè¯­è¨€ä¸­sqlite3çš„åº“æ˜¯Cè¯­è¨€çš„,Cgoä¸æ”¯æŒè·¨å¹³å°ç¼–è¯‘.æ­£æ˜¯ç”±äºè¿™ç§éœ€æ±‚,æ‰æƒ³åˆ°ä½¿ç”¨jsonæ ¼å¼å°†æ•°æ®ç›´æ¥ä¿å­˜åœ¨æ–‡ä»¶ä¸­. å…·ä½“çš„æ€è·¯æ˜¯æ€ä¹ˆæ ·å‘¢? åœ¨Goè¯­è¨€ä¸­å¦‚æœè¦å°†æ•°æ®è½¬åŒ–æˆjsonæ ¼å¼çš„è¯,æœ‰ä¸¤ç§æ ¼å¼ struct å’Œ map. å¦‚æœåŒæ—¶éœ€è¦å¢åˆ æŸ¥æ”¹åŠŸèƒ½çš„è¯,å°†mapä½œä¸ºä¸­é—´æ ¼å¼æ˜¯æ¯”è¾ƒåˆé€‚çš„.æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å®ç°å®ƒ. æŸ¥è¯¢æ“ä½œ è¿™ç§æ“ä½œçš„å®ç°æ¯”è¾ƒç®€å•,ç›´æ¥å°†æ–‡ä»¶ä¸­çš„æ•°æ®è¯»å–å‡ºæ¥,ä½¿ç”¨jsonåº“ååºåˆ—åŒ–å°±å¯ä»¥äº†. ä»£ç å¦‚ä¸‹ : type Product struct { Name string `json:\"name\"` Num int `json:\"num\"` } func findAll() { ps := make([]Product, 0) data, err := ioutil.ReadFile(\"./index.json\") if err != nil { log.Fatal(err) } // è¿™é‡Œå‚æ•°è¦æŒ‡å®šä¸ºå˜é‡çš„åœ°å€ err = json.Unmarshal(data, \u0026ps) if err != nil { log.Fatal(err) } fmt.Println(ps) } æ·»åŠ æ“ä½œ æ·»åŠ çš„å®ç°å®åœ¨æŸ¥è¯¢çš„åŸºç¡€ä¸Šçš„,æˆ‘ä»¬éœ€è¦å…ˆæŸ¥è¯¢æ–‡ä»¶ä¸­çš„æ•°æ®åº“,å¹¶è½¬åŒ–ä¸ºmapæ ¼å¼,å†å°†structä¹Ÿè½¬åŒ–ä¸ºmapæ ¼å¼(è¿™é‡Œè¦ä½¿ç”¨åå°„),åˆå¹¶map,jsonåºåˆ—åŒ–,æœ€åä¿å­˜åœ¨æ–‡ä»¶ä¸­.ä»£ç å¦‚ä¸‹: func create() { fields := make([]map[string]interface{}, 0) p1 := \u0026Product{ Name: \"Blog\", Num: 2, } _, _ = json.Marshal(p1) // è¯»å–æ–‡ä»¶ä¸­çš„æ•°æ®,ä¿å­˜ä¸ºmapæ ¼å¼ data, _ := ioutil.ReadFile(\"./index.json\") err := json.Unmarshal(data, \u0026fields) if err != nil { log.Fatal(err) } // ä½¿ç”¨åå°„å°†structè½¬åŒ–ä¸ºmap tp := reflect.TypeOf(p1).Elem() vp := reflect.ValueOf(p1).Elem() field := make(map[string]interface{}, 0) for i := 0; i \u003c tp.NumField(); i++ { field1 := tp.Field(i) field2 := vp.Field(i) key := field1.Tag.Get(\"json\") field[key] = field2.Interface() } // åˆå¹¶map fields = append(fields, field) // å†™å…¥æ–‡ä»¶ out, _ := json.Marshal(fields) _ = ioutil.WriteFile(\"./index.json\", out, 0755) } æ¡ä»¶æŸ¥è¯¢ æ€è·¯: å°†structè½¬åŒ–ä¸ºmap,æ ¹æ®è¾“å…¥çš„æ¡ä»¶æŸ¥è¯¢.æŸ¥è¯¢çš„ç»“æœè½¬åŒ–ä¸ºstruct.ä»£ç å¦‚ä¸‹: func FindOne() { product := \u0026Product{} p1 := \u0026Product{ Name: \"John\", Num: 23, } // ä½¿ç”¨åå°„å°†structè½¬åŒ–ä¸ºmap tp := reflect.TypeOf(p1).Elem() vp := reflect.ValueOf(p1).Elem() field := make(map[string]interface{}, 0) for i := 0; i \u003c tp.NumField(); i++ { field1 := tp.Field(i) field2 := vp.Field(i) key := field1.Tag.Get(\"json\") switch field2.Kind() { case reflect.Int: field[key] = float64(field2.Interface().(int)) case reflect.Int8: field[key] = float64(field2.Interface().(int8)) case reflect.Int16: field[key] = float64(field2.Interface().(int16)) case reflect.Int32: field[key] = float64(field2.Interface().(int32)) case reflect.Int64: field[key] = float64(field2.Interface().(int64)) case reflect.Uint: field[key] = float64(field2.Interface().(uint)) case reflect.Uint8: field[key] = float64(field2.Interface().(uint8)) case reflect.Uint16: field[key] = float64(field2.Interface().(uint16)) case reflect.Uint32: field[key] = float64(field2.Interface().(uint32)) case reflect.Uint64: field[key] = float64(field2.Interface().(uint64)) case reflect.Float32: field[key] = float64(field2.Interface().(float32)) case reflect.Float64: field[key] = field2.Interface() default: field[key] = field2.Interface() } } _, _ = json.Marshal(p1) // è¯»å–æ–‡ä»¶ä¸­çš„æ•°æ®,ä¿å­˜ä¸ºmapæ ¼å¼ // æ•°æ®è½¬åŒ–ä¸ºmapæ—¶,æ•°å€¼ç±»å‹çš„ç»Ÿä¸€å˜æˆfloat64 data, _ := ioutil.ReadFile(\"./index.json\") fields := make([]map[string]interface{}, 0) err := json.Unmarshal(data, \u0026fields) if err != nil { log.Fatal(err) } // æŸ¥è¯¢çš„æ¡ä»¶ columns := []string{\"name\", \"num\"} length := len(columns) for _, item := range fields { for i := 0; i \u003c length; i++ { // è¿™é‡Œçš„æ¯”è¾ƒéœ€è¦æ”¹è¿› if item[columns[i]] != field[columns[i]] { break } if i == length-1 { field = item goto OVER } } } OVER: fmt.Println(field) out, _ := json.Marshal(field) _ = json.Unmarshal(out, \u0026product) fmt.Println(product) } ä¿®æ”¹æ“ä½œ ä¿®æ”¹æ“ä½œåœ¨æŸ¥è¯¢æ“ä½œçš„åŸºç¡€ä¸Šå®ç°, ä¿®æ”¹æ“ä½œéœ€è¦æœ‰ä¸€ä¸ªidå€¼,èƒ½ç¡®å®šå…ƒç´ çš„å”¯ä¸€æ€§.ä»£ç å¦‚ä¸‹: func Update() { p1 := \u0026Product{ Id: \"2bbec87025968879c3c9682abe3bf730\", Name: \"John_e\", Num: 100, } // ä½¿ç”¨åå°„å°†structè½¬åŒ–ä¸ºmap tp := reflect.TypeOf(p1).Elem() vp := reflect.ValueOf(p1).Elem() field := make(map[string]interface{}, 0) for i := 0; i \u003c tp.NumField(); i++ { field1 := tp.Field(i) field2 := vp.Field(i) key := field1.Tag.Get(\"json\") switch field2.Kind() { case reflect.Int: field[key] = float64(field2.Interface().(int)) case reflect.Int8: field[key] = float64(field2.Interface().(int8)) case reflect.Int16: field[key] = float64(field2.Interface().(int16)) case reflect.Int32: field[key] = float64(field2.Interface().(int32)) case reflect.Int64: field[key] = float64(field2.Interface().(int64)) case reflect.Uint: field[key] = float64(field","date":"2019-08-07","objectID":"/golang%E4%BD%BF%E7%94%A8json%E6%A0%BC%E5%BC%8F%E5%AE%9E%E7%8E%B0%E5%A2%9E%E5%88%A0%E6%9F%A5%E6%94%B9/:0:0","tags":["golang"],"title":"Golangä½¿ç”¨jsonæ ¼å¼å®ç°å¢åˆ æŸ¥æ”¹","uri":"/golang%E4%BD%BF%E7%94%A8json%E6%A0%BC%E5%BC%8F%E5%AE%9E%E7%8E%B0%E5%A2%9E%E5%88%A0%E6%9F%A5%E6%94%B9/"},{"categories":["è¿ç»´"],"content":"ä¸€ã€éœ€æ±‚ å…·ä½“å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼šä½¿ç”¨ nginx ä½œä¸ºå¯¹å¤–çš„æœåŠ¡æœºå™¨ï¼Œè®©å®¢æˆ·ç«¯é€šè¿‡è®¿é—® nginx æ‰€åœ¨çš„IP+ç«¯å£çš„æ–¹å¼èƒ½è®¿é—®å†…éƒ¨å¤šä¸ªç³»ç»Ÿï¼Œè¿™æ ·ä¸€æ¥é€šè¿‡å¯¹å•å°æœºå™¨ä½œè®¿é—®æ§åˆ¶å°±å¯ä»¥ä¿è¯å†…éƒ¨ç³»ç»Ÿçš„è®¿é—®å®‰å…¨ã€‚å®ç°æ€è·¯å¦‚ä¸‹ï¼šåœ¨å¯¹å¤–çš„æœºå™¨ä¸Šéƒ¨ç½² nginx æœåŠ¡ï¼Œé€šè¿‡ nginx è™šæ‹ŸæœºåŠŸèƒ½å’Œä»£ç†åŠŸèƒ½ç›¸ç»“åˆå®ç°å¤šç»„ä»£ç†ã€‚å…·ä½“åœºæ™¯å¦‚ä¸‹ï¼š ä»£ç†æœåŠ¡å™¨ ä»£ç†æœåŠ¡ nginx 192.168.10.10:8080 192.168.10.11:8080 nginx 192.168.10.10:8081 192.168.10.11:9000 äºŒã€ç¯å¢ƒ æµ‹è¯•ç¯å¢ƒå¦‚ä¸‹ï¼š ä»£ç†æœåŠ¡å™¨ï¼šip 192.168.10.10ï¼›ç³»ç»Ÿ CentOS7 ;Â  éœ€è¦ä»£ç†çš„æœåŠ¡ï¼š192.168.10.11:8080 nginx ï¼›192.168.10.11:9000 tomcat ä¸‰ã€é…ç½®ä»£ç† å‡å¦‚æœ‰ä¸¤ä¸ªæœåŠ¡éœ€è¦é…ç½®ä»£ç†ï¼Œä¸€ä¸ª webï¼Œä¸€ä¸ª tomcatã€‚web è¿è¡Œåœ¨ 192.168.10.11:8080 tomcat è¿è¡Œåœ¨ 192.168.10.11:9000 ç°åœ¨é…ç½® nginx ä»£ç†ã€‚ 1.å®‰è£… nginxå…ˆåœ¨ä»£ç†æœåŠ¡å™¨ä¸Šå®‰è£… nginxï¼Œä½¿ç”¨å‘½ä»¤ï¼š $ yum install -y nginx å®‰è£…æˆåŠŸåå°±å¯ä»¥å°è¯•å¯åŠ¨ nginx æœåŠ¡å™¨ï¼š $ systemctl start nginx å¯åŠ¨æœåŠ¡æˆåŠŸåï¼Œnginx å°±è¿è¡Œåœ¨ 80 ç«¯å£ã€‚ 2.ä¿®æ”¹é…ç½®æ–‡ä»¶å®‰è£…nginxå°±å¯ä»¥ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶çš„é»˜è®¤è·¯å¾„ä¸ºÂ  $ ll /etc/nginx/nginx.conf -rw-r--r-- 1 root root 1822 Nov 24 19:30 /etc/nginx/nginx.conf ä¿®æ”¹ nginx.conf å¦‚ä¸‹ # ç³»ç»Ÿç”¨æˆ· user nginx; # å·¥ä½œè¿›ç¨‹æ•°ï¼Œé…ç½®é«˜çš„æœºå™¨å¯ä»¥é€‚å½“å¢åŠ  worker_processes 4; # é”™è¯¯æ—¥å¿— error_log /var/log/nginx/error.log; # pid æ–‡ä»¶å­˜æ”¾ç›®å½• pid /run/nginx.pid; events { # linux ä½¿ç”¨ epoll äº‹ä»¶æœºåˆ¶ use epoll; # è¿æ¥æ•° worker_connections 1024; } http { log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; access_log /var/log/nginx/access.log main; sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 2048; include /etc/nginx/mime.types; default_type application/octet-stream; # é…ç½®è™šæ‹Ÿæœºï¼Œåœ¨è¯¥ç›®å½•ä¸‹é…ç½®å¤šä¸ªé…ç½®æ–‡ä»¶å¯¹åº”å¤šå°éœ€è¦ä»£ç†çš„æœºå™¨ include /etc/nginx/conf.d/*.conf; # é…ç½® https # Settings for a TLS enabled server. # # server { # listen 443 ssl http2 default_server; # listen [::]:443 ssl http2 default_server; # server_name _; # root /usr/share/nginx/html; # # ssl_certificate \"/etc/pki/nginx/server.crt\"; # ssl_certificate_key \"/etc/pki/nginx/private/server.key\"; # ssl_session_cache shared:SSL:1m; # ssl_session_timeout 10m; # ssl_ciphers HIGH:!aNULL:!MD5; # ssl_prefer_server_ciphers on; # # # Load configuration files for the default server block. # include /etc/nginx/default.d/*.conf; # # location / { # } # # error_page 404 /404.html; # location = /40x.html { # } # # error_page 500 502 503 504 /50x.html; # location = /50x.html { # } # } } æ³¨æ„ 23 è¡Œçš„é…ç½®ï¼šinclude /etc/nginx/conf.d/*.conf; è¿™ä¸ªç›®å½•ä¸‹å°±æ˜¯è¦å­˜æ”¾ä»£ç†çš„é…ç½®æ–‡ä»¶ã€‚ä¸€èˆ¬è¿™ä¸ªæ–‡ä»¶é»˜è®¤æ˜¯å­˜åœ¨çš„ï¼Œå¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œå°±åˆ›å»ºå¹¶ä¿®æ”¹æƒé™ã€‚ $ mkdir /etc/nginx/conf.d $ chmod 755 /etc/nginx/conf.d 3.é…ç½®ä»£ç†æ–‡ä»¶åœ¨è¿™ä¸ªç›®å½•ä¸‹å­˜æ”¾ä»£ç†æœåŠ¡çš„æ–‡ä»¶ï¼Œæœ€å¥½ä¸€ä¸ªä»£ç†å¯¹åº”ä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚æˆ‘ä»¬ä¹‹å‰éœ€æ±‚ä¸Šéœ€è¦ä»£ç†çš„æœåŠ¡æ˜¯ä¸¤ä¸ªï¼Œç›´æ¥åˆ›å»ºä¸¤ä¸ªä»£ç†æ–‡ä»¶ï¼Œå¹¶ä¿®æ”¹ # /etc/nginx/conf.d/nginx.conf # ä»£ç†çš„èŠ‚ç‚¹ # upstream \u003cä»£ç†åç§° å”¯ä¸€\u003e upstream nginx_server { # ä»£ç†çš„ip:port,å¯æ·»åŠ å¤šä¸ªipåœ°å€å°±è¡Œè´Ÿè½½å‡è¡¡ server 192.168.10.11:8080; } server { # ç›‘å¬çš„åœ°å€å’Œç«¯å£ # å¯¹åº”ä¸€ä¸ªä»£ç†ä¸€ä¸ªç«¯å£ listen 192.168.10.10:8080; # å¯¹å¤–çš„åŸŸå server_name aaa.test.com; location / { # ä»£ç†é…ç½®ï¼Œåç§°å’Œä»¥ä¸Šçš„ä»£ç†åç§°å¯¹åº” proxy_pass http://nginx_server; # é…ç½®ä½¿ç”¨çœŸå®çš„åœ°å€è®¿é—®ï¼Œå¦‚æœä¸é…ç½®æ­¤é¡¹ä¼šå¯¼è‡´ä»£ç†tomcatæœåŠ¡å™¨ 400 é”™è¯¯ proxy_set_header Host $host; } } # cat /etc/nginx/conf.d/tomcat.conf upstream tomcat_server { server 192.168.10.11:9000; } server { listen 192.168.10.10:8081; server_name bbb.test.com; location / { proxy_pass http://tomcat_server; proxy_set_header Host $host; } } ä¿®æ”¹å¹¶ä¿å­˜åï¼Œä½¿ç”¨ nginx å‘½ä»¤æ¥éªŒè¯æ–‡ä»¶çš„è¯­æ³•ï¼š $ # nginx -t nginx: the configuration file /etc/nginx/nginx.conf syntax is ok nginx: configuration file /etc/nginx/nginx.conf test is successful ä¹‹åå°±å¯ä»¥é‡å¯ nginx æœåŠ¡ $ systemctl restart nginx $ netstat -tnlp | grep nginx tcp 0 0 192.168.10.10:8080 0.0.0.0:* LISTEN 11643/nginx: master tcp 0 0 192.168.10.10:8081 0.0.0.0:* LISTEN 11643/nginx: master å¯ä»¥çœ‹åˆ°æˆåŠŸç»‘å®šä¸¤ä¸ªç«¯å£ï¼Œä»£ç†ä¸¤ä¸ªæœåŠ¡ã€‚é€šè¿‡æµè§ˆå™¨è®¿é—®8080å’Œ8081![image.png] åˆ°è¿™é‡Œé…ç½®å°±å®Œæˆäº†ã€‚å¦‚æœéœ€è¦å†ä»£ç†ï¼Œåœ¨ /etc/nginx/conf.d ç›®å½•ä¸‹å†æ·»åŠ ç›¸åº”çš„é…ç½®æ–‡ä»¶å°±å¯ä»¥ã€‚å¦‚æœæ²¡æœ‰è®¿é—®æˆåŠŸï¼Œè¯·æ£€æŸ¥å„ç§é˜²ç«å¢™å’Œå®‰å…¨ç­–ç•¥ã€‚ ","date":"2019-07-31","objectID":"/nginx%E5%A4%9A%E7%BB%84%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE/:0:0","tags":["linux","nginx"],"title":"Nginxå¤šç»„ä»£ç†é…ç½®","uri":"/nginx%E5%A4%9A%E7%BB%84%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE/"},{"categories":["ç¬”è®°"],"content":"åˆ¶ä½œrpmåŒ…çš„æµç¨‹ rpmåŒ…æ˜¯redhatå’ŒCentOSç­‰linuxå‘è¡Œç‰ˆçš„åŒ…ç®¡ç†å·¥å…·ï¼Œèƒ½æœ‰æ•ˆçš„ç®¡ç†ç³»ç»Ÿçš„è½¯ä»¶åŒ…ï¼ŒåŒ…æ‹¬æ·»åŠ ã€åˆ é™¤ã€å‡çº§ç­‰æ“ä½œã€‚æ‰€ä»¥ä¸ºäº†æˆ‘ä»¬è‡ªå·±å¼€å‘çš„è½¯ä»¶ä¹Ÿå¯ä»¥è¿™æ ·å®¹æ˜“çš„ç®¡ç†ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æ€ä¹ˆåˆ¶ä½œrpmè½¯ä»¶åŒ… ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:0:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"å®‰è£…éœ€è¦çš„è½¯ä»¶ [root@CentOS1 ~]# yum install -y rpm-build æ‰§è¡Œäº†ä»¥ä¸Šçš„å‘½ä»¤åæˆ‘ä»¬å°±è¿™é‡Œä½¿ç”¨rpmbuildè¿™ä¸ªå‘½ä»¤äº†ã€‚ ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:1:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"åˆ›å»ºrpmbuild ç„¶åå°±éœ€è¦åˆ›å»ºrpmbuild rpmbuild/ â”œâ”€â”€ BUILD // åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰äº›ç¼“å­˜çš„æ•°æ®éƒ½ä¼šæ”¾ç½®åœ¨è¿™ä¸ªç›®å½•å½“ä¸­ï¼› â”œâ”€â”€ BUILDROOT // ç¼–è¯‘åç”Ÿæˆçš„è½¯ä»¶ä¸´æ—¶å®‰è£…ç›®å½• â”œâ”€â”€ RPMS // ç»è¿‡ç¼–è¯‘ä¹‹åï¼Œå¹¶ä¸”é¡ºåˆ©çš„ç¼–è¯‘æˆåŠŸä¹‹åï¼Œå°†æ‰“åŒ…å®Œæˆçš„æ–‡ä»¶æ”¾ç½®åœ¨è¿™ä¸ªç›®å½•å½“ä¸­ã€‚é‡Œå¤´æœ‰åŒ…å«äº† i386, i586, i686, noarch.... ç­‰ç­‰çš„æ¬¡ç›®å½•ã€‚ â”œâ”€â”€ SOURCES // è¿™ä¸ªç›®å½•å½“ä¸­æ”¾ç½®çš„æ˜¯è¯¥è½¯ä»¶çš„åŸå§‹æ¡£ (*.tar.gz çš„æ–‡ä»¶) ä»¥åŠ config è¿™ä¸ªé…ç½®æ¡£ï¼› â”œâ”€â”€ SPECS // è¿™ä¸ªç›®å½•å½“ä¸­æ”¾ç½®çš„æ˜¯è¯¥è½¯ä»¶çš„é…ç½®æ¡£ï¼Œä¾‹å¦‚è¿™ä¸ªè½¯ä»¶çš„èµ„è®¯å‚æ•°ã€é…ç½®é¡¹ç›®ç­‰ç­‰éƒ½æ”¾ç½®åœ¨è¿™é‡Œï¼› â””â”€â”€ SRPMS // ä¸ RPMS å†…ç›¸ä¼¼çš„ï¼Œè¿™é‡Œæ”¾ç½®çš„å°±æ˜¯ SRPM å°è£…çš„æ–‡ä»¶ç½—ï¼æœ‰æ—¶å€™ä½ æƒ³è¦å°†ä½ çš„è½¯ä»¶ç”¨ SRPM çš„æ–¹å¼é‡Šå‡ºæ—¶ï¼Œ ä½ çš„ SRPM æ–‡ä»¶å°±ä¼šæ”¾ç½®åœ¨è¿™ä¸ªç›®å½•ä¸­äº†ã€‚ [root@CentOS1 ~]# mkdir -p rpmbuild/{BUILD,BUILDROOT,RPMS,SOURCES,SPECS,SRPMS} è¿™ä¸ªç›®å½•å°±æ˜¯æˆ‘ä»¬è¦åˆ¶ä½œrpmåŒ…çš„ç›¸å…³ç›®å½•ï¼Œå®ƒé‡Œé¢ä¿å­˜æˆ‘ä»¬éœ€è¦çš„å„ç§æ–‡ä»¶ã€‚ ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:2:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"åˆ›å»ºhelloworld.specæ–‡ä»¶ æ¥ä¸‹æ¥æ¥ä¸€ä¸ªç®€å•çš„demoï¼Œå…ˆåœ¨rpmbuild/SPECSä¸‹æ–°å»ºæ–‡ä»¶helloworld.spec [root@CentOS1 ~]# vim rpmbuild/SPCES/helloworld.spec Name: helloworld Version: 1.0.0 Release: 1%{?dist} Summary: helloworld Group: Development/Tools License: GPL #URL: Source0: %{name}-%{version}.tar.gz #BuildRequires: #Requires: %description %prep %setup -q %build %install mkdir -p $RPM_BUILD_ROOT/usr/bin cp $RPM_BUILD_DIR/%{name}-%{version}/helloworld $RPM_BUILD_ROOT/usr/bin/ %clean rm -rf $RPM_BUILD_ROOT %files %defattr(-,root,root,-) %doc /usr/bin/helloworld %changelog *.specÂ æ–‡ä»¶çš„å†…å®¹ç­‰ä¸‹å†è®²ï¼Œä¿å­˜å¥½ helloworld.spec æ–‡ä»¶åï¼Œè¿˜éœ€è¦å† rpmbuild/SOURCES ç›®å½•ä¸‹æ·»åŠ å¯¹åº”çš„è½¯ä»¶åŒ…ï¼Œè½¯ä»¶åŒ…çš„åå­—å’ŒSOURCE0å­—æ®µå¯¹åº” [root@CentOS1 ~]# echo \"#! /bin/bash\" \u003e rpmbuild/SOURCES/helloworld-1.0.0/helloworld [root@CentOS1 ~]# echo \"echo 'Hello World'\" \u003e\u003e rpmbuild/SOURCES/helloworld-1.0.0/helloworld [root@CentOS1 ~]# tar -cvf rpmbuild/SOURCES/helloworld-1.0.0.tar.gz rpmbuild/SOURCES/helloworld-1.0.0 rpmbuild/SOURCES/helloworld-1.0.0/ rpmbuild/SOURCES/helloworld-1.0.0/helloworld ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:3:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"åˆ¶ä½œrpmåŒ… éœ€è¦çš„æ–‡ä»¶éƒ½å‡†å¤‡å¥½äº†ï¼Œå°±å¯ä»¥åˆ¶ä½œæ–‡ä»¶åŒ…äº†ã€‚ [root@CentOS1 ~]# rpmbuild -bb rpmbuild/SPECS/helloworld.spec [root@CentOS1 ~]# ls rpmbuild/RPMS/x86_64/helloworld-1.0.0-1.el7.x86_64.rpm rpmbuild/RPMS/x86_64/helloworld-1.0.0-1.el7.x86_64.rpm ç”Ÿæˆçš„rpmåŒ…å°±å¯ä»¥ä½¿ç”¨ rpm -ivh å‘½ä»¤å®‰è£…äº† specæ–‡ä»¶è¯´æ˜ æ¥ä¸‹æ¥è¯´æ˜specæ–‡ä»¶çš„è¯­æ³•è§„åˆ™ã€‚ä¸€èˆ¬çš„specæ–‡ä»¶å¤´åŒ…å«ä»¥ä¸‹å‡ ä¸ªåŸŸï¼š ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:4:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"Name æè¿°ï¼š è½¯ä»¶åŒ…çš„åç§°ï¼Œåé¢å¯ä½¿ç”¨%{name}çš„æ–¹å¼å¼•ç”¨ æ ¼å¼ï¼š Name: ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:5:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"Version æè¿°ï¼š è½¯ä»¶åŒ…çš„åç§°ï¼Œåé¢å¯ä½¿ç”¨%{name}çš„æ–¹å¼å¼•ç”¨è½¯ä»¶åŒ…ç‰ˆæœ¬å·ï¼Œåé¢å¯ä½¿ç”¨%{version}å¼•ç”¨ æ ¼å¼ï¼š Version: ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:6:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"Release æè¿°ï¼š è½¯ä»¶åŒ…çš„å‘è¡Œå·ï¼Œåé¢å¯ä½¿ç”¨%{release}å¼•ç”¨ æ ¼å¼ï¼š Release: ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:7:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"Packager æè¿°ï¼š æ‰“åŒ…çš„äººï¼ˆä¸€èˆ¬å–œæ¬¢å†™ä¸ªäººé‚®ç®±ï¼‰ æ ¼å¼ï¼š Packager: youner_liucn@126.com ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:8:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"License æè¿°ï¼š è½¯ä»¶æˆæƒæ–¹å¼ï¼Œé€šå¸¸æ˜¯GPLï¼ˆè‡ªç”±è½¯ä»¶ï¼‰æˆ–GPLv2,BSD æ ¼å¼ï¼š License: GPL ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:9:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"Summary æè¿°ï¼š è½¯ä»¶æ‘˜è¦ä¿¡æ¯ æ ¼å¼ï¼š Summary: ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:10:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"Group æè¿°ï¼š è½¯ä»¶åŒ…æ‰€å±ç±»åˆ« æ ¼å¼ï¼š Group: Applications/Multimedia å…·ä½“ç±»åˆ«ï¼š Amusements/Gamesï¼ˆå¨±ä¹/æ¸¸æˆï¼‰ Amusements/Graphicsï¼ˆå¨±ä¹/å›¾å½¢ï¼‰ Applications/Archivingï¼ˆåº”ç”¨/æ–‡æ¡£ï¼‰ Applications/Communicationsï¼ˆåº”ç”¨/é€šè®¯ï¼‰ Applications/Databasesï¼ˆåº”ç”¨/æ•°æ®åº“ï¼‰ Applications/Editorsï¼ˆåº”ç”¨/ç¼–è¾‘å™¨ï¼‰ Applications/Emulatorsï¼ˆåº”ç”¨/ä»¿çœŸå™¨ï¼‰ Applications/Engineeringï¼ˆåº”ç”¨/å·¥ç¨‹ï¼‰ Applications/Fileï¼ˆåº”ç”¨/æ–‡ä»¶ï¼‰ Applications/Internetï¼ˆåº”ç”¨/å› ç‰¹ç½‘ï¼‰ Applications/Multimediaï¼ˆåº”ç”¨/å¤šåª’ä½“ï¼‰ Applications/Productivityï¼ˆåº”ç”¨/äº§å“ï¼‰ Applications/Publishingï¼ˆåº”ç”¨/å°åˆ·ï¼‰ Applications/Systemï¼ˆåº”ç”¨/ç³»ç»Ÿï¼‰ Applications/Textï¼ˆåº”ç”¨/æ–‡æœ¬ï¼‰ Development/Debuggersï¼ˆå¼€å‘/è°ƒè¯•å™¨ï¼‰ Development/Languagesï¼ˆå¼€å‘/è¯­è¨€ï¼‰ Development/Librariesï¼ˆå¼€å‘/å‡½æ•°åº“ï¼‰ Development/Systemï¼ˆå¼€å‘/ç³»ç»Ÿï¼‰ Development/Toolsï¼ˆå¼€å‘/å·¥å…·ï¼‰ Documentation ï¼ˆæ–‡æ¡£ï¼‰ SystemEnvironment/Baseï¼ˆç³»ç»Ÿç¯å¢ƒ/åŸºç¡€ï¼‰ SystemEnvironment/Daemons ï¼ˆç³»ç»Ÿç¯å¢ƒ/å®ˆæŠ¤ï¼‰ SystemEnvironment/Kernel ï¼ˆç³»ç»Ÿç¯å¢ƒ/å†…æ ¸ï¼‰ SystemEnvironment/Libraries ï¼ˆç³»ç»Ÿç¯å¢ƒ/å‡½æ•°åº“ï¼‰ SystemEnvironment/Shells ï¼ˆç³»ç»Ÿç¯å¢ƒ/æ¥å£ï¼‰ UserInterface/Desktopsï¼ˆç”¨æˆ·ç•Œé¢/æ¡Œé¢ï¼‰ User Interface/Xï¼ˆç”¨æˆ·ç•Œé¢/Xçª—å£ï¼‰ User Interface/XHardware Support ï¼ˆç”¨æˆ·ç•Œé¢/Xç¡¬ä»¶æ”¯æŒï¼‰ ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:11:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"Source0 æè¿°ï¼š æºä»£ç åŒ…çš„åå­— æ ¼å¼ï¼š Source0: %{name}-%{version}.tar.gz ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:12:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"BuildRoot æè¿°ï¼š ç¼–è¯‘çš„è·¯å¾„ã€‚æ˜¯å®‰è£…æˆ–ç¼–è¯‘æ—¶ä½¿ç”¨çš„â€œè™šæ‹Ÿç›®å½•â€ï¼Œè€ƒè™‘åˆ°å¤šç”¨æˆ·çš„ç¯å¢ƒï¼Œä¸€èˆ¬å®šä¹‰ä¸ºï¼š è¯¥å‚æ•°éå¸¸é‡è¦ï¼Œå› ä¸ºåœ¨ç”Ÿæˆrpmçš„è¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œmake installæ—¶å°±ä¼šæŠŠè½¯ä»¶å®‰è£…åˆ°ä¸Šè¿°çš„è·¯å¾„ä¸­ï¼Œåœ¨æ‰“åŒ…çš„æ—¶å€™ï¼ŒåŒæ ·ä¾èµ–â€œè™šæ‹Ÿç›®å½•â€ä¸ºâ€œæ ¹ç›®å½•â€è¿›è¡Œæ“ä½œ(å³%filesæ®µ)ã€‚ åé¢å¯ä½¿ç”¨$RPM_BUILD_ROOT æ–¹å¼å¼•ç”¨ã€‚ æ ¼å¼ï¼š BuildRootï¼š%{_tmppath}/%{name}-%{version}-%{release}-buildroot ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:13:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"URL æè¿°ï¼š è½¯ä»¶çš„ä¸»é¡µ æ ¼å¼ï¼š URL: ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:14:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"Vendor æè¿°ï¼š å‘è¡Œå•†æˆ–æ‰“åŒ…ç»„ç»‡çš„ä¿¡æ¯ï¼Œä¾‹å¦‚RedFlagCo,Ltd æ ¼å¼ï¼š Vendor: \u003cRedFlag Co,Ltd\u003e ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:15:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"Provides æè¿°ï¼š æŒ‡æ˜æœ¬è½¯ä»¶ä¸€äº›ç‰¹å®šçš„åŠŸèƒ½ï¼Œä»¥ä¾¿å…¶ä»–rpmè¯†åˆ« æ ¼å¼ï¼š Provides: æè¿°ï¼šæŒ‡æ˜æœ¬è½¯ä»¶ä¸€äº›ç‰¹å®šçš„åŠŸèƒ½ï¼Œä»¥ä¾¿å…¶ä»–rpmè¯†åˆ«æ ¼å¼ï¼šProvides: ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:16:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"ä¾èµ–å…³ç³» ä¾èµ–å…³ç³»å®šä¹‰äº†ä¸€ä¸ªåŒ…æ­£å¸¸å·¥ä½œéœ€è¦ä¾èµ–çš„å…¶ä»–åŒ…ï¼ŒRPMåœ¨å‡çº§ã€å®‰è£…å’Œåˆ é™¤çš„æ—¶å€™ä¼šç¡®ä¿ä¾èµ–å…³ç³»å¾—åˆ°æ»¡è¶³ã€‚rpmæ”¯æŒ4ç§ä¾èµ–ï¼š Requirements, åŒ…ä¾èµ–å…¶ä»–åŒ…æ‰€æä¾›çš„åŠŸèƒ½ Provides, è¿™ä¸ªåŒ…èƒ½æä¾›çš„åŠŸèƒ½ Conflicts, ä¸€ä¸ªåŒ…å’Œå…¶ä»–åŒ…å†²çªçš„åŠŸèƒ½ Obsoletes, å…¶ä»–åŒ…æä¾›çš„åŠŸèƒ½å·²ç»ä¸æ¨èä½¿ç”¨äº†ï¼Œè¿™é€šå¸¸æ˜¯å…¶ä»–åŒ…çš„åŠŸèƒ½ä¿®æ”¹äº†ï¼Œè€ç‰ˆæœ¬ä¸æ¨èä½¿ç”¨äº†ï¼Œå¯ä»¥åœ¨ä»¥åçš„ç‰ˆæœ¬ä¸­ä¼šè¢«åºŸå¼ƒã€‚ å®šä¹‰ä¾èµ–å…³ç³»çš„è¯­æ³•æ˜¯ï¼š Requires: capability Provides: capability Obsoletes: capability Conflicts: capability å¤§éƒ¨åˆ†æ—¶å€™ï¼Œcapabilityåº”è¯¥æ˜¯æ‰€ä¾èµ–çš„åŒ…çš„åç§°ã€‚ä¸€è¡Œä¸­ä¹Ÿå¯ä»¥å®šä¹‰å¤šä¸ªä¾èµ–ï¼Œæ¯”å¦‚ï¼š Requires: tbsys tbnetÂ åœ¨æŒ‡å®šä¾èµ–å…³ç³»çš„æ—¶å€™è¿˜å¯ä»¥æŒ‡å®šç‰ˆæœ¬å·ï¼Œæ¯”å¦‚:Requires: tbsys \u003e= 2.0Â ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:17:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"Requires æè¿°ï¼š æ‰€ä¾èµ–çš„è½¯ä»¶åŒ…åç§°, å¯ä»¥ç”¨\u003e=æˆ–\u003c=è¡¨ç¤ºå¤§äºæˆ–å°äºæŸä¸€ç‰¹å®šç‰ˆæœ¬ã€‚ â€œ\u003e=â€å·ä¸¤è¾¹éœ€ç”¨ç©ºæ ¼éš”å¼€ï¼Œè€Œä¸åŒè½¯ä»¶åç§°ä¹Ÿç”¨ç©ºæ ¼åˆ†å¼€ã€‚ æ ¼å¼ï¼š Requires: libpng-devel \u003e= 1.0.20 zlib å…¶å®ƒå†™æ³•ä¾‹å¦‚ï¼š Requires: bzip2 = %{version}, bzip2-libs =%{version} æˆ– Requires: perl(Carp)\u003e=3.2 # éœ€è¦perlæ¨¡å—Carp è¿˜æœ‰ä¾‹å¦‚PreReqã€Requires(pre)ã€Requires(post)ã€Requires(preun)ã€Requires(postun)ã€BuildRequiresç­‰éƒ½æ˜¯é’ˆå¯¹ä¸åŒé˜¶æ®µçš„ä¾èµ–æŒ‡å®šã€‚ ä¾‹å¦‚ï¼š PreReq: capability\u003e=version # capabilityåŒ…å¿…é¡»å…ˆå®‰è£… Conflicts:bash\u003e=2.0 # è¯¥åŒ…å’Œæ‰€æœ‰ä¸å°äº2.0çš„bashåŒ…æœ‰å†²çª ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:18:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"BuildRequires æè¿°ï¼š ç¼–è¯‘æ—¶çš„åŒ…ä¾èµ– æ ¼å¼ï¼š BuildRequires: zlib-devel ä¾èµ–åŒ…æ ¼å¼ï¼š ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:19:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"è¯´æ˜%description è½¯ä»¶åŒ…è¯¦ç»†è¯´æ˜ï¼Œå¯å†™åœ¨å¤šä¸ªè¡Œä¸Šã€‚ %description Consul feature - Service Discovery, HealthChecking, KV, Multi Datacenter ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:20:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"é¢„å¤„ç†%prep é¢„å¤„ç†é€šå¸¸ç”¨æ¥æ‰§è¡Œä¸€äº›è§£å¼€æºç¨‹åºåŒ…çš„å‘½ä»¤ï¼Œä¸ºä¸‹ä¸€æ­¥çš„ç¼–è¯‘å®‰è£…ä½œå‡†å¤‡ã€‚%prepå’Œä¸‹é¢çš„%buildï¼Œ%installæ®µä¸€æ ·ï¼Œé™¤äº†å¯ä»¥æ‰§è¡ŒRPMæ‰€å®šä¹‰çš„å®å‘½ä»¤ï¼ˆä»¥%å¼€å¤´ï¼‰ä»¥å¤–ï¼Œè¿˜å¯ä»¥æ‰§è¡ŒSHELLå‘½ä»¤ã€‚åŠŸèƒ½ä¸Šç±»ä¼¼äº./configureã€‚ä½œç”¨ï¼šç”¨æ¥å‡†å¤‡è¦ç¼–è¯‘çš„è½¯ä»¶ã€‚é€šå¸¸ï¼Œè¿™ä¸€æ®µè½å°†å½’æ¡£ä¸­çš„æºä»£ç è§£å‹ï¼Œå¹¶åº”ç”¨è¡¥ä¸ã€‚è¿™äº›å¯ä»¥ç”¨æ ‡å‡†çš„ shell å‘½ä»¤å®Œæˆï¼Œä½†æ˜¯æ›´å¤šåœ°ä½¿ç”¨é¢„å®šä¹‰çš„å®ã€‚æ£€æŸ¥æ ‡ç­¾è¯­æ³•æ˜¯å¦æ­£ç¡®ï¼Œåˆ é™¤æ—§çš„è½¯ä»¶æºç¨‹åºï¼Œå¯¹åŒ…å«æºç¨‹åºçš„taræ–‡ä»¶è¿›è¡Œè§£ç ã€‚å¦‚æœåŒ…å«è¡¥ä¸ï¼ˆpatchï¼‰æ–‡ä»¶ï¼Œå°†è¡¥ä¸æ–‡ä»¶åº”ç”¨åˆ°è§£å¼€çš„æºç ä¸­ã€‚å®ƒä¸€èˆ¬åŒ…å«%setupä¸%patchä¸¤ä¸ªå‘½ä»¤ã€‚%setupç”¨äºå°†è½¯ä»¶åŒ…æ‰“å¼€ï¼Œæ‰§è¡Œ%patchå¯å°†è¡¥ä¸æ–‡ä»¶åŠ å…¥è§£å¼€çš„æºç¨‹åºä¸­ã€‚ ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:21:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"å®%setup è¿™ä¸ªå®è§£å‹æºä»£ç ï¼Œå°†å½“å‰ç›®å½•æ”¹ä¸ºæºä»£ç è§£å‹ä¹‹åäº§ç”Ÿçš„ç›®å½•ã€‚è¿™ä¸ªå®è¿˜æœ‰ä¸€äº›é€‰é¡¹å¯ä»¥ç”¨ã€‚ä¾‹å¦‚ï¼Œåœ¨è§£å‹åï¼Œ%setup å®å‡è®¾äº§ç”Ÿçš„ç›®å½•æ˜¯%{name}-%{version}å¦‚æœ tar æ‰“åŒ…ä¸­çš„ç›®å½•ä¸æ˜¯è¿™æ ·å‘½åçš„ï¼Œå¯ä»¥ç”¨ -n é€‰é¡¹æ¥æŒ‡å®šè¦åˆ‡æ¢åˆ°çš„ç›®å½•ã€‚ä¾‹å¦‚ï¼š %setup -n %{name}-April2003Rel %setup-q ï¼šå°† tar å‘½ä»¤çš„ç¹å¤è¾“å‡ºå…³é—­ã€‚ %setup -n newdir ï¼šå°†å‹ç¼©çš„è½¯ä»¶æºç¨‹åºåœ¨newdirç›®å½•ä¸‹è§£å¼€ã€‚ %setup -c ï¼šåœ¨è§£å¼€æºç¨‹åºä¹‹å‰å…ˆåˆ›å»ºç›®å½•ã€‚ %setup -b num ï¼šåœ¨åŒ…å«å¤šä¸ªæºç¨‹åºæ—¶ï¼Œå°†ç¬¬numä¸ªæºç¨‹åºè§£å‹ç¼©ã€‚ %setup -T ï¼šä¸ä½¿ç”¨ç¼ºçœçš„è§£å‹ç¼©æ“ä½œã€‚ ä¾‹å¦‚ï¼š %setup -T -b 0 //è§£å¼€ç¬¬ä¸€ä¸ªæºç¨‹åºæ–‡ä»¶ã€‚ -%setup -c -nnewdir //åˆ›å»ºç›®å½•newdirï¼Œå¹¶åœ¨æ­¤ç›®å½•ä¹‹ä¸‹è§£å¼€æºç¨‹åºã€‚ ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:21:1","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"å®%patch è¿™ä¸ªå®å°†å¤´éƒ¨å®šä¹‰çš„è¡¥ä¸åº”ç”¨äºæºä»£ç ã€‚å¦‚æœå®šä¹‰äº†å¤šä¸ªè¡¥ä¸ï¼Œå®ƒå¯ä»¥ç”¨ä¸€ä¸ªæ•°å­—çš„å‚æ•°æ¥æŒ‡ç¤ºåº”ç”¨å“ªä¸ªè¡¥ä¸æ–‡ä»¶ã€‚å®ƒä¹Ÿæ¥å— -b extension å‚æ•°ï¼ŒæŒ‡ç¤º RPM åœ¨æ‰“è¡¥ä¸ä¹‹å‰ï¼Œå°†æ–‡ä»¶å¤‡ä»½ä¸ºæ‰©å±•åæ˜¯ extension çš„æ–‡ä»¶ã€‚ %patch N ï¼šè¿™é‡ŒNæ˜¯æ•°å­—ï¼Œè¡¨ç¤ºä½¿ç”¨ç¬¬Nä¸ªè¡¥ä¸æ–‡ä»¶ï¼Œç­‰ä»·äº%patch-P N -p0 ï¼šæŒ‡å®šä½¿ç”¨ç¬¬ä¸€ä¸ªè¡¥ä¸æ–‡ä»¶ï¼Œ-p1æŒ‡å®šä½¿ç”¨ç¬¬äºŒä¸ªè¡¥ä¸æ–‡ä»¶ã€‚ -s ï¼šåœ¨ä½¿ç”¨è¡¥ä¸æ—¶ï¼Œä¸æ˜¾ç¤ºä»»ä½•ä¿¡æ¯ã€‚ -bname ï¼šåœ¨åŠ å…¥è¡¥ä¸æ–‡ä»¶ä¹‹å‰ï¼Œå°†æºæ–‡ä»¶åä¸ŠåŠ å…¥nameã€‚è‹¥ä¸ºæŒ‡å®šæ­¤å‚æ•°ï¼Œåˆ™ç¼ºçœæºæ–‡ä»¶åŠ å…¥.origã€‚ -T ï¼šå°†æ‰€æœ‰æ‰“è¡¥ä¸æ—¶äº§ç”Ÿçš„è¾“å‡ºæ–‡ä»¶åˆ é™¤ ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:21:2","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"ç¼–è¯‘%build å®šä¹‰ç¼–è¯‘è½¯ä»¶åŒ…æ‰€è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œ è¿™ä¸€èŠ‚ä¸€èˆ¬ç”±å¤šä¸ªmakeå‘½ä»¤ç»„æˆã€‚ä½œç”¨ï¼šåœ¨è¿™ä¸ªæ®µè½ä¸­ï¼ŒåŒ…å«ç”¨æ¥é…ç½®å’Œç¼–è¯‘å·²é…ç½®çš„è½¯ä»¶çš„å‘½ä»¤ã€‚ä¸ Prep æ®µè½ä¸€æ ·ï¼Œè¿™äº›å‘½ä»¤å¯ä»¥æ˜¯ shell å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥æ˜¯å®ã€‚å¦‚æœè¦ç¼–è¯‘çš„å®ä½¿ç”¨äº† autoconfï¼Œé‚£ä¹ˆåº”å½“ç”¨ %configure å®æ¥é…ç½®è½¯ä»¶ã€‚è¿™ä¸ªå®è‡ªåŠ¨ä¸º autoconf æŒ‡å®šäº†å®‰è£…è½¯ä»¶çš„æ­£ç¡®é€‰é¡¹ï¼Œç¼–è¯‘ä¼˜åŒ–çš„è½¯ä»¶ã€‚å¦‚æœè½¯ä»¶ä¸æ˜¯ç”¨ autoconf é…ç½®çš„ï¼Œé‚£ä¹ˆä½¿ç”¨åˆé€‚çš„ shell å‘½ä»¤æ¥é…ç½®å®ƒã€‚è½¯ä»¶é…ç½®ä¹‹åï¼Œå¿…é¡»ç¼–è¯‘å®ƒã€‚ç”±äºå„ä¸ªåº”ç”¨ç¨‹åºçš„ç¼–è¯‘æ–¹æ³•éƒ½å„è‡ªä¸åŒï¼Œæ²¡æœ‰ç”¨æ¥ç¼–è¯‘çš„å®ã€‚åªè¦å†™å‡ºè¦ç”¨æ¥ç¼–è¯‘çš„ shell å‘½ä»¤å°±å¯ä»¥äº†ã€‚ç¯å¢ƒå˜é‡ $RPM_OPT_FLAGS åœ¨ç¼–è¯‘è½¯ä»¶æ—¶å¾ˆå¸¸ç”¨ã€‚è¿™ä¸ª shell å˜é‡åŒ…å«é’ˆå¯¹ gcc ç¼–è¯‘å™¨å¥—ä»¶çš„æ­£ç¡®çš„ä¼˜åŒ–é€‰é¡¹ï¼Œä½¿ç”¨è¿™æ ·çš„è¯­æ³•ï¼š makeCC=\"gcc $RPM_OPT_FLAGS\" æˆ–è€… makeCFLAGS=\"$RPM_OPT_FLAGS\" å°±å¯ä»¥ä¿è¯æ€»æ˜¯ä½¿ç”¨åˆé€‚çš„ä¼˜åŒ–é€‰é¡¹ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ç¼–è¯‘å™¨æ ‡å¿—å’Œé€‰é¡¹ã€‚é»˜è®¤çš„ $RPM_OPT_FLAGS æ˜¯: -O2 -g-march=i386 -mcpu=i686 ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:22:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"å®‰è£…%install å®šä¹‰åœ¨å®‰è£…è½¯ä»¶åŒ…æ—¶å°†æ‰§è¡Œå‘½ä»¤ï¼Œç±»ä¼¼äºmake installå‘½ä»¤ã€‚æœ‰äº›specæ–‡ä»¶è¿˜æœ‰%post-installæ®µï¼Œç”¨äºå®šä¹‰åœ¨è½¯ä»¶å®‰è£…å®Œæˆåçš„æ‰€éœ€æ‰§è¡Œçš„é…ç½®å·¥ä½œã€‚ä½œç”¨ï¼šè¿™ä¸ªæ®µè½ç”¨äºå°†å·²ç¼–è¯‘çš„è½¯ä»¶å®‰è£…åˆ°è™šæ‹Ÿçš„ç›®å½•ç»“æ„ä¸­ï¼Œä»è€Œå¯ä»¥æ‰“åŒ…æˆä¸€ä¸ª RPMã€‚åœ¨ Header æ®µè½ï¼Œå¯ä»¥å®šä¹‰ Buildrootï¼Œå®ƒå®šä¹‰äº†è™šæ‹Ÿç›®å½•æ ‘çš„ä½ç½®ï¼Œè½¯ä»¶å°†å®‰è£…åˆ°é‚£é‡Œã€‚é€šå¸¸ï¼Œå®ƒæ˜¯è¿™æ ·çš„ï¼šBuildroot:%{_tmppath}/%{name}-buildroot ä½¿ç”¨ RPM å†…å»ºçš„å®æ¥æŒ‡å®š /var/tmp ç›®å½•ä¸­ä¸€ä¸ªç§ç”¨çš„ç›®å½•ã€‚åœ¨ spec æ–‡ä»¶çš„å…¶ä½™éƒ¨åˆ†å¯ä»¥ç”¨ shell å˜é‡ $RPM_BUILD_ROOT è·å– Buildroot çš„å€¼ã€‚ mkdir -p $RPM_BUILD_ROOT/usr/share/icons/ cp %{SOURCE3}$RPM_BUILD_ROOT/usr/share/icons/ Install æ®µè½é€šå¸¸åˆ—å‡ºè¦å°†å·²ç¼–è¯‘çš„è½¯ä»¶å®‰è£…åˆ° Buildroot ä¸­çš„å‘½ä»¤ å® %makeinstall å¯ä»¥ç”¨äºå®‰è£…æ”¯æŒ autoconf çš„è½¯ä»¶ã€‚è¿™ä¸ªè½¯ä»¶è‡ªåŠ¨åœ°å°†è½¯ä»¶å®‰è£…åˆ° $RPM_BUILD_ROOT ä¸‹çš„æ­£ç¡®çš„å­ç›®å½•ä¸­ã€‚ æœ‰æ—¶ï¼Œè½¯ä»¶åŒ…å¿…é¡»è¢«æ„å»ºå¤šæ¬¡ï¼Œç”±äºæ‰“åŒ…é”™è¯¯æˆ–å…¶ä»–åŸå› ã€‚æ¯æ¬¡æ„å»ºæ—¶ï¼ŒInstall æ®µè½å°†å¤åˆ¶æ–‡ä»¶åˆ° Buildroot ä¸­ã€‚è¦é˜²æ­¢ç”±äº Buildroot ä¸­çš„æ—§æ–‡ä»¶è€Œå¯¼è‡´é”™è¯¯çš„æ‰“åŒ…ï¼Œå¿…é¡»åœ¨å®‰è£…æ–°æ–‡ä»¶ä¹‹å‰å°† Buildroot ä¸­ä»»ä½•ç°æœ‰çš„æ–‡ä»¶åˆ é™¤ã€‚ä¸ºæ­¤ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ª clean è„šæœ¬ã€‚è¿™ä¸ªè„šæœ¬é€šå¸¸ä»¥ %clean æ ‡è®°è¡¨ç¤ºï¼Œé€šå¸¸ä»…ä»…åŒ…å«è¿™æ ·ä¸€å¥ï¼š rm -rf$RPM_BUILD_ROOT å¦‚æœæœ‰çš„è¯ï¼Œåœ¨åˆ¶ä½œäº†åœ¨ Install æ®µè½ä¸­å®‰è£…çš„æ–‡ä»¶çš„æ‰“åŒ…ä¹‹åï¼Œå°†è¿è¡Œ %cleanï¼Œä¿è¯ä¸‹æ¬¡æ„å»ºä¹‹å‰ Buildroot è¢«æ¸…ç©ºã€‚ ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:23:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"æ¸…ç†%clean %clean rm-rf $RPM_BUILD_ROOT ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:24:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"æ–‡ä»¶%files å®šä¹‰è½¯ä»¶åŒ…æ‰€åŒ…å«çš„æ–‡ä»¶ï¼Œåˆ†ä¸ºä¸‰ç±»ï¼šè¯´æ˜æ–‡æ¡£ï¼ˆdocï¼‰ï¼Œé…ç½®æ–‡ä»¶ï¼ˆconfigï¼‰åŠæ‰§è¡Œç¨‹åºï¼Œè¿˜å¯å®šä¹‰æ–‡ä»¶å­˜å–æƒé™ï¼Œæ‹¥æœ‰è€…åŠç»„åˆ«ã€‚ è¿™é‡Œä¼šåœ¨è™šæ‹Ÿæ ¹ç›®å½•ä¸‹è¿›è¡Œï¼Œåƒä¸‡ä¸è¦å†™ç»å¯¹è·¯å¾„ï¼Œè€Œåº”ç”¨å®æˆ–å˜é‡è¡¨ç¤ºç›¸å¯¹è·¯å¾„ã€‚ å¦‚æœæè¿°ä¸ºç›®å½•ï¼Œè¡¨ç¤ºç›®å½•ä¸­é™¤%excludeå¤–çš„æ‰€æœ‰æ–‡ä»¶ã€‚ %defattr (-,root,root) æŒ‡å®šåŒ…è£…æ–‡ä»¶çš„å±æ€§ï¼Œåˆ†åˆ«æ˜¯(mode,owner,group)ï¼Œ-è¡¨ç¤ºé»˜è®¤å€¼ï¼Œå¯¹æ–‡æœ¬æ–‡ä»¶æ˜¯0644ï¼Œå¯æ‰§è¡Œæ–‡ä»¶æ˜¯0755 ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:25:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"æ›´æ–°æ—¥å¿—%changelog æ¯æ¬¡è½¯ä»¶çš„æ›´æ–°å†…å®¹å¯ä»¥è®°å½•åœ¨æ­¤åˆ°è¿™é‡Œï¼Œä¿å­˜åˆ°å‘å¸ƒçš„è½¯ä»¶åŒ…ä¸­ï¼Œä»¥ä¾¿æŸ¥è¯¢ä¹‹ç”¨ã€‚ æ›´å¤æ‚çš„spec Name: oracle-agent Version: 1.0.1 Release: 1%{?dist} Summary: oracle agent Group: Development/Tools License: GPL #URL: Source0: %{name}-%{version}.tar.gz #BuildRequires: #Requires: %define __debug_install_post %{rpmconfigdir}/find-debuginfo.sh %{?find_debuginfo_opts} \"%{_builddir}/%{?buildsubdir}\" %{nil} %description %pre %setup -q %build %install $RPM_BUILD_ROOT # å¯¹åº”æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•ï¼Œéœ€è¦çš„è·¯å¾„è¦å…ˆåˆ›å»º $RPM_BUILD_DIR # å¯¹åº”tarè§£å‹åçš„æ–‡ä»¶ç›®å½• mkdir -p $RPM_BUILD_ROOT/etc/init.d/ mkdir -p $RPM_BUILD_ROOT/opt/howlink/oracle-agent cp -r $RPM_BUILD_DIR/%{name}-%{version}/* $RPM_BUILD_ROOT/opt/howlink/oracle-agent/ rm -fr $RPM_BUILD_ROOT/opt/howlink/oracle-agent/debug*.list rm -fr $RPM_BUILD_ROOT/opt/howlink/oracle-agent/elfbins.list cp $RPM_BUILD_ROOT/opt/howlink/oracle-agent/oracle-agent-default.sh $RPM_BUILD_ROOT/etc/init.d/oracle-agent chmod 755 $RPM_BUILD_ROOT/etc/init.d/oracle-agent %post systemctl daemon-reload systemctl start oracle-agent %clean # è¿™é‡Œæ¸…ç†è¦æ³¨æ„ rm -rf $RPM_BUILD_ROOT/opt/howlink/oracle-agent %files # ç”Ÿæˆçš„æ–‡ä»¶è¦è¿™é‡Œæ·»åŠ  %defattr(-,root,root,-) %doc /opt/howlink/oracle-agent /etc/init.d/oracle-agent %preun systemctl stop oracle-agent %changelog é—®é¢˜æ±‡æ€» rpmbuildæŠ¥error: Installed (but unpackaged) file(s) foundçš„é—®é¢˜ æ‰¾åˆ° /usr/lib/rpm/macros ä¸­ %__check_files /usr/lib/rpm/check-files %{buildroot} æ³¨é‡Šæ‰ #%__check_files /usr/lib/rpm/check-files %{buildroot} æ„æ€å°±æ˜¯è¯´ä¸è¦åœ¨æ£€æŸ¥æ–‡ä»¶äº†ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸ä¼šåŒ…file foundçš„æŠ¥é”™äº† check-rpathsçš„é—®é¢˜ æŠ¥error ERROR 0002: file 'xxx.so' contains an invalid rpath 'xxx' in [xxx] ç»è¿‡ç½‘ä¸ŠæŸ¥è¯¢ï¼Œå¾—çŸ¥è¿™ä¸€æ­¥åªæ˜¯ä¸€ç§æ£€æµ‹æ˜¯ä¸æ˜¯ä»£ç ä¸­ä½¿ç”¨äº†rpathï¼Œé‚£æˆ‘ä»¬å¯ä»¥ç®€å•çš„æ³¨é‡Šæ‰rpathæ£€æµ‹å°±å¯ä»¥äº†ï¼Œå…·ä½“åšæ³•å°±æ˜¯ï¼š vi ~/.rpmmacros æ‰¾åˆ°è¿™è¡Œ %__arch_install_post /usr/lib/rpm/check-rpaths /usr/lib/rpm/check-buildroot æ³¨é‡Šæ‰ #%__arch_install_post /usr/lib/rpm/check-rpaths /usr/lib/rpm/check-buildroot .åœ¨ç”ŸæˆrpmåŒ…åŒæ—¶ï¼Œè¿˜ä¼šç”ŸæˆdebuginfoåŒ…ï¼Œå¦‚æœè¦é¿å…ç”ŸæˆdebuginfoåŒ…ï¼šè¿™ä¸ªæ˜¯é»˜è®¤ä¼šç”Ÿæˆçš„rpmåŒ…ã€‚åˆ™å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š echo '%debug_package %{nil}' \u003e\u003e ~/.rpmmacros æŠŠ%debug_package %{nil} è¿½åŠ åˆ° ~/.rpmmacros æ–‡ä»¶ä¸­ä¾¿å¯ã€‚ (%prep)é˜¶æ®µæç¤ºåŒ…æ‰¾ä¸åˆ° å¯ä»¥æ˜¯è½¯ä»¶çš„åŒ…è§£å‹åä¸ä¼šç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„ç›®å½•ï¼Œä¸¤ä¸ªè§£å†³æ–¹å¼ï¼š 1.é‡æ–°ä¿®æ”¹taråŒ… 2.%setup -c ","date":"2019-05-29","objectID":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/:26:0","tags":["linux"],"title":"åˆ¶ä½œrpmåŒ…","uri":"/%E5%88%B6%E4%BD%9Crpm%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"å‹å…ƒè¯´æ˜ ç›¸å¯¹äºå…¶ä»–çš„ç¼–ç¨‹è¯­è¨€ï¼Œâ€œå‹å…ƒâ€æ˜¯C++ä¸­ç‰¹åˆ«çš„ä¸€ç§è¯­æ³•ã€‚é‚£å®ƒæœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ å…¶å®â€œå‹å…ƒâ€å°±æ˜¯æä¾›ä¸€ç§è®¿é—®ç±»ç§æœ‰éƒ¨åˆ†çš„çš„æ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰â€œå‹å…ƒâ€ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡ç±»æœ¬èº«æä¾›çš„å…¬æœ‰æ–¹æ³•æ¥è®¿é—®ï¼Œä½†ç›¸å¯¹åœ°ï¼Œè¿™æ ·é™åˆ¶å¤ªé«˜äº†ï¼Œæ‰€ä»¥â€œå‹å…ƒâ€å°±æ˜¯ä¸€ç§çš„åœ¨ç±»çš„å°è£…æ€§å’Œå®ç”¨æ€§ä¸­å¾ˆå¥½çš„â€œæŠ˜ä¸­â€æ–¹å¼ã€‚ C++ä¸­çš„å‹å…ƒæœ‰ä¸‰ç§ï¼š å‹å…ƒå‡½æ•° å‹å…ƒç±» å‹å…ƒæˆå‘˜å‡½æ•° C++ä¸­ä½¿ç”¨å…³é”®å­—friendæ¥å®šä¹‰ã€‚ å‹å…ƒå‡½æ•° è¿™é‡Œç›´æ¥ç”¨ä»£ç æ¥è¯´æ˜ï¼š #include \u003ciostream\u003e#include \u003cstring\u003e class Person { private: std::string account; std::string passwd; public: Person(std::string ac, std::string pw); // è¿™é‡Œä½¿ç”¨friendå…³é”®å­—ï¼ŒæŒ‡å®šPointä¸­çš„getPersonæ–¹æ³•å¯ä»¥ä½¿ç”¨Personç±»çš„ç§æœ‰å˜é‡ã€‚ friend void getPerson(Person \u0026p); }; Person::Person(std::string ac, std::string pw) { account = ac; passwd = pw; } void getPerson(Person \u0026p) { // å› ä¸ºå®šä¹‰äº†å‹å…ƒï¼Œè¿™é‡Œå°±å¯ä»¥è®¿é—®Personç±»çš„ç§æœ‰å˜é‡äº†ã€‚ std::cout \u003c\u003c \"account: \" \u003c\u003c p.account \u003c\u003c \", passwd: \" \u003c\u003c p.passwd \u003c\u003c std::endl; } int main() { Person p(\"xingyys\", \"123456\"); getPerson(p); return 0; } è¿™ä¸ªä¾‹å­è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œåªè¦åœ¨æŒ‡å®šçš„æ–¹æ³•ä¸­æ·»åŠ å…³é”®å­—å°±å¯ä»¥å®ç°äº†ã€‚ å‹å…ƒç±» åœ¨æ¥ä¸€ä¸ªä¾‹å­è¯´æ˜ï¼š #include \u003ciostream\u003e#include \u003cstring\u003e class Tv { private: int state; int volume; int maxchannel; int channel; int mode; int input; public: // åœ¨è¿™é‡ŒæŒ‡å®šè°æ˜¯ä»–çš„å‹å…ƒ friend class Remote; enum { Off, On }; enum { MinVal, MaxVal = 20 }; enum { Antenna, Cable }; enum { TV, DVD }; Tv(int s = Off, int mc = 125) : state(s), volume(5), maxchannel(mc), channel(2), mode(Cable), input(TV) {} void onoff() { state = (state == On) ? Off : On; } bool ison() const { return state == On; } bool volup(); bool voldown(); void chanup(); void chandown(); void set_mode() { mode = (mode == Antenna) ? Cable : Antenna; } void set_input() { input = (input == TV) ? DVD : TV; } void settings() const; }; class Remote { private: int mode; public: Remote(int m = Tv::TV) : mode(m) {} bool volup(Tv \u0026t) { return t.volup(); } bool voldown(Tv \u0026t) { return t.voldown(); } void onoff(Tv \u0026t) { t.onoff(); } void chanup(Tv \u0026t) { t.chanup(); } void chandown(Tv \u0026t) { t.chandown(); } void set_chan(Tv \u0026t, int c) { t.channel = c; } void set_mode(Tv \u0026t) { t.set_mode(); } void set_input(Tv \u0026t) { t.set_input(); } }; bool Tv::volup() { if (volume \u003c MaxVal) { volume++; return true; } else { return false; } } bool Tv::voldown() { if (volume \u003e MinVal) { volume--; return true; } else { return false; } } void Tv::chanup() { if (channel \u003c maxchannel) channel++; else channel = 1; } void Tv::chandown() { if (channel \u003e 1) channel--; else channel = maxchannel; } void Tv::settings() const { using std::cout; using std::endl; cout \u003c\u003c \"TV is \" \u003c\u003c (state == Off ? \"Off\" : \"On\") \u003c\u003c endl; if (state == On) { cout \u003c\u003c \"Volume setting = \" \u003c\u003c volume \u003c\u003c endl; cout \u003c\u003c \"Channel setting = \" \u003c\u003c channel \u003c\u003c endl; cout \u003c\u003c \"Mode = \" \u003c\u003c (mode == Antenna ? \"antenna\" : \"cable\") \u003c\u003c endl; cout \u003c\u003c \"Input = \" \u003c\u003c (input == TV ? \"TV\" : \"DVD\") \u003c\u003c endl; } } int main() { using std::cout; Tv s42; cout \u003c\u003c \"Initial setting for 42\\\"TV:\\n\"; s42.settings(); s42.onoff(); s42.chanup(); cout \u003c\u003c \"\\nAdjusted setting for 42\\\"TV:\\n\"; s42.chanup(); cout \u003c\u003c \"\\nAdjusted settings for 42\\\"TV:\\n\"; s42.settings(); Remote grey; grey.set_chan(s42, 10); grey.volup(s42); grey.volup(s42); cout \u003c\u003c \"\\n42\\\"setting after using remote:\\n\"; s42.settings(); Tv s58(Tv::On); s58.set_mode(); grey.set_chan(s58, 28); cout \u003c\u003c \"\\n58\\\"settings:\\n\"; s58.settings(); return 0; } å‹å…ƒæˆå‘˜å‡½æ•° #include \u003ciostream\u003e#include \u003cstring\u003e class Person; class Point { public: void getPerson(Person \u0026p); }; class Person { private: std::string account; std::string passwd; public: Person(std::string ac, std::string pw); // è¿™é‡Œä½¿ç”¨friendå…³é”®å­—ï¼ŒæŒ‡å®šPointä¸­çš„getPersonæ–¹æ³•å¯ä»¥ä½¿ç”¨Personç±»çš„ç§æœ‰å˜é‡ã€‚ friend void Point::getPerson(Person \u0026p); }; Person::Person(std::string ac, std::string pw) { account = ac; passwd = pw; } void Point::getPerson(Person \u0026p) { // å› ä¸ºå®šä¹‰äº†å‹å…ƒï¼Œè¿™é‡Œå°±å¯ä»¥è®¿é—®Personç±»çš„ç§æœ‰å˜é‡äº†ã€‚ std::cout \u003c\u003c \"account: \" \u003c\u003c p.account \u003c\u003c \", passwd: \" \u003c\u003c p.passwd \u003c\u003c std::endl; } int main() { Person p (\"xingyys\", \"123456\"); Point pt; pt.getPerson(p); return 0; } è¡¥å…… ä¸èƒ½å®šä¹‰ç±»çš„å¯¹è±¡ã€‚ å¯ä»¥ç”¨äºå®šä¹‰æŒ‡å‘è¿™ä¸ªç±»å‹çš„æŒ‡é’ˆæˆ–å¼•ç”¨ã€‚ ç”¨äºå£°æ˜(ä¸æ˜¯å®šä¹‰)ï¼Œä½¿ç”¨è¯¥ç±»å‹ä½œä¸ºå½¢å‚ç±»å‹æˆ–è€…å‡½æ•°çš„è¿”å›å€¼ç±»å‹ã€‚ å‹å…ƒå…³ç³»ä¸èƒ½è¢«ç»§æ‰¿ã€‚ å‹å…ƒå…³ç³»æ˜¯å•å‘çš„ï¼Œä¸å…·æœ‰äº¤æ¢æ€§ã€‚è‹¥ç±»Bæ˜¯ç±»Açš„å‹å…ƒï¼Œç±»Aä¸ä¸€å®šæ˜¯ç±»Bçš„å‹å…ƒï¼Œè¦çœ‹åœ¨ç±»ä¸­æ˜¯å¦æœ‰ç›¸åº”çš„å£°æ˜ã€‚ å‹å…ƒå…³ç³»ä¸å…·æœ‰ä¼ é€’æ€§ã€‚è‹¥ç±»Bæ˜¯ç±»Açš„å‹å…ƒï¼Œç±»Cæ˜¯Bçš„å‹å…ƒï¼Œç±»Cä¸ä¸€å®šæ˜¯ç±»Açš„å‹å…ƒï¼ŒåŒæ ·è¦çœ‹ç±»ä¸­æ˜¯å¦æœ‰ç›¸åº”çš„ç”³æ˜ ","date":"2019-05-11","objectID":"/c-%E5%8F%8B%E5%85%83/:0:0","tags":["C++"],"title":"C++å‹å…ƒ","uri":"/c-%E5%8F%8B%E5%85%83/"},{"categories":["è¿ç»´"],"content":"æœ€è¿‘é¡¹ç›®éœ€è¦å† windows ä¸Šåšå¼€å‘ï¼Œè€Œä¸”ä¸€äº›è‡ªåŠ¨åŒ–çš„å¤„ç†éœ€è¦ä½¿ç”¨ windows çš„çš„è„šæœ¬ã€‚æ‰€ä»¥åšäº›è®°å½•ï¼Œé˜²æ­¢é—å¿˜ã€‚ åŸºæœ¬çš„è¯­æ³• é¦–å…ˆä»åŸºç¡€å¼€å§‹å§ï¼Œä¹‹å‰éƒ½æ˜¯ä½¿ç”¨ linux bash çš„ã€‚å¯ä»¥è¯´ windows bat è„šæœ¬å’Œ linux bash è„šæœ¬è¿˜æ˜¯æœ‰å¾ˆå¤šåŒºåˆ«çš„ã€‚ ","date":"2019-03-22","objectID":"/bat/:0:0","tags":["bat","è„šæœ¬"],"title":"Windows Batæ€»ç»“","uri":"/bat/"},{"categories":["è¿ç»´"],"content":"è®¾ç½®å˜é‡ å˜é‡è®¾ç½®ä½¿ç”¨çš„å‘½ä»¤ä¸ºsetã€‚ set a=\"hello world\" echo %a% ä»ä¸Šé¢çš„è„šæœ¬ä¸­å¯ä»¥çŸ¥é“ï¼Œä½¿ç”¨setæ¥è®¾ç½®å˜é‡ï¼Œè¯­æ³•ä¸ºset var=\u003cå€¼\u003eã€‚å¦‚æœè¦å¼•ç”¨è¿™ä¸ªå˜é‡çš„è¯å°±ä½¿ç”¨%var%ã€‚ æ³¨ï¼šbat è„šæœ¬ä¸èƒ½åƒ bash ä¸­ä¸€æ ·è®¾ç½®ä¸´æ—¶å˜é‡ï¼Œåªç”¨å°†å˜é‡è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ã€‚ setå‘½ä»¤çš„åŠŸèƒ½è¿˜æ˜¯æ¯”è¾ƒå¼ºå¤§çš„ï¼Œæ¯”å¦‚è·å–ä»é”®ç›˜ä¸­è¾“å…¥çš„å­—ç¬¦ï¼š set /p a=\"Input a number:\" echo %a% æ”¯æŒç®—æœ¯ï¼š set /a a=1+2 echo %a% set /a a-=1 echo %a% set /a a*=3 echo %a% set /a a/=3 echo %a% è¿™ä¸ªå…³é”®åœ¨äºset /a è¿˜æœ‰å­—ç¬¦ä¸²çš„ä¿®æ”¹å’Œæˆªå–ï¼š :::::::::: å­—ç¬¦ä¸²çš„æˆªå– :::::::::: set a=Hello Windows Bat :: æˆªå–æ‰€æœ‰ set a=%a:~0% :: æˆªå–æŒ‡å®šçš„ set a=%a:~1,-1% set a=%a:~2,4% :::::::::: å­—ç¬¦ä¸²çš„æ›¿æ¢ :::::::::: set a=Hello Windows :: å°†Windowsæ›¿æ¢æˆLinux set a=%a:Windows=Linux% ","date":"2019-03-22","objectID":"/bat/:1:0","tags":["bat","è„šæœ¬"],"title":"Windows Batæ€»ç»“","uri":"/bat/"},{"categories":["è¿ç»´"],"content":"æ³¨é‡Š bat ä¸­èƒ½å®ç°æ³¨é‡ŠåŠŸèƒ½çš„æœ‰ä¸¤ä¸ª::å’Œremã€‚ å®ƒä»¬çš„ä¸åŒç‚¹æ˜¯ï¼šremæ˜¯ä¸€æ¡å‘½ä»¤ï¼Œåœ¨è¿è¡Œçš„æ—¶å€™ç›¸å½“äºæŠŠremæœ¬èº«åŠå…¶åé¢çš„å†…å®¹ç½®ç©ºã€‚æ—¢ç„¶å®ƒæ˜¯ä¸€æ¡å‘½ä»¤ï¼Œå°±å¿…é¡»å¤„äºå•ç‹¬çš„ä¸€è¡Œæˆ–è€…æœ‰ç±»ä¼¼ â€œ\u0026â€ çš„è¿æ¥ç¬¦å·è¿æ¥ã€‚ bat é‡åˆ°ä»¥å†’å· â€œ:â€ å¼€å¤´çš„è¡Œæ—¶ï¼ˆå¿½ç•¥å†’å·å‰çš„ç©ºæ ¼ï¼‰ï¼Œä¼šå°†å…¶åçš„è¯­å¥è¯†åˆ«ä¸ºâ€œæ ‡è®°â€è€Œä¸æ˜¯å‘½ä»¤è¯­å¥ï¼Œå› æ­¤ç±»ä¼¼ â€œ:labelâ€ è¿™æ ·çš„åœ¨ bat ä¸­ä»…ä»…æ˜¯ä¸€ä¸ªæ ‡è®°ã€‚ æ³¨: ä½¿ç”¨ bat ä¸­çš„æ³¨é‡Šæ—¶éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œä¸è¦å† () çš„è¾¹ä¸Šä½¿ç”¨æ³¨é‡Šã€‚ ","date":"2019-03-22","objectID":"/bat/:2:0","tags":["bat","è„šæœ¬"],"title":"Windows Batæ€»ç»“","uri":"/bat/"},{"categories":["è¿ç»´"],"content":"æ¡ä»¶åˆ¤æ–­ bat ä¸­çš„æ¡ä»¶åˆ¤æ–­ä¹Ÿæ˜¯ä½¿ç”¨ifã€‚ set a=1 if %a%==1 ( echo OK ) else ( echo ERROR ) å¦‚æœæ—¶åˆ¤æ–­å­—ç¬¦ä¸²ä½¿ç”¨ä¸ºç©ºæ—¶,å¯ä»¥è¿™æ ·å¤„ç†: set a=\"hello\" if (%a%)==() ( echo OK ) else ( echo ERROR ) ","date":"2019-03-22","objectID":"/bat/:3:0","tags":["bat","è„šæœ¬"],"title":"Windows Batæ€»ç»“","uri":"/bat/"},{"categories":["è¿ç»´"],"content":"å¾ªç¯è¯­å¥ bat ä¸­çš„å¾ªç¯æœ‰äº›ä¸åŒã€‚å…³é”®å­—ä¹Ÿæ˜¯forã€‚è¿˜æ˜¯å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š for /f \"delims=: tokens=1,2,3\" %%i in ( \"2018:04:11\" ) do ( echo %%i echo %%j ) è¿™æ®µè„šæœ¬ä¸­éœ€è¦æ³¨æ„çš„ç‚¹æ˜¯ï¼šdelims=:è¡¨ç¤ºä½¿ç”¨ â€œ:â€ æ¥åˆ†å‰²å­—ç¬¦ä¸²ï¼Œè€Œtokens=1,2,3åˆ™è¡¨ç¤ºå–å‡ºåˆ†å‰²åçš„å­—ç¬¦ä¸²çš„éƒ¨åˆ†ï¼Œä»1å¼€å§‹ã€‚%%iæ˜¯å¾ªç¯ä¸­çš„æ¯ä¸ªé¡¹ã€‚è¾“å‡ºæ—¶%%iå’Œ%%jåˆ†åˆ«å¯¹åº”çš„å°±æ˜¯æˆªå–çš„å­—æ®µ1å’Œ2ã€‚å¦‚æœè¿˜éœ€è¦è¾“å‡ºç¬¬ä¸‰ä¸ªï¼Œä¹Ÿæ˜¯ä½¿ç”¨%%kè¡¨ç¤ºï¼Œä¾æ¬¡ç±»æ¨ã€‚ ä½† bat ä¸­çš„forä¼šå­˜åœ¨å»¶è¿Ÿèµ‹å€¼çš„æƒ…å†µï¼Œå…ˆæ¥çœ‹ä¸€æ®µè„šæœ¬: for /f \"delims=: tokens=2\" %%i in ( 'ipconfig /all ^| findstr /i \"ipv4\" ' ) do ( echo %%i set a=%%i echo %a% ) è¾“å‡ºç»“æœ: IPv4 åœ°å€ . . . . . . . . . . . . : 192.168.168.1(é¦–é€‰) IPv4 åœ°å€ . . . . . . . . . . . . : 192.168.2.160(é¦–é€‰ IPv4 åœ°å€ . . . . . . . . . . . . : 192.168.157.1(é¦–é€‰) IPv4 åœ°å€ . . . . . . . . . . . . : 192.168.2.160(é¦–é€‰ IPv4 åœ°å€ . . . . . . . . . . . . : 192.168.2.160(é¦–é€‰) IPv4 åœ°å€ . . . . . . . . . . . . : 192.168.2.160(é¦–é€‰ %a%çš„å€¼ä¸€ç›´ç­‰äºæœ€åä¸€é¡¹ã€‚ ","date":"2019-03-22","objectID":"/bat/:4:0","tags":["bat","è„šæœ¬"],"title":"Windows Batæ€»ç»“","uri":"/bat/"},{"categories":["è¿ç»´"],"content":"å‡½æ•° bat ä¸­å‡½æ•°æ˜¯ä½¿ç”¨:labelæ–¹å¼å®šä¹‰çš„ï¼Œä½¿ç”¨callæ¥è°ƒç”¨: call :test Hello World goto EXIT :test echo %1 %2 :EXIT è„šæœ¬ä¸­çš„gotoç”¨æ¥è·³è½¬é€€å‡ºï¼Œè€Œä¸”å‡½æ•°è¦æ”¾åœ¨è„šæœ¬çš„å°¾éƒ¨ï¼Œå­˜åœ¨å¤šä¸ªå‡½æ•°æ—¶è¿˜éœ€è¦ä½¿ç”¨gotoç›´æ¥è·³è½¬ï¼Œå› ä¸ºè„šæœ¬æ˜¯ä¼šæŒ‰é¡ºåºæ‰§è¡Œä¸‹å»çš„ã€‚ å®æˆ˜æ“ä½œ @echo off set option=%1 set address=%2 if (%option%) == () ( echo \"Usage: connectIscsi.bat \u003cstart|stop\u003e \u003caddress\u003e\" goto EXIT ) if (%address%) == () ( echo \"Usage: connectIscsi.bat \u003cstart|stop\u003e \u003caddress\u003e\" goto EXIT ) if %option% == start ( call :start %address% ) else if %option% == stop ( call :stop %address% ) else ( echo \"Usage: connectIscsi.bat \u003cstart|stop\u003e \u003caddress\u003e\" goto EXIT ) ::sc config msiscsi start=auto ::net start msiscsi goto EXIT :: è¿æ¥iscsiæœåŠ¡å™¨ :start iscsicli QAddTargetPortal %1 for /f \"delims= tokens=1\" %%i in ( 'iscsicli ListTargets t ^| findstr /i \"iqn.2018-11\" ' ) do ( iscsicli qlogintarget %%i ) goto EXIT :: æ–­å¼€iscsiæœåŠ¡å™¨ :stop set a= for /f \"delims=: tokens=2\" %%i in ('iscsicli SessionList ^| findstr /i \"fffffa8\"') do ( set a=%%i goto return ) :return set a=%a: =0x% set a=%a:-=-0x% iscsicli LogoutTarget %a% iscsicli RemoveTargetPortal %1 3260 goto EXIT :EXIT è¿™ä¸ªè„šæœ¬æ˜¯ç”¨æ¥è¿æ¥å’Œæ–­å¼€iscsiæœåŠ¡å™¨çš„ã€‚è„šæœ¬æœ‰ä¸¤ä¸ªå…¥å‚ï¼Œoption å’Œ addressã€‚è¿æ¥å’Œæ–­å¼€iscsiæœåŠ¡å™¨ã€‚è„šæœ¬çš„æ€è·¯å¾ˆç®€å•ï¼Œå¼€å§‹åˆ¤æ–­è¾“å…¥å‚æ•°æ˜¯å¦æ­£ç¡®ã€‚ç„¶åæ ¹æ® option é€‰æ‹©æ‰§è¡Œå¯¹åº”çš„å‡½æ•°ã€‚ç‰¹åˆ«åœ¨:stopä¸­ï¼Œå› ä¸ºå»¶æ—¶å¤åˆ¶çš„å…³ç³»ï¼Œæ‰€ä»¥å¾ªç¯ä½“ä¸­åªæ”¾ç®€å•çš„å¤åˆ¶ï¼Œå¤„ç†éƒ¨åˆ†åœ¨å¤–é¢è¿›è¡Œå¤„ç†ã€‚ åè®° ","date":"2019-03-22","objectID":"/bat/:5:0","tags":["bat","è„šæœ¬"],"title":"Windows Batæ€»ç»“","uri":"/bat/"},{"categories":["è¿ç»´"],"content":"å»¶æ—¶èµ‹å€¼é—®é¢˜ bat çš„å»¶æ—¶èµ‹å€¼æœ‰å¯¹åº”çš„è§£å†³æ–¹æ³•ï¼š SETLOCAL ENABLEDELAYEDEXPANSION set a=hello set a=!a! set a=!a:~1! ","date":"2019-03-22","objectID":"/bat/:6:0","tags":["bat","è„šæœ¬"],"title":"Windows Batæ€»ç»“","uri":"/bat/"},{"categories":["ç¬”è®°","ä»£ç "],"content":"æ‰“åŒ… // æ‰“åŒ… func Compress(destPath, srcDir string) error { // å‹ç¼©æ–‡ä»¶è·¯å¾„ fw, err := os.Create(destPath) if err != nil { return err } defer fw.Close() // gzip writer gw := gzip.NewWriter(fw) defer gw.Close() // tar writer tw := tar.NewWriter(gw) defer tw.Close() // è¯»å–è¦å‹ç¼©çš„ç›®å½• dir, err := os.Open(srcDir) if err != nil { return err } defer dir.Close() // è¯»å–ç›®å½•å†…å®¹ files, err := dir.Readdir(0) if err != nil { return err } for _, file := range files { if file.IsDir() { continue } // è·¯å¾„è¡¥å…¨ filePath := path.Join(dir.Name(), file.Name()) fread, err := os.Open(filePath) if err != nil { continue } // è·å–æ–‡ä»¶å¤´éƒ¨ä¿¡æ¯ h := \u0026tar.Header{} h.Name = file.Name() h.Size = file.Size() h.Mode = int64(file.Mode()) h.ModTime = file.ModTime() err = tw.WriteHeader(h) if err == nil { // å¼€å§‹å‹ç¼©ï¼Œè¿™é‡Œç­‰äºå¿½ç•¥é”™è¯¯ io.Copy(tw, fread) } // è®°å¾—å…³é—­æ–‡ä»¶ fread.Close() } return nil } è§£åŒ… // è§£å‹ func DeCompress(srcPath, destDir string) error { // è§£å‹åŒ…çš„è·¯å¾„ fread, err := os.Open(srcPath) if err != nil { return err } defer fread.Close() // æ£€æµ‹ç›®æ ‡è·¯å¾„æ˜¯å¦å­˜åœ¨ _, err = os.Stat(destDir) if err != nil { return err } // gzip reader gr, err := gzip.NewReader(fread) if err != nil { return err } defer gr.Close() // tr reader tr := tar.NewReader(gr) for { // è·å–ä¸‹ä¸€ä¸ªæ–‡ä»¶ h, err := tr.Next() // è¯»å–å®Œæ¯• if err == io.EOF { break } if err != nil { continue } fw, err := os.OpenFile(path.Join(destDir, h.Name), os.O_CREATE|os.O_WRONLY, 0644) if err == nil { io.Copy(fw, tr) fw.Close() } } return nil } ","date":"2019-02-15","objectID":"/golang%E6%89%93%E5%8C%85%E5%92%8C%E8%A7%A3%E5%8C%85/:0:0","tags":["golang"],"title":"golangæ‰“åŒ…å’Œè§£åŒ…","uri":"/golang%E6%89%93%E5%8C%85%E5%92%8C%E8%A7%A3%E5%8C%85/"},{"categories":["ç¬”è®°"],"content":"éœ€æ±‚å’Œåˆ†æ åœ¨ä¸€æ¬¡é¡¹ç›®ä¸­éœ€è¦å°†è¿›è¡Œoracleæ•°æ®åº“çš„å¤‡ä»½ï¼Œè¦æ±‚åœ¨oracleæœºå™¨æ€»æ˜¯èƒ½è®¤åˆ°å¤‡ä»½çš„å—è®¾å¤‡çš„è·¯å¾„ä»¥ä¿è¯å¤‡ä»½å’Œæ¢å¤çš„æ­£å¸¸ã€‚åŒæ—¶è¿˜éœ€è¦å¯¹ç£ç›˜è¿›è¡Œä¿®æ”¹ï¼Œè½¬åŒ–ä¸­asmæ ¼å¼çš„ã€‚ åŸºäºè¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨linuxä¸­å°†ç£ç›˜è½¬åŒ–æˆå¯¹åº”çš„è£¸è®¾å¤‡æ˜¯ä¸€ç§åˆé€‚çš„æ–¹æ³•ã€‚ ç®€å•çš„æ“ä½œå°±æ˜¯å°†é…ç½®å†™å…¥/etc/udev/rule.d/1401-oracle-asmdevice.rulesæ–‡ä»¶ä¸­ï¼Œè®©udevç®¡ç†ã€‚ udev è§„åˆ™çš„åŒ¹é…é”® ACTIONï¼š äº‹ä»¶ (uevent) çš„è¡Œä¸ºï¼Œä¾‹å¦‚ï¼šadd( æ·»åŠ è®¾å¤‡ )ã€remove( åˆ é™¤è®¾å¤‡ )ã€‚ KERNELï¼š å†…æ ¸è®¾å¤‡åç§°ï¼Œä¾‹å¦‚ï¼šsda, cdromã€‚ DEVPATHï¼šè®¾å¤‡çš„ devpath è·¯å¾„ã€‚ SUBSYSTEMï¼š è®¾å¤‡çš„å­ç³»ç»Ÿåç§°ï¼Œä¾‹å¦‚ï¼šsda çš„å­ç³»ç»Ÿä¸º blockã€‚ BUSï¼š è®¾å¤‡åœ¨ devpath é‡Œçš„æ€»çº¿åç§°ï¼Œä¾‹å¦‚ï¼šusbã€‚ DRIVERï¼š è®¾å¤‡åœ¨ devpath é‡Œçš„è®¾å¤‡é©±åŠ¨åç§°ï¼Œä¾‹å¦‚ï¼šide-cdromã€‚ IDï¼š è®¾å¤‡åœ¨ devpath é‡Œçš„è¯†åˆ«å·ã€‚ SYSFS{filename}ï¼š è®¾å¤‡çš„ devpath è·¯å¾„ä¸‹ï¼Œè®¾å¤‡çš„å±æ€§æ–‡ä»¶â€œfilenameâ€é‡Œçš„å†…å®¹ã€‚ ä¾‹å¦‚ï¼šSYSFS{model}==â€œST936701SSâ€è¡¨ç¤ºï¼šå¦‚æœè®¾å¤‡çš„å‹å·ä¸º ST936701SSï¼Œåˆ™è¯¥è®¾å¤‡åŒ¹é…è¯¥ åŒ¹é…é”®ã€‚ åœ¨ä¸€æ¡è§„åˆ™ä¸­ï¼Œå¯ä»¥è®¾å®šæœ€å¤šäº”æ¡ SYSFS çš„ åŒ¹é…é”®ã€‚ ENV{key}ï¼š ç¯å¢ƒå˜é‡ã€‚åœ¨ä¸€æ¡è§„åˆ™ä¸­ï¼Œå¯ä»¥è®¾å®šæœ€å¤šäº”æ¡ç¯å¢ƒå˜é‡çš„ åŒ¹é…é”®ã€‚ PROGRAMï¼šè°ƒç”¨å¤–éƒ¨å‘½ä»¤ã€‚ RESULTï¼š å¤–éƒ¨å‘½ä»¤ PROGRAM çš„è¿”å›ç»“æœã€‚ é…ç½®æ–‡ä»¶ è¿™é‡Œæ˜¯CentOS 6çš„ç‰ˆæœ¬ [root@rac1 ~]# cat /etc/udev/rules.d/99-oracle-asmdevice.rules KERNEL==\"sd*\",SUBSYSTEM==\"block\",PROGRAM==\"/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/$name\",RESULT==\"360000000000000000e00000000020fa8\",NAME+=\"oracleasm/disks/HL_360000000000000000e00000000020fa8\",OWNER=\"grid\",GROUP=\"asmadmin\",MODE=\"0660\" ç„¶ååŠ è½½é…ç½®æ–‡ä»¶ [root@rac1 ~]# start_udev æ­£åœ¨å¯åŠ¨ udevï¼š [ç¡®å®š] [root@rac1 ~]# ll /dev/oracleasm/disks æ€»ç”¨é‡ 0 brw-rw---- 1 grid asmadmin 8, 16 1æœˆ 23 14:30 HL_360000000000000000e00000000020fa8 æ³¨æ„ åœ¨CentOS6å’ŒCentOS7çš„é…ç½®æœ‰æ‰€ä¸åŒã€‚ ä¸€ä¸ªæ˜¯scsi_idå‘½ä»¤ï¼Œè¿˜æœ‰æ˜¯udevè§„åˆ™å˜åŒ–ã€‚ KERNEL==\"sd*\",SUBSYSTEM==\"block\",PROGRAM==\"/usr/lib/udev/scsi_id --whitelisted --replace-whitespace --device=/dev/$name\",RESULT==\"360000000000000000e00000000160fa8\",RUN+=\"/bin/sh -c 'mkdir -pv /dev/oracleasm/disks;mknod /dev/oracleasm/disks/HL_360000000000000000e00000000160fa8 b 1 3; chown grid:oinstall /dev/oracleasm/disks/HL_360000000000000000e00000000160fa8; chmod 0660 /dev/oracleasm/disks/HL_360000000000000000e00000000160fa8'\" scsi_idå‘½ä»¤éœ€è¦å®‰è£…systemdåŒ…ï¼Œå¦‚æœçŸ¥é“å‘½ä»¤å¯¹åº”çš„è½¯ä»¶åŒ…åç§°ï¼Œå¯ä»¥ä½¿ç”¨yumå‘½ä»¤æŸ¥çœ‹ yum provides \"/*/scsi_id\" udevéœ€è¦ä½¿ç”¨RUNæ¥ä»£æ›¿NAMEï¼Œåœ¨RUNä¸­èƒ½ä½¿ç”¨linuxçš„å‘½ä»¤ï¼Œä½¿ç”¨ï¼›åˆ†éš”å¤šä¸ªå‘½ä»¤ã€‚ mknodæ˜¯CentOS7ä¸­è½¬åŒ–è®¾å¤‡çš„æ–°å‘½ä»¤ï¼Œæ ¼å¼ä¸ºï¼š mknod /dev/sdb \u003cDEVICE_TYPE\u003e \u003cä¸»è®¾å¤‡å·\u003e \u003cæ¬¡è®¾å¤‡å·\u003e åŒæ—¶ä¿®æ”¹udevçš„å‘½ä»¤ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ã€‚ [root@localhost ~]# /usr/sbin/udevadm trigger --type=devices --action=change åœ¨åŒæ—¶æ·»åŠ å¤šä¸ªè®¾å¤‡æ—¶ï¼Œåæ·»åŠ çš„è®¾å¤‡åŒæ­¥è¾ƒæ…¢ã€‚æ¯”è¾ƒå¥½çš„æ–¹æ³•æ˜¯å…ˆå…¨éƒ¨æ·»åŠ åˆ°.rulesæ–‡ä»¶ä¸­ï¼Œæœ€åå†æ‰§è¡Œudevadm triggeråŠ è½½ã€‚ ","date":"2019-01-26","objectID":"/linux%E4%B8%8A%E4%BD%BF%E7%94%A8udev%E5%88%9B%E5%BB%BA%E8%A3%B8%E8%AE%BE%E5%A4%87/:0:0","tags":["linux"],"title":"linuxä¸Šä½¿ç”¨udevåˆ›å»ºè£¸è®¾å¤‡","uri":"/linux%E4%B8%8A%E4%BD%BF%E7%94%A8udev%E5%88%9B%E5%BB%BA%E8%A3%B8%E8%AE%BE%E5%A4%87/"},{"categories":["è¿ç»´"],"content":"iscsiç®€å•ä»‹ç» iSCSIï¼ˆInternet Small Computer System Interfaceï¼Œå‘éŸ³ä¸º/ËˆĞ°ÉªskÊŒzi/ï¼‰ï¼ŒInternetå°å‹è®¡ç®—æœºç³»ç»Ÿæ¥å£ï¼Œåˆç§°ä¸ºIP-SANï¼Œæ˜¯ä¸€ç§åŸºäºå› ç‰¹ç½‘åŠSCSI-3åè®®ä¸‹çš„å­˜å‚¨æŠ€æœ¯ï¼Œç”±IETFæå‡ºï¼Œå¹¶äº2003å¹´2æœˆ11æ—¥æˆä¸ºæ­£å¼çš„æ ‡å‡†ã€‚ä¸ä¼ ç»Ÿçš„SCSIæŠ€æœ¯æ¯”è¾ƒèµ·æ¥ï¼ŒiSCSIæŠ€æœ¯æœ‰ä»¥ä¸‹ä¸‰ä¸ªé©å‘½æ€§çš„å˜åŒ–ï¼š æŠŠåŸæ¥åªç”¨äºæœ¬æœºçš„SCSIåä¹‰é€è¿‡TCP/IPç½‘ç»œå‘é€ï¼Œä½¿è¿æ¥è·ç¦»å¯ä½œæ— é™çš„åœ°åŸŸå»¶ä¼¸ï¼› è¿æ¥çš„æœåŠ¡å™¨æ•°é‡æ— é™ï¼ˆåŸæ¥çš„SCSI-3çš„ä¸Šé™æ˜¯15ï¼‰ï¼› ç”±äºæ˜¯æœåŠ¡å™¨æ¶æ„ï¼Œå› æ­¤ä¹Ÿå¯ä»¥å®ç°åœ¨çº¿æ‰©å®¹ä»¥è‡³åŠ¨æ€éƒ¨ç½²ã€‚ ç®€å•çš„è¯´å°±æ˜¯tcpåè®®ä»¿çœŸscsiï¼Œå°†æœ¬åœ°çš„ç£ç›˜é€šè¿‡ç½‘ç»œå…±äº«ç»™å…¶ä»–æœºå™¨ï¼Œæä¾›æ•°æ®çš„è¿œç¨‹å­˜å‚¨ã€‚ iscsiåŸºæœ¬æ¦‚å¿µ iscsiä¸­æœ‰ä¸€äº›å¸¸ç”¨çš„åŸºæœ¬æ¦‚å¿µï¼Œäº†è§£è¿™äº›èƒ½å¸®åŠ©æˆ‘ä»¬è®¤è¯†iscsiæœåŠ¡çš„å…·ä½“å·¥ä½œåŸç†ï¼Œä¸‹é¢å°±ç”¨ä¸€å¼ å›¾è¡¨æ¥è¯´æ˜ï¼š åè¯ è¯´æ˜ ACL è®¿é—®æƒé™æ§åˆ¶åˆ—è¡¨ï¼Œç”¨æ¥éªŒè¯å®¢æˆ·ç«¯å¯åŠ¨å™¨çš„è®¿é—®ï¼Œé€šå¸¸æ˜¯å®¢æˆ·ç«¯ iSCSI å¯åŠ¨å™¨çš„ IQN åç§° IQN ç”¨äºæ ‡è¯†å•ä¸ª iSCSI ç›®æ ‡å’Œå¯åŠ¨å™¨çš„å”¯ä¸€åç§°(å…¨éƒ¨å°å†™) WWN ç”¨äºæ ‡è¯†å•ä¸ªå…‰çº¤é€šé“ç«¯å£å’ŒèŠ‚ç‚¹çš„å”¯ä¸€ç¼–å· TARGET iSCSI æœåŠ¡å™¨ä¸Šçš„å­˜å‚¨èµ„æº LUN iSCSI æœåŠ¡å™¨ä¸Šçš„å—è®¾å¤‡ initiator(å¯åŠ¨å™¨) ä»¥è½¯ä»¶æˆ–ç¡¬ä»¶å®æ–½çš„ iSCSI å®¢æˆ·ç«¯ NODE å•ä¸ª iSCSI å¯åŠ¨å™¨æˆ–è€…ç›®æ ‡ TPG å¯åŠ¨å™¨æˆ–è€…ç›®æ ‡ä¸Šçš„å•ä¸ª IP è¿æ¥åœ°å€ Portal ç½‘ç»œæ¥å£åŠç«¯å£ iscsi å®‰è£…é…ç½® iscsi æœåŠ¡ç®¡ç†çš„è½¯ä»¶æœ‰å¤šä¸ªï¼Œè¿™é‡Œå°±ç®€å•ä»‹ç»ä¸¤ä¸ªï¼Œtargetcliå’Œtgtã€‚ ","date":"2019-01-26","objectID":"/iscsi%E5%85%B1%E4%BA%AB%E7%A3%81%E7%9B%98%E6%9C%8D%E5%8A%A1/:0:0","tags":["linux"],"title":"iscsiå…±äº«ç£ç›˜æœåŠ¡","uri":"/iscsi%E5%85%B1%E4%BA%AB%E7%A3%81%E7%9B%98%E6%9C%8D%E5%8A%A1/"},{"categories":["è¿ç»´"],"content":"ä½¿ç”¨targetcliç®¡ç†é…ç½®iscsi 1.å‡†å¤‡é˜¶æ®µ æœ‰ä¸¤å°linuxæœºå™¨ï¼Œåˆ†åˆ«ä½œä¸ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ã€‚å®éªŒç¯å¢ƒæœ€å¥½åœ¨è™šæ‹Ÿæœºä¸Šï¼Œæ–¹ä¾¿ä¿®æ”¹çš„åå¤æ“ä½œã€‚åŒæ—¶åœ¨æœåŠ¡ç«¯ä¸Šæœ‰ä¸€å—ç£ç›˜ä½œä¸ºiscsiå…±äº«ç£ç›˜ã€‚ [root@localhost ~]# lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 40G 0 disk â”œâ”€sda1 8:1 0 500M 0 part /boot â”œâ”€sda2 8:2 0 4G 0 part [SWAP] â””â”€sda3 8:3 0 35.5G 0 part / sdb 8:16 0 10G 0 disk â””â”€sdb1 8:17 0 10G 0 part sdc 8:32 0 10G 0 disk sr0 11:0 1 1024M 0 rom è¿™ä¸ªé€‰æ‹©/dev/sdb1,æ²¡æœ‰çš„åŒå­¦å¯ä»¥ä½¿ç”¨fdiskå‘½ä»¤è‡ªå·±åˆ†é…ä¸€ä¸ªã€‚ 2.å®‰è£…targetcli yum install -y targetcli è¿˜éœ€è¦å¯åŠ¨targetcliæœåŠ¡ systemctl start target 3.é…ç½®targetcli é…ç½®targetcliæœ‰å‡ ä¸ªæ­¥éª¤ï¼Œæ·»åŠ targetï¼Œåœ¨targetä¸Šæ·»åŠ lunï¼Œå°†targetå…±äº«åˆ°æŒ‡å®šç½‘æ®µã€‚ å…ˆæ¥åˆ›å»ºä¸€ä¸ªå—è®¾å¤‡ï¼Œä½¿ç”¨å‘½ä»¤ä¸ºï¼š /backstores/block create westos:storage1 /dev/sdb1 è¿›å…¥targetcliæ“ä½œï¼š [root@localhost ~]# targetcli Warning: Could not load preferences file /root/.targetcli/prefs.bin. targetcli shell version 2.1.fb46 Copyright 2011-2013 by Datera, Inc and others. For help on commands, type 'help'. /\u003e /backstores/block create westos:storage1 /dev/sdb1 Created block storage object westos:storage1 using /dev/sdb1. # æ³¨æ„è¿™é‡Œå°±æˆåŠŸåˆ›å»ºä¸€ä¸ªå¿«è®¾å¤‡ /\u003e ls o- / ......................................................................................................................... [...] o- backstores .............................................................................................................. [...] | o- block .................................................................................................. [Storage Objects: 1] | | o- westos:storage1 .............................................................. [/dev/sdb1 (0 bytes) write-thru deactivated] | | o- alua ................................................................................................... [ALUA Groups: 1] | | o- default_tg_pt_gp ....................................................................... [ALUA state: Active/optimized] | o- fileio ................................................................................................. [Storage Objects: 0] | o- pscsi .................................................................................................. [Storage Objects: 0] | o- ramdisk ................................................................................................ [Storage Objects: 0] o- iscsi ............................................................................................................ [Targets: 0] o- loopback ......................................................................................................... [Targets: 0] /\u003e æ¥ç€åˆ›å»ºä¸€ä¸ªiscsiå…±äº«çš„targetï¼Œä½¿ç”¨å‘½ä»¤ä¸ºï¼š /iscsi create iqn.2018-10.com.westos:storage1 è¿™é‡Œçš„targetåç§°å…¶å®å¯ä»¥éšæ„ï¼Œä½†ä¸€èˆ¬æ ¼å¼ä¸ºiqn.year.month.com.domain.xxx, æ‰§è¡Œçš„ç»“æœå¦‚ä¸‹ï¼š /\u003e /iscsi create iqn.2018-10.com.westos:storage1 Created target iqn.2018-10.com.westos:storage1. Created TPG 1. Global pref auto_add_default_portal=true Created default portal listening on all IPs (0.0.0.0), port 3260. /\u003e ls o- / ......................................................................................................................... [...] o- backstores .............................................................................................................. [...] | o- block .................................................................................................. [Storage Objects: 1] | | o- westos:storage1 .............................................................. [/dev/sdb1 (0 bytes) write-thru deactivated] | | o- alua ................................................................................................... [ALUA Groups: 1] | | o- default_tg_pt_gp ....................................................................... [ALUA state: Active/optimized] | o- fileio ................................................................................................. [Storage Objects: 0] | o- pscsi .................................................................................................. [Storage Objects: 0] | o- ramdisk ................................................................................................ [Storage Objects: 0] o- iscsi ........................","date":"2019-01-26","objectID":"/iscsi%E5%85%B1%E4%BA%AB%E7%A3%81%E7%9B%98%E6%9C%8D%E5%8A%A1/:1:0","tags":["linux"],"title":"iscsiå…±äº«ç£ç›˜æœåŠ¡","uri":"/iscsi%E5%85%B1%E4%BA%AB%E7%A3%81%E7%9B%98%E6%9C%8D%E5%8A%A1/"},{"categories":["è¿ç»´"],"content":"ä½¿ç”¨tgté…ç½®iscsi å†æ¥ä»‹ç»å¦å¤–ä¸€ç§è½¯ä»¶ï¼Œå°±æ˜¯tgtã€‚ 1.å®‰è£… yum install -y epel-release yum install -y scsi-target-utils å¯åŠ¨æœåŠ¡ systemctl start tgtd 2.é…ç½®tgt é…ç½®tgtä½¿ç”¨çš„å‘½ä»¤æ˜¯tgtadmï¼Œæœ‰ä»¥ä¸‹å¸¸ç”¨é€‰é¡¹ï¼š â€“lld â€“mode target â€“op new â€“tid â€“targetname # æ–°å»ºtarget â€“lld â€“mode target â€“op delete [â€“force] â€“tid # åˆ é™¤target â€“lld â€“mode target â€“op show # æŸ¥çœ‹æ‰€æœ‰çš„target â€“lld â€“mode target â€“op show â€“tid # æŸ¥çœ‹æŒ‡å®šidçš„target â€“lld â€“mode target â€“op update â€“tid â€“name â€“value # æ›´æ–°target â€“lld â€“mode target â€“op bind â€“tid â€“initiator-address # targetå…±äº«åˆ°æŒ‡å®šç½‘æ®µ â€“lld â€“mode target â€“op bind â€“tid â€“initiator-name # targetå…±äº«åˆ°æŒ‡å®šçš„å®¢æˆ·ç«¯åç§° â€“lld â€“mode target â€“op unbind â€“tid â€“initiator-address # è§£ç»‘ â€“lld â€“mode target â€“op unbind â€“tid â€“initiator-name â€“lld â€“mode logicalunit â€“op new â€“tid â€“lun â€“backing-store â€“bstype â€“bsopts â€“bsoflags # åˆ›å»ºlun â€“lld â€“mode logicalunit â€“op delete â€“tid â€“lun # åˆ é™¤lun â€“lld â€“mode account â€“op new â€“user â€“password # æ·»åŠ è®¤è¯ â€“lld â€“mode account â€“op delete â€“user # åˆ é™¤è®¤è¯ â€“lld â€“mode account â€“op bind â€“tid â€“user [â€“outgoing] # ç»‘å®šè®¤è¯ â€“lld â€“mode account â€“op unbind â€“tid â€“user [â€“outgoing] # è§£ç»‘è®¤è¯ æ·»åŠ target [root@localhost ~]# tgtadm --lld iscsi --mode target --op new --tid 1 --targetname iqn-2019-11.com.iscsi.test [root@localhost ~]# tgtadm --lld iscsi --mode target --op show Target 1: iqn-2019-11.com.iscsi.test System information: Driver: iscsi State: ready I_T nexus information: LUN information: LUN: 0 Type: controller SCSI ID: IET 00010000 SCSI SN: beaf10 Size: 0 MB, Block size: 1 Online: Yes Removable media: No Prevent removal: No Readonly: No SWP: No Thin-provisioning: No Backing store type: null Backing store path: None Backing store flags: Account information: ACL information: æ·»åŠ lun [root@localhost ~]# tgtadm --lld iscsi --mode logicalunit --op new --tid 1 --lun 22 -b /dev/sdb [root@localhost ~]# tgtadm --lld iscsi --mode target --op show Target 1: iqn-2019-11.com.iscsi.test System information: Driver: iscsi State: ready I_T nexus information: LUN information: LUN: 0 Type: controller SCSI ID: IET 00010000 SCSI SN: beaf10 Size: 0 MB, Block size: 1 Online: Yes Removable media: No Prevent removal: No Readonly: No SWP: No Thin-provisioning: No Backing store type: null Backing store path: None Backing store flags: LUN: 22 Type: disk SCSI ID: IET 00010016 SCSI SN: beaf122 Size: 10737 MB, Block size: 512 Online: Yes Removable media: No Prevent removal: No Readonly: No SWP: No Thin-provisioning: No Backing store type: rdwr Backing store path: /dev/sdb Backing store flags: Account information: ACL information: æ³¨ï¼šè¿™é‡Œæœ‰ä¸€ä¸ªå°æç¤ºï¼Œæ¯ä¸ªlunä¸­çš„SCSI IDé¡¹æ˜¯åœ¨å®¢æˆ·ç«¯ä¸­çš„å”¯ä¸€æ ‡è¯†ï¼Œå®ƒçš„å€¼æ˜¯æ ¹æ®target idå’Œlun idè®¡ç®—å¾—åˆ°çš„ï¼Œå³ï¼š SCSI ID = Target IDè½¬16è¿›åˆ¶(å‰å››ä½) + Lun IDè½¬16è¿›åˆ¶(åå››ä½) æ‰€ä»¥lun 22çš„SCSI IDä¸º00010016 å…±äº«åˆ°å®¢æˆ·ç«¯ï¼š [root@localhost ~]# tgtadm --lld iscsi --mode target --op bind --tid 1 --initiator-address 192.168.3.131 ","date":"2019-01-26","objectID":"/iscsi%E5%85%B1%E4%BA%AB%E7%A3%81%E7%9B%98%E6%9C%8D%E5%8A%A1/:2:0","tags":["linux"],"title":"iscsiå…±äº«ç£ç›˜æœåŠ¡","uri":"/iscsi%E5%85%B1%E4%BA%AB%E7%A3%81%E7%9B%98%E6%9C%8D%E5%8A%A1/"},{"categories":["è¿ç»´"],"content":"å®¢æˆ·ç«¯è¿æ¥ 1.å®‰è£…å®¢æˆ·ç«¯ yum install -y epel-release yum install -y iscsi-initiator-utils å®¢æˆ·ç«¯å‘½ä»¤ï¼š iscsiadm -m session # æŸ¥çœ‹æ‰€æœ‰ä¼šè¯ iscsiadm -m discovery -t st -p 192.168.3.150 #æŸ¥çœ‹å…±äº«target iscsiadm -m node -T iqn.2018-10.com.westos:storage1 -p 192.168.3.150 -l #ç™»é™†è¿æ¥ iscsiadm -m node -T iqn.2018-10.com.westos:storage1 -u #é€€å‡ºç™»é™† iscsiadm -m node -T iqn.2018-10.com.westos:storage1 -o delete #åˆ é™¤ç™»é™†æ•°æ® 2.å‘ç°è®¾å¤‡ [root@localhost ~]# iscsiadm -m discovery -t st -p 192.168.3.150 192.168.3.150:3260,1 iqn.2018-10.com.westos:storage1 ç™»å½• æ³¨ï¼šè¯·å…³é—­é˜²ç«å¢™å’Œselinux [root@localhost mnt]# iscsiadm -m node -T iqn.2018-10.com.westos:storage1 -p 192.168.3.150 -l Logging in to [iface: default, target: iqn.2018-10.com.westos:storage1, portal: 192.168.3.150,3260] (multiple) Login to [iface: default, target: iqn.2018-10.com.westos:storage1, portal: 192.168.3.150,3260] successful. [root@localhost ~]# lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT fd0 2:0 1 4K 0 disk sda 8:0 0 40G 0 disk â”œâ”€sda1 8:1 0 500M 0 part /boot â”œâ”€sda2 8:2 0 8G 0 part [SWAP] â””â”€sda3 8:3 0 31.5G 0 part / sdb 8:16 0 2G 0 disk â””â”€sdb1 8:17 0 2G 0 part sr0 11:0 1 1024M 0 rom åŒæ—¶åœ¨/dev/disk/by-idä¸‹ç”Ÿæˆå—è®¾å¤‡ã€‚ ","date":"2019-01-26","objectID":"/iscsi%E5%85%B1%E4%BA%AB%E7%A3%81%E7%9B%98%E6%9C%8D%E5%8A%A1/:3:0","tags":["linux"],"title":"iscsiå…±äº«ç£ç›˜æœåŠ¡","uri":"/iscsi%E5%85%B1%E4%BA%AB%E7%A3%81%E7%9B%98%E6%9C%8D%E5%8A%A1/"},{"categories":["ç¬”è®°"],"content":"ä»Šå¤©é‡æ–°æ•´ç†äº†ä¸‹åšå®¢ï¼Œå‘ç°ä¹‹å‰é…ç½®å¥½çš„ä¸ƒç‰›äº‘å›¾ç‰‡æ˜¾ç¤ºé”™è¯¯ã€‚é‡æ–°é…ç½®çš„åŒæ—¶ä¹Ÿè®°å½•ä¸‹é…ç½®æ­¥éª¤ã€‚ æ·»åŠ åŸŸå ç™»å½•ä¸ƒç‰›äº‘çš„å®˜ç½‘èåˆCDNï¼Œåœ¨â€œåŸŸåç®¡ç†â€ä¸­â€œæ·»åŠ åŸŸåâ€ï¼Œå¦‚å›¾ï¼š å¡«å†™â€œåŠ é€ŸåŸŸåâ€å­—æ®µä¸ºimage.xingyys.club å…¶ä»–é»˜è®¤ã€‚ è§£æDNS åœ¨æ·»åŠ å®ŒåŸŸååï¼Œç›´æ¥ä¼šåœ¨åå°å®¡æ ¸ã€‚ é¼ æ ‡åœåœ¨è¡¨æ ¼ä¸Šè·å–CNAMEï¼Œimage.xingyys.club.qiniudns.comã€‚ä¹‹åå°±æ˜¯åœ¨åŸŸååå°ä¸Šæ·»åŠ è§£æã€‚æˆ‘çš„æ˜¯è…¾è®¯äº‘çš„åŸŸåï¼Œæ·»åŠ ä¸€æ¡CNAMEè§£æï¼š 1.ä¸»æœºè®°å½•ä¸ºäºŒçº§åŸŸåã€‚ 2.è®°å½•ç±»å‹ä¸ºCNAMEã€‚ 3.çº¿è·¯ç±»å‹é»˜è®¤ã€‚ 4.è®°å½•å€¼ä¸ºåˆšæ‰è·å–çš„ä¸ƒç‰›äº‘CNAMEã€‚ ç„¶åä¿å­˜å³å¯ã€‚ ç»‘å®šå­˜å‚¨ç©ºé—´ åœ¨ä¸ƒç‰›äº‘çš„æ§åˆ¶å°ï¼Œâ€œå¯¹è±¡å­˜å‚¨â€é‡Œâ€œæ–°å»ºå­˜å‚¨ç©ºé—´â€ æœ€ååœ¨æ–°å»ºçš„å­˜å‚¨ç©ºé—´é‡Œé¢åœ¨ç»‘å®šåˆšæ·»åŠ çš„äºŒçº§åŸŸåï¼š é…ç½®å®Œæˆã€‚ ","date":"2019-01-19","objectID":"/%E9%85%8D%E7%BD%AE%E4%B8%83%E7%89%9B%E4%BA%91%E5%AD%98%E5%82%A8%E5%A4%96%E9%93%BE/:0:0","tags":["å…¶ä»–"],"title":"é…ç½®ä¸ƒç‰›äº‘å­˜å‚¨å¤–é“¾","uri":"/%E9%85%8D%E7%BD%AE%E4%B8%83%E7%89%9B%E4%BA%91%E5%AD%98%E5%82%A8%E5%A4%96%E9%93%BE/"},{"categories":["å­˜å‚¨"],"content":"scaleio-gatewayæ˜¯EMC ScaleIOå­˜å‚¨çš„ç½‘å…³æ¥å£ï¼Œé€šè¿‡è°ƒç”¨å…¶apièƒ½å®ç°EMCå­˜å‚¨è½¯ä»¶çš„ç®¡ç†ã€‚ä¸‹é¢æ¥ä»‹ç»æ€ä¹ˆå®‰è£…å’Œé…ç½®ï¼š ä¸€ã€å®‰è£… 1.ç›´æ¥æ˜¯ä½¿ç”¨rpmè½¯ä»¶å®‰è£…ï¼šgatewayè¿è¡Œç¯å¢ƒéœ€è¦ java1.8ï¼Œå†…å­˜å¤§äº3G # å…ˆé…ç½®gateway adminç”¨æˆ·çš„å¯†ç  [root@localhost ~]# export GATEWAY_ADMIN_PASSWORD=Scale10 [root@localhost ~]# rpm -ivh /tmp/EMC-ScaleIO-gateway-2.6-11000.113.x86_64.rpm # å®‰è£…æˆåŠŸåæœåŠ¡é»˜è®¤å¯åŠ¨ï¼Œç»‘å®šåœ¨ç«¯å£80 [root@localhost ~]# netstat -tnlp | grep 80 tcp6 0 0 :::80 :::* LISTEN 4225/java äºŒã€é…ç½® å®‰è£…å®Œgatewayè¿˜éœ€è¦é…ç½®ï¼Œgatewayçš„é…ç½®æœ‰ä¸¤ç§æ–¹å¼ã€‚ ä½¿ç”¨æµè§ˆå™¨é…ç½®ã€‚ ç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚ ä½¿ç”¨æµè§ˆå™¨é…ç½®ä½¿ç”¨æµè§ˆå™¨è¾“å…¥åœ°å€ https://\u003cä¸»æœºip\u003eï¼Œè¾“å…¥ç”¨æˆ·åå¯†ç (admin/Scale10)åç™»é™† è¾“å…¥å ç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶ [root@localhost ~]# vim /opt/emc/scaleio/gateway/webapps/ROOT/WEB-INF/classes/gatewayUser.properties // ä¿®æ”¹ä»¥ä¸‹å­—æ®µ // scaleioç®¡ç†çš„ipåœ°å€ï¼Œä½¿ç”¨,æˆ–;éš”å¼€ mdm.ip.addresses=192.168.3.200;192.168.3.201 // å…è®¸éåŠ å¯†çš„é€šè®¯ gateway-security.allow_non_secure_communication=true // é˜²æ­¢ä¸»ä»åˆ‡æ¢ä¸­gatewayé”™è¯¯ security.bypass_certificate_check=true // è®°å¾—é‡å¯gatewayæœåŠ¡ [root@localhost ~]# /etc/init.d/scaleio-gateway restart ä¸‰ã€éªŒè¯ ä½¿ç”¨æµè§ˆå™¨ç™»é™† https://\u003cä¸»æœºip\u003e/api/login éªŒè¯curlå‘½ä»¤éªŒè¯éªŒè¯ï¼š [root@localhost ~]# curl -k --user admin:Scale10 https://192.168.3.107/api/login \"YWRtaW46MTU1ODA5ODgyNjQyODozMDVjYWQ3NjljNWFlNWU4ZWI2MDcxZGNiNmI4MmMzMA\" ","date":"2018-08-31","objectID":"/%E5%AE%89%E8%A3%85scaleio-gateway/:0:0","tags":["linux","scaleio"],"title":"å®‰è£…scaleio Gateway","uri":"/%E5%AE%89%E8%A3%85scaleio-gateway/"},{"categories":["è™šæ‹ŸåŒ–"],"content":" æ³¨ï¼šè¿è¡Œkvmä¿è¯æœºå™¨æ”¯æŒè™šæ‹ŸåŒ–ä¸”åœ¨biosä¸­å¼€å¯ã€‚ å‡†å¤‡å·¥ä½œ ","date":"2018-06-30","objectID":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/:0:0","tags":["kvm","linux"],"title":"CentOSä¸‹kvmå®‰è£…","uri":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"æ¸…é™¤iptablesè§„åˆ™ # CentOS6 service iptables stop; service iptables save # CentOS7 systemctl stop firewalld ","date":"2018-06-30","objectID":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/:1:0","tags":["kvm","linux"],"title":"CentOSä¸‹kvmå®‰è£…","uri":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"å…³é—­selinux sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config setenforce 0 ","date":"2018-06-30","objectID":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/:2:0","tags":["kvm","linux"],"title":"CentOSä¸‹kvmå®‰è£…","uri":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"æ£€æµ‹ç³»ç»Ÿæ˜¯å¦æ”¯æŒè™šæ‹ŸåŒ– grep -Ei 'vmx|svm' /proc/cpuinfo å¦‚æœæœ‰è¾“å‡ºå†…å®¹ï¼Œåˆ™æ”¯æŒï¼Œå…¶ä¸­intel cpuæ”¯æŒä¼šæœ‰vmxï¼Œamd cpuæ”¯æŒä¼šæœ‰svm å®‰è£… ","date":"2018-06-30","objectID":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/:3:0","tags":["kvm","linux"],"title":"CentOSä¸‹kvmå®‰è£…","uri":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"æ‰§è¡Œå®‰è£…å‘½ä»¤ yum install -y kvm virt-* libvirt bridge-utils qemu-img è¯´æ˜ï¼š kvm:è½¯ä»¶åŒ…ä¸­å«æœ‰KVMå†…æ ¸æ¨¡å—ï¼Œå®ƒåœ¨é»˜è®¤linuxå†…æ ¸ä¸­æä¾›kvmç®¡ç†ç¨‹åº libvirt:å®‰è£…è™šæ‹Ÿæœºç®¡ç†å·¥å…·ï¼Œä½¿ç”¨virshç­‰å‘½ä»¤æ¥ç®¡ç†å’Œæ§åˆ¶è™šæ‹Ÿæœºã€‚ bridge-utils:è®¾ç½®ç½‘ç»œç½‘å¡æ¡¥æ¥ã€‚ virt-*:åˆ›å»ºã€å…‹éš†è™šæ‹Ÿæœºå‘½ä»¤ï¼Œä»¥åŠå›¾å½¢åŒ–ç®¡ç†å·¥å…·virt-manager qemu-img:å®‰è£…qemuç»„ä»¶ï¼Œä½¿ç”¨qemuå‘½ä»¤æ¥åˆ›å»ºç£ç›˜ç­‰ã€‚ ","date":"2018-06-30","objectID":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/:4:0","tags":["kvm","linux"],"title":"CentOSä¸‹kvmå®‰è£…","uri":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"æ£€æŸ¥kvmæ¨¡å—æ˜¯å¦åŠ è½½ lsmod |grep kvm ç»“æœè¾“å‡ºï¼š kvm_intel 55496 3 kvm 337772 1 kvm_intel å¦‚æœæ²¡æœ‰ï¼Œéœ€è¦æ‰§è¡Œï¼Œè¿˜æ²¡æœ‰å°±é‡å¯ä¸€ä¸‹è¯•è¯• modprobe kvm-intel ","date":"2018-06-30","objectID":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/:5:0","tags":["kvm","linux"],"title":"CentOSä¸‹kvmå®‰è£…","uri":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"é…ç½®ç½‘å¡ cd /etc/sysconfig/network-scripts/ cp ifcfg-eth0 ifcfg-br0 ç¼–è¾‘eth0 DEVICE=eth0 HWADDR=00:0C:29:55:A7:0A TYPE=Ethernet UUID=2be47d79-2a68-4b65-a9ce-6a2df93759c6 ONBOOT=yes NM_CONTROLLED=yes BOOTPROTO=none BRIDGE=br0 ç¼–è¾‘br0 DEVICE=br0 #HWADDR=00:0C:29:55:A7:0A TYPE=Bridge #UUID=2be47d79-2a68-4b65-a9ce-6a2df93759c6 ONBOOT=yes NM_CONTROLLED=yes BOOTPROTO=static IPADDR=192.168.11.17 NETMASK=255.255.255.0 GATEWAY=192.168.11.1 DNS1=202.106.0.20 è®°å¾—é‡å¯ç½‘å¡ï¼š/etc/init.d/network restart br0 Link encap:Ethernet HWaddr 00:0C:29:55:A7:0A inet addr:192.168.11.17 Bcast:192.168.11.255 Mask:255.255.255.0 inet6 addr: fe80::20c:29ff:fe55:a70a/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:141326 errors:0 dropped:0 overruns:0 frame:0 TX packets:90931 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:456024940 (434.8 MiB) TX bytes:10933593 (10.4 MiB) eth0 Link encap:Ethernet HWaddr 00:0C:29:55:A7:0A inet6 addr: fe80::20c:29ff:fe55:a70a/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:341978 errors:0 dropped:0 overruns:0 frame:0 TX packets:90946 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:468848861 (447.1 MiB) TX bytes:10934699 (10.4 MiB) lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:0 (0.0 b) TX bytes:0 (0.0 b) virbr0 Link encap:Ethernet HWaddr 52:54:00:14:EF:D5 inet addr:192.168.122.1 Bcast:192.168.122.255 Mask:255.255.255.0 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:0 (0.0 b) TX bytes:0 (0.0 b) ","date":"2018-06-30","objectID":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/:6:0","tags":["kvm","linux"],"title":"CentOSä¸‹kvmå®‰è£…","uri":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"å¯åŠ¨æœåŠ¡ /etc/init.d/libvirtd start /etc/init.d/messagebus restart æ­¤æ—¶å¯ä»¥æŸ¥çœ‹ç½‘ç»œæ¥å£åˆ—è¡¨ $ brctl show bridge name bridge id STP enabled interfaces br0 8000.000c2955a70a no eth0 virbr0 8000.52540014efd5 yes virbr0-nic åˆ›å»ºè™šæ‹Ÿæœº åˆ›å»ºä¸€ä¸ªå­˜å‚¨è™šæ‹Ÿæœºè™šæ‹Ÿç£ç›˜çš„ç›®å½•ï¼Œè¯¥ç›®å½•æ‰€åœ¨åˆ†åŒºå¿…é¡»è¶³å¤Ÿå¤§ mkdir /data/ æ‰§è¡Œå‘½ä»¤ï¼š virt-install \\ --name ping \\ --ram 512 \\ --disk path=/data/ping.img,size=20 \\ --vcpus 1 \\ --os-type linux \\ --os-variant rhel6 \\ --network bridge=br0 \\ --graphics none \\ --console pty,target_type=serial \\ --location 'http://mirrors.163.com/centos/6.8/os/x86_64/' \\ --extra-args 'console=ttyS0,115200n8 serial' è¯´æ˜ï¼š â€“name æŒ‡å®šè™šæ‹Ÿæœºçš„åå­— â€“ram æŒ‡å®šå†…å­˜åˆ†é…å¤šå°‘ â€“disk path æŒ‡å®šè™šæ‹Ÿç£ç›˜æ”¾åˆ°å“ªé‡Œï¼Œsize=30 æŒ‡å®šç£ç›˜å¤§å°ä¸º30G,è¿™æ ·ç£ç›˜æ–‡ä»¶æ ¼å¼ä¸ºrawï¼Œrawæ ¼å¼ä¸èƒ½åšå¿«ç…§ï¼Œåé¢æœ‰è¯´æ˜ï¼Œéœ€è¦è½¬æ¢ä¸ºqcow2æ ¼å¼ï¼Œå¦‚æœè¦ä½¿ç”¨qcow2æ ¼å¼çš„è™šæ‹Ÿç£ç›˜ï¼Œéœ€è¦äº‹å…ˆåˆ›å»ºqcow2æ ¼å¼çš„è™šæ‹Ÿç£ç›˜ã€‚ å‚è€ƒ http://www.361way.com/kvm-qcow2-preallocation-metadata/3354.html ç¤ºä¾‹:qemu-img create -f qcow2 -o preallocation=metadata /data/test02.img 7G; â€“disk path=/data/test02.img,format=qcow2,size=7,bus=virtio â€“vcpus æŒ‡å®šåˆ†é…cpuå‡ ä¸ª â€“os-type æŒ‡å®šç³»ç»Ÿç±»å‹ä¸ºlinux â€“os-variant æŒ‡å®šç³»ç»Ÿç‰ˆæœ¬ â€“network æŒ‡å®šç½‘ç»œç±»å‹ â€“graphics æŒ‡å®šå®‰è£…é€šè¿‡å“ªç§ç±»å‹ï¼Œå¯ä»¥æ˜¯vncï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰å›¾å½¢ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨å›¾å½¢ç›´æ¥ä½¿ç”¨æ–‡æœ¬æ–¹å¼ â€“console æŒ‡å®šæ§åˆ¶å°ç±»å‹ â€“location æŒ‡å®šå®‰è£…ä»‹è´¨åœ°å€ï¼Œå¯ä»¥æ˜¯ç½‘ç»œåœ°å€ï¼Œä¹Ÿå¯ä»¥æ˜¯æœ¬åœ°çš„ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œï¼ˆâ€“location â€˜/mnt/â€™, å…¶ä¸­/mnt/ä¸‹å°±æ˜¯æˆ‘ä»¬æŒ‚è½½çš„å…‰ç›˜é•œåƒmount /dev/cdrom /mnt)å¦‚æœæ˜¯ç»å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆåé¢è¿˜éœ€è¦æŒ‡å®šä¸€ä¸ªå®‰è£…ä»‹è´¨ï¼Œæ¯”å¦‚NFS ä¹‹åå°±å‡ºç°ï¼š å¼€å§‹å®‰è£…...... æœç´¢æ–‡ä»¶ .treeinfo...... | 720 B 00:00 ... æœç´¢æ–‡ä»¶ vmlinuz...... | 7.7 MB 00:02 ... æœç´¢æ–‡ä»¶ initrd.img...... | 63 MB 00:23 ... åˆ›å»ºå­˜å‚¨æ–‡ä»¶ ping.img | 30 GB 00:00 åˆ›å»ºåŸŸ...... | 0 B 00:00 è¿æ¥åˆ°åŸŸ ping Escape character is ^] ç„¶åå°±æ˜¯æˆ‘ä»¬éå¸¸ç†Ÿæ‚‰çš„OK or Next äº† ï¼Œåªä¸è¿‡è¿™ä¸ªè¿‡ç¨‹æ˜¯æ–‡æœ¬æ¨¡å¼ï¼Œå¦‚æœæƒ³ä½¿ç”¨å›¾å½¢ï¼Œåªèƒ½å¼€å¯vncå•¦ æœ€åå®‰è£…å®Œï¼Œrebootå°±è¿›å…¥åˆšåˆšåˆ›å»ºçš„è™šæ‹Ÿæœºäº†ã€‚è¦æƒ³é€€å›åˆ°å®¿ä¸»æœºï¼Œctrl + ] å³å¯ã€‚ virsh list å¯ä»¥åˆ—å‡ºå½“å‰çš„å­æœºåˆ—è¡¨ã€‚ virsh start ping å¼€å¯å­æœº virsh console ping å¯ä»¥è¿›å…¥æŒ‡å®šçš„å­æœº ä½¿ç”¨pythonç®¡ç†API ","date":"2018-06-30","objectID":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/:7:0","tags":["kvm","linux"],"title":"CentOSä¸‹kvmå®‰è£…","uri":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"å®‰è£…ç›¸å…³åŒ… yum install libvirt-devel ","date":"2018-06-30","objectID":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/:8:0","tags":["kvm","linux"],"title":"CentOSä¸‹kvmå®‰è£…","uri":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"å®‰è£…pythonçš„libvirtåº“ pip install libvirt-python libvirt ","date":"2018-06-30","objectID":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/:9:0","tags":["kvm","linux"],"title":"CentOSä¸‹kvmå®‰è£…","uri":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"æµ‹è¯• import libvirt conn = libvirt.open(\"qemu:///system\") ","date":"2018-06-30","objectID":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/:10:0","tags":["kvm","linux"],"title":"CentOSä¸‹kvmå®‰è£…","uri":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"è¿œç¨‹ç®¡ç† ç›´æ¥ä¸Šè¿°å®‰è£…è¿˜åªèƒ½åœ¨æœ¬åœ°ä½¿ç”¨pythonç®¡ç†ã€‚å¦‚æœè¿˜éœ€è¦è¿œç¨‹ç®¡ç†çš„è¯è¿˜è¦é¢å¤–çš„é…ç½®ã€‚ ä¿®è¯¥é…ç½®æ–‡ä»¶/etc/libvirt/libvirtd.conf ###/etc/libvirt/libvirtd.conf listen_tls = 0ã€€#ç¦ç”¨tlsç™»å½• listen_tcp = 1ã€€#å¯ç”¨tcpæ–¹å¼ç™»å½• tcp_port = \"16509\"ã€€#tcpç«¯å£16509 listen_addr = \"0.0.0.0\" unix_sock_group = \"libvirtd\" unix_sock_rw_perms = \"0770\" auth_unix_ro = \"none\" auth_unix_rw = \"none\" auth_tcp = \"none\"ã€€#TCPä¸ä½¿ç”¨è®¤è¯ max_clients = 1024ã€€#æœ€å¤§æ€»çš„è¿æ¥å®¢æˆ·æ•°1024 min_workers = 50ã€€#libvirtdå¯åŠ¨æ—¶ï¼Œåˆå§‹çš„å·¥ä½œçº¿ç¨‹æ•°ç›® max_workers = 200ã€€#åŒä¸Šï¼Œæœ€å¤§æ•°ç›® max_requests = 1000ã€€#æœ€å¤§åŒæ—¶æ”¯æŒçš„RPCè°ƒç”¨ï¼Œå¿…é¡»å¤§äºç­‰äºmax_workers max_client_requests = 200ã€€#æ¯ä¸ªå®¢æˆ·ç«¯æ”¯æŒçš„æœ€å¤§è¿æ¥æ•° ä¿®æ”¹é…ç½®æ–‡ä»¶/etc/sysconfig/libvirtdï¼š LIBVIRTD_ARGS=\"--listen\" é‡å¯æœåŠ¡ålibvirtdä¼šç»‘å®šåœ¨16509ç«¯å£ åœ¨è¿œç¨‹çš„æœºå™¨ä¸Šå®‰è£…pythonåº“ yum install libvirt-devel python-devel # è¦å…ˆå®‰è£…libvirt-develåŒ…ï¼Œå› ä¸ºlibvirt-pythonä¾èµ–äºlibvirt-devel pip install libvirt libvirt-python æµ‹è¯•ä»£ç ï¼š import libvirt conn = libvirt.open(\"qemu+tcp://192.168.11.17/system\") æ²¡æœ‰æŠ¥é”™ï¼Œå®‰è£…å®Œæ¯•ã€‚ ","date":"2018-06-30","objectID":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/:11:0","tags":["kvm","linux"],"title":"CentOSä¸‹kvmå®‰è£…","uri":"/centos%E4%B8%8Bkvm%E5%AE%89%E8%A3%85/"},{"categories":["è¿ç»´"],"content":"lnmpå³ï¼šnginx + mysql + phpã€‚ä¸lampä¸åŒçš„æ˜¯ï¼Œlnmpçš„phpä¸åœ¨åªæ˜¯httpdä¸­çš„ä¸€ä¸ªåº“ï¼Œlnmpæ¶æ„ä¸­phpä½œä¸ºä¸€ä¸ªæœåŠ¡ï¼Œä¸“é—¨è§£æphpã€‚åŒæ ·çš„phpä¾èµ–mysqlï¼Œæ‰€ä»¥é¦–å…ˆå®‰è£…mysql è¿™é‡Œç¯å¢ƒä¸ºCentOS6.5 å®‰è£…mysql è¿™é‡Œé€‰æ‹©å…ç¼–è¯‘å®‰è£…ï¼Œå¯ä»¥åœ¨å®˜ç½‘æ‰¾åˆ°ã€‚åœ¨mysql5.5ä¹‹åçš„ç‰ˆæœ¬ä¸åœ¨å¼€æºäº†ï¼Œä½†è¿˜å¯ä»¥é€‰æ‹©mariadbçš„åˆ†æ”¯ç‰ˆæœ¬ä½œä¸ºè¿™ä¸ªæ¶æ„çš„ä»£æ›¿ã€‚æ¥ä¸‹æ¥å°±å¯ä»¥å¼€å§‹mysqlçš„å®‰è£…äº†ã€‚ ","date":"2018-05-31","objectID":"/lnmp/:0:0","tags":["linux"],"title":"æ­å»ºlnmpç¯å¢ƒ","uri":"/lnmp/"},{"categories":["è¿ç»´"],"content":"ä¸‹è½½mysql wget http://mirrors.sohu.com/mysql/MySQL-5.1/mysql-5.1.73-linux-i686-glibc23.tar.gz è¿™ä¸ªç‰ˆæœ¬æœ‰ç‚¹ä½ï¼Œå¯ä»¥è‡ªå·±é€‰æ‹©åˆé€‚ç‰ˆæœ¬ ","date":"2018-05-31","objectID":"/lnmp/:1:0","tags":["linux"],"title":"æ­å»ºlnmpç¯å¢ƒ","uri":"/lnmp/"},{"categories":["è¿ç»´"],"content":"è§£å‹ tar -zxvf tar -zxvf mysql-5.1.73-linux-i686-glibc23.tar.gz ","date":"2018-05-31","objectID":"/lnmp/:2:0","tags":["linux"],"title":"æ­å»ºlnmpç¯å¢ƒ","uri":"/lnmp/"},{"categories":["è¿ç»´"],"content":"ç§»åŠ¨åˆ°æŒ‡å®šç›®å½• mv mysql-5.1.73-linux-i686-glibc23 /usr/local/mysql ","date":"2018-05-31","objectID":"/lnmp/:3:0","tags":["linux"],"title":"æ­å»ºlnmpç¯å¢ƒ","uri":"/lnmp/"},{"categories":["è¿ç»´"],"content":"åˆ›å»ºmysqlç”¨æˆ·ï¼Œä½†ä¸å…è®¸ç™»å½•ï¼Œä¸åˆ›å»ºå®¶ç›®å½• useradd -s /sbin/nologin -M mysql -sè¡¨ç¤ºæŒ‡å®šbashï¼Œè¿™é‡Œå‡ºäºå®‰å…¨æ€§è€ƒè™‘è®¾ç½®ä¸å…è®¸ç™»å½•ï¼Œ-Mä¸åˆ›å»ºå®¶ç›®å½• ","date":"2018-05-31","objectID":"/lnmp/:4:0","tags":["linux"],"title":"æ­å»ºlnmpç¯å¢ƒ","uri":"/lnmp/"},{"categories":["è¿ç»´"],"content":"åˆ›å»ºæ•°æ®åº“ç›®å½•ï¼Œå¹¶æ”¹ä¸ºmysqlå±ä¸» mkdir /data/mysql -pv chown -R mysqlï¼šmysql /data/mysql ","date":"2018-05-31","objectID":"/lnmp/:5:0","tags":["linux"],"title":"æ­å»ºlnmpç¯å¢ƒ","uri":"/lnmp/"},{"categories":["è¿ç»´"],"content":"åˆå§‹åŒ–mysql cd /usr/local/mysql ./scripts/mysql_install_db --user=mysql --datadir=/data/mysql --user=*æ˜¯æŒ‡å®šç”¨æˆ·mysqlï¼Œ--datadir=*æ˜¯æŒ‡å®šæ•°æ®åº“ç›®å½•ã€‚å¯ä»¥ä½¿ç”¨echo $?éªŒè¯å‘½ä»¤æ‰§è¡Œç»“æœæ˜¯å¦æ­£ç¡®ï¼Œ0ä¸ºæ­£ç¡®ã€‚ ","date":"2018-05-31","objectID":"/lnmp/:6:0","tags":["linux"],"title":"æ­å»ºlnmpç¯å¢ƒ","uri":"/lnmp/"},{"categories":["è¿ç»´"],"content":"mysqlé…ç½®æ–‡ä»¶ cp /usr/local/mysql/support-files/my-large.cnf /etc/my.cnf vim /etc/my.cnf ...... port = 3306 #ç›‘å¬ç«¯å£ socket = /tmp/mysql.sock #socket ..... log-bin=mysql-bin #ä¿®æ”¹mysqlæ•°æ®åº“æ—¶ï¼Œè®°å½•æ—¥å¿— ","date":"2018-05-31","objectID":"/lnmp/:7:0","tags":["linux"],"title":"æ­å»ºlnmpç¯å¢ƒ","uri":"/lnmp/"},{"categories":["è¿ç»´"],"content":"mysqlå¯åŠ¨è„šæœ¬ cp /usr/local/mysql/mysql.server /etc/init.d/mysqld vim /etc/init.d/mysqld basedir=/usr/local/mysql #æŒ‡å®šå®‰è£…ç›®å½• datadir=/data/mysql #æŒ‡å®šæ•°æ®åº“ç›®å½• ","date":"2018-05-31","objectID":"/lnmp/:8:0","tags":["linux"],"title":"æ­å»ºlnmpç¯å¢ƒ","uri":"/lnmp/"},{"categories":["è¿ç»´"],"content":"è®¾ç½®å¼€æœºå¯åŠ¨ chkconfig --add mysqldï¼›chkconfig mysqld on å¼€æœºå¯åŠ¨ ç¼–è¯‘å®‰è£…mysqlæ—¶ç¼–è¯‘å‚æ•°è®°å½•åœ¨cat /usr/local/mysql/bin/mysqlbug |grep -i configure å®‰è£…php ","date":"2018-05-31","objectID":"/lnmp/:9:0","tags":["linux"],"title":"æ­å»ºlnmpç¯å¢ƒ","uri":"/lnmp/"},{"categories":["è¿ç»´"],"content":"ä¸‹è½½ wget http://cn2.php.net/get/php-5.4.45.tar.bz2/from/this/mirror ","date":"2018-05-31","objectID":"/lnmp/:10:0","tags":["linux"],"title":"æ­å»ºlnmpç¯å¢ƒ","uri":"/lnmp/"},{"categories":["è¿ç»´"],"content":"è§£å‹ mv mirror php-5.4.45.tar.bz2 tar -jxvf php-5.4.45.tar.bz2 ","date":"2018-05-31","objectID":"/lnmp/:11:0","tags":["linux"],"title":"æ­å»ºlnmpç¯å¢ƒ","uri":"/lnmp/"},{"categories":["è¿ç»´"],"content":"ç¼–è¯‘å®‰è£… cd php-5.4.45 ./configure --prefix=/usr/local/php --with-config-file-path=/usr/local/php/etc --enable-fpm --with-fpm-user=php-fpm --with-fpm-group=php-fpm --with-mysql=/usr/local/mysql --with-mysql-sock=/tmp/mysql.sock --with-libxml-dir --with-gd --with-jpeg-dir --with-png-dir --with-freetype-dir --with-iconv-dir --with-zlib-dir --with-mcrypt --enable-soap --enable-gd-native-ttf --enable-ftp --enable-mbstring --enable-exif --enable-zend-multibyte --disable-ipv6 --with-pear --with-curl # å‡ºç°é”™è¯¯ï¼š configure: error: jpeglib.h not found. #è§£å†³æ–¹æ³•ï¼š yum install -y libjpeg-devel #å‡ºç°é”™è¯¯ï¼š configure: error: mcrypt.h not found. # è§£å†³æ–¹æ³•ï¼š wget http://www.lishiming.net/data/attachment/forum/epel-release-6-8_32.noarch.rpm #CentOSçš„yumæ‰©å±•æº rpm -ivh epel-release-6-8_32.noarch.rpm yum install -y libmcrypt-devel make make install /usr/local/php/bin/php -m :æŸ¥çœ‹é™æ€æ¨¡å— /usr/local/php/bin/php -i ï¼šæŸ¥çœ‹ç›¸å…³é…ç½® ","date":"2018-05-31","objectID":"/lnmp/:12:0","tags":["linux"],"title":"æ­å»ºlnmpç¯å¢ƒ","uri":"/lnmp/"},{"categories":["è¿ç»´"],"content":"phpçš„é…ç½®æ–‡ä»¶ cp /usr/src/php-5.4.45/php.ini-production /usr/local/php/etc/php.ini ","date":"2018-05-31","objectID":"/lnmp/:13:0","tags":["linux"],"title":"æ­å»ºlnmpç¯å¢ƒ","uri":"/lnmp/"},{"categories":["è¿ç»´"],"content":"phpå¼€æœºå¯åŠ¨ cp /usr/src/php-5.4.45/sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm mv /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf #æœåŠ¡å¯åŠ¨çš„è„šæœ¬é…ç½®æ–‡ä»¶ chkconfig --add php-fpm chkconfig --level 345 php-fpm on ","date":"2018-05-31","objectID":"/lnmp/:14:0","tags":["linux"],"title":"æ­å»ºlnmpç¯å¢ƒ","uri":"/lnmp/"},{"categories":["è¿ç»´"],"content":"å¯åŠ¨php useradd -s /sbin/nologin php-fpm chmod +x /etc/init.d/php-fpm service php-fpm start å®‰è£…nginx ","date":"2018-05-31","objectID":"/lnmp/:15:0","tags":["linux"],"title":"æ­å»ºlnmpç¯å¢ƒ","uri":"/lnmp/"},{"categories":["è¿ç»´"],"content":"ä¸‹è½½nginx cd /usr/src wget http://nginx.org/download/nginx-1.6.2.tar.gz ","date":"2018-05-31","objectID":"/lnmp/:16:0","tags":["linux"],"title":"æ­å»ºlnmpç¯å¢ƒ","uri":"/lnmp/"},{"categories":["è¿ç»´"],"content":"è§£å‹ tar -xvf nginx-1.6.2.tar.gz ","date":"2018-05-31","objectID":"/lnmp/:17:0","tags":["linux"],"title":"æ­å»ºlnmpç¯å¢ƒ","uri":"/lnmp/"},{"categories":["è¿ç»´"],"content":"ç¼–è¯‘å®‰è£… ./configure --prefix=/usr/local/nginx --with-pcre #å‡ºç°é”™è¯¯ï¼š ./configure: error: the HTTP rewrite module requires the PCRE library. #è§£å†³æ–¹æ³•ï¼š yum install -y pcre-devel make make install ","date":"2018-05-31","objectID":"/lnmp/:18:0","tags":["linux"],"title":"æ­å»ºlnmpç¯å¢ƒ","uri":"/lnmp/"},{"categories":["è¿ç»´"],"content":"å¯åŠ¨ ç¼–è¾‘å¯åŠ¨è„šæœ¬ vim /etc/init.d/nginx #!/bin/bash # chkconfig: - 30 21 # description: http service. # Source Function Library . /etc/init.d/functions # Nginx Settings NGINX_SBIN=\"/usr/local/nginx/sbin/nginx\" NGINX_CONF=\"/usr/local/nginx/conf/nginx.conf\" NGINX_PID=\"/usr/local/nginx/logs/nginx.pid\" RETVAL=0 prog=\"Nginx\" start() { echo -n $\"Starting $prog: \" mkdir -p /dev/shm/nginx_temp daemon $NGINX_SBIN -c $NGINX_CONF RETVAL=$? echo return $RETVAL } stop() { echo -n $\"Stopping $prog: \" killproc -p $NGINX_PID $NGINX_SBIN -TERM rm -rf /dev/shm/nginx_temp RETVAL=$? echo return $RETVAL } reload(){ echo -n $\"Reloading $prog: \" killproc -p $NGINX_PID $NGINX_SBIN -HUP RETVAL=$? echo return $RETVAL } restart(){ stop start } configtest(){ $NGINX_SBIN -c $NGINX_CONF -t return 0 } case \"$1\" in start) start ;; stop) stop ;; reload) reload ;; restart) restart ;; configtest) configtest ;; *) echo $\"Usage: $0{start|stop|reload|restart|configtest}\" RETVAL=1 esac exit $RETVAL ä¿å­˜åï¼Œæ›´æ”¹æƒé™: chmod 755 /etc/init.d/nginx chkconfig --add nginx å¼€æœºå¯åŠ¨ chkconfig nginx on å¯åŠ¨æœåŠ¡ service nginx start ","date":"2018-05-31","objectID":"/lnmp/:19:0","tags":["linux"],"title":"æ­å»ºlnmpç¯å¢ƒ","uri":"/lnmp/"},{"categories":["è¿ç»´"],"content":"æµ‹è¯•è§£æphp ç¼–è¾‘é…ç½®æ–‡ä»¶/usr/local/nginx/conf/nginx.conf ä¿®æ”¹åˆ¶å®šè¡Œ ...... location ~ \\.php$ { root html; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME /usr/local/nginx/html$fastcgi_script_name; #è·¯å¾„ä¸ºç½‘ç«™æ ¹ç›®å½• include fastcgi_params; } ...... åœ¨/usr/local/nginx/html/ä¸‹åˆ›å»ºä¸€ä¸ªinfo.phpæ–‡ä»¶ \u003c?php phpinfo(); ?\u003e æµè§ˆå™¨è®¿é—®ï¼šhttp://127.0.0.1/info.phpæµ‹è¯• ","date":"2018-05-31","objectID":"/lnmp/:20:0","tags":["linux"],"title":"æ­å»ºlnmpç¯å¢ƒ","uri":"/lnmp/"},{"categories":["è¿ç»´"],"content":" lampå³ apache + mysql + phpï¼Œæ˜¯äº’è”ç½‘å¸¸ç”¨æ¶æ„ã€‚ è¦æ³¨æ„çš„æ˜¯phpä¾èµ–apacheå’Œmysqlï¼Œæ‰€ä»¥è¦æœ€åå®‰è£…ã€‚ç³»ç»Ÿç¯å¢ƒä¸ºCentOS6.5 å®‰è£…mysql è¿™é‡Œé€‰æ‹©å…ç¼–è¯‘å®‰è£…ï¼Œå¯ä»¥åœ¨å®˜ç½‘æ‰¾åˆ°ã€‚åœ¨mysql5.5ä¹‹åçš„ç‰ˆæœ¬ä¸åœ¨å¼€æºäº†ï¼Œä½†è¿˜å¯ä»¥é€‰æ‹©mariadbçš„åˆ†æ”¯ç‰ˆæœ¬ä½œä¸ºè¿™ä¸ªæ¶æ„çš„ä»£æ›¿ã€‚æ¥ä¸‹æ¥å°±å¯ä»¥å¼€å§‹mysqlçš„å®‰è£…äº†ã€‚ ","date":"2018-05-31","objectID":"/lamp/:0:0","tags":["linux"],"title":"æ­å»ºlampç¯å¢ƒ","uri":"/lamp/"},{"categories":["è¿ç»´"],"content":"ä¸‹è½½mysql wget http://mirrors.sohu.com/mysql/MySQL-5.1/mysql-5.1.73-linux-i686-glibc23.tar.gz è¿™ä¸ªç‰ˆæœ¬æœ‰ç‚¹ä½ï¼Œå¯ä»¥è‡ªå·±é€‰æ‹©åˆé€‚ç‰ˆæœ¬ ","date":"2018-05-31","objectID":"/lamp/:1:0","tags":["linux"],"title":"æ­å»ºlampç¯å¢ƒ","uri":"/lamp/"},{"categories":["è¿ç»´"],"content":"è§£å‹ tar -zxvf tar -zxvf mysql-5.1.73-linux-i686-glibc23.tar.gz ","date":"2018-05-31","objectID":"/lamp/:2:0","tags":["linux"],"title":"æ­å»ºlampç¯å¢ƒ","uri":"/lamp/"},{"categories":["è¿ç»´"],"content":"ç§»åŠ¨åˆ°æŒ‡å®šç›®å½• mv mysql-5.1.73-linux-i686-glibc23 /usr/local/mysql ","date":"2018-05-31","objectID":"/lamp/:3:0","tags":["linux"],"title":"æ­å»ºlampç¯å¢ƒ","uri":"/lamp/"},{"categories":["è¿ç»´"],"content":"åˆ›å»ºmysqlç”¨æˆ·ï¼Œä½†ä¸å…è®¸ç™»å½•ï¼Œä¸åˆ›å»ºå®¶ç›®å½• useradd -s /sbin/nologin -M mysql -sè¡¨ç¤ºæŒ‡å®šbashï¼Œè¿™é‡Œå‡ºäºå®‰å…¨æ€§è€ƒè™‘è®¾ç½®ä¸å…è®¸ç™»å½•ï¼Œ-Mä¸åˆ›å»ºå®¶ç›®å½• ","date":"2018-05-31","objectID":"/lamp/:4:0","tags":["linux"],"title":"æ­å»ºlampç¯å¢ƒ","uri":"/lamp/"},{"categories":["è¿ç»´"],"content":"åˆ›å»ºæ•°æ®åº“ç›®å½•ï¼Œå¹¶æ”¹ä¸ºmysqlå±ä¸» mkdir /data/mysql -pv chown -R mysqlï¼šmysql /data/mysql ","date":"2018-05-31","objectID":"/lamp/:5:0","tags":["linux"],"title":"æ­å»ºlampç¯å¢ƒ","uri":"/lamp/"},{"categories":["è¿ç»´"],"content":"åˆå§‹åŒ–mysql cd /usr/local/mysql ./scripts/mysql_install_db --user=mysql --datadir=/data/mysql --user=*æ˜¯æŒ‡å®šç”¨æˆ·mysqlï¼Œ--datadir=*æ˜¯æŒ‡å®šæ•°æ®åº“ç›®å½•ã€‚å¯ä»¥ä½¿ç”¨echo $?éªŒè¯å‘½ä»¤æ‰§è¡Œç»“æœæ˜¯å¦æ­£ç¡®ï¼Œ0ä¸ºæ­£ç¡®ã€‚ ","date":"2018-05-31","objectID":"/lamp/:6:0","tags":["linux"],"title":"æ­å»ºlampç¯å¢ƒ","uri":"/lamp/"},{"categories":["è¿ç»´"],"content":"mysqlé…ç½®æ–‡ä»¶ cp /usr/local/mysql/support-files/my-large.cnf /etc/my.cnf vim /etc/my.cnf ...... port = 3306 #ç›‘å¬ç«¯å£ socket = /tmp/mysql.sock #socket ..... log-bin=mysql-bin #ä¿®æ”¹mysqlæ•°æ®åº“æ—¶ï¼Œè®°å½•æ—¥å¿— ","date":"2018-05-31","objectID":"/lamp/:7:0","tags":["linux"],"title":"æ­å»ºlampç¯å¢ƒ","uri":"/lamp/"},{"categories":["è¿ç»´"],"content":"mysqlå¯åŠ¨è„šæœ¬ cp /usr/local/mysql/mysql.server /etc/init.d/mysqld vim /etc/init.d/mysqld basedir=/usr/local/mysql #æŒ‡å®šå®‰è£…ç›®å½• datadir=/data/mysql #æŒ‡å®šæ•°æ®åº“ç›®å½• ","date":"2018-05-31","objectID":"/lamp/:8:0","tags":["linux"],"title":"æ­å»ºlampç¯å¢ƒ","uri":"/lamp/"},{"categories":["è¿ç»´"],"content":"è®¾ç½®å¼€æœºå¯åŠ¨ chkconfig --add mysqldï¼›chkconfig mysqld on å¼€æœºå¯åŠ¨ ç¼–è¯‘å®‰è£…mysqlæ—¶ç¼–è¯‘å‚æ•°è®°å½•åœ¨cat /usr/local/mysql/bin/mysqlbug |grep -i configure å®‰è£…httpd ä½¿ç”¨apacheçš„httpdæä¾›ç½‘ç»œwebæœåŠ¡ ","date":"2018-05-31","objectID":"/lamp/:9:0","tags":["linux"],"title":"æ­å»ºlampç¯å¢ƒ","uri":"/lamp/"},{"categories":["è¿ç»´"],"content":"ä¸‹è½½httpd wget http://mirrors.cnnic.cn/apache/httpd/httpd-2.2.31.tar.gz ","date":"2018-05-31","objectID":"/lamp/:10:0","tags":["linux"],"title":"æ­å»ºlampç¯å¢ƒ","uri":"/lamp/"},{"categories":["è¿ç»´"],"content":"è§£å‹ tar -zxvf httpd-2.2.31.tar.gz ","date":"2018-05-31","objectID":"/lamp/:11:0","tags":["linux"],"title":"æ­å»ºlampç¯å¢ƒ","uri":"/lamp/"},{"categories":["è¿ç»´"],"content":"ç¼–è¯‘å®‰è£… # ç¼–è¯‘ ./configure --prefix=/usr/local/apache \\ \u003e-with-include-apr --enable-so \\ \u003e--enable-deflate=shared \\ \u003e--enable-rewrite=shared \\ \u003e--enable-expires=shared \\ \u003e-with-pcre \\ \u003e-with-mpm=prefork make # å®‰è£… make install ç¼–è¯‘é€‰é¡¹è®°å½•åœ¨/usr/local/apache/build/config.nice ä¸­ ","date":"2018-05-31","objectID":"/lamp/:12:0","tags":["linux"],"title":"æ­å»ºlampç¯å¢ƒ","uri":"/lamp/"},{"categories":["è¿ç»´"],"content":"å¯åŠ¨httpd /usr/local/apache/bin/apachectl start /usr/local/apache/bin/apachectl -M ï¼šæŸ¥çœ‹å„ç§åº“ é™æ€åº“(ç¼–è¯‘æ—¶ç›´æ¥æ”¾å…¥ä¸‹åˆ—æ–‡ä»¶) /usr/local/apache/bin/httpd åŠ¨æ€åº“(ç”¨åˆ°æ—¶åŠ è½½) /usr/local/apache/modules/ /usr/local/apache/bin/apachectl -l ï¼šæŸ¥çœ‹é™æ€åº“ä»¥åŠapacheå·¥ä½œæ¨¡å¼ /usr/local/apache/bin/apachectl -t ï¼šæŸ¥çœ‹é…ç½®æ–‡ä»¶æœ‰æ— è¯­æ³•é”™è¯¯ é…ç½®æ–‡ä»¶ /usr/local/apache/conf/httpd.conf /usr/local/apache/bin/apachectl graceful åŠ è½½é…ç½®æ–‡ä»¶ å¯åŠ¨httpdæ—¶çš„è­¦å‘Šï¼š httpd: apr_sockaddr_info_get() failed for ã€linuxã€‘ httpd: Could not reliably determine the server's fully qualified domain name, using 127.0.0.1 for ServerName è§£å†³æ–¹æ³•(é—®é¢˜åœ¨äºä¸»æœºåä¸åŒ¹é…) è­¦å‘Š1 ï¼šåœ¨/etc/hostsä¸­çš„127.0.0.1è¡Œåæ·»åŠ linux è­¦å‘Š2 ï¼šåœ¨httpdçš„é…ç½®æ–‡ä»¶/usr/local/apache/conf/httpd.confä¸­çš„ServerNameè¡Œä¸­æ”¹ä¸º ServerName linux:80 ","date":"2018-05-31","objectID":"/lamp/:13:0","tags":["linux"],"title":"æ­å»ºlampç¯å¢ƒ","uri":"/lamp/"},{"categories":["è¿ç»´"],"content":"å¼€æœºå¯åŠ¨ ä¿®æ”¹å¯åŠ¨è„šæœ¬ cp /usr/local/apache/bin/apachectl /etc/init.d/httpd vim /etc/init.d/httpd åœ¨#!/bin/bashä¸‹åŠ å…¥ #chkconfig:345 61 61 #description:Apache httpd è®¾ç½®å¼€æœºå¯åŠ¨ chkconfig --add httpd chkconfig --level 345 httpd on å®‰è£…php ","date":"2018-05-31","objectID":"/lamp/:14:0","tags":["linux"],"title":"æ­å»ºlampç¯å¢ƒ","uri":"/lamp/"},{"categories":["è¿ç»´"],"content":"ä¸‹è½½php wget http://cn2.php.net/get/php-5.4.45.tar.bz2/from/this/mirror ","date":"2018-05-31","objectID":"/lamp/:15:0","tags":["linux"],"title":"æ­å»ºlampç¯å¢ƒ","uri":"/lamp/"},{"categories":["è¿ç»´"],"content":"è§£å‹ mv mirror php-5.4.45.tar.bz2 tar -jxvf php-5.4.45.tar.bz2 ","date":"2018-05-31","objectID":"/lamp/:16:0","tags":["linux"],"title":"æ­å»ºlampç¯å¢ƒ","uri":"/lamp/"},{"categories":["è¿ç»´"],"content":"ç¼–è¯‘å®‰è£… cd php-5.4.45 ./configure --prefix=/usr/local/php --with-apxs2=/usr/local/apache/bin/apxs --with-config-file-path=/usr/local/php/etc --with-mysql=/usr/local/mysql --with-libxml-dir --with-gd --with-jpeg-dir --with-png-dir --with-freetype-dir --with-iconv-dir --with-zlib-dir --with-bz2 --with-openssl --with-mcrypt --enable-soap --enable-gd-native-ttf --enable-mbstring --enable-sockets --enable-exif --disable-ipv6 #å‡ºç°é”™è¯¯ï¼š configure: error: jpeglib.h not found. # è§£å†³æ–¹æ³•ï¼š yum install -y libjpeg-devel #å‡ºç°é”™è¯¯ï¼š configure: error: mcrypt.h not found. #è§£å†³æ–¹æ³•ï¼š wget http://www.lishiming.net/data/attachment/forum/epel-release-6-8_32.noarch.rpm #CentOSçš„yumæ‰©å±•æº rpm -ivh epel-release-6-8_32.noarch.rpm yum install -y libmcrypt-devel make make install /usr/local/php/bin/php -m :æŸ¥çœ‹é™æ€æ¨¡å— /usr/local/php/bin/php -i ï¼šæŸ¥çœ‹ç›¸å…³é…ç½® ","date":"2018-05-31","objectID":"/lamp/:17:0","tags":["linux"],"title":"æ­å»ºlampç¯å¢ƒ","uri":"/lamp/"},{"categories":["è¿ç»´"],"content":"ä¿®æ”¹é…ç½®æ–‡ä»¶ cp /usr/src/php-5.4.45/php.ini-production /usr/local/php/etc/php.ini vim /usr/local/apache/conf/httpd.conf åœ¨ AddType application/x-compress .Z AddType application/x-gzip .gz .tgz ä¸¤è¡Œä¸‹åŠ å…¥ AddType application/x-httpd-php .php å°† DirectoryIndex index.html åæ·»åŠ  1.php DirectoryIndex index.html 1.php ","date":"2018-05-31","objectID":"/lamp/:18:0","tags":["linux"],"title":"æ­å»ºlampç¯å¢ƒ","uri":"/lamp/"},{"categories":["è¿ç»´"],"content":"æµ‹è¯• åœ¨Apacheçš„å®‰è£…æ–‡ä»¶ä¸­æ·»åŠ phpæ–‡ä»¶ /usr/local/apache/htdocs/ç›®å½•ä¸‹åˆ›å»º vim 1.php \u003c?php echo \"Welcome to 1.php\" ; ?\u003e ","date":"2018-05-31","objectID":"/lamp/:19:0","tags":["linux"],"title":"æ­å»ºlampç¯å¢ƒ","uri":"/lamp/"},{"categories":["ç¬”è®°"],"content":"ç®€å•çš„è£…é¥°å™¨å‡½æ•°ï¼š import time from functools import wraps def timethis(func): \"\"\" Decorator that reports the execution time. \"\"\" @wraps(func) def wrapper(*args, **kwargs): start = time.time() result = func(*args, **kwargs) end = time.time() print(func.__name__, end-start) return result return wrapper å‡½æ•°çš„åŠŸèƒ½å¾ˆç®€å•ï¼Œå°±æ˜¯è¾“å‡ºè°ƒç”¨å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ã€‚ In [2]: @timethis ...: def countdown(n): ...: while n \u003e 0: ...: n -= 1 ...: In [3]: countdown(100000) countdown 0.009751319885253906 æœ¬è´¨ä¸Šæ¥è¯´pythonçš„è£…é¥°å™¨å°±æ˜¯ä¸€ä¸ªå‡½æ•°å¤–å†åŒ…è£…ä¸€ä¸ªå‡½æ•°ï¼Œç­‰åŒäºï¼š timethis(countdown(100000)) è£…é¥°å™¨å†…éƒ¨çš„wrapper()å‡½æ•°ä¸­ä½¿ç”¨*argså’Œ**kwargsæ¥æ¥å—ä»»æ„å‚æ•°ï¼Œå¹¶ç”¨æ–°çš„å‡½æ•°åŒ…è£…å™¨æ¥ä»£æ›¿åŸæ¥å‡½æ•°ï¼Œå…¶ä¸­çš„funcå°±æ˜¯åŸæ¥çš„å‡½æ•°ï¼Œå³è°ƒç”¨åŒ…è£…å™¨çš„å‡½æ•°ã€‚è€Œä½¿ç”¨@wraps(func)çš„ç›®çš„æ—¶ä¿ç•™åŸå§‹å‡½æ•°çš„å…ƒæ•°æ®ã€‚ In [19]: @timethis ...: def countdown(n:int): ...: '''counts down''' ...: while n \u003e 0: ...: n -= 1 ...: In [20]: countdown(100000) countdown 0.008384943008422852 In [21]: countdown.__name__ Out[21]: 'countdown' In [22]: countdown.__doc__ Out[22]: 'counts down' In [23]: countdown.__annotations__ Out[23]: {'n': int} è¾“å‡ºçš„åŸå§‹å‡½æ•°çš„å…ƒæ•°æ®éƒ½æ­£å¸¸ å†æ¥çœ‹çœ‹å»æ‰wraps()å‡½æ•°çš„ In [26]: countdown.__name__ Out[26]: 'wrapper' In [27]: countdown.__doc__ In [28]: countdown.__annotations__ Out[28]: {} @wraps æœ‰ä¸€ä¸ªé‡è¦ç‰¹å¾æ˜¯å®ƒèƒ½è®©ä½ é€šè¿‡å±æ€§ wrapped ç›´æ¥è®¿é—®è¢«åŒ…è£…å‡½æ•°ã€‚ä¾‹å¦‚: In [34]: countdown.__wrapped__.__name__ Out[34]: 'countdown' __wrapped__ å±æ€§è¿˜èƒ½è®©è¢«è£…é¥°å‡½æ•°æ­£ç¡®æš´éœ²åº•å±‚çš„å‚æ•°ç­¾åä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š In [43]: from inspect import signature In [44]: signature(countdown) Out[44]: \u003cSignature (n:int)\u003e å¸¦å‚æ•°çš„è£…é¥°å™¨ import logging from functools import wraps def logged(level, name=None, message=None): def decorate(func): logname = name if name else func.__module__ log = logging.getLogger(logname) logmsg = message if message else func.__name__ @wraps(func) def wrapper(*args, **kwargs): log.log(level, logmsg) return func(*args, **kwargs) return wrapper return decorate @logged(logging.DEBUG) def add(x, y): return x + y @logged(logging.CRITICAL, 'example') def spam(): print(\"Spam!\") å¸¦å¯é€‰å‚æ•°çš„è£…é¥°å™¨ import logging from functools import wraps, partial def logged(func=None, *, level=logging.DEBUG, name=None, message=None): if func is None: return partial(logged, level=level, name=name, message=message) logname = name if name else func.__module__ log = logging.getLogger(logname) logmsg = message if message else func.__name__ @wraps(func) def wrapper(*args, **kwargs): log.log(level, logmsg) return func(*args, **kwargs) return wrapper @logged def add(x, y): return x + y @logged(level=logging.CRITICAL, name='example') def spam(): print(\"Spam!\") ","date":"2018-03-31","objectID":"/python%E8%A3%85%E9%A5%B0%E5%99%A8/:0:0","tags":["python"],"title":"pythonè£…é¥°å™¨","uri":"/python%E8%A3%85%E9%A5%B0%E5%99%A8/"},{"categories":["ä»£ç "],"content":" åç«¯ä½¿ç”¨flaskè®¾è®¡åŸºäºtokenè®¤è¯æ–¹å¼çš„restfulæ¥å£ï¼Œå‰ç«¯ä½¿ç”¨vue.jså…¨å®¶æ¡¶ï¼Œåˆ©ç”¨axiosé€šè®¯ã€‚ æ„Ÿè°¢ä¸¤ç¯‡æ–‡ç« çš„ä½œè€…ï¼š http://www.cnblogs.com/vovlie/p/4182814.html https://segmentfault.com/a/1190000008383094?_ea=1639495 æºç é“¾æ¥ï¼šhttps://github.com/xingyys/flaskvue åç«¯Flask Flaské‡‡ç”¨tokenè®¤è¯æ–¹å¼ï¼Œä¸»è¦æ€è·¯æ˜¯é€šè¿‡/api/loginç™»å½•è·å–tokenï¼Œç„¶åä½¿ç”¨tokenè°ƒç”¨å„ä¸ªæ¥å£ã€‚ æ‰€ç”¨åˆ°æ¡†æ¶çš„åº“ï¼š flask flask-corsï¼šflaskè·¨åŸŸ flask-sqlachemy: flaskæ•°æ®åº“orm flask-httpauthï¼šflaskçš„authè®¤è¯ passlib: pythonå¯†ç è§£æåº“ itsdangerous ","date":"2017-09-20","objectID":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/:0:0","tags":["flask","vue"],"title":"Flaskä¸Vueçš„tokenè®¤è¯","uri":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/"},{"categories":["ä»£ç "],"content":"åç«¯ç»“æ„å›¾ flask/ â”œâ”€â”€ app # ä¸»ç›®å½• â”‚Â â”œâ”€â”€ __init__.py â”‚Â â”œâ”€â”€ __init__.pyc â”‚Â â”œâ”€â”€ models.py # æ•°æ®åº“ â”‚Â â”œâ”€â”€ models.pyc â”‚Â â”œâ”€â”€ views.py # è§†å›¾ â”‚Â â””â”€â”€ views.pyc â”œâ”€â”€ config.py # é…ç½®ä¿¡æ¯ â”œâ”€â”€ config.pyc â”œâ”€â”€ db_create.py # åˆ›å»ºæ•°æ®åº“ â”œâ”€â”€ db_migrate.py # æ›´æ–°æ•°æ®åº“ â”œâ”€â”€ db_repository â”‚Â â”œâ”€â”€ __init__.py â”‚Â â”œâ”€â”€ __init__.pyc â”‚Â â”œâ”€â”€ manage.py â”‚Â â”œâ”€â”€ migrate.cfg â”‚Â â”œâ”€â”€ README â”‚Â â””â”€â”€ versions â”‚Â â”œâ”€â”€ 008_migration.py â”‚Â â”œâ”€â”€ 008_migration.pyc â”‚Â â”œâ”€â”€ 009_migration.py â”‚Â â”œâ”€â”€ 009_migration.pyc â”‚Â â”œâ”€â”€ __init__.py â”‚Â â””â”€â”€ __init__.pyc â”œâ”€â”€ index.html â””â”€â”€ run.py # appçš„è¿è¡Œæ–‡ä»¶ ","date":"2017-09-20","objectID":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/:1:0","tags":["flask","vue"],"title":"Flaskä¸Vueçš„tokenè®¤è¯","uri":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/"},{"categories":["ä»£ç "],"content":"å…·ä½“å®ç° ","date":"2017-09-20","objectID":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/:2:0","tags":["flask","vue"],"title":"Flaskä¸Vueçš„tokenè®¤è¯","uri":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/"},{"categories":["ä»£ç "],"content":"ç³»ç»Ÿåˆå§‹åŒ–app/__init__.py # -*- coding:utf-8 -*- from flask import Flask from flask_sqlalchemy import SQLAlchemy from flask_httpauth import HTTPBasicAuth from flask_cors import CORS app = Flask(__name__) # flaskçš„è·¨åŸŸè§£å†³ CORS(app) app.config.from_object('config') db = SQLAlchemy(app) auth = HTTPBasicAuth() from . import models, views ","date":"2017-09-20","objectID":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/:2:1","tags":["flask","vue"],"title":"Flaskä¸Vueçš„tokenè®¤è¯","uri":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/"},{"categories":["ä»£ç "],"content":"é…ç½®æ–‡ä»¶config.py import os basedir = os.path.abspath(os.path.dirname(__file__)) SQLALCHEMY_DATABASE_URI = \"mysql://root:123456@127.0.0.1/rest\" SQLALCHEMY_MIGRATE_REPO = os.path.join(basedir, 'db_repository') SQLALCHEMY_TRACK_MODIFICATIONS = True BASEDIR = basedir # å®‰å…¨é…ç½® CSRF_ENABLED = True SECRET_KEY = 'jklklsadhfjkhwbii9/sdf\\sdf' ç¯å¢ƒä¸­ä½¿ç”¨mysqlæ•°æ®åº“ï¼Œç‰ˆæœ¬ä¸ºmariadb 10.1.22ã€‚åˆ›å»ºrestè¡¨ $ mysql -uroot -p xxxxxx $ create database rest default charset utf8; ","date":"2017-09-20","objectID":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/:2:2","tags":["flask","vue"],"title":"Flaskä¸Vueçš„tokenè®¤è¯","uri":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/"},{"categories":["ä»£ç "],"content":"åˆ›å»ºæ•°æ®åº“è¡¨app/models.py # -*- coding:utf-8 -*- from app import db, app from passlib.apps import custom_app_context from itsdangerous import TimedJSONWebSignatureSerializer as Serializer, SignatureExpired, BadSignature class User(db.Model): __tablename__ = 'users' id = db.Column(db.Integer, primary_key=True) username = db.Column(db.String(32), index=True) password = db.Column(db.String(128)) # å¯†ç åŠ å¯† def hash_password(self, password): self.password = custom_app_context.encrypt(password) # å¯†ç è§£æ def verify_password(self, password): return custom_app_context.verify(password, self.password) # è·å–tokenï¼Œæœ‰æ•ˆæ—¶é—´10min def generate_auth_token(self, expiration = 600): s = Serializer(app.config['SECRET_KEY'], expires_in = expiration) return s.dumps({ 'id': self.id }) # è§£ætokenï¼Œç¡®è®¤ç™»å½•çš„ç”¨æˆ·èº«ä»½ @staticmethod def verify_auth_token(token): s = Serializer(app.config['SECRET_KEY']) try: data = s.loads(token) except SignatureExpired: return None # valid token, but expired except BadSignature: return None # invalid token user = User.query.get(data['id']) return user åˆ›å»ºæ•°æ®åº“usersè¡¨ï¼š $ python db_create.py $ python db_migrate.py ","date":"2017-09-20","objectID":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/:2:3","tags":["flask","vue"],"title":"Flaskä¸Vueçš„tokenè®¤è¯","uri":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/"},{"categories":["ä»£ç "],"content":"è§†å›¾app/views.py from app import app, db, auth from flask import render_template, json, jsonify, request, abort, g from app.models import * @app.route(\"/\") @auth.login_required def index(): return jsonify('Hello, %s' % g.user.username) @app.route('/api/users', methods = ['POST']) def new_user(): username = request.json.get('username') password = request.json.get('password') if username is None or password is None: abort(400) # missing arguments if User.query.filter_by(username = username).first() is not None: abort(400) # existing user user = User(username = username) user.hash_password(password) db.session.add(user) db.session.commit() return jsonify({ 'username': user.username }) @auth.verify_password def verify_password(username_or_token, password): if request.path == \"/api/login\": user = User.query.filter_by(username=username_or_token).first() if not user or not user.verify_password(password): return False else: user = User.verify_auth_token(username_or_token) if not user: return False g.user = user return True @app.route('/api/login') @auth.login_required def get_auth_token(): token = g.user.generate_auth_token() return jsonify(token) ç”¨æˆ·æ³¨å†Œåå¯†ç åŠ å¯†å­˜å‚¨ï¼Œç¡®è®¤ç”¨æˆ·èº«ä»½æ—¶å¯†ç è§£å¯†ã€‚éœ€è¦è®¤è¯çš„apiä¸Šæ·»åŠ @auth.login_requiredï¼Œå®ƒä¼šåœ¨è°ƒç”¨æ¥å£ä¹‹å‰è°ƒç”¨@auth.verify_passwordä¸‹çš„æ–¹æ³•(æ­¤æ–¹æ³•å”¯ä¸€)å¦‚verify_passwordã€‚æ ¹æ®è¯·æ±‚çš„è·¯å¾„é€‰æ‹©ä¸åŒçš„è®¤è¯æ–¹å¼ã€‚ ","date":"2017-09-20","objectID":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/:2:4","tags":["flask","vue"],"title":"Flaskä¸Vueçš„tokenè®¤è¯","uri":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/"},{"categories":["ä»£ç "],"content":"æµ‹è¯• ä½¿ç”¨curlå‘½ä»¤æµ‹è¯•æ¥å£ æ³¨å†Œç”¨æˆ·: $ curl -i -X POST -H \"Content-Type: application/json\" -d '{\"username\":\"admin\",\"password\":\"123456\"}' http://127.0.0.1:5000/api/register HTTP/1.0 200 OK Content-Type: application/json Access-Control-Allow-Origin: * Content-Length: 26 Server: Werkzeug/0.12.2 Python/2.7.13 Date: Wed, 20 Sep 2017 06:33:46 GMT { \"username\": \"admin\" } æŸ¥çœ‹æ•°æ®åº“ï¼š MariaDB [rest]\u003e select * from users\\G; *************************** 1. row *************************** id: 1 username: admin password: $6$rounds=656000$etV4F3xLL0dwflX8$mLFX9l5dumBnQFtajGmey346viGuQ4bxR7YhQdKtB/nQH9ij2e3HHMEBPj.ef/o//4o9P2Wd3Y7dxQfjwR2hY/ 1 row in set (0.00 sec) è·å–tokenï¼š curl -i -u admin:123456 -X GET -H \"Content-Type: application/json\" http://127.0.0.1:5000/api/login HTTP/1.0 200 OK Content-Type: application/json Access-Control-Allow-Origin: * Content-Length: 125 Server: Werkzeug/0.12.2 Python/2.7.13 Date: Wed, 20 Sep 2017 06:37:01 GMT \"eyJhbGciOiJIUzI1NiIsImV4cCI6MTUwNTg5MDAyMSwiaWF0IjoxNTA1ODg5NDIxfQ.eyJpZCI6MX0.nUIKq-ZhFOiLPwZyUmfgWPfHYNy8o6eoR6lmzdsY0oQ\" ä½¿ç”¨tokenè°ƒç”¨apiï¼š $ curl -i -u eyJhbGciOiJIUzI1NiIsImV4cCI6MTUwNTg5MDAyMSwiaWF0IjoxNTA1ODg5NDIxfQ.eyJpZCI6MX0.nUIKq-ZhFOiLPwZyUmfgWPfHYNy8o6eoR6lmzdsY0oQ:unused -X GET -H \"Content-Type: application/json\" http://127.0.0.1:5000/ HTTP/1.0 200 OK Content-Type: application/json Access-Control-Allow-Origin: * Content-Length: 15 Server: Werkzeug/0.12.2 Python/2.7.13 Date: Wed, 20 Sep 2017 06:38:22 GMT \"Hello, admin\" åŸºäºtokençš„Flask apiæˆåŠŸï¼ï¼ï¼ï¼ å‰ç«¯Vue.js å‰ç«¯ä½¿ç”¨vueçš„å…¨å®¶æ¡¶ï¼Œaxioså‰åç«¯é€šè®¯ï¼Œaxiosæ‹¦æˆªå™¨ï¼ŒlocalStorageä¿å­˜token æ‰€ä½¿ç”¨çš„æ¡†æ¶å’Œåº“ï¼š vue2.0 iview2.X axios vuex vue-router ","date":"2017-09-20","objectID":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/:2:5","tags":["flask","vue"],"title":"Flaskä¸Vueçš„tokenè®¤è¯","uri":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/"},{"categories":["ä»£ç "],"content":"å…·ä½“å®ç° ","date":"2017-09-20","objectID":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/:3:0","tags":["flask","vue"],"title":"Flaskä¸Vueçš„tokenè®¤è¯","uri":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/"},{"categories":["ä»£ç "],"content":"main.js // åˆå§‹åŒ–axios axios.defaults.baseURL = 'http://127.0.0.1:5000' axios.defaults.auth = { username: '', password: '', } // axios.interceptors.request.use((config) =\u003e { // console.log(config) // return config; // }, (error) =\u003e { // return Promise.reject(error) // }) // axiosæ‹¦æˆªå™¨ï¼Œ401çŠ¶æ€æ—¶è·³è½¬ç™»å½•é¡µå¹¶æ¸…é™¤token axios.interceptors.response.use((response) =\u003e { return response; }, (error) =\u003e { if (error.response) { switch (error.response.status) { case 401: store.commit('del_token') router.push('/login') } } return Promise.reject(error.response.data) }) // è·¯ç”±è·³è½¬ router.beforeEach((to, from, next) =\u003e { if (to.meta.required) { // æ£€æŸ¥localStorage if (localStorage.token) { store.commit('set_token', localStorage.token) // æ·»åŠ axioså¤´éƒ¨Authorized axios.defaults.auth = { username: store.state.token, password: store.state.token, } // iviewçš„é¡µé¢åŠ è½½æ¡ iView.LoadingBar.start(); next() } else { next({ path: '/login', }) } } else { iView.LoadingBar.start(); next() } }) router.afterEach((to, from, next) =\u003e { iView.LoadingBar.finish(); }) ","date":"2017-09-20","objectID":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/:3:1","tags":["flask","vue"],"title":"Flaskä¸Vueçš„tokenè®¤è¯","uri":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/"},{"categories":["ä»£ç "],"content":"è·¯ç”± export default new Router({ routes: [{ path: '/', name: 'index', component: Index, meta: { required: true, } }, { path: '/login', name: 'login', component: Login, }] }) è·¯ç”±æ·»åŠ metaå­—æ®µï¼Œä½œä¸ºéœ€è¦è®¤è¯è·¯ç”±çš„æ ‡å¿— ","date":"2017-09-20","objectID":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/:3:2","tags":["flask","vue"],"title":"Flaskä¸Vueçš„tokenè®¤è¯","uri":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/"},{"categories":["ä»£ç "],"content":"vuex export default new Vuex.Store({ state: { token: '' }, mutations: { set_token(state, token) { state.token = token localStorage.token = token }, del_token(state) { state.token = '' localStorage.removeItem('token') } } }) vuexä¸­ä¿å­˜tokenï¼ŒåŒæ—¶ä¿®æ”¹åˆ é™¤tokenå’ŒlocalStorage.token ","date":"2017-09-20","objectID":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/:3:3","tags":["flask","vue"],"title":"Flaskä¸Vueçš„tokenè®¤è¯","uri":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/"},{"categories":["ä»£ç "],"content":"ç™»å½•å’Œç™»å‡º ç™»å½•ï¼š handleSubmit(name, form) { this.$refs[name].validate((valid) =\u003e { if (valid) { // ç”¨æˆ·åå¯†ç ç®€å•éªŒè¯åæ·»åŠ åˆ°axiosçš„authä¸­ this.$axios.defaults.auth = { username: form.username, password: form.password, } this.$axios.get('/api/login').then(response =\u003e { this.$Message.success(\"æäº¤æˆåŠŸ\") let data = response.data // ä¿å­˜token this.$store.commit('set_token', data) this.$router.push('/') }).catch(error =\u003e { this.$Message.error(error.status) }) } else { this.$Message.error('è¡¨å•éªŒè¯å¤±è´¥!'); } }) } ç™»å‡ºï¼š logout() { this.$store.commit('del_token') this.$router.push('/login') } åˆ é™¤tokenå¹¶è·³è½¬åˆ°ç™»å½•é¡µ flaskå’Œvueçš„tokenè®¤è¯å°±å®Œæˆäº†ï¼ï¼ï¼ï¼ ","date":"2017-09-20","objectID":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/:3:4","tags":["flask","vue"],"title":"Flaskä¸Vueçš„tokenè®¤è¯","uri":"/flask%E4%B8%8Evue%E7%9A%84token%E8%AE%A4%E8%AF%81/"}]