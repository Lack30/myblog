<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title class="pjax-title">GPRC 实战 - lack 的个人博客</title><meta name="Description" content=""><meta property="og:title" content="GPRC 实战" />
<meta property="og:description" content="GRPC 简介 grpc 是由 google 开发的一款开源，高性能 rpc（远程进程调用协议）使用 Protocol Buffers 作为数据交换格式。
GRPC 安装 golang 使用 grpc 要安装 grpc-go, protoc 和 对应的插件。安装grpc-go go get -u github.com/golang/protobuf/{proto,protoc-gen-go} go get -u google.golang.org/grpc 如果是国内用户无法连接到 google.golang.org 的话可以使用 VPN。或者直接从 github.com 直接下载源代码再编译安装git clone https://github.com/grpc/grpc-go.git $GOPATH/src/google.golang.org/grpc go get -u google.golang.org/grpc 安装 protoc golang 要使用 grpc，还需要使用 protoc 工具。因为 golang 不能直接识别 .proto 文件，需要使用 protoc 工具将 .proto 转化成 golang 代码。下面介绍几个平台下安装 protobuf 的方法。macos macos 下安装直接使用 brew 命令即可。brew install protobuf linux linux 下需要先从 github.com 下载 protobuf 源码或者二进制文件，下载地址。二进制安装的话就下载 protobuf-all-*." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://xingyys.tech/posts/grpc1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-31T14:38:08+08:00" />
<meta property="article:modified_time" content="2020-07-31T14:38:08+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="GPRC 实战"/>
<meta name="twitter:description" content="GRPC 简介 grpc 是由 google 开发的一款开源，高性能 rpc（远程进程调用协议）使用 Protocol Buffers 作为数据交换格式。
GRPC 安装 golang 使用 grpc 要安装 grpc-go, protoc 和 对应的插件。安装grpc-go go get -u github.com/golang/protobuf/{proto,protoc-gen-go} go get -u google.golang.org/grpc 如果是国内用户无法连接到 google.golang.org 的话可以使用 VPN。或者直接从 github.com 直接下载源代码再编译安装git clone https://github.com/grpc/grpc-go.git $GOPATH/src/google.golang.org/grpc go get -u google.golang.org/grpc 安装 protoc golang 要使用 grpc，还需要使用 protoc 工具。因为 golang 不能直接识别 .proto 文件，需要使用 protoc 工具将 .proto 转化成 golang 代码。下面介绍几个平台下安装 protobuf 的方法。macos macos 下安装直接使用 brew 命令即可。brew install protobuf linux linux 下需要先从 github.com 下载 protobuf 源码或者二进制文件，下载地址。二进制安装的话就下载 protobuf-all-*."/>
<meta name="application-name" content="lack 的个人博客">
<meta name="apple-mobile-web-app-title" content="lack 的个人博客">

<meta name="theme-color" content="#ffffff"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="canonical" href="http://xingyys.tech/posts/grpc1/" /><link rel="prev" href="http://xingyys.tech/posts/grpc2/" /><link rel="next" href="http://xingyys.tech/posts/scst%E7%BB%93%E5%90%88fc/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.css">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "GPRC 实战",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/xingyys.tech\/posts\/grpc1\/"
        },"genre": "posts","keywords": "golang, grpc","wordcount":  774 ,
        "url": "http:\/\/xingyys.tech\/posts\/grpc1\/","datePublished": "2020-07-31T14:38:08+08:00","dateModified": "2020-07-31T14:38:08+08:00","publisher": {
            "@type": "Organization",
            "name": "作者"},"author": {
                "@type": "Person",
                "name": "作者"
            },"description": ""
    }
    </script></head>

<body header-desktop="" header-mobile=""><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme);}
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('' === 'light' || '' === 'dark' || '' === 'black') setTheme(''), saveTheme(''); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let themeColorMeta = getMeta('theme-color');
        if (document.body.getAttribute('theme') != 'light') themeColorMeta.content = '#000000';
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="lack 的个人博客">lack 的个人博客</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/about/"> 关于 </a><a class="menu-item" href="/about/" title="关于"> 关于 </a><span class="menu-item delimiter"></span><a href="#" onclick="return false;" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="lack 的个人博客">lack 的个人博客</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/about/" title="">关于</a><a class="menu-item" href="/about/" title="关于">关于</a><a href="#" onclick="return false;" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">目录</h2>
        <div class="toc-content" id="toc-content-auto"></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("pageStyle", "normal")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">GPRC 实战</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><i class="author fas fa-user-circle fa-fw"></i><a href="/" title="Author" rel=" author" class="author">作者</a>
                </span>&nbsp;<span class="post-category">收录于 </span>&nbsp;<span class="post-category">类别 <a href="/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"><i class="far fa-folder fa-fw"></i>微服务</a>&nbsp;<a href="/categories/%E4%BB%A3%E7%A0%81/"><i class="far fa-folder fa-fw"></i>代码</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2020-07-31">2020-07-31</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="2020-07-31">2020-07-31</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 774 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 4 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#安装grpc-go">安装grpc-go</a></li>
    <li><a href="#安装-protoc">安装 protoc</a>
      <ul>
        <li><a href="#macos">macos</a></li>
        <li><a href="#linux">linux</a></li>
        <li><a href="#windows">windows</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#新建项目">新建项目</a></li>
    <li><a href="#server">Server</a></li>
    <li><a href="#client">Client</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h1 id="grpc-简介">GRPC 简介</h1>
<p>grpc 是由 google 开发的一款开源，高性能 rpc（<a href="https://zh.wikipedia.org/wiki/%E9%81%A0%E7%A8%8B%E9%81%8E%E7%A8%8B%E8%AA%BF%E7%94%A8" target="_blank" rel="noopener noreffer">远程进程调用协议</a>）使用 <a href="https://developers.google.com/protocol-buffers/docs/overview" target="_blank" rel="noopener noreffer">Protocol Buffers</a> 作为数据交换格式。</p>
<p><img
        class="lazyload"
        data-src="https://raw.githubusercontent.com/xingyys/myblog/main/post/images/20201030101652.png"
        data-srcset="https://raw.githubusercontent.com/xingyys/myblog/main/post/images/20201030101652.png, https://raw.githubusercontent.com/xingyys/myblog/main/post/images/20201030101652.png 1.5x, https://raw.githubusercontent.com/xingyys/myblog/main/post/images/20201030101652.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/xingyys/myblog/main/post/images/20201030101652.png"
        title="grpc.png"
    /></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h1 id="grpc-安装">GRPC 安装</h1>
<p><!-- raw HTML omitted -->golang 使用 grpc 要安装 grpc-go, protoc 和 对应的插件。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="安装grpc-go">安装grpc-go</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">go get -u github.com/golang/protobuf/<span class="o">{</span>proto,protoc-gen-go<span class="o">}</span>
go get -u google.golang.org/grpc
</code></pre></div><p><!-- raw HTML omitted -->如果是国内用户无法连接到 google.golang.org 的话可以使用 VPN。或者直接从 github.com 直接下载源代码再编译安装<!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">git clone https://github.com/grpc/grpc-go.git <span class="nv">$GOPATH</span>/src/google.golang.org/grpc
go get -u google.golang.org/grpc
</code></pre></div><h2 id="安装-protoc">安装 protoc</h2>
<p><!-- raw HTML omitted -->golang 要使用 grpc，还需要使用 protoc 工具。因为 golang 不能直接识别 .proto 文件，需要使用 protoc 工具将 .proto 转化成 golang 代码。下面介绍几个平台下安装 protobuf 的方法。<!-- raw HTML omitted --></p>
<h3 id="macos">macos</h3>
<p><!-- raw HTML omitted -->macos 下安装直接使用 brew 命令即可。<!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">brew install protobuf
</code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="linux">linux</h3>
<p><!-- raw HTML omitted -->linux 下需要先从 github.com 下载 protobuf 源码或者二进制文件，<a href="https://github.com/protocolbuffers/protobuf/releases" target="_blank" rel="noopener noreffer">下载地址</a>。<!-- raw HTML omitted -->二进制安装的话就下载 protobuf-all-*.tar.gz 包，解压后进入生成的目录。之后执行命令：<!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">make <span class="o">&amp;&amp;</span> make install
</code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="windows">windows</h3>
<p><!-- raw HTML omitted -->下载 protobuf.all-*.zip 包，解压后再配置环境变量，将 protobuf\bin 配置到 $PATH 变量中。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h1 id="grpc使用">GRPC使用</h1>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="新建项目">新建项目</h2>
<p><!-- raw HTML omitted -->新建一个 grpc 项目，如下:<!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">../sample
└── pb
    └── echo.proto
</code></pre></div><p><!-- raw HTML omitted -->echo.proto 的内容为:<!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-protobuf" data-lang="protobuf"><span class="n">syntax</span> <span class="o">=</span> <span class="s">&#34;proto3&#34;</span><span class="p">;</span> <span class="c1">// protobuf 语法版本，默认为 proto2
</span><span class="c1">// // 这个是注释
</span><span class="c1">// .proto 所在的包路径
</span><span class="c1"></span><span class="kn">package</span> <span class="nn">sample</span><span class="o">.</span><span class="n">pb</span><span class="p">;</span><span class="err">
</span><span class="err"></span><span class="k">option</span> <span class="n">go_package</span> <span class="o">=</span> <span class="s">&#34;pb&#34;</span><span class="p">;</span><span class="err">
</span><span class="err"></span><span class="c1">// EchoRequest grpc 请求报文格式.
</span><span class="c1"></span><span class="kd">message</span> <span class="nc">EchoRequest</span> <span class="p">{</span><span class="err">
</span><span class="err"></span>  <span class="kt">string</span> <span class="kd">message</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="err">
</span><span class="err"></span><span class="p">}</span><span class="err">
</span><span class="err"></span><span class="c1">// EchoResponse grpc 响应报文格式.
</span><span class="c1"></span><span class="kd">message</span> <span class="nc">EchoResponse</span> <span class="p">{</span><span class="err">
</span><span class="err"></span>  <span class="kt">string</span> <span class="kd">message</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="err">
</span><span class="err"></span><span class="p">}</span><span class="err">
</span><span class="err"></span><span class="c1">// 定义 Echo 服务.
</span><span class="c1"></span><span class="kd">service</span> <span class="n">Echo</span> <span class="p">{</span><span class="err">
</span><span class="err"></span>  <span class="c1">// UnaryEcho 一元请求.
</span><span class="c1"></span>  <span class="k">rpc</span> <span class="n">UnaryEcho</span><span class="p">(</span><span class="n">EchoRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">EchoResponse</span><span class="p">)</span> <span class="p">{}</span><span class="err">
</span><span class="err"></span>  <span class="c1">// ServerStreamingEcho 服务端 stream 请求.
</span><span class="c1"></span>  <span class="k">rpc</span> <span class="n">ServerStreamingEcho</span><span class="p">(</span><span class="n">EchoRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">stream</span> <span class="n">EchoResponse</span><span class="p">)</span> <span class="p">{}</span><span class="err">
</span><span class="err"></span>  <span class="c1">// ClientStreamingEcho 客户端 stream 请求.
</span><span class="c1"></span>  <span class="k">rpc</span> <span class="n">ClientStreamingEcho</span><span class="p">(</span><span class="n">stream</span> <span class="n">EchoRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">EchoResponse</span><span class="p">)</span> <span class="p">{}</span><span class="err">
</span><span class="err"></span>  <span class="c1">// BidirectionalStreamingEcho 双向 stream.
</span><span class="c1"></span>  <span class="k">rpc</span> <span class="n">BidirectionalStreamingEcho</span><span class="p">(</span><span class="n">stream</span> <span class="n">EchoRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">stream</span> <span class="n">EchoResponse</span><span class="p">)</span> <span class="p">{}</span><span class="err">
</span><span class="err"></span><span class="p">}</span><span class="err">
</span></code></pre></div><p><!-- raw HTML omitted -->执行以下命令将  .proto 转化为 golang 代码:<!-- raw HTML omitted --></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">cd</span> sample
<span class="c1"># protoc -I&lt;import路径&gt; &lt;...-I$PATH&gt; --go_out=plugins=grpc:&lt;输出路径&gt; *.proto</span>
protoc -I. --go_out<span class="o">=</span><span class="nv">plugins</span><span class="o">=</span>grpc:. pb/echo.proto
</code></pre></div><p><!-- raw HTML omitted -->简单描述下 protoc 命令的功能。<!-- raw HTML omitted --></p>
<ul>
<li>-I  :  *.proto 中导入的包的路径，导入的路径为全路径格式。. 表示当前路径。</li>
<li>&ndash;go_out=plugins=grpc: ：指定 _.proto 输出的格式和路径，生成 _.go 文件的路径为  和 *.proto 的拼接。<!-- raw HTML omitted -->执行成功后成为文件 echo.pb.go 文件:</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">../sample
└── pb
    ├── echo.pb.go
    └── echo.proto
</code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="server">Server</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>
<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;context&#34;</span>
	<span class="s">&#34;errors&#34;</span>
	<span class="s">&#34;google.golang.org/grpc&#34;</span>
	<span class="s">&#34;io&#34;</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;mysite/sample/pb&#34;</span>
	<span class="s">&#34;net&#34;</span>
<span class="p">)</span>
<span class="kd">type</span> <span class="nx">server</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">pb</span><span class="p">.</span><span class="nx">EchoServer</span>
<span class="p">}</span>
<span class="c1">// 简单请求
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">server</span><span class="p">)</span> <span class="nf">UnaryEcho</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">request</span> <span class="o">*</span><span class="nx">pb</span><span class="p">.</span><span class="nx">EchoRequest</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">pb</span><span class="p">.</span><span class="nx">EchoResponse</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">EchoResponse</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span> <span class="s">&#34;echo: &#34;</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">Message</span><span class="p">},</span> <span class="kc">nil</span>
<span class="p">}</span>
<span class="c1">// 服务端流式
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">server</span><span class="p">)</span> <span class="nf">ServerStreamingEcho</span><span class="p">(</span><span class="nx">request</span> <span class="o">*</span><span class="nx">pb</span><span class="p">.</span><span class="nx">EchoRequest</span><span class="p">,</span> <span class="nx">stream</span> <span class="nx">pb</span><span class="p">.</span><span class="nx">Echo_ServerStreamingEchoServer</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="nx">_</span> <span class="p">=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">EchoResponse</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span> <span class="s">&#34;hello&#34;</span><span class="p">})</span>
	<span class="nx">_</span> <span class="p">=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">EchoResponse</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span> <span class="s">&#34; &#34;</span><span class="p">})</span>
	<span class="nx">_</span> <span class="p">=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">EchoResponse</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span> <span class="s">&#34;client&#34;</span><span class="p">})</span>
	<span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>
<span class="c1">// 客户端流式
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">server</span><span class="p">)</span> <span class="nf">ClientStreamingEcho</span><span class="p">(</span><span class="nx">stream</span> <span class="nx">pb</span><span class="p">.</span><span class="nx">Echo_ClientStreamingEchoServer</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="k">for</span> <span class="p">{</span>
      <span class="nx">recv</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">Recv</span><span class="p">()</span> <span class="c1">// block 直到有数据输出
</span><span class="c1"></span>      <span class="k">if</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// 表示消息传输完毕
</span><span class="c1"></span>        <span class="k">break</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;recv error: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">err</span>
      <span class="p">}</span>
      <span class="c1">// client 断开连接
</span><span class="c1"></span>      <span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;recv data: %v&#34;</span><span class="p">,</span> <span class="nx">recv</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span>
	<span class="p">}</span>
  <span class="c1">// SendAndClose 只存在于客户端 stream 请求
</span><span class="c1"></span>	<span class="c1">// 发送完关闭 stream
</span><span class="c1"></span>	<span class="k">return</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">SendAndClose</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">EchoResponse</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span> <span class="s">&#34;bye&#34;</span><span class="p">})</span>
<span class="p">}</span>
<span class="c1">// 双向流式
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">server</span><span class="p">)</span> <span class="nf">BidirectionalStreamingEcho</span><span class="p">(</span><span class="nx">stream</span> <span class="nx">pb</span><span class="p">.</span><span class="nx">Echo_BidirectionalStreamingEchoServer</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="c1">// 如果服务端 stream 方法退出，客户端请求也直接断开
</span><span class="c1"></span>	<span class="k">for</span> <span class="p">{</span>
      <span class="nx">recv</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">Recv</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">break</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;recv error: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">err</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="nx">recv</span><span class="p">.</span><span class="nx">Message</span> <span class="o">==</span> <span class="s">&#34;bye&#34;</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;client send done!&#34;</span><span class="p">)</span>
        <span class="k">break</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">EchoResponse</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span> <span class="s">&#34;reply: &#34;</span> <span class="o">+</span> <span class="nx">recv</span><span class="p">.</span><span class="nx">Message</span><span class="p">});</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;send message error: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">err</span>
      <span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">addr</span> <span class="o">:=</span> <span class="s">&#34;127.0.0.1:50001&#34;</span>
	<span class="c1">// grpc 为 http2 请求，传输层协议为 tcp
</span><span class="c1"></span>	<span class="nx">lis</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">net</span><span class="p">.</span><span class="nf">Listen</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span> <span class="nx">addr</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
  		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;binding at %v: %v&#34;</span><span class="p">,</span> <span class="nx">addr</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">gRPCServer</span> <span class="o">:=</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">NewServer</span><span class="p">()</span>
	<span class="nx">pb</span><span class="p">.</span><span class="nf">RegisterEchoServer</span><span class="p">(</span><span class="nx">gRPCServer</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">server</span><span class="p">{})</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">gRPCServer</span><span class="p">.</span><span class="nf">Serve</span><span class="p">(</span><span class="nx">lis</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
  		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;start grpc: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="client">Client</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>
<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;context&#34;</span>
	<span class="s">&#34;errors&#34;</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;google.golang.org/grpc&#34;</span>
	<span class="s">&#34;io&#34;</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;mysite/sample/pb&#34;</span>
<span class="p">)</span>
<span class="c1">// 简单请求
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">unaryEcho</span><span class="p">(</span><span class="nx">cli</span> <span class="nx">pb</span><span class="p">.</span><span class="nx">EchoClient</span><span class="p">,</span> <span class="nx">msg</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">recv</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cli</span><span class="p">.</span><span class="nf">UnaryEcho</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">(),</span> <span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">EchoRequest</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span> <span class="nx">msg</span><span class="p">})</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
  		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;unaryEcho %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;recv data =&gt; &#34;</span> <span class="o">+</span> <span class="nx">recv</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">// 服务端流式
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">serverStreamingEcho</span><span class="p">(</span><span class="nx">cli</span> <span class="nx">pb</span><span class="p">.</span><span class="nx">EchoClient</span><span class="p">,</span> <span class="nx">msg</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">stream</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cli</span><span class="p">.</span><span class="nf">ServerStreamingEcho</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">(),</span> <span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">EchoRequest</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span> <span class="nx">msg</span><span class="p">})</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
  		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;serverStreamingEcho %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">ctx</span> <span class="o">:=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">Context</span><span class="p">()</span>
	<span class="k">for</span> <span class="p">{</span>
      <span class="k">select</span> <span class="p">{</span>
          <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">ctx</span><span class="p">.</span><span class="nf">Done</span><span class="p">():</span>
            <span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;serverStreamingEcho done!&#34;</span><span class="p">)</span>
            <span class="k">break</span>
          <span class="k">default</span><span class="p">:</span>
      <span class="p">}</span>
      <span class="nx">msg</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">Recv</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">break</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;serverStreaming reply =&gt; &#34;</span><span class="p">,</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span>
      <span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="c1">// 客户端流式
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">clientStreamingEcho</span><span class="p">(</span><span class="nx">cli</span> <span class="nx">pb</span><span class="p">.</span><span class="nx">EchoClient</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">stream</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cli</span><span class="p">.</span><span class="nf">ClientStreamingEcho</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">())</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
      <span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;connect client Streaming: %v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
      <span class="k">return</span>
	<span class="p">}</span>
	<span class="nx">err</span> <span class="p">=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">EchoRequest</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span> <span class="s">&#34;hello&#34;</span><span class="p">})</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
      <span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;clientStreamingEcho send data: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
      <span class="k">return</span>
	<span class="p">}</span>
	<span class="nx">err</span> <span class="p">=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">EchoRequest</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span> <span class="s">&#34; &#34;</span><span class="p">})</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
      <span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;clientStreamingEcho send data: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
      <span class="k">return</span>
	<span class="p">}</span>
	<span class="nx">err</span> <span class="p">=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">EchoRequest</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span> <span class="s">&#34;world&#34;</span><span class="p">})</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
      <span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;clientStreamingEcho send data: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
      <span class="k">return</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="nx">recv</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">CloseAndRecv</span><span class="p">();</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
  		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;recv data: %v\n&#34;</span><span class="p">,</span> <span class="nx">recv</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="c1">// 双向流式
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">bidirectionalStreamingEcho</span><span class="p">(</span><span class="nx">cli</span> <span class="nx">pb</span><span class="p">.</span><span class="nx">EchoClient</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">stream</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cli</span><span class="p">.</span><span class="nf">BidirectionalStreamingEcho</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">())</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
  		<span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;bidirectionalStreamingEcho error: %v\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
  		<span class="k">return</span>
	<span class="p">}</span>
	<span class="nx">stream</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">EchoRequest</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span> <span class="s">&#34;dataset 1&#34;</span><span class="p">})</span>
	<span class="nx">recv</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">Recv</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
  		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;recv from bidirectionalStreamingEcho =&gt; %v\n&#34;</span><span class="p">,</span> <span class="nx">recv</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">stream</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">EchoRequest</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span> <span class="s">&#34;dataset 2&#34;</span><span class="p">})</span>
	<span class="nx">recv</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">Recv</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
  		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;recv from bidirectionalStreamingEcho =&gt; %v\n&#34;</span><span class="p">,</span> <span class="nx">recv</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">stream</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">EchoRequest</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span> <span class="s">&#34;dataset 3&#34;</span><span class="p">})</span>
	<span class="nx">recv</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">stream</span><span class="p">.</span><span class="nf">Recv</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
  		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;recv from bidirectionalStreamingEcho =&gt; %v\n&#34;</span><span class="p">,</span> <span class="nx">recv</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">stream</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">EchoRequest</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span> <span class="s">&#34;bye&#34;</span><span class="p">})</span>
	<span class="nx">stream</span><span class="p">.</span><span class="nf">CloseSend</span><span class="p">()</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">addr</span> <span class="o">:=</span> <span class="s">&#34;127.0.0.1:50001&#34;</span>
	<span class="nx">ctx</span><span class="p">,</span> <span class="nx">cancel</span> <span class="o">:=</span> <span class="nx">context</span><span class="p">.</span><span class="nf">WithCancel</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">())</span>
	<span class="k">defer</span> <span class="nf">cancel</span><span class="p">()</span>
	<span class="nx">conn</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">DialContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">addr</span><span class="p">,</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">WithInsecure</span><span class="p">())</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
  		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;connect %v: %v&#34;</span><span class="p">,</span> <span class="nx">addr</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">cli</span> <span class="o">:=</span> <span class="nx">pb</span><span class="p">.</span><span class="nf">NewEchoClient</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
	<span class="nf">unaryEcho</span><span class="p">(</span><span class="nx">cli</span><span class="p">,</span> <span class="s">&#34;hello&#34;</span><span class="p">)</span>
	<span class="nf">serverStreamingEcho</span><span class="p">(</span><span class="nx">cli</span><span class="p">,</span> <span class="s">&#34;hello&#34;</span><span class="p">)</span>
	<span class="nf">clientStreamingEcho</span><span class="p">(</span><span class="nx">cli</span><span class="p">)</span>
	<span class="nf">bidirectionalStreamingEcho</span><span class="p">(</span><span class="nx">cli</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2020-07-31</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/golang/">golang</a>,&nbsp;<a href="/tags/grpc/">grpc</a></section>
        <section>
            <span><a href="#" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/grpc2/" class="prev" rel="prev" title="GPRC 进阶"><i class="fas fa-angle-left fa-fw"></i>GPRC 进阶</a>
            <a href="/posts/scst%E7%BB%93%E5%90%88fc/" class="next" rel="next" title="Scst结合FC">Scst结合FC<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.87.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreffer" title="DoIt 0.2.10"><i class="far fa-edit fa-fw"></i> DoIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank" rel="noopener noreferrer"></a></span></div>
        </div></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="回到顶部">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/topbar/topbar.min.js"></script><script type="text/javascript" src="/lib/pjax/pjax.min.js"></script><script type="text/javascript" src="/js/theme.min.js"></script></div>

<div class="pjax-assets"><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{}};</script></div>
</body>

</html>