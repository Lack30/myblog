---
title: "C语言学习"
date: 2022-02-15T15:08:35+08:00
lastmod: 2022-02-15T15:08:35+08:00
draft: true
tags:
  - C
categories:
  - 笔记
author: "Lack"
---

# 存储类别

`对象`(object) 是指存储数据的物理内存。

`标识符`(identifier) 是指定特定对象内容的方式。

`存储期`(storage duration) 是指对象在内存中保留了多长时间。C 对象有 4 中存储器:

- 静态存储期
- 线程存储期
- 自动存储期
- 动态分配存储期

存储期用来描述对象，标识符用于访问对象，可以用作用域(scope)和链接(linkage)描述标识符，标识符的作用域和链接表明了程序的哪些部分可以使用它。

`作用域`(scope) 描述程序中可访问标识符的区域: 一个 C 变量的作用域可以是:

- 块作用域
- 函数作用域
- 函数原型作用域
- 文件作用域

`块`(block)是用一对花括号括起来的代码区域。

C 变量有 3 种链接属性:

- 外部链接
- 内存链接
- 无链接

具有块作用域、函数作用域或函数原型作用域的变量都是无链接变量。这意味着这些变量属于定义它们的块、函数或原型私有。

具有文件作用域的变量可以是外部链接或内存链接。外部链接变量可以在多文件程序中使用，内部链接变量只能在一个翻译单元 (即一个源代码文件和它所包含的头文件) 中使用。

> C 标准用 “内部链接的文件作用域” 描述仅限于一个翻译单元的作用域，用 “外部链接的文件作用域” 描述可延伸至其他翻译单元的作用域。“内部链接的文件作用域” 可简称为 “文件作用域”，“外部链接的文件作用域” 简称为 “全局作用域” 或 “程序作用域”

使用表格说明：

| 存储类别     | 存储期 | 作用域 | 链接 | 声明方式                      |
| ------------ | ------ | ------ | ---- | ----------------------------- |
| 自动         | 自动   | 块     | 无   | 块内                          |
| 寄存器       | 自动   | 块     | 无   | 块内，使用关键字 register     |
| 静态外部链接 | 静态   | 文件   | 外部 | 所有函数外                    |
| 静态内部链接 | 静态   | 文件   | 内部 | 所有函数外，使用关键字 static |
| 静态无连接   | 静态   | 块     | 无   | 块内，使用关键字 static       |

# 内存分配

静态数据在程序载入内存时分配，而自动数据在程序执行块是分配，并在程序离开块时销毁。

## malloc 和 free

`malloc()` 函数用于分配内存。

```C
#include <stdlib.h>

int main(void) {
    double *ptd;

    ptd = (double *) malloc(30 * sizeof(double));

    return 0;
}
```

如果 `malloc()` 返回值为 `NULL`，表示执行失败

和 `malloc()` 对应的是 `free()` 函数，表示释放指针所指向的内存。

```C
#include <stdlib.h>

int main(void) {
    double *ptd;

    ptd = (double *) malloc(30 * sizeof(double));

    free(ptd);

    return 0;
}
```

`malloc()` 和 `free()` 函数的原型都在 `stdlib.h` 头文件中。

## calloc 函数

`calloc()` 函数和 `malloc()` 函数类似，也是用于分配内存，用法如下:

```C
long * newmem;
newmem = (long *) calloc(100, sizeof(long));
```
`free()` 也可以用于释放 `calloc()` 分配的内存。